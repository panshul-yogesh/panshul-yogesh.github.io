{
  "title": "Upgrade OO Containerized on EKS and AKS",
  "content": "<div class=\"mw-parser-output\"><p>This topic outlines steps to upgrade OO Containerized on Amazon EKS and Microsoft AKS using managed Kubernetes from 25.2 to 25.3.</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>The upgrade process may take 20 to 30 minutes based on the number of tenants, which may impact flow execution.</div></div></div>\n<h2>Prerequisites for upgrade</h2>\n<p>The following sections list the prerequisite steps to upgrade OO Containerized.</p>\n<h3>Download OO chart</h3>\n<p>You can download the OO chart from the <a href=\"https://sld.microfocus.com/mysoftware/index\" title=\"Software Licenses and Downloads (SLD)\">Software Licenses and Downloads (SLD)</a> website.</p>\n<p>After downloading the OO Containerized package from either location, copy and unzip the downloaded file to a temporary directory on the Bastion host.</p>\n<p>If you downloaded from the Software Licenses and Downloads portal:</p>\n<p>Unzip the OO Containerized package:</p>\n<pre><code>cd /path/to/oo_package_zip\nunzip oo-helm-charts-1.x.x+26.x.x.zip</code></pre>\n<p>The OO chart contains the following files:</p>\n<table title=\"\">\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Name</p>\n</th>\n<th scope=\"col\">\n<p>File</p>\n</th>\n</tr>\n<tr>\n<td>\n<p>OO Helm chart file</p>\n</td>\n<td>\n<p><code>oo-helm-charts-1.x.x+26.x.x/oo-helm-charts/charts/oo-1.x.x+26.x.x.tgz</code></p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Example Persistent Volume (PV) and Persistent Volume Claims (PVC) yaml files</p>\n</td>\n<td>\n<p>PV templates:<br/>\n<code>oo-helm-charts-1.x.x+26.x.x/oo-helm-charts/samples/persistent_storage/volumes.yaml</code><br/>\n<br/>\n\t\t\tPVC templates:<br/>\n<code>oo-helm-charts-1.x.x+26.x.x/oo-helm-charts/samples/persistent_storage/claims.yaml</code><br/>\n<br/>\n<strong>README</strong> file for PV:<br/>\n<code>oo-helm-charts-1.x.x+26.x.x/oo-helm-charts/samples/persistent_storage/README</code></p>\n</td>\n</tr>\n</thead>\n</table>\n<h3>Download and upload new OO images</h3>\n<ul>\n<li>If you deployed the suite on EKS, follow the steps provided in the topic <a href=\"/doc/423/26.1/399-downloaduploadooccontainerimage\" title=\"Download and upload container images for OO\">Download and upload OO container images</a>, by generating the download bundle for the OO Containerized 25.3 Helm chart.</li>\n<li>If you deployed the suite on AKS, follow the steps provided in the topic <a href=\"/doc/423/26.1/399-downloadinstallationimagesoo\" title=\"Download container images for OO (AKS)\">Download container images for OO (AKS)</a>, by generating the download bundle for the OO Containerized 25.3 Helm chart.</li>\n</ul>\n<h3>Get values.yaml file and update</h3>\n<p>In the following commands, the command line tool <strong>yq</strong> is part of the OPTIC Management Toolkit (OMT), available in the <code>/opt/cdf/bin/yq</code> directory. Make sure that the version of <strong>yq</strong> is 4.6.1. </p>\n<ol>\n<li>Run the following command to get <strong>values.yaml</strong> file from the previous OO deployment. \n\n\t<pre><code>helm get values &lt;oo_install_name&gt; -n &lt;oo_namespace&gt; &gt; /path/to/previous_deployment_values.yaml</code></pre>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>Check the newly added parameters on the <a href=\"/doc/423/26.1/399-ooccreateymleks\" title=\"Create values.yaml for OO on EKS\">Create values.yaml for OO Containerized on EKS</a> and <a href=\"/doc/423/26.1/399-createconfigureyaml\" title=\"Create values.yaml for OO (AKS)\">Create values.yaml for OO on AKS</a> pages to understand if other values than the default ones are required to be configured.</div></div></div>\n</li>\n<li>Run the following command on the control plane node/bastion host to clean old image versions from <code>previous_deployment_values.yaml</code>. \n\t<pre>    <code>\n&lt;OMT_install_directory&gt;/bin/yq eval 'del(.global.busybox)' -i /path/to/previous_deployment_values.yaml\n&lt;OMT_install_directory&gt;/bin/yq eval 'del(.global.opensuse)' -i /path/to/previous_deployment_values.yaml\n&lt;OMT_install_directory&gt;/bin/yq eval 'del(.global.vaultRenew)' -i /path/to/previous_deployment_values.yaml\n&lt;OMT_install_directory&gt;/bin/yq eval 'del(.global.vaultInit)' -i /path/to/previous_deployment_values.yaml\n&lt;OMT_install_directory&gt;/bin/yq eval 'del(.. | select(has(\"image\")).image)' -i /path/to/previous_deployment_values.yaml\n&lt;OMT_install_directory&gt;/bin/yq eval 'del(.. | select(has(\"imageTag\")).imageTag)' -i /path/to/previous_deployment_values.yaml\n&lt;OMT_install_directory&gt;/bin/yq eval 'del(.ootenants-sync.version)' -i /path/to/previous_deployment_values.yaml</code>\n    </pre>\n</li>\n<li>(<strong>Amazon EKS only</strong>) Add the Service Management internal IDM URL to the <strong>previous_deployment_values.yaml</strong> file. If Service Management and OO are deployed on EKS, then, as part of installing OO, you have created an integration load balancer that facilitates the internal communication between Service Management and OO - see <a href=\"/doc/oo_containerized/main/configurealbeksooc#Configure_integration_Application_Load_Balancer\" title=\"Create application load balancer for integration\">Create application load balancer for integration</a>. Run the following command to add the internal Service Management IDM URL to the <strong>previous_deployment_values.yaml</strong> file:\n\t<pre><code>&lt;OMT_install_directory&gt;/bin/yq e '.global.idm.idmServiceUrl = \"https://&lt;int_lb_fqdn&gt;:&lt;sma_ingress_listener_port&gt;/idm-service\"' -i /path/to/previous_deployment_values.yaml</code></pre>\n\tWhere:<br/>\n\t&lt;<code>INT_LB_FQDN</code>&gt; is the FQDN of the integration load balancer. For details, see <a href=\"/doc/oo_containerized/main/configurealbeksooc#Integration_Bind_an_FQDN_with_ALB\" title=\"Bind an FQDN with the integration ALB\">Bind an FQDN with the integration ALB</a>.<br/>\n\t&lt;<code>SMA_INGRESS_LISTENER_PORT</code>&gt; is the listener port defined for the Service Management ingress.<br/>\n\tThe Service Management ingress listener port number specified in the  <a href=\"/doc/oo_containerized/main/configurealbeksooc#Configure_integration_Application_Load_Balancer\" title=\"Create application load balancer for integration\">Create application load balancer for integration</a> is 2443. If you use a different port, you must use that port in the command. <br/>\n\tFor example:\n\t<pre><code>&lt;OMT_install_directory&gt;/bin/yq e '.global.idm.idmServiceUrl = \"https://int.example.com:2443/idm-service\"' -i /path/to/previous_deployment_values.yaml</code></pre>\n</li>\n<li>(<strong>Amazon EKS only</strong>) Verify that the internal URL of accessing Service Management IDM was correctly added to the <strong>previous_deployment_values.yaml</strong> file:\n\t<pre>cat /path/to/previous_deployment_values.yaml</pre>\n\tIf the command to add the internal Service Management IDM URL was successful, you should see the following in the <strong>previous_deployment_values.yaml</strong> file:\n\n\t<pre>[user@host values]# cat <code>/path/to/previous_deployment_values.yaml</code>\nglobal:\n[...]\n  idm:\n    idmServiceUrl: https://int.example.com:2443/idm-service\n[...]</pre>\n</li>\n<li><span id=\"cke_bm_3230S\" style=\"display: none;\"> </span>Run the following commands on the control plane node/bastion host to get <code>autopass</code> database name and user using the OO Containerized <strong>values.yaml</strong> file:\n\t<pre><code>APLSDBNAME=$(echo `&lt;OMT_install_directory&gt;/bin/yq e '.autopass.deployment.database.dbName' /path/to/previous_deployment_values.yaml`) &amp;&amp; echo $APLSDBNAME\nAPLSDBUSER=$(echo `&lt;OMT_install_directory&gt;/bin/yq e '.autopass.deployment.database.user' /path/to/previous_deployment_values.yaml`) &amp;&amp; echo $APLSDBUSER</code></pre>\n</li>\n<li><span id=\"cke_bm_5435S\" style=\"display: none;\"> </span>Run the following commands on the control plane node/bastion host to get <code>autopass-migration</code> database name and user using the OO Containerized <strong>values.yaml</strong> file:\n\t<pre><code>APLSMIGRATIONDBNAME=$(echo `&lt;OMT_install_directory&gt;/bin/yq e '.autopass-migration.deployment.database.dbName' /path/to/previous_deployment_values.yaml`) &amp;&amp; echo $APLSMIGRATIONDBNAME \nAPLSMIGRATIONDBUSER=$(echo `&lt;OMT_install_directory&gt;/bin/yq e '.autopass-migration.deployment.database.user' /path/to/previous_deployment_values.yaml`) &amp;&amp; echo $APLSMIGRATIONDBUSER</code></pre>\n</li>\n<li>Compare <code>autopass</code> and <code>autopass-migration</code> database name and user:\n\t<pre><code>[[ $APLSDBNAME == $APLSMIGRATIONDBNAME ]] &amp;&amp; echo \"Values of autopass db name and autopass migration db name is same.\"\n[[ $APLSDBUSER == $APLSMIGRATIONDBUSER ]] &amp;&amp; echo \"Values of autopass db user and autopass migration db user is same.\"</code></pre>\n<p>If the output of the command shows as below, skip the following steps.</p>\n<pre><code>The values of AutoPass database name and AutoPass migration database name is the same.\nThe values of AutoPass database user and AutoPass migration database user is the same.</code></pre>\n</li>\n<li>Update database connection information in the <code>autopass-migration</code> section of the yaml file. Run the following commands on the control plane node/bastion host:\n\t<pre><code>&lt;OMT_install_directory&gt;/bin/yq e '.autopass-migration.deployment.database.dbName = \"'${APLSDBNAME}'\"' -i /path/to/previous_deployment_values.yaml\n&lt;OMT_install_directory&gt;/bin/yq e '.autopass-migration.deployment.database.user = \"'${APLSDBUSER}'\"' -i /path/to/previous_deployment_values.yaml</code></pre>\n</li>\n<li>Verify that the <strong>previous_deployment_values.yaml</strong> file was updated correctly. Run the following command on the control plane node/bastion host: \n\t<pre><code>cat /path/to/previous_deployment_values.yaml</code></pre>\n<p>You should see the following update in the <strong>previous_deployment_values.yaml</strong> file:</p>\n<pre><code>[user@host values]# cat /path/to/previous_deployment_values.yaml\nglobal:\n  [...]\nautopass-migration: \n  [...]\n  deployment:\n    database:\n      dbName: &lt;aplsdbname&gt;\n      user: &lt;aplsdbuser&gt;\n[...]</code></pre>\n</li>\n</ol>\n<h3>Create temporary cluster nodes for OO</h3>\n<p>OO Containerized upgrade is a rolling update. You require additional cluster nodes for deploying the new pods. Add one additional node in the EKS/AKS group of OO Containerized to ensure that the rolling update isn't stuck in a pending state for additional resources. After the upgrade is complete, you can scale back the EKS/AKS node group.</p>\n<h2>Upgrade OO Containerized</h2>\n<p>The upgrade consists of three stages:</p>\n<ul>\n<li><strong>Pre-upgrade hooks</strong>: Three Kubernetes jobs run first. These are responsible for upgrading the databases of the OO components and tailoring some IDM resources.<br/>\n\tIf these jobs run successfully, the upgrade process continues with rolling out the new version of OO pods. <br/>\n\tIf these jobs fail, the upgrade process stops.</li>\n<li><strong>Rolling update</strong>: This is the stage where the OO pods are upgraded to the new version through a rolling update strategy. </li>\n<li><strong>Post upgrade</strong>: A Kubernetes job runs as soon as the pre-upgrade hooks complete, and waits until all the OO components are rolled out to the new version before it runs. Its purpose is to upgrade all OO RAS pods in the OO namespace in a sequential order. This step takes about 5 minutes per RAS.</li>\n</ul>\n<p>To upgrade OO Containerized, follow these steps:</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>Don't run any OO flows when you're upgrading OO Containerized.</div></div></div>\n<ol>\n<li>\n<p>Run the following command to upgrade OO Containerized: </p>\n<pre><code>helm upgrade &lt;oo_install_name&gt; -n &lt;oo_namespace&gt; &lt;OO_chart_file&gt; -f &lt;previous_deployment_values.yaml&gt; --timeout 30m</code></pre>\n<p>Where:<br/>\n\t&lt;<code>oo_install_name</code>&gt; is the name of the OO deployment that you specified when installing OO.<br/>\n\t&lt;<code>oo_namespace</code>&gt; is the unique namespace of the OO deployment.<br/>\n\t&lt;<code>OO_chart_file</code>&gt; is the new tar file containing the OO installation charts.<br/>\n\t&lt;<code>previous_deployment_values.yaml-path</code>&gt; is an absolute path of previous_deployment_values.yaml file.</p>\n<p>For example:</p>\n<pre><code>helm upgrade oo-prod -n oo oo-helm-charts-1.x.x+26.x.x/oo-helm-charts/charts/oo-1.x.x+26.x.x.tgz -f /path/to/previous_deployment_values.yaml --timeout 30m</code></pre>\n<p>You can run this command with the <code>--dry-run</code> an argument to simulate an upgrade.</p>\n<p>On successful completion of pre-upgrade hooks, you will see a message similar to the following. Completing pre-upgrade hooks takes about 3 to 4 minutes.</p>\n<pre>    <code>\nRelease \"&lt;oo_install_name&gt;\" has been upgraded. Happy Helming!\n\n[...]\n\nThank you for installing OpenText Operations Orchestration - 2*.*.\n\nThe deployment is in progress, you can check the status using the following command:\n   `watch kubectl get pods -n &lt;oo_namespace&gt;`\n\n*********************************************************************************\n** WARNING:                                                                    **\n**                                                                             **\n**  1. If you referenced a values.yaml file for installing OO, you must        **\n**  manage access to this file carefully as it contains sensitive information. **\n**  OpenText recommends restricting access by leveraging file permissions,     **\n**  by moving the file to a secure location, or by simply deleting the file.   **\n**  Failing to secure values.yaml may expose the system to increased           **\n**  security risks. You understand and agree to assume all associated risks    **\n**  and hold OpenText harmless for the same. It always remains the             **\n**  Customer's sole responsibility to assess its own regulatory and business   **\n**  requirements. OpenText does not represent or warrant that its              **\n**  products comply with any specific legal or regulatory standards            **\n**  applicable to Customer in conducting Customer's business.                  **\n**                                                                             **\n*********************************************************************************\n    </code>\n    </pre>\n<p>After completing pre-upgrade hooks, Helm starts upgrading OO components.</p>\n</li>\n<li>\n<p>Run the following command to make sure that all OO pods are ready. If the command returns a blank output, then all OO pods are ready.</p>\n<pre>kubectl get pod -n &lt;oo_namespace&gt; |grep -v 1/1|grep -v 2/2|grep -v 3/3|grep -v Completed</pre>\n</li>\n<li>\n<p>(<strong>Azure AKS only</strong>) Once all the pods are ready, run the following commands to configure the OO load balancer.</p>\n<p>Run the following command to assign an external IP address for the OO load balancer:</p>\n<pre>kubectl patch services &lt;itom-ingress-controller-svc-name&gt; -p '{\"metadata\":{\"annotations\":{\"service.beta.kubernetes.io/azure-load-balancer-internal\": \"true\"}},\"spec\":{\"type\":\"LoadBalancer\"}}' -n &lt;OO namespace&gt;\n</pre>\n<p>Run the following command until the command output displays the load balancer's external IP address, instead of \"<strong>Pending</strong>\":</p>\n<pre>kubectl get svc &lt;itom-ingress-controller-svc-name&gt; -n &lt;OO NAMESPACE&gt;</pre>\n<p>Where:<br/>\n\t&lt;<code>OO namespace</code>&gt; is the unique namespace of the OO deployment.<br/>\n\t&lt;<code>itom-ingress-controller-svc-name</code>&gt; is the ingress controller service name. Run the following command to get the ingress controller service name</p>\n<pre>INGRESS_SERVICE=$(echo `kubectl get svc -n &lt;OO namespace&gt; | grep -m1 itom-ingress-controller-svc | head -1 | awk '{print $1}'`) &amp;&amp; echo $INGRESS_SERVICE</pre>\n</li>\n<li>\n<p>Access the OO page at <strong>https://&lt;EXTERNAL_ACCESS_HOST&gt;:&lt;EXTERNAL_ACCESS_PORT&gt;/oo</strong> and ensure that the OO Containerized state is fully up. </p>\n</li>\n</ol>\n<h2>Related topic</h2>\n<p>To fix the \"<code>[OO RAS error] Must define value for all six parameters</code>\"  error during the upgrade, see <a href=\"/doc/423/26.1/ooraserror\" title=\"Upgrade fails with [OO RAS] Error: Must define value for all six parameters\">Must define value for all six parameters</a>.</p>\n</div>",
  "modifiedon": "2025-11-21 07:16:02"
}