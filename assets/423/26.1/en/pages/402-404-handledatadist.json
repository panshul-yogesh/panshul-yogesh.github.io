{
  "title": "Enable OPTIC Data Lake Message Bus data distribution",
  "content": "<div class=\"mw-parser-output\">\n \n\n<p>Skip this topic if you are installing on-premises or on-cloud in a single zone.</p>\n<p>This topic gives steps to enable OPTIC Data Lake Message Bus data distribution across multiple zones for embedded or external <span class=\"nanospell-typo\">Kubernetes</span> deployment where the worker nodes are in different zones.</p>\n<p>OPTIC Data Lake Message Bus stores the data temporarily before it's loaded to the <span class=\"nanospell-typo\">Vertica</span> database. The volumes provisioned for the OPTIC Data Lake Message Bus store this data. The <span class=\"nanospell-typo\">BookKeeper</span> (Bookies) stores the messages forwarded to the OPTIC Data Lake Message Bus. The message gets written to two Bookies which helps to avoid data loss when a Bookie or node crashes in the deployment. It's necessary to set a placement policy to ensure the data replicas are placed on Bookies in different zones.</p>\n<p>In an <span class=\"nanospell-typo\">AWS</span> deployment, the data replicas <span class=\"mstp_suggestion_5_359_374\">are distributed</span> across different zones by default. This helps to avoid data loss when there is a zone failure. In an embedded <span class=\"mstp_error_5_165_176\"><span class=\"nanospell-typo\">Kubernetes</span></span> deployment, the data distributions are across different nodes and avoid data loss when there is a node failure. In external or embedded <span class=\"nanospell-typo\">Kubernetes</span> deployment, if the nodes are distributed across different data centers to avoid data loss, you must configure the data distribution and data placement policy.</p>\n<p>If the data placement policy isn't configured, the OPTIC Data Lake Message Bus Bookies are grouped without any order. That means, two Bookies from the same availability zone are grouped together for data replication in OPTIC Data Lake Message Bus. In such cases, if a zone fails, there will be data loss. The following image explains the data distribution across the zones:</p>\n<p>As seen in the image, you have <em>Zone-1</em> with <em>Bookie-1a</em>, <em>Bookie-1b, </em><em>Zone-2</em> with <em>Bookie-2a</em>, <em>Bookie-2b,</em> and <em>Zone-3</em> with <em>Bookie-3a</em> and <em>Bookie-3b</em>. In <em>Zone-1</em>, <em>Bookie-1a</em> can replicate the data to <em>Bookie-1b</em>. If you haven't set the placement policy, when there's a failure in <em>Zone-1</em>, there is data loss. </p>\n<div><a class=\"image\" href=\"\"> <img alt=\"OPTICDL_23\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/7/78/OPTICDL_23.4_DataDistrbNO.png\" hspace=\"0\" src=\"../../../images/OPTICDL_23.4_DataDistrbNO_a93eef0b.png\" style=\"width:799px;height:362px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\"/> </a></div>\n<p>If you have set the placement policy, in the case of failure in <em>Zone-1</em>, the replica <code><span class=\"nanospell-typo\">msg</span></code> is in <em>Bookie-3a</em> and ensures there is no data loss as follows:</p>\n<div><a class=\"image\" href=\"\"> <img alt=\"OPTICDL_23\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/8/84/OPTICDL_23.4_DataDistrb.png\" hspace=\"0\" src=\"../../../images/OPTICDL_23.4_DataDistrb_6a0da0b6.png\" style=\"width:800px;height:365px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\"/> </a></div>\n<p>The nodes must have <code>topology.<span class=\"nanospell-typo\">kubernetes</span>.io/zone</code> label to reflect the data center it belongs to. Following is the command to add <code>zone</code> label on a <span class=\"nanospell-typo\">Kubernetes</span> node:</p>\n<pre><span class=\"nanospell-typo\">kubectl</span> label nodes &lt;node_name&gt; topology.<span class=\"nanospell-typo\">kubernetes</span>.io/zone=&lt;data center identifier&gt;</pre>\n<p>For example, if the <span class=\"nanospell-typo\">Kubernetes</span> node name is <code>mynode1.domain.net</code> and data center identifier for the node is <code><span class=\"nanospell-typo\">india</span>-<span class=\"nanospell-typo\">blr</span>-1a</code>, then the command will be:</p>\n<pre><span class=\"nanospell-typo\">kubectl</span> label nodes mynode1.domain.net topology.<span class=\"nanospell-typo\">kubernetes</span>.io/zone=<span class=\"nanospell-typo\">india</span>-<span class=\"nanospell-typo\">blr</span>-1a</pre>\n<p>To get the zone information of each of the nodes, run the command:</p>\n<pre><span class=\"nanospell-typo\">kubectl</span> get nodes --label-columns topology.<span class=\"nanospell-typo\">kubernetes</span>.io/zone\n</pre>\n<p>The <code>global.<span class=\"nanospell-typo\">rbac</span>.<span class=\"nanospell-typo\">clusterRoleCreate</span></code> parameter with value <code>true</code> along with <code><span class=\"nanospell-typo\">itomdipulsar</span>.<span class=\"nanospell-typo\">configureDataplacementPolicy</span></code> as <code>true</code> configures the data placement policy. You must set these helm parameters while deploying the application to achieve the data distribution. To set the data placement policy, the application requires cluster level permission to get and list nodes in the cluster. In an external <span class=\"nanospell-typo\">Kubernetes</span> scenario, applications may not have cluster level permissions. In such cases, the placement policy must be manually configured to avoid data loss in the event of zone failure. </p>\n<p>To manually enable the data distribution across the zones and configure the data placement policy, you must run the <code>configure-<span class=\"nanospell-typo\">dataplacement</span>-policy.sh</code> script. You can locate the script in the <code><span class=\"nanospell-typo\">itomdipulsar</span>-bastion-0</code> pod. Follow these steps on the master or the bastion node to manually configure the data placement policy:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to copy the <code>configure-<span class=\"nanospell-typo\">dataplacement</span>-policy.sh</code> script to the master node:\n\n\t<pre><span class=\"nanospell-typo\">kubectl</span> -n &lt;application <span class=\"nanospell-typo\">namespace</span>&gt; cp <span class=\"nanospell-typo\">itomdipulsar</span>-bastion-0:/pulsar/di-tools/configure-<span class=\"nanospell-typo\">dataplacement</span>-policy.sh -c pulsar configure-<span class=\"nanospell-typo\">dataplacement</span>-policy.sh</pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to execute the script:\n\t<pre>sh ./configure-<span class=\"nanospell-typo\">dataplacement</span>-policy.sh -n &lt;application <span class=\"nanospell-typo\">namespace</span>&gt;</pre>\n</li></ol>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-tip-icon\"></div><div class=\"admonition-content admonition-tip-content\"><div>To view the script <code>configure-<span class=\"nanospell-typo\">dataplacement</span>-policy.sh</code> options, run the command: <code>sh .</code><code>/configure-<span class=\"nanospell-typo\">dataplacement</span>-policy</code><code>.sh -h</code></div></div></div>\n<ol style=\"padding-left: 0px;\"></ol>\n</div>",
  "modifiedon": "2026-01-30 13:56:46"
}