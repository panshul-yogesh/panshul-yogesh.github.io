{
  "title": "Create persistent volumes",
  "content": "<div class=\"mw-parser-output\">\n<p class=\"mw-empty-elt\">Persistent volumes (<span class=\"nanospell-typo\">PVs</span>) are used to manage storage in your cluster. They are provisioned dynamically using storage class. When you install <span class=\"nanospell-typo\">OMT</span> with <span class=\"nanospell-typo\">NFS</span> <span class=\"nanospell-typo\">provisioner</span> capability, the <span class=\"nanospell-typo\">NFS</span> <span class=\"nanospell-typo\">provisioner</span> creates a storage class, <code><span class=\"nanospell-typo\">cdf</span>-<span class=\"nanospell-typo\">nfs</span></code>. This storage class is used to create the volumes dynamically.</p>\n<h2><a id=\"Embedded_Kubernetes\" name=\"Embedded_Kubernetes\" title=\"Embedded Kubernetes\"></a><a id=\"Embedded-Kubernetes\" name=\"Embedded-Kubernetes\" title=\"Embedded Kubernetes\"></a>Embedded <span class=\"nanospell-typo\">Kubernetes</span></h2>\n<p>For embedded <span class=\"nanospell-typo\">Kubernetes</span>, you can create the persistent volumes automatically or manually.</p>\n<h3><a id=\"Create_persistent_volumes_automatically\" name=\"Create_persistent_volumes_automatically\" title=\"Create persistent volumes automatically\"></a><a id=\"Create-persistent-volumes-automatically\" name=\"Create-persistent-volumes-automatically\" title=\"Create persistent volumes automatically\"></a>Create persistent volumes automatically</h3>\n<p>To create persistent volumes automatically, you must have installed <span class=\"nanospell-typo\">OMT</span> with <span class=\"nanospell-typo\">NFS</span> <span class=\"nanospell-typo\">provisioner</span> capability. Then, while you configure the Operations Platform <code>values.<span class=\"nanospell-typo\">yaml</span></code> file, set the <code>persistence:enabled</code> parameter value to <code>true</code>. This creates the required <span class=\"nanospell-typo\">PVs</span> for you. For more information, see <a href=\"/doc/423/26.1/402-valuesyamlforopsplatform\" title=\"Configure values.yaml\">Configure values <span class=\"nanospell-typo\">YAML</span> file</a>.</p>\n<h3><a id=\"Create_persistent_volumes_manually\" name=\"Create_persistent_volumes_manually\" title=\"Create persistent volumes manually\"></a><a id=\"Create-persistent-volumes-manually\" name=\"Create-persistent-volumes-manually\" title=\"Create persistent volumes manually\"></a>Create persistent volumes manually</h3>\n<p>If you have not installed <span class=\"nanospell-typo\">OMT</span> with <span class=\"nanospell-typo\">NFS</span> <span class=\"nanospell-typo\">provisioner</span> capability, you must create three persistent volumes for the application upfront.</p>\n<p>To create Persistent volumes, perform the following tasks:</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>Give the <span class=\"nanospell-typo\">FQDN</span> of the <span class=\"nanospell-typo\">NFS</span> server and the <span class=\"nanospell-typo\">NFS</span> directory path that you used while configuring the <span class=\"nanospell-typo\">NFS</span> server.</div>\n<div><strong>Do not edit any names or labels or change any indentation in the <span class=\"nanospell-typo\">yaml</span> file.</strong></div>\n<div>You can update the required values and retain the <span class=\"nanospell-typo\">yaml</span> syntax.</div></div></div>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Connect to the Control Plane node.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create a file with the name <code>pv.<span class=\"nanospell-typo\">yaml</span></code> and copy the following lines:\n\t<pre><code>NFS_FQDN=&lt;YOUR_NFS_SERVER&gt;\nfor i in {1..4}; do\n    mkdir \"/var/vols/itom/opvol$i\"\n    chown 1999:1999 \"/var/vols/itom/opvol$i\"\n    chmod g+w+s \"/var/vols/itom/opvol$i\"\n    kubectl apply -f - &lt;&lt;&lt;\"\n        apiVersion: v1\n        kind: PersistentVolume\n        metadata:\n          name: opvol$i\n        spec:\n          accessModes:\n            - ReadWriteMany\n          capacity:\n            storage: 10Gi\n          nfs:\n            path: /var/vols/itom/opvol$i\n            server: $NFS_FQDN\n          persistentVolumeReclaimPolicy: Retain\n          storageClassName: &lt;your storage class&gt;\n          volumeMode: Filesystem\n        \"\n     echo \"done till here\"\ndone</code></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">To create persistent volumes, run the following command:\n\t<pre><span class=\"nanospell-typo\">kubectl</span> create -f pv.<span class=\"nanospell-typo\">yaml</span></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">To verify volume creation, run the following command:\n\t<pre><span class=\"nanospell-typo\">kubectl</span> get pv</pre>\n</li></ol>\n<h2><a id=\"EKS\" name=\"EKS\" title=\"EKS\"></a><span class=\"nanospell-typo\">EKS</span></h2>\n<p>To create persistent volumes manually for Amazon Elastic <span class=\"nanospell-typo\">Kubernetes</span> Service (<span class=\"nanospell-typo\">EKS</span>).</p>\n<p>On <span class=\"nanospell-typo\">AWS</span>, the <a href=\"https://console.aws.amazon.com/efs/home\" target=\"_blank\" title=\"EFS Service\"><span class=\"nanospell-typo\">EFS</span> Service</a> provides <span class=\"nanospell-typo\">NFS</span> in specific regions. See the <a href=\"https://docs.aws.amazon.com/efs/latest/ug/mounting-fs-mount-cmd-dns-name.html\" target=\"_blank\" title=\"AWS documentation\"><span class=\"nanospell-typo\">AWS</span> documentation</a> and adjust the mount path if you use a different one.</p>\n<p>To create the required <span class=\"nanospell-typo\">PVs</span> required, connect to the bastion node in your <span class=\"nanospell-typo\">VPC</span> with <span class=\"nanospell-typo\">SSH</span>.</p>\n<p>Run the following commands to create volumes by replacing the <span class=\"nanospell-typo\">NFS</span> <span class=\"nanospell-typo\">DNS</span> with the <span class=\"nanospell-typo\">EFS</span> <span class=\"nanospell-typo\">DNS</span> name:</p>\n<pre><code>NFS_FQDN=&lt;EFS_NFS_DNS&gt;\n\nfor i in {1..4}; do\n    sudo mkdir -p \"&lt;EFS mount path&gt;/var/vols/itom/opvol$i\"\n    sudo chown 1999:1999 \"&lt;EFS mount path&gt;/var/vols/itom/opvol$i\"\n    sudo chmod g+w+s \"&lt;EFS mount path&gt;/var/vols/itom/opvol$i\"\n    kubectl apply -f - &lt;&lt;&lt;\"\n        apiVersion: v1\n        kind: PersistentVolume\n        metadata:\n          name: opvol$i\n        spec:\n          accessModes:\n            - ReadWriteMany\n          capacity:\n            storage: 10Gi\n          nfs:\n            path: /var/vols/itom/opvol$i\n            server: $NFS_FQDN\n          persistentVolumeReclaimPolicy: Retain\n          storageClassName: op-default\n          volumeMode: Filesystem\n        \"\ndone</code></pre>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>The value <code>1999:1999</code> represents the <code>user:group</code> <span class=\"nanospell-typo\">IDs</span> that containers use to run as part of Operations Platform. If you change the <code>user:group</code> <span class=\"nanospell-typo\">IDs</span>, ensure that you update the values when you configure your <span class=\"nanospell-typo\">YAML</span> file.</div></div></div>\n<p>You can then exit the root prompt with <code><span class=\"nanospell-typo\">Ctrl</span>+D</code>. </p>\n<p>To verify Persistent Volume creation, run the command: <code><span class=\"nanospell-typo\">kubectl</span> get pv</code></p>\n<h2><a id=\"AKS\" name=\"AKS\" title=\"AKS\"></a><span class=\"nanospell-typo\">AKS</span></h2>\n<div>\n<p>Follow these steps to create persistent volumes manually for Azure <span class=\"nanospell-typo\">Kubernetes</span> Service (<span class=\"nanospell-typo\">AKS</span>).</p>\n<p>Once the Azure file shares are ready, log on to the bastion and set up volumes to store data by following these steps:</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-tip-icon\"></div><div class=\"admonition-content admonition-tip-content\"><div>You can skip steps 1 to 3 if you have already mounted the Azure file share on the bastion node or if you have set up the external <span class=\"nanospell-typo\">Kubernetes</span> using the Cloud deployment toolkit.</div></div></div>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Install the <span class=\"nanospell-typo\">NFS</span> client on the bastion:</p>\n<pre><span class=\"nanospell-typo\">sudo</span> yum install -y <span class=\"nanospell-typo\">nfs</span>-<span class=\"nanospell-typo\">utils</span> <span class=\"nanospell-typo\">cifs</span>-<span class=\"nanospell-typo\">utils</span></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Copy and save the following script as <code><span class=\"nanospell-typo\">mountazurefile</span>.sh</code>. This script supports the Server Message Block (<span class=\"nanospell-typo\">SMB</span>) protocol for mounting Azure file share:</p>\n<pre>#!/bin/bash\n<span class=\"nanospell-typo\">MOUNTPOINT</span>=/<span class=\"nanospell-typo\">mnt</span>/<span class=\"nanospell-typo\">nfs</span>/$3\n<span class=\"nanospell-typo\">sudo</span> <span class=\"nanospell-typo\">mkdir</span> -p $<span class=\"nanospell-typo\">MOUNTPOINT</span>\nif [ ! -d \"/etc/<span class=\"nanospell-typo\">smbcredentials</span>\" ]; then\n<span class=\"nanospell-typo\">sudo</span> <span class=\"nanospell-typo\">mkdir</span> /etc/<span class=\"nanospell-typo\">smbcredentials</span>\nfi\nif [ ! -f \"/etc/<span class=\"nanospell-typo\">smbcredentials</span>/$1.<span class=\"nanospell-typo\">cred</span>\" ]; then\n    <span class=\"nanospell-typo\">sudo</span> bash -c \"echo <span class=\"nanospell-typo\">username</span>=$1 &gt;&gt; /etc/<span class=\"nanospell-typo\">smbcredentials</span>/$1.<span class=\"nanospell-typo\">cred</span>\"\n    <span class=\"nanospell-typo\">sudo</span> bash -c \"echo password=$2 &gt;&gt; /etc/<span class=\"nanospell-typo\">smbcredentials</span>/$1.<span class=\"nanospell-typo\">cred</span>\"\nfi\n<span class=\"nanospell-typo\">sudo</span> <span class=\"nanospell-typo\">chmod</span> 600 /etc/<span class=\"nanospell-typo\">smbcredentials</span>/$1.<span class=\"nanospell-typo\">cred</span>\n<span class=\"nanospell-typo\">sudo</span> bash -c \"echo //$1.file.core.windows.net/$3 $<span class=\"nanospell-typo\">MOUNTPOINT</span> <span class=\"nanospell-typo\">cifs</span> <span class=\"nanospell-typo\">nofail</span>,<span class=\"nanospell-typo\">vers</span>=3.0,credentials=/etc/<span class=\"nanospell-typo\">smbcredentials</span>/$1.<span class=\"nanospell-typo\">cred</span>,dir_mode=0775,file_mode=0775,<span class=\"nanospell-typo\">serverino</span>,<span class=\"nanospell-typo\">mfsymlinks</span>,<span class=\"nanospell-typo\">uid</span>=$4,<span class=\"nanospell-typo\">gid</span>=$5 &gt;&gt; /etc/<span class=\"nanospell-typo\">fstab</span>\"\n<span class=\"nanospell-typo\">sudo</span> mount -t <span class=\"nanospell-typo\">cifs</span> //$1.file.core.windows.net/$3 $<span class=\"nanospell-typo\">MOUNTPOINT</span> -o <span class=\"nanospell-typo\">vers</span>=3.0,credentials=/etc/<span class=\"nanospell-typo\">smbcredentials</span>/$1.<span class=\"nanospell-typo\">cred</span>,dir_mode=0775,file_mode=0775,<span class=\"nanospell-typo\">serverino</span>,<span class=\"nanospell-typo\">mfsymlinks</span>,<span class=\"nanospell-typo\">uid</span>=$4,<span class=\"nanospell-typo\">gid</span>=$5\n</pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Run the following command to mount the Azure file share to bastion:</p>\n<pre><span class=\"nanospell-typo\">chmod</span> 755 <span class=\"nanospell-typo\">mountazurefile</span>.sh\n<span class=\"nanospell-typo\">sudo</span> ./<span class=\"nanospell-typo\">mountazurefile</span>.sh  &lt;storage_account_name&gt; &lt;storage_account_key&gt; &lt;<span class=\"nanospell-typo\">fileshare</span>_name&gt; &lt;SYSTEM_USER_ID&gt; &lt;SYSTEM_GROUP_ID&gt;\n</pre>\n<p>In these commands,</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><code>&lt;storage_account_name&gt;</code> is the name of the created <strong><span class=\"nanospell-typo\">FileStorage</span></strong> account. </li><li style=\"margin-left: 40px; position: relative;\"><code>&lt;storage_account_key&gt;</code> is the key you got when creating Azure file shares. </li><li style=\"margin-left: 40px; position: relative;\"><code>&lt;<span class=\"nanospell-typo\">fileshare</span>_name&gt;</code> is the name of the Azure file share. </li><li style=\"margin-left: 40px; position: relative;\"><code>&lt;SYSTEM_USER_ID&gt;</code> and <code>&lt;SYSTEM_GROUP_ID&gt;</code>: specify an operating system user ID and group ID that are used to run the process in the container, respectively. Both values must be <code>1999</code> or a number between <code>100000</code> and <code>2000000000</code> (for example, <code><span class=\"nanospell-typo\">UID</span>=100001</code> and <code><span class=\"nanospell-typo\">GID</span>=100002</code>).</li></ul>\n\tFor example:\n\n\t<pre><span class=\"nanospell-typo\">chmod</span> 755 <span class=\"nanospell-typo\">mountazurefile</span>.sh \n<span class=\"nanospell-typo\">sudo</span> ./<span class=\"nanospell-typo\">mountazurefile</span>.sh <span class=\"nanospell-typo\">myopsbstorage</span> ${<span class=\"nanospell-typo\">storageAccountKey</span>} generic <code>1999</code> <code>1999</code></pre>\n</li></ol>\n<p><strong>Create <span class=\"nanospell-typo\">PVs</span> manually</strong></p>\n<p>Follow these steps to create the <span class=\"nanospell-typo\">PVs</span> manually:</p>\n<p>Log on to the bastion node, run the following commands by replacing the File Share with the Azure File Share name:</p>\n<pre><span class=\"nanospell-typo\">sudo</span> su\n\nFILE_SHARE=&lt;FILE_SHARE_NAME&gt;\n\nfor i in {1..4}; do\n    <span class=\"nanospell-typo\">mkdir</span> -p \"/<span class=\"nanospell-typo\">mnt</span>/<span class=\"nanospell-typo\">nfs</span>/$FILE_SHARE/<span class=\"nanospell-typo\">var</span>/<span class=\"nanospell-typo\">vols</span>/<span class=\"nanospell-typo\">itom</span>/<span class=\"nanospell-typo\">opvol</span>$i\"\n    <span class=\"nanospell-typo\">chown</span> 1999:1999 \"/<span class=\"nanospell-typo\">mnt</span>/<span class=\"nanospell-typo\">nfs</span>/$FILE_SHARE/<span class=\"nanospell-typo\">var</span>/<span class=\"nanospell-typo\">vols</span>/<span class=\"nanospell-typo\">itom</span>/<span class=\"nanospell-typo\">opvol</span>$i\"\n    <span class=\"nanospell-typo\">chmod</span> g+w+s \"/<span class=\"nanospell-typo\">mnt</span>/<span class=\"nanospell-typo\">nfs</span>/$FILE_SHARE/<span class=\"nanospell-typo\">var</span>/<span class=\"nanospell-typo\">vols</span>/<span class=\"nanospell-typo\">itom</span>/<span class=\"nanospell-typo\">opvol</span>$i\"\n    <span class=\"nanospell-typo\">kubectl</span> apply -f - &lt;&lt;&lt;\"\n<span class=\"nanospell-typo\">apiVersion</span>: v1\nkind: <span class=\"nanospell-typo\">PersistentVolume</span>\n<span class=\"nanospell-typo\">metadata</span>:\n  name: <span class=\"nanospell-typo\">opvol</span>$i\nspec:\n  <span class=\"nanospell-typo\">accessModes</span>:\n    - <span class=\"nanospell-typo\">ReadWriteMany</span>\n  <span class=\"nanospell-typo\">azureFile</span>:\n    <span class=\"nanospell-typo\">secretName</span>: azure-secret\n    <span class=\"nanospell-typo\">secretNamespace</span>: core\n    <span class=\"nanospell-typo\">shareName</span>: $FILE_SHARE/<span class=\"nanospell-typo\">var</span>/<span class=\"nanospell-typo\">vols</span>/<span class=\"nanospell-typo\">itom</span>/<span class=\"nanospell-typo\">opvol</span>$i\n  capacity:\n    storage: 10Gi\n  <span class=\"nanospell-typo\">mountOptions</span>:\n    - dir_mode=0775\n    - <span class=\"nanospell-typo\">uid</span>=1999\n    - <span class=\"nanospell-typo\">gid</span>=1999\n    - <span class=\"nanospell-typo\">mfsymlinks</span>\n    - <span class=\"nanospell-typo\">nobrl</span>\n    - <span class=\"nanospell-typo\">noserverino</span>\n  <span class=\"nanospell-typo\">persistentVolumeReclaimPolicy</span>: Retain\n  <span class=\"nanospell-typo\">storageClassName</span>: op-default\n  <span class=\"nanospell-typo\">volumeMode</span>: <span class=\"nanospell-typo\">Filesystem</span>\n\"\n\ndone\n</pre>\n<p>The value <code>1999:1999</code> represents the <code>user:group</code> <span class=\"nanospell-typo\">IDs</span> used by the containers that run as part of Operations Platform. If you change the <code>user:group</code> <span class=\"nanospell-typo\">IDs</span>, ensure that you update the values when you configure your <span class=\"nanospell-typo\">YAML</span> file.</p>\n<p>You can then exit the root prompt with <code><span class=\"nanospell-typo\">Ctrl</span>+D</code>. </p>\n<p>To verify Persistent Volume creation, run the command: <code><span class=\"nanospell-typo\">kubectl</span> get pv</code></p>\n<h2><a id=\"GKE\" name=\"GKE\" title=\"GKE\"></a><span class=\"nanospell-typo\">GKE</span></h2>\n<p>To create persistent volumes manually for Google <span class=\"nanospell-typo\">Kubernetes</span> Engine (<span class=\"nanospell-typo\">GKE</span>).</p>\n<p>You must create four persistent volumes upfront.</p>\n<p>To create the required <span class=\"nanospell-typo\">PVs</span> required, connect to the bastion machine within your <span class=\"nanospell-typo\">VPC</span> with <span class=\"nanospell-typo\">SSH</span>.</p>\n<p>Run the following commands to create volumes by replacing the <span class=\"nanospell-typo\">NFS</span> <span class=\"nanospell-typo\">DNS</span> with the <span class=\"nanospell-typo\">Filestore</span> <span class=\"nanospell-typo\">DNS</span> name:</p>\n<pre><code>NFS_FQDN=&lt;EFS_NFS_DNS&gt;\nFILE_STORE_NAME=&lt;YOUR_FILESTORE_NAME&gt;\nMOUNT_POINT_LOCATION=&lt;YOUR MOUNT POINT USED FOR FILESTORE&gt;\nCAPACITIES=(10Gi 10Gi 10Gi 10Gi)\n\nfor i in {1..4}; do\n    sudo mkdir -p \"$MOUNT_POINT_LOCATION/var/vols/itom/opvol$i\"\n    sudo chown -R 1999:1999 \"$MOUNT_POINT_LOCATION/\"\n    sudo chmod g+w+s \"$MOUNT_POINT_LOCATION/var/vols/itom/opvol$i\"    \n    \n    kubectl apply -f - &lt;&lt;&lt;\"\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: opvol$i\nspec:\n  accessModes:\n    - ReadWriteMany\n  capacity:\n    storage: ${CAPACITIES[$((i-1))]}\n  nfs:\n    path: /$FILE_STORE_NAME/var/vols/itom/opvol$i\n    server: $NFS_FQDN\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: standard\n  volumeMode: Filesystem\n\"\ndone\n</code></pre>\n<p>The value <code>1999:1999</code> represents the <code>user:group</code> <span class=\"nanospell-typo\">IDs</span> that containers use to run as part of Operations Platform. If you change the <code>user:group</code> <span class=\"nanospell-typo\">IDs</span>, ensure that you update the values when you configure your <span class=\"nanospell-typo\">YAML</span> file.</p>\n<p>You can then exit the root prompt with <code><span class=\"nanospell-typo\">Ctrl</span>+D</code>. </p>\n<p>To verify Persistent Volume creation, run the command: <code><span class=\"nanospell-typo\">kubectl</span> get pv</code></p>\n</div>\n</div>",
  "modifiedon": "2026-01-30 13:52:30"
}