{
  "title": "Enable TLS on PostgreSQL",
  "content": "<div class=\"mw-parser-output\">\n<p>You can skip this topic if:</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">you are using CA-signed certificates</li><li style=\"margin-left: 28px; position: relative;\">you are using self-signed CA certificates</li><li style=\"margin-left: 28px; position: relative;\">you have an embedded PostgreSQL setup</li><li style=\"margin-left: 28px; position: relative;\">you are already familiar with configuring TLS on a PostgreSQL server</li><li style=\"margin-left: 28px; position: relative;\">you do not require TLS for your deployment</li></ul>\n<p>In these cases, the steps outlined in this page may not be necessary.</p>\n<h2><a id=\"Create_certificate_using_cdfcert_tool_for_PostgreSQL\" name=\"Create_certificate_using_cdfcert_tool_for_PostgreSQL\" title=\"Create certificate using cdfcert tool for PostgreSQL\"></a>Create certificate using cdfcert tool for PostgreSQL</h2>\n<p>Run the following command to create the certificate:</p>\n<pre><code>cdfcert cert create postgres -S mypostgres.host1.net -d .</code></pre>\n<p>This creates the following files:</p>\n<pre><code>cdf_ca.crt\npostgres.crt\npostgres.key</code></pre>\n<p>If you create the certificate using the <font face=\"monospace\">cdfcert</font> tool on the control plane node, you must copy them onto the PostgreSQL database server for updating the <code>postgresql.conf</code> file.</p>\n<p>For the complete documentation on how to configure PostgreSQL with TLS, see <strong>Secure TCP/IP Connections with SSL </strong>in the PostgreSQL documentation. For PostgreSQL 13, see <a href=\"https://www.postgresql.org/docs/13/ssl-tcp.html\" title=\"Secure TCP/IP Connections with SSL\">https://www.postgresql.org/docs/13/ssl-tcp.html</a>.</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>The instructions for <strong>Creating </strong><strong>Certificates </strong>of the PostgreSQL documentation in the section <strong>Secure TCP/IP Connections with SSL</strong> results in a certificate that doesn't contain a <code>subjectAlternativeName</code> field, however, it's required.</div></div></div>\n<h2><a id=\"Update_Certificate\" name=\"Update_Certificate\" title=\"Update Certificate\"></a>Update Certificate</h2>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Edit <code>postgresql.conf</code> and search for <code>ssl</code>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">You will see the <code><strong>ssl</strong></code> property commented out and with a value of <strong>off</strong>.  Uncomment the property and set the value to <strong><code>on.</code></strong><br/>\n<br/>\n\tExample for the configuration, when <code>cdfcert</code> is used to generate certificates:<br/>\n\tIn this example, cdf.crt is a root CA certificate.\n\t<pre><code># - SSL -\nssl = on\nssl_ca_file = 'cdf_ca.crt'\nssl_cert_file = 'postgres.crt'\n#ssl_crl_file = ''\n#ssl_crl_dir = ''\nssl_key_file = 'postgres.key'</code></pre>\n<br/>\n\tExample for a custom root CA certificate:\n\t<pre><code># - SSL -\nssl = on\n#ssl_ca_file = 'root_ca.crt'\nssl_cert_file = 'postgres.crt'\n#ssl_crl_file = ''\n#ssl_crl_dir = ''\nssl_key_file = 'postgres.key'</code></pre>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>If you have any intermediate certificates, ensure that the <code>postgres.crt</code> contains all the intermediate certificates along with the server certificate.</div></div></div>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Uncomment the properties for <code>ssl_ca_file</code>, <code>ssl_cert_file</code> and <code>ssl_key_file</code>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Save the changes and restart the <code>postgres</code> service as a root user.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Pass the CA certificate during installation. ​</li></ol>\n<h2><a id=\"Connect_to_PostgreSQL_for_GCP\" name=\"Connect_to_PostgreSQL_for_GCP\" title=\"Connect to PostgreSQL for GCP\"></a>Connect to PostgreSQL for GCP</h2>\n<p>If you are using Cloud SQL for PostgreSQL, you may not be able to connect to PostgreSQL with TLS enabled because of a GCP limitation.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the bastion node, run the following command to get the certificate:\n\t<pre><code>openssl s_client -starttls postgres -connect &lt;PostgreSQL IP&gt;:&lt;port&gt; -showcerts 2&gt;/dev/null | awk '/-----BEGIN CERTIFICATE-----/,/-----END CERTIFICATE-----/'</code></pre>\n<p>Example:</p>\n<pre><code>openssl s_client -starttls postgres -connect EXAMPLE.COM:5432 -showcerts 2&gt;/dev/null | awk '/-----BEGIN CERTIFICATE-----/,/-----END CERTIFICATE-----/'</code></pre>\n<p>The following is a sample output of the command:</p>\n<pre><code>-----BEGIN CERTIFICATE-----\n&lt;server cert&gt;\n-----END CERTIFICATE-----</code></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Save the output as a certificate ( <code>.crt</code> )file.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to extract DNS from the certificate:\n\t<pre><code>openssl x509 -in &lt;location of the certificate you saved&gt; -text -noout | grep -A1 \"X509v3 Subject Alternative Name\" | grep \"DNS:\" | sed 's/DNS://;s/^[ \\t]*//;s/[ \\t]*$//'</code></pre>\n<p>From the output, copy and save the DNS name ending with <code>sql.goog</code>.</p>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In <strong>Google Cloud</strong>, select <strong>Network Services</strong> <strong>&gt;</strong> <strong>Cloud DNS</strong>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <strong>Create Zone</strong> <strong>&gt; Private</strong> and enter the zone name.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>DNS name</strong> field, enter <code>sql.goog</code>.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In <strong>Networks</strong>, select your VPC detail and click <strong>CREATE</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">After the zone is created, under same zone create standard to create DNS name.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>ADD STANDARD</strong> and under <strong>DNS name</strong>, enter the DNS name without the <code>.sql.goog</code> you saved in step 3.</li><li style=\"--number-width: 19px; --number-spacing: 24px; margin-left: 36px; position: relative;\">For <strong>IP Address</strong> , type the private IP generated from the PostgreSQL server and click <strong>CREATE</strong>.</li></ol>\n<p>You can use the same certificate during deployment. </p>\n</div>",
  "modifiedon": "2026-01-30 13:44:08"
}