{
  "title": "Create external databases",
  "content": "<div class=\"mw-parser-output\"><br/><h2>Create an external PostgreSQL instance</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Database administrator</td>\n<td>GCP Console</td>\n</tr>\n</tbody>\n</table>\n<p>To allow private IP connectivity from the GKE cluster to the PostgreSQL instance, you first need to enable Service Networking API by navigating to <b>APIs &amp; Services</b> &gt; <b>Library</b> &gt; <b>Service Networking API</b> and clicking <b>Enable</b>.</p>\n<p>To create a PostgreSQL instance on GCP, follow these steps:</p>\n<ol>\n<li>Log in to the Google Cloud Platform Console at <a class=\"external free\" href=\"https://console.cloud.google.com/\" rel=\"nofollow\" target=\"1\" title=\"https://console.cloud.google.com/\">https://console.cloud.google.com/</a>.</li>\n<li>Click <b>SQL</b> &gt; <b>CREATE INSTANCE</b>.</li>\n<li>Choose <b>PostgreSQL</b> and populate the following fields:\n\t<ul>\n<li><b>Instance ID</b>: Give a name to the instance.</li>\n<li><b>Password</b>: Set a password for the default admin user <strong>postgres</strong>. You will need it during the UD/UCMDB installation.</li>\n<li><b>Database version</b>: select a <a href=\"/doc/423/26.1/gcpsizing#Databases\" title=\"supported database version\">supported database version</a>.</li>\n<li><b>Region</b>: Select the same region as the prepared VPC.</li>\n<li><strong>Zonal availability</strong>: Select <strong>Multiple zones (Highly available)</strong>.</li>\n</ul>\n</li>\n<li>Click <b>SHOW CONFIGURATION OPTIONS</b> and configure as follows:\n\t<ul>\n<li>Under <b>Machine type</b>, select a machine type by referring to <a href=\"/doc/423/26.1/gcpsizing#Additional_hardware_requirements_for_UD_UCMDB\" title=\"Sizing guide\">Sizing guide</a>.</li>\n<li>Under <b>Storage</b>, configure storage by referring to <a href=\"/doc/423/26.1/gcpsizing#Additional_hardware_requirements_for_UD_UCMDB\" title=\"Sizing guide\">Sizing guide</a>.</li>\n<li>Under <b>Connections</b>, deselect <b>Public IP</b>, select <b>Private IP</b>, click <strong>Set Up Connection</strong>, select <strong>Use an automatically allocated IP range</strong>, click <strong>Continue, </strong>and then click <strong>Create Connection</strong>.</li>\n<li>Under <b>Data Protection</b>, set up your preferred backup configurations.</li>\n<li>Under <b>Flags</b>, click <b>ADD FLAG</b> and add a flag <i><b>max</b></i>_<i><b>connections : 2000</b></i>.</li>\n</ul>\n</li>\n<li>Leave the remaining settings as is and click <b>Create Instance</b>. It will take several minutes for the new instance to be created. You can monitor its status on the SQL page.</li>\n<li>To enforce SSL/TLS for all connections to your Cloud SQL instance, follow the <a class=\"external text\" href=\"https://cloud.google.com/sql/docs/sqlserver/configure-ssl-instance\" rel=\"nofollow\" target=\"1\" title=\"Google Cloud\">Google Cloud</a> documentation. </li>\n<li>(Optional) To enforce TLSv1.3 on the PostgreSQL server side, set the <a href=\"https://postgresqlco.nf/doc/en/param/ssl_min_protocol_version/\" title=\"ssl_min_protocol_version\"><strong>ssl_min_protocol_version</strong></a> and <strong><a href=\"https://postgresqlco.nf/doc/en/param/ssl_max_protocol_version/\" title=\"ssl_max_protocol_version\">ssl_max_protocol_version</a> </strong>parameters to <strong>TLSv1.3</strong>.  See <a href=\"https://cloud.google.com/sql/docs/postgres/flags\" title=\"Configure database flags\">Configure database flags</a> for details.</li>\n</ol>\n<h2>Set up a PostgreSQL database for UD/UCMDB</h2>\n<p>In a production environment, you must use external databases for the UD/UCMDB application. The database user and database name information are required when you install UD/UCMDB, and the database schema information is also required.</p>\n<p>The databases must be empty so that UD/UCMDB will initialize them during installation. The table below shows example database information prepared for the UD/UCMDB components.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Service</th>\n<th scope=\"col\">DB User</th>\n<th scope=\"col\">DB Name</th>\n<th scope=\"col\">Schema</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>UCMDB Server</td>\n<td>ucmdb_server</td>\n<td>ucmdb_server_db</td>\n<td>ucmdb_server_schema</td>\n</tr>\n<tr>\n<td>UCMDB Gateway</td>\n<td>ucmdb_gateway</td>\n<td>ucmdb_gateway_db</td>\n<td>ucmdb_gateway_schema</td>\n</tr>\n<tr>\n<td>IdM</td>\n<td>ucmdb_idm</td>\n<td>ucmdb_idm_db</td>\n<td>ucmdb_idm_schema</td>\n</tr>\n<tr>\n<td>APLS</td>\n<td>ucmdb_autopass</td>\n<td>ucmdb_autopass_db</td>\n<td>ucmdb_autopass_schema</td>\n</tr>\n</tbody>\n</table>\n<p><br/>\nBelow are sample SQL commands for creating a user and a database for a service:</p>\n<ol>\n<li>\n<p>Log in to the bastion node and then run the following command to connect to the PostgreSQL instance.</p>\n<pre>psql -h &lt;db_private_ip&gt; -U &lt;db_user&gt;</pre>\n\tFor example,\n\n\t<pre>psql -h 10.180.96.198 -U postgres</pre>\n</li>\n<li>\n<p>Run the following commands to create the databases and the users used by UCMDB Server and AutoPass:</p>\n<pre>CREATE USER &lt;USERNAME&gt; PASSWORD '&lt;PASSWORD&gt;';\n\ngrant &lt;USERNAME&gt; to &lt;PostgresSQL admin&gt;;\n\nCREATE DATABASE &lt;DBNAME&gt; OWNER &lt;USERNAME&gt;;   </pre>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\"><code>&lt;PASSWORD&gt;</code> for database user should follow below complexity defined by the Vault secret utility:\n\n\t<ul>\n<li>At least 8 characters long</li>\n<li>Alphanumeric characters</li>\n<li>At least one lower case letter</li>\n<li>At least one upper case letter</li>\n<li>At least one digit</li>\n</ul>\n</div>\n</div>\n<p>For example:</p>\n<b># For UCMDB </b>\n<pre>CREATE USER ucmdb_server PASSWORD '&lt;PASSWORD&gt;';\n\ngrant ucmdb_server to &lt;PostgresSQL admin&gt;;\n\nCREATE DATABASE ucmdb_server_db OWNER ucmdb_server; </pre>\n<b># For APLS  </b>\n<pre>CREATE USER ucmdb_autopass PASSWORD '&lt;PASSWORD&gt;';\n\ngrant ucmdb_autopass to &lt;PostgresSQL admin&gt;;\n\nCREATE DATABASE ucmdb_autopass_db OWNER ucmdb_autopass; </pre>\n<b># For UCMDB Gateway</b>\n<pre>CREATE USER ucmdb_gateway PASSWORD '&lt;PASSWORD&gt;';\n\ngrant ucmdb_gateway to &lt;PostgresSQL admin&gt;;\n\nCREATE DATABASE ucmdb_gateway_db OWNER ucmdb_gateway;</pre>\n<b># For IdM</b>\n<pre>CREATE USER ucmdb_IdM PASSWORD '&lt;PASSWORD&gt;';\n\ngrant ucmdb_IdM to &lt;PostgresSQL admin&gt;;\n\nCREATE DATABASE ucmdb_IdM_db OWNER ucmdb_IdM;</pre>\n</li>\n<li>\n<p>Run the following commands to create the schemas used by UCMDB Server and AutoPass: </p>\n<pre>\\c &lt;DBNAME&gt;\n\nCREATE SCHEMA &lt;DBSCHEMA&gt; AUTHORIZATION &lt;USERNAME&gt;;\n\nALTER USER &lt;USERNAME&gt; SET search_path TO &lt;DBSCHEMA&gt;;</pre>\n<p>For example:</p>\n<b># For UCMDB</b>:\n\n\t<pre>\\c ucmdb_server_db\n\nCREATE SCHEMA ucmdb_server_schema AUTHORIZATION ucmdb_server;\n\nALTER USER ucmdb_server SET search_path TO ucmdb_server_schema;</pre>\n<b># For APLS</b>:\n\n\t<pre>\\c ucmdb_autopass_db\n\nCREATE SCHEMA ucmdb_autopass_schema AUTHORIZATION ucmdb_autopass;\n\nALTER USER ucmdb_autopass SET search_path TO ucmdb_autopass_schema;</pre>\n<b># For UCMDB Gateway</b>:\n\n\t<pre>\\c ucmdb_gateway_db\n\nCREATE SCHEMA ucmdb_gateway_schema AUTHORIZATION ucmdb_gateway;\n\nALTER USER ucmdb_gateway SET search_path TO ucmdb_gateway_schema;</pre>\n<b># For UCMDB IdM</b>:\n\n\t<pre>\\c ucmdb_IdM_db\n\nCREATE SCHEMA ucmdb_IdM_schema AUTHORIZATION ucmdb_IdM;\n\nALTER USER ucmdb_IdM SET search_path TO ucmdb_IdM_schema;</pre>\n</li>\n</ol>\n<h2>External references</h2>\n<p>For Cloud SQL for PostgreSQL information, see <a class=\"external text\" href=\"https://cloud.google.com/sql/docs/postgres/\" rel=\"nofollow\" target=\"1\" title=\"Cloud SQL\">Cloud SQL</a>.</p>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}