{
  "title": "Download and upload container images to a registry (for UD/UCMDB)",
  "content": "<div class=\"mw-parser-output\"><br/><table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>UD/UCMDB administrator</td>\n<td>Bastion node</td>\n</tr>\n</tbody>\n</table>\n<p>Before you deploy OMT and UD/UCMDB, you need to download the OMT and UD/UCMDB images from Docker Hub or other registries and then upload the images to your registry. The Artifactory registry is used to host images on GCP.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">If you have already uploaded images to your registry, skip this step.</div>\n</div>\n<h2>Prepare the registry</h2>\n<p>Complete the following steps to prepare the Artifactory registry for storing images.</p>\n<ol>\n<li>Ensure you already enabled the Artifactory Registry API. For details, see Google's official documentation <a href=\"https://cloud.google.com/endpoints/docs/openapi/enable-api#enabling_an_api\" title=\"Enable an API\">Enable an API</a>.</li>\n<li>Run the following command to know your cluster's service account information. You will need it in the later steps.\n\t<pre><code>gcloud config get-value account</code></pre>\n\tThe command output may resemble the following: <code>878xxxxx026-compute@developer.gserviceaccount.com.</code></li>\n<li>Follow the official documentation to set up the Artifactory registry. Ensure you choose <strong>Access token</strong> for the authentication method. For details on setting up your Artifactory registry, see <a href=\"https://cloud.google.com/artifact-registry/docs/docker/store-docker-container-images\" title=\"Store Docker container images in Artifact Registry\">Store Docker container images in Artifact Registry</a>. For details on enabling Access token for authentication, see <a href=\"https://cloud.google.com/artifact-registry/docs/docker/store-docker-container-images\" title=\"Access token\">Access token</a>.</li>\n<li>Run the following command to get an auth token and verify that the authentication is set up correctly. Use the following command to get the access tokens required to upload the images to the Artifactory registry.\n\t<pre><code>gcloud auth print-access-token --impersonate-service-account &lt;<em>your service account</em>&gt;\n</code></pre>\n</li>\n</ol>\n<h2>Generate the image set</h2>\n<p>Before downloading and uploading the images, you need to generate the image set with the following steps on the bastion node:</p>\n<ol>\n<li>\n<p>On the bastion node, navigate to the OMT installation directory:</p>\n<pre>cd OMT_External_K8s_2x.x-xxx/tools/generate-download</pre>\n</li>\n<li>Run the <code>generate_download_bundle.sh </code>command together with the options required by your deployment.\n\t<pre>generate_download_bundle.sh -f &lt;<em>image_set_file</em>&gt; [ -d &lt;output_directory&gt;]</pre>\n\tWhere,\n\n\t<ul>\n<li><code>&lt;<em>image_set_file</em>&gt;</code>: The absolute path to the image set file. To locate this file, untar <code>ucmdb-1.xx.x-xxx+2x.x.x.tgz</code> and check the scripts folder. </li>\n<li><code>&lt;<em>output_directory</em>&gt;</code>: The directory where the script saves the<strong> </strong><code>offline-download.zip</code><strong> </strong>file. If you don't specify a value, the script saves the file to the default directory, which is the current working directory.</li>\n</ul>\n\tFor example:\n\n\t<pre>generate_download_bundle.sh -f  &lt;<code>UCMDB_Helm_Chart-2x.x&gt;</code>/scripts/image_sets/_image-set.json -d /tmp</pre>\n</li>\n<li>When the <code>offline-download.zip</code> file is successfully generated, you will see a success message similar to the following:\n\t<pre>INFO offline-download.zip is generated under /tmp\nINFO For more details, please refer: /home/centos/cdf/log/generate_download_bundle/generate_download_bundle.20240129084204.log\n</pre>\n</li>\n</ol>\n<p>The generated file contains the image download bundle. This bundle downloads the images required for installation.</p>\n<h2>Download the required installation images for OMT and UD/UCMDB</h2>\n<ol>\n<li>Log on to the first bastion node. If that node can't access Docker Hub, transfer the  <code>offline-download.zip</code>  file to a Linux server that can access Docker Hub.</li>\n<li>Extract the <code>.zip</code> package to a directory. If you can't access Docker Hub directly, set up the HTTP/HTTPS proxy. For example, run the following commands to set the HTTP/HTTPS proxy. Replace the placeholders with your actual server and port. \n\t<pre>export http_proxy=\"&lt;<em>http://PROXY_SERVER:PORT</em>&gt;\"\nexport https_proxy=\"&lt;<em>https://PROXY_SERVER:PORT</em>&gt;\"</pre>\n</li>\n<li>Go to the directory where you extracted the <code>offline-download.zip</code> package and run the following command:\n\t<pre>./downloadimages.sh [-u &lt;<em>username</em>&gt;] [-p &lt;<em>password&gt;</em>] [-d &lt;<em>image download directory</em>&gt;] [-c &lt;<em>digital signature verification</em>&gt;] [-o &lt;<em>org name</em>&gt;]</pre>\n\tWhere:\n\n\t<ul>\n<li><code>&lt;<em>username</em>&gt;</code><b> </b>and <code>&lt;<em>password</em>&gt;</code><b>:</b> The Docker Hub username and password.  If you don't pass the credentials to the command, you will be prompted for them during execution.</li>\n<li><code>&lt;<em>image download directory</em>&gt;</code>: The directory where the container images will be downloaded. The default is <strong>/</strong><code>var/opt/cdf/offline</code>.</li>\n<li><code>&lt;<em>digital signature verification</em>&gt;</code><strong>: </strong>Verifies the digital signature of the images during the download. The default is <strong>off</strong>, which doesn't verify the signature. Set it to <strong>on</strong> to allow signature verification.</li>\n<li><code>&lt;<em>org name</em>&gt;</code>: The organization in the image registry that contains the images for installation. The default is <code>hpeswitom</code>. This option is mandatory if you aren't using the default organization name.</li>\n</ul>\n</li>\n</ol>\n<p>To see the full list of options for the <code>downloadimages.sh</code> command, run the following command:</p>\n<pre>./downloadimages.sh –h</pre>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">\n<p>The <code>./downloadimages.sh</code> command also has a <code>-p</code> option to provide your password. The <code>-p</code>  option doesn't support single quotes (don't include single quotes in the password).</p>\n<p>By selecting the <code>-p</code> option, you are disabling or bypassing security features, thereby exposing the system to increased security risks. By using this option, you understand and agree to assume all associated risks and hold OpenText harmless for the same.</p>\n<p>OpenText encourages you to use some other password options, which aren't provided by OpenText. By implementing the -p option, you may expose the system to increased security risks. You understand and agree to assume all associated risks and hold OpenText harmless for the same. It remains at all times your sole responsibility to assess its own regulatory and business requirements. OpenText doesn't represent or warrant that its products comply with any specific legal or regulatory standards applicable to you in conducting your business.</p>\n</div>\n</div>\n<h2>(Optional) Transfer the images to the bastion node</h2>\n<p>If you downloaded the images to a server other than the bastion node, transfer the images to a directory on the bastion node. By default, the images should be placed under the <code>/var/opt/cdf/offline</code> directory.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">\n<p>The images will be uploaded using the <code>uploadimages.sh</code> script in the next step. The image upload requires a storage space of up to two times the image size in the target image directory. For example, if you choose to use the default <code>/var/opt/cdf/offline</code> directory, and your image size is 10 GB, ensure that you have 20 GB or more free storage space under the <code>/var/opt/cdf/offline</code> directory of the bastion node.</p>\n</div>\n</div>\n<h2>Upload images for UD/UCMDB</h2>\n<p>Follow these steps to upload the installation images to your image registry:</p>\n<ol>\n<li>Log on to one of the bastion nodes. The node must be able to connect to the registry.</li>\n<li>Run the following command to get the authentication token. Use the verified service account from the <em>Prepare the registry </em>section.\n\t<pre>gcrpwd=$(gcloud auth print-access-token --impersonate-service-account 878xxxxx026-compute@developer.gserviceaccount.com 2&gt; /dev/null)\necho  $gcrpwd</pre>\n</li>\n<li>Go to the directory where you extracted the <code>offline-download.zip</code> package.</li>\n<li>Run the following command to upload the UD/UCMDB images to the registry:\n\t<pre>./uploadimages.sh -r &lt;<em>registry</em>&gt; -u &lt;<em>username</em>&gt; -p &lt;<em>password</em>&gt; -d &lt;<em>image download directory</em>&gt; -o &lt;<em>org name</em>&gt; -F &lt;<em>image-set file</em>&gt; -k &lt;<em>chunksize</em>&gt;</pre>\n\tWhere,\n\n\t<ul>\n<li><code>&lt;<em>registry</em>&gt;</code> is the URL of the registry.</li>\n<li><code>&lt;<em>username</em>&gt; </code>and <strong>&lt;</strong><code><em>password</em>&gt;</code> are the username and password of your docker registry. You can get it from the admin of the registry.</li>\n<li><code>&lt;<em>image download directory</em>&gt;</code><b> </b>is the directory where you downloaded the container images. The default value is <code>/var/opt/cdf/offline</code>. Specify the <b>-d</b> option if the images aren't in the <code>/var/opt/cdf/offline</code> directory. You can use the <strong>-d</strong> option multiple times when the images are in different directories. The images can be the images downloaded using the <code>downloadimages.sh</code><strong> </strong>script. Make sure the image file type matches the file extension. </li>\n<li><code>&lt;<em>org name</em>&gt;</code><strong> </strong>is the organization in the image registry that contains the images for installation. By default, this is <code>hpeswitom</code>. This option is mandatory if you aren't using the default organization name.</li>\n<li><code>&lt;i<em>mage-set file</em>&gt;</code>: Path to the file containing the image set. </li>\n<li><code>&lt;<em>chunksize</em>&gt;</code>: Chunking size for image transfer. The default value is 100000000000.</li>\n</ul>\n<p>To see the full list of options for the <code>uploadimages.sh</code> command, run the following command:</p>\n<pre>./uploadimages.sh -h </pre>\n</li>\n<li>Wait until the images are successfully uploaded. Your terminal should resemble the following:\n\t<pre>Upload-process successfully completed.\n</pre>\n</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}