{
  "title": "Uninstall UD/UCMDB on GCP",
  "content": "<div class=\"mw-parser-output\"><br/><br/><p>To uninstall UD/UCMDB on GCP with GKE, perform the following tasks:</p>\n<h2>Delete the UD/UCMDB deployment</h2>\n<ol>\n<li>Log on to the bastion node, navigate to the OPTIC Management Toolkit (OMT) installation directory:\n\t<pre>cd OMT_External_K8s_2x.x-xxx/bin</pre>\n</li>\n<li>Run the following command to remove the UD/UCMDB release:\n\t<pre>./helm uninstall &lt;<em>UD/UCMDB RELEASE NAME</em>&gt; -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt;</pre>\n\tWhere:\n\n\t<ul>\n<li><code>&lt;<em>UD/UCMDB RELEASE NAME</em>&gt;</code> is the UD/UCMDB release that you want to uninstall, which you can get by running the command <code>./helm list -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt;.</code></li>\n<li><code>&lt;<em>UD/UCMDB NAMESPACE</em>&gt;</code> is the namespace where you installed UD/UCMDB.</li>\n</ul>\n</li>\n<li>Run the following command to remove the OMT deployment:\n\t<pre>cd OMT_External_K8s_2x.x-xxx/scripts\n./cdfctl deployment delete -d &lt;<em>UD/UCMDB DEPLOYMENT NAME</em>&gt;</pre>\n\tWhere\n\n\t<ul>\n<li><code>&lt;<em>UD/UCMDB DEPLOYMENT NAME</em>&gt;</code> is the name you specified for the deployment you created to install UD/UCMDB.</li>\n</ul>\n\tFor example:\n\n\t<pre>./cdfctl deployment delete -d ucmdb-prod</pre>\n<p>You will need to enter the password of the administrator that you set during the OMT installation. </p>\n</li>\n</ol>\n<h2>Remove persistent volumes</h2>\n<p>If you created PVs based on the ucmdb-pv.yaml sample file as documented in the <em>Create persistent volumes for UD/UCMDB</em> step, you can run the following command to delete the persistent volumes:</p>\n<pre>kubectl delete -f &lt;ucmdb-pv.yaml path&gt;</pre>\n<p>For example:</p>\n<pre>kubectl delete -f /tmp/ucmdb-helm-charts/samples/ucmdb-pv.yaml</pre>\n<h2>Clean the NFS volumes</h2>\n<ol>\n<li>Copy and save the following script as <strong>cleanCMSNFS.sh</strong> on the bastion node:\n\n\t<pre>#!/bin/bash\nshopt -s extglob\n# Edit as needed\nMOUNT_POINT=\"/mnt/cms\"\nNFS_PARENT=\"var/vols/itom/cms\"\n\nrm -rf ${MOUNT_POINT}/${NFS_PARENT}/*/*\nls -l ${MOUNT_POINT}/${NFS_PARENT}/*/</pre>\n</li>\n<li>Run the following commands to clean up UD/UCMDB data in the NFS storage:\n\t<pre>chmod 755 cleanCMSNFS.sh\nsudo ./cleanCMSNFS.sh</pre>\n</li>\n</ol>\n<h2>Clean the databases</h2>\n<p>The UD/UCMDB un-installation process doesn't remove the databases residing in the external PostgreSQL databases. You need to remove the databases manually.</p>\n<ol>\n<li>Connect to the Postgres server with the command below:\n\t<pre>psql -h &lt;RDSEndpointAddress&gt; -U postgres -d postgres</pre>\n</li>\n<li>Delete all the UD/UCMDB databases by running the following commands:\n\t<pre># drop databases\ndrop database ucmdb_server_db;\ndrop database ucmdb_autopass_db;\ndrop database ucmdb_gateway_db;\ndrop database ucmdb_idm_db;\n</pre>\n</li>\n<li>Delete all the UD/UCMDB database users by running the following commands:\n\t<pre># drop users\ndrop role ucmdb_server;\ndrop role ucmdb_autopass;\ndrop role ucmdb_gateway;\ndrop role ucmdb_idm;\n</pre>\n</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}