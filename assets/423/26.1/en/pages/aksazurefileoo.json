{
  "title": "Configure Azure Premium Files for OO Containerized",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This release only supports Azure Files as OO Containerized storage service on Azure.</p>\n<p>Follow the steps in this section to create and configure Azure file shares.</p>\n<h2 id=\"Create_premium_Azure_file_shares\">Create premium Azure file shares</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Storage Admin</td>\n<td>Bastion node</td>\n</tr>\n</tbody>\n</table>\n<p>To create and configure premium Azure file shares for OO, log on to the bastion and follow these steps:</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">This account is the same as the one used when creating <a href=\"/doc/423/26.1/akspremiumnfshelm\" title=\"premium Azure file shares for Service Management\">premium Azure file shares for Service Management</a>.</div>\n</div>\n<ol>\n<li>Run the following command to get the key of the created FileStorage account:\n\t<pre>az storage account keys list \\\n    --resource-group &lt;resource_group_name&gt; \\\n    --account-name &lt;storage_account_name&gt; \\\n    --query \"[0].value\" | tr -d '\"'</pre>\n<p>In this command,</p>\n<ul>\n<li><b>&lt;resource_group_name&gt;</b> is the name of the resource group you created. Do <b>NOT</b> use your cluster's resource group name with the format <code>MC_&lt;resource_group&gt;_&lt;aks_cluster_name&gt;_&lt;location&gt;</code>.</li>\n<li><b>&lt;storage_account_name&gt;</b> is the name of the created FileStorage account.</li>\n</ul>\n</li>\n<li>Create an Azure file share for OO by running the following command: \n\t<pre>az storage share create \\\n--account-name &lt;storage_account_name&gt; \\\n--account-key &lt;storage_account_key&gt; \\\n--name \"&lt;oo_fileshare_name&gt;\" \\\n--quota &lt;share_quota&gt;</pre>\n<p>In this command,</p>\n<ul>\n<li><b>&lt;storage_account_name&gt;</b> is the name of the created FileStorage account.</li>\n<li><b>&lt;storage_account_key&gt;</b> is the key you got in the previous step.</li>\n<li><b>&lt;oo_fileshare_name&gt;</b>: Specify the name of the Azure file share for OO. For example, <strong>oo</strong>.</li>\n<li><b>&lt;share_quota&gt;</b>: Specify the size of the share (in GB). Must be greater than 0, and less than or equal to 5 TB (5120).</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"Configure_CMS_volumes\">Configure OO volumes</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Storage Admin</td>\n<td>Bastion node</td>\n</tr>\n</tbody>\n</table>\n<p>Once the Azure file share for OO is ready, log on to the bastion and set up volumes to store all OO data by following these steps:</p>\n<ol>\n<li>Copy and save the following script as <code>mountazurefile.sh</code>:\n\n\t<pre>#!/bin/bash\nMOUNTPOINT=/mnt/nfs/$3\nsudo mkdir -p $MOUNTPOINT\nif [ ! -d \"/etc/smbcredentials\" ]; then\nsudo mkdir /etc/smbcredentials\nfi\nif [ ! -f \"/etc/smbcredentials/$1.cred\" ]; then\n    sudo bash -c \"echo username=$1 &gt;&gt; /etc/smbcredentials/$1.cred\"\n    sudo bash -c \"echo password=$2 &gt;&gt; /etc/smbcredentials/$1.cred\"\nfi\nsudo chmod 600 /etc/smbcredentials/$1.cred\nsudo bash -c \"echo //$1.file.core.windows.net/$3 $MOUNTPOINT cifs nofail,vers=3.0,credentials=/etc/smbcredentials/$1.cred,dir_mode=0775,file_mode=0775,serverino,mfsymlinks,uid=$4,gid=$5 &gt;&gt; /etc/fstab\"\nsudo mount -t cifs //$1.file.core.windows.net/$3 $MOUNTPOINT -o vers=3.0,credentials=/etc/smbcredentials/$1.cred,dir_mode=0775,file_mode=0775,serverino,mfsymlinks,uid=$4,gid=$5</pre>\n</li>\n<li>Run the following command to mount the Azure file share for storing the OO data to bastion:\n\t<pre>sudo ./mountazurefile.sh  &lt;storage_account_name&gt; &lt;storage_account_key&gt; &lt;oo_fileshare_name&gt; &lt;SYSTEM_USER_ID&gt; &lt;SYSTEM_GROUP_ID&gt;</pre>\n<p>In these commands,</p>\n<ul>\n<li><b>&lt;storage_account_name&gt;</b> is the name of the created FileStorage account.</li>\n<li><b>&lt;storage_account_key&gt;</b> is the key you got when creating Azure file shares.</li>\n<li><b>&lt;oo_fileshare_name&gt;</b> is the name of the Azure file share for storing the <b>oo </b>data.</li>\n<li><b>&lt;SYSTEM_USER_ID&gt;</b> and <b>&lt;SYSTEM_GROUP_ID&gt;</b>: specify an operating system user ID and group ID that are used to run the process in the container, respectively. Both values must be 1999 or a number between 100000 and 2000000000. </li>\n</ul>\n</li>\n<li>Run the following command to test the performance of the Azure file share. <strong>Do not proceed if the result cannot meet the minimum requirement.</strong>\n<pre>dd if=/dev/zero of=/mnt/nfs/&lt;oo_fileshare_name&gt;/small.img bs=512 count=10000 oflag=dsync</pre>\n<p>In this command, <b>&lt;oo_fileshare_name&gt;</b> is the name of the Azure file share for storing the <b>oo</b> data.</p>\n<p>The output looks as below:</p>\n<pre>10+0 records in\n10+0 records out\n5120 bytes (5.1 kB, 5.0 KiB) copied, 0.0713496 s, 71.8 kB/s</pre>\n<p>The minimum requirement for the OO installation is <strong>60 kB/s</strong>. Based on the performance tests, the command returns an output higher than 60 kB/s in most Azure regions.</p>\n<p>Any number smaller than that will cause the installation to fail. In this case, contact Azure support to fix the performance issue.</p>\n</li>\n<li>Run the following commands to create directories for the <b>oo</b> data:\n\t<pre>cd /mnt/nfs/&lt;oo_fileshare_name&gt;\n\nsudo mkdir -p ./var/vols/itom/oo/oo_data_vol\nsudo mkdir -p ./var/vols/itom/oo/oo_config_vol\nsudo mkdir -p ./var/vols/itom/oo/oo_logs_vol\nsudo mkdir -p ./var/vols/itom/oo/oo_ras_logs_vol\nsudo mkdir -p ./var/vols/itom/oo/oo_data_export_vol\n</pre>\n<p>In these commands,</p>\n<p><b>&lt;oo_fileshare_name&gt;</b> is the name of the Azure file share for storing the <b>oo</b> data.</p>\n</li>\n<li>Run the following command to generate the secret under the OO namespace for Kubernetes to access the Azure file shares:\n\t<pre>kubectl create secret generic azure-secret --from-literal=azurestorageaccountname=&lt;storage_account_name&gt; --from-literal=azurestorageaccountkey=&lt;storage_account_key&gt; -n &lt;oo_namespace&gt;</pre>\n\tIn this command:\n\n\t<ul>\n<li><b>&lt;storage_account_name&gt;</b> is the name of the created FileStorage account.</li>\n<li><b>&lt;storage_account_key&gt;</b> is the key you obtained for the FileStorage account created.</li>\n<li><b>&lt;oo_namespace&gt;</b> is the OO namespace created at step <a href=\"/doc/423/26.1/createdeploymentaksoo\" title=\"Create new deployment for OO\">Create new deployment for OO</a>.</li>\n</ul>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}