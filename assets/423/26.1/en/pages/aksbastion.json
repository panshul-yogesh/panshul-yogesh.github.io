{
  "title": "Configure bastion",
  "content": "<div class=\"mw-parser-output\">\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>IT / Server administrator</td>\n<td>Azure portal and Bastion node</td>\n</tr>\n</tbody>\n</table>\n<p>The bastion node supports CentOS and Ubuntu operating systems.</p>\n<h3><a id=\"Create_bastion_node_using_Azure_portal\" name=\"Create_bastion_node_using_Azure_portal\" title=\"Create bastion node using Azure portal\"></a>Create bastion node using Azure portal</h3>\n<p>To create a virtual machine as the bastion node using, complete the following steps: </p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to the Azure portal at <a class=\"external free\" href=\"https://portal.azure.com\" rel=\"nofollow\" target=\"1\" title=\"https://portal.azure.com\">https://portal.azure.com</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Virtual machines</b> &gt; <b>+ Create &gt; + Virtual machine</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Under <b>Basics</b>, populate the following fields:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Subscription</b>: Select your subscription from the drop-down list.</li><li style=\"margin-left: 40px; position: relative;\"><b>Resource group</b>: Select the name of the resource group you created on the <a href=\"/doc/423/26.1/akscluster#Prerequisites\" title=\"Build AKS cluster\">Build AKS cluster</a> page. Be sure not to use your cluster's resource group name with the format <code>MC_&lt;resource_group&gt;_&lt;aks_cluster_name&gt;_&lt;location&gt;</code>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Virtual machine name</b>: Give a name to the bastion.</li><li style=\"margin-left: 40px; position: relative;\"><b>Region</b>: Select the same region as the created resource group.</li><li style=\"margin-left: 40px; position: relative;\"><b>Image</b>: Select a Linux image from the drop-down list. If you will use <b>Azure Files</b> as the storage service, we recommend that you select a <strong>Rocky 9.3 + </strong>image for the bastion. For details, see <a class=\"external text\" href=\"https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-linux\" rel=\"nofollow\" target=\"1\" title=\"Use Azure Files with Linux\">Use Azure Files with Linux</a>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Size</b>: Select <b>Standard B1ms</b>. For details, see <a href=\"/doc/423/26.1/akssizing\" title=\"Sizing guide\">Sizing guide</a>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Authentication type</b>: Select an authentication method for the bastion admin and specify a username and a password or an SSH key accordingly.</li><li style=\"margin-left: 40px; position: relative;\"><b>Public inbound ports</b>: Select <b>Allow selected ports</b> and <b>SSH (22)</b> from the drop-down list.</li></ul>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Under <b>Disks</b>, select <b>Premium SSD</b> as <b>OS disk type </b>and<b> 128 GiB(p10) </b>as<b> OS disk size.</b></li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Under <b>Networking</b>, select the created VNet as <b>Virtual network</b> and the subnet created for the bastion as <b>Subnet</b>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Leave the remaining settings as is and click <b>Review + create</b>.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In Azure portal <strong>All Service</strong>s &gt; <strong>Virtual Machines</strong> &gt; search for the bastion host name you used</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In <strong>Settings</strong> &gt; <strong>Extensions and Applications</strong> &gt; +<strong>Add</strong> → select <strong>Azure AD based SSH Login</strong></li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Review all the settings and click <b>Create</b> after confirmation. It will take several minutes for the virtual machine to be created.</li><li style=\"--number-width: 19px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following to update <code>nic ip-config </code>\n<pre><code>az network nic ip-config update \\\n--name  ipconfig1 \\\n--nic-name  &lt;bastion node nic&gt; \\\n--resource-group &lt;resource group&gt; \\\n--public-ip-address &lt;public IP address name&gt;\n\naz network nic update \\\n--name &lt;Bastion Node Nic Name&gt; \\\n--resource-group &lt;Resource Group&gt; \\\n--network-security-group &lt;Network security group name&gt;</code></pre>\n</li></ol>\n<p>After the VM is ready, log on to the bastion and perform the following steps to configure the connectivity from <code>kubectl</code> to the AKS cluster:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following commands to download <code>kubectl</code> and move it to <code>/bin</code>:\n\n\t<pre>curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl\n\nchmod 755 kubectl\n\nsudo mv kubectl /bin\n</pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Install the Azure CLI. For details, see <a href=\"https://learn.microsoft.com/en-us/cli/azure/install-azure-cli\" title=\"How to install Azure CLI\">How to install Azure CLI</a>. See the following examples for installing on Rocky Linux and Ubuntu:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">To install the Azure CLI on Rocky Linux, run the following commands:\n\t\t<pre>sudo dnf --disablerepo=* -y install https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm\nsudo dnf update -y\nsudo dnf install -y python3-pip\npip3 install --upgrade oauthlib\npip3 install azure-cli\n</pre>\n</li><li style=\"margin-left: 40px; position: relative;\">To install the Azure CLI on Ubuntu, run the following command:\n\t\t<pre>curl -sL https://aka.ms/InstallAzureCLIDeb | sudo bash\n</pre>\n</li></ul>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to log in to the Azure CLI. Following the instructions in the command output:\n\t<pre>az login</pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to test the connectivity from <code>kubectl</code> to AKS cluster:\n\t<pre>az aks get-credentials --resource-group &lt;resource_group_name&gt; --name &lt;kubernetes_cluster_name&gt; --subscription &lt;subscription_name_or_id&gt;  \n</pre>\n<p>If the above command runs successfully, a file named <strong>/home//.kube/config</strong> will be created with cluster credentials. You can run the <code>kubectl get nodes</code> command to check nodes status.</p>\n<p>Where:</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>&lt;resource_group_name&gt;</b>: Enter the name of the resource group you created on the <a href=\"/doc/423/26.1/akscluster#Prerequisites\" title=\"Build AKS cluster\">Build AKS cluster</a> page. Be sure not to use your cluster's resource group name with the format <code>MC_&lt;resource_group&gt;_&lt;aks_cluster_name&gt;_&lt;location&gt;</code>.</li><li style=\"margin-left: 40px; position: relative;\"><strong>&lt;kubernetes_cluster_name&gt;</strong>: Enter the name of the created Kubernetes cluster.</li><li style=\"margin-left: 40px; position: relative;\"><strong>&lt;subscription_name_or_id&gt;</strong>: Enter your subscription name or ID. You can get it by navigating to the Azure portal Home page &gt; <b>Subscriptions</b>.</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Based on the OS, run the following commands to install Docker. See the following examples for installing Docker on Rocky Linux and Ubuntu:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">Run the following commands to install Docker on Red Hat Enterprise Linux or CentOS Linux:\n\t\t<pre>sudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nsudo yum install -y docker-ce docker-ce-cli containerd.io --allowerasing\n\n</pre>\n</li><li style=\"margin-left: 40px; position: relative;\">Run the following commands to install Docker on Ubuntu:\n\t\t<pre>sudo apt update\nsudo apt install docker.io\n</pre>\n</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following commands to enable Docker and grant permission to run Docker commands as non-root:\n\t<pre>sudo groupadd docker\nsudo usermod -a -G docker ${USER}\nsudo systemctl start docker\nsudo systemctl enable docker</pre>\n</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log out and log in again to the bastion to enable the Docker group.</li></ol>\n<h2 class=\"mw-headline\" id=\"Related_topics\"><a id=\"External_references\" name=\"External_references\" title=\"External references\"></a>External references</h2>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">For information on how to connect to an Azure virtual machine, see <a class=\"external text\" href=\"https://docs.microsoft.com/en-us/azure/virtual-machines/windows/connect-logon\" rel=\"nofollow\" target=\"1\" title=\"Connect to a VM\">Connect to a VM</a>.</li><li style=\"margin-left: 28px; position: relative;\">For information on how to install the Azure CLI, see <a class=\"external text\" href=\"https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest\" rel=\"nofollow\" target=\"1\" title=\"Azure CLI installation guides\">Azure CLI installation guides</a>.</li></ul>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>Don't customize any ClusterRoles such as cluster-admin in the system to avoid potential issues. </div></div></div>\n</div>",
  "modifiedon": "2025-12-10 06:51:40"
}