{
  "title": "Create external databases",
  "content": "<div class=\"mw-parser-output\">\n<p>When deployed on Azure, the suite uses Azure Database for PostgreSQL Flexible Server as the database engine. This flexible server instance is a fully managed database server for the suite in a production environment.</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-tip-icon\"></div><div class=\"admonition-content admonition-tip-content\"><div>If you are new to this, we strongly suggest starting with Azure Flexible Server as your preferred option.</div></div></div>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-tip-icon\"></div><div class=\"admonition-content admonition-tip-content\"><div>If you're using self-hosted PostgreSQL on an Azure virtual machine already, we also highly recommend you to <a href=\"/doc/423/26.1/migrateselfhostedpg2azureserver\" title=\"Migrate from self-hosted PostgreSQL to Azure Flexible Server\">Migrate from self-hosted PostgreSQL to Azure Flexible Server</a>.</div></div></div>\n<h2><a id=\"Create_private_DNS_VNet_link\" name=\"Create_private_DNS_VNet_link\" title=\"Create private DNS VNet link\"></a>Create private DNS VNet link</h2>\n<div>Run the following command to create a Private DNS Zone and a link for the load balancer:</div>\n<div>\n<pre><code>az network private-dns zone create \\\n--resource-group &lt;Resource Group&gt; \\\n--name &lt;prinate dns zone name&gt;\n\naz network private-dns link vnet create\\ \n--resource-group &lt;Resource Group&gt;\\ \n--zone-name flexipg.postgres.database.azure.com\\ \n--name &lt;name of vnet link&gt;\\\n--virtual-network &lt;Vnet Name&gt;\\\n--registration-enabled false\n\naz network private-dns link vnet create \\\n  --resource-group &lt;Resource group&gt; \\\n  --zone-name &lt;Private DNS Zone name&gt; \\\n  --name  &lt;Vnet Link&gt; \\\n  --virtual-network /subscriptions/&lt;Subscription ID&gt;/resourceGroups/sigma-reg-261/providers/Microsoft.Network/virtualNetworks/&lt;Vnet Name&gt; \\\n  --registration-enabled true</code></pre>\n<h2><a id=\"Set_up_an_Azure_flexible_server\" name=\"Set_up_an_Azure_flexible_server\" title=\"Set up an Azure flexible server\"></a>Set up an Azure flexible server</h2>\n</div>\n<p>To set up an Azure flexible server, follow these steps.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Go to the Azure portal (<a href=\"https://portal.azure.com\" title=\"https://portal.azure.com\">https://portal.azure.com</a>).</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Search for \"Azure Database for PostgreSQL flexible servers\" and open it.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Create</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the creation page, enter the following information.\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Project details</strong>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><strong>Subscriptions</strong>: Enter your subscription ID. You can get it from the <strong>Azure portal Home page</strong> &gt; <strong>Subscriptions</strong>.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Resource group</strong>: Enter the name of the resource group created in the prerequisite tasks (see <a href=\"/doc/423/26.1/akscluster\" title=\"Build an AKS cluster\">Build an AKS cluster</a>). For example, myResourceGroup.</li></ul>\n</li><li style=\"margin-left: 40px; position: relative;\"><strong>Server details</strong>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><strong>Server name</strong>: Enter a name for the flexible server. For example: <strong>mypghost</strong>.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Region</strong>: Choose a region. Ideally, your database should be in the same region as your production environment.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Workload type:</strong> Select a workload type according to your needs.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Compute + storage</strong>: Click <strong>Configure server</strong>, then choose the compute size according to the <a href=\"/doc/423/26.1/akssizing\" title=\"Sizing considerations for Azure deployment\">Sizing considerations for Azure deployment</a>. Click <strong>Save</strong>.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Availability Zone</strong>: Select a value as needed. See the Azure documentation for instructions. </li><li style=\"margin-left: 52px; position: relative;\"><strong>PostgreSQL Version</strong>: Choose the PostgreSQL version. For details about supported PostgreSQL versions, see <a href=\"/doc/423/26.1/akssupportmatrix\" title=\"Support matrix for Azure deployment\">Support matrix for Azure deployment</a>.</li></ul>\n</li><li style=\"margin-left: 40px; position: relative;\"><strong>High availability</strong>  \n\t\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\">Check <strong>Enable high availability</strong> as needed. Selecting this option will enable zone redundant high availability across availability zones.</li></ul>\n</li><li style=\"margin-left: 40px; position: relative;\"><strong>Administrator account</strong>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><strong>Admin username</strong>: Name your database administrator. </li><li style=\"margin-left: 52px; position: relative;\"><strong>Password</strong>: Set the password for the admin.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Confirm password</strong>: Confirm the password.</li></ul>\n</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Next: Networking</strong>. Enter the following information.\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Connectivity method</strong>: Select <strong>Private access(Vnet Integration) </strong>&gt;<strong> Virtual network</strong>.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Subscription: </strong>Enter your subscription ID. You can get it from the <strong>Azure portal Home page</strong> &gt; <strong>Subscriptions</strong>.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Virtual network:</strong> Select the Vnet you created for the SMA production environment.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Subnet:</strong> Select the subnet prepared for <strong>PostgreSQL</strong>.</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Review + create</strong>.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Download the root CA. To do this, go to the <strong>Azure Database for PostgreSQL flexible server</strong> page, click the <strong>Networking</strong> section, then click <strong>Download SSL Certificate</strong>.<br/>\n\tYou will need to select the <b>Use TLS connection</b> option and upload this certificate in the IdM database configuration step during the installation.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Make sure the <b>pg_trgm </b>extension is allowed in the flexible server. For details, see <a href=\"https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-extensions\" title=\"PostgreSQL extensions in Azure Database for PostgreSQL - Flexible Server\">PostgreSQL extensions in Azure Database for PostgreSQL - Flexible Server</a>. Once done, the DBA user should be able to run the following SQL statement in the <strong>postgres</strong> database. \n\t<pre>create extension pg_trgm;</pre>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">(Optional) To enforce TLSv1.3 on the PostgreSQL server side, set the <a href=\"https://postgresqlco.nf/doc/en/param/ssl_min_protocol_version/\" title=\"ssl_min_protocol_version\"><strong>ssl_min_protocol_version</strong></a> and <strong><a href=\"https://postgresqlco.nf/doc/en/param/ssl_max_protocol_version/\" title=\"ssl_max_protocol_version\">ssl_max_protocol_version</a> </strong>parameters to <strong>TLSv1.3</strong>. See <a href=\"https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-server-parameters\" title=\"Server parameters in Azure Database for PostgreSQL - Flexible Server\">Server parameters in Azure Database for PostgreSQL - Flexible Server</a> for details.</li><li style=\"--number-width: 19px; --number-spacing: 24px; margin-left: 36px; position: relative;\">(Optional) - Enable certain azure extensions for Azure such as pg_stat_statements PGSTATTUPLE,UUID-OSSP under postgres server parameters.  </li></ol>\n<div>To download Postgres SSL certificate, refer to the official <a href=\"https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/security-tls#download-root-ca-certificates-and-update-application-clients-in-certificate-pinning-scenarios\" target=\"_blank\" title=\"Microsoft\">Microsoft</a> official documentation.</div>\n</div>",
  "modifiedon": "2025-12-10 07:05:59"
}