{
  "title": "Prepare File Storage - Subscribe NetApp Files (Helm)",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This release supports <strong>NetApp Files</strong> or <strong>Azure Files</strong> and <strong>Azure Disks</strong> as the storage service on Azure.</p>\n<p>To deploy the suite using Azure Files and Azure Disks, refer to <a href=\"/doc/423/26.1/akspremiumnfshelm\" title=\"Subscribe premium Azure Files and Azure Disks\">Subscribe premium Azure Files and Azure Disks</a>.</p>\n<p>To use Azure NetApp Files as the storage service, you can use either of the following methods.</p>\n<ul>\n<li>Option 1: Azure NetApp Files static provision.</li>\n<li>Option 2: Azure NetApp Files dynamic provision.</li>\n</ul>\n<p>You must set up Azure NetApp file for your deployment before you create the storage volume according to the prefered method.</p>\n<h1>Set up Azure NetApp Files</h1>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Storage administrator</td>\n<td>Bastion node and Azure portal</td>\n</tr>\n</tbody>\n</table>\n<p>You must first register for NetApp Files and NetApp Resource Provider with your subscription details before setting up the Azure NetApp files. To registered, complete the following steps.</p>\n<ol>\n<li>Run the following commands on the bastion:\n\t<pre>az login\n\n#Specify the subscription that has been allowlisted for Azure NetApp Files\n\naz account set --subscription &lt;subscription_id&gt;\n\n#Register the Azure Resource Provider\n\naz provider register --namespace Microsoft.NetApp --wait\n</pre>\n<p>Where:</p>\n<strong>&lt;subscription_id&gt;</strong>: Is the subscription ID.  You can find the subscription ID from the Azure portal <b>Home</b> page &gt; <b>Subscriptions</b>.</li>\n</ol><p>\nAfter registration, completet the following steps to create an Azure NetApp Files instance:\n\n</p><ol>\n<li>Log in to the Azure portal at <a class=\"external free\" href=\"https://portal.azure.com\" rel=\"nofollow\" target=\"1\" title=\"https://portal.azure.com\">https://portal.azure.com</a>.</li>\n<li>Click <b>Azure NetApp Files</b> &gt; <b>+ Create</b>.</li>\n<li>Give a name to the new NetApp account and populate the following fields:\n\t<ul>\n<li><b>Subscription</b>: Select your subscription from the drop-down list.</li>\n<li><b>Resource group</b>: Select the name of the resource group you created on the <a href=\"/doc/423/26.1/akscluster#Prerequisites\" title=\"Build AKS cluster \">Build AKS cluster </a>page. \n\t\t<div class=\"admonition\">\n<div class=\"admonition-icon admonition-important-icon\"></div>\n<div class=\"admonition-content admonition-important-content\">For the resource group name, make sure not to use the cluster's resource group name in this format:<i> MC_&lt;resource_group&gt;_&lt;aks_cluster_name&gt;_&lt;location&gt;</i>.</div>\n</div>\n</li>\n<li><b>Location</b>: Select the same location as the resource group and AKS cluster.</li>\n</ul>\n</li>\n<li>Click <b>Create</b>.</li>\n<li>Go to Azure NetApp Files, from the item list, click your created NetApp Files account.</li>\n<li>Click <b>Capacity pools</b> &gt; <b>+ Add pool</b> and populate the following fields:\n\t<ul>\n<li><b>Name</b>: Give a name to the new capacity pool.</li>\n<li><b>Service level</b>: Select a service level according to <a href=\"/doc/423/26.1/akssizing\" title=\"SMAX:25.1/AKSSizing\">Sizing guide</a>.</li>\n<li><b>Size (Tib)</b>: Type <b>4</b>. See details at <a href=\"/doc/423/26.1/akssizing\" title=\"SMAX:25.1/AKSSizing\">Sizing guide</a>. </li>\n<li><strong>QoS Type</strong>: Leave as <strong>Auto</strong>.</li>\n</ul>\n</li>\n<li>Click <b>Create</b> to create your capacity pool.</li>\n<li>[<strong>Only perform this step for static provision]</strong> Create a volume for storing the <b>Smart Analytics</b> data.\n\t<ol start=\"1\">\n<li>Click<b> Volumes</b> &gt; <b>+ Add volume</b>.\n\t\t<ul>\n<li>Under <b>Basics</b>, populate the following fields:\n\t\t\t<ul>\n<li><b>Volume name</b>: Give a name to the new volume.</li>\n<li><b>Capacity pool</b>: Select the created capacity pool.</li>\n<li><b>Quota (GiB)</b>: Type a quota, size according to <a href=\"/doc/423/26.1/akssizing\" title=\"SMAX:25.1/AKSSizing\">Sizing recommendation</a>.</li>\n<li><b>Virtual network</b>: Select the created virtual network.</li>\n<li><b>Delegated subnet</b>: Select the subnet created for NetApp Files. <b>Note that a subnet of CIDR 192.168.0.0/24 will cause the installation failure</b>.</li>\n</ul>\n</li>\n<li>Under <b>Protocol</b>, select <b>NFS</b> as protocol type and type a File path as the export path for NFS volumes. Select <strong>NFSv4.xx</strong> as the NFS version.</li>\n</ul>\n</li>\n<li>Leave the remaining settings as is and click <b>Review + create</b>.</li>\n<li>Review all the settings and click <b>Create</b> after confirmation.</li>\n</ol>\n</li>\n<li>[<strong>Only perform this step for static provision</strong>] Run the previous step again to create a volume for storing <b>generic</b> data (all data of OMT and the suite except Smart Analytics).</li>\n</ol>\n<h2>Azure NetApp Files static provision</h2>\n<p>To use Azure NetApp Files static provision, use the following steps to configure the necessary volumes.</p>\n<ol>\n<li>Install NFS client on the bastion:\n\t<pre>#For Red Hat Enterprise Linux or CentOS Linux instance:\n\nsudo yum install -y nfs-utils\n\n#For Ubuntu instance:\n\nsudo apt-get install nfs-common</pre>\n</li>\n<li>Copy and save the following script as <b>createNFS.sh</b>:\n\t<pre>#!/bin/bash\n\nif [ $# -lt 1 ]; then\n    echo \"Usage: $0 &lt;NFS-server-FQDN&gt; &lt;Generic_volume_path&gt; &lt;Smarta_volume_path&gt; &lt;UID&gt; &lt;GID&gt; [&lt;NFS-version&gt;]\"\n    exit 1\nfi\n\nMOUNT_POINT=\"/mnt/nfs\"\nNFS_SERVER=$1\nGENERIC_VOLUME_PATH=${2:-\"\"}\nSMARTA_VOLUME_PATH=${3:-\"\"}\nSUITE_USER_UID=$4\nSUITE_USER_GID=$5\nNFS_VERSION=${6:-\"4\"}\nNFS_PARENT=\"var/vols/itom\"\n\nif [ ! -d $MOUNT_POINT/${GENERIC_VOLUME_PATH} ]; then\n    mkdir -p $MOUNT_POINT/${GENERIC_VOLUME_PATH}\nfi\n\nif [ ! -d $MOUNT_POINT/${SMARTA_VOLUME_PATH} ]; then\n    mkdir -p $MOUNT_POINT/${SMARTA_VOLUME_PATH}\nfi\n\ndeclare -a arr1=(\n\"itsma/logging-volume\"\n\"itsma/config-volume\"\n\"itsma/data-volume\"\n)\n\ndeclare -a arr2=(\n\"itsma/rabbitmq-infra-rabbitmq-0\"\n\"itsma/rabbitmq-infra-rabbitmq-1\"\n\"itsma/rabbitmq-infra-rabbitmq-2\"\n\"itsma/itsma-smarta-sawarc-con-0\"\n\"itsma/itsma-smarta-sawarc-con-1\"\n\"itsma/itsma-smarta-sawarc-con-a-0\"\n\"itsma/itsma-smarta-sawarc-con-a-1\"\n\"itsma/itsma-smarta-saw-con-0\"\n\"itsma/itsma-smarta-saw-con-1\"\n\"itsma/itsma-smarta-saw-con-2\"\n\"itsma/itsma-smarta-saw-con-3\"\n\"itsma/itsma-smarta-saw-con-4\"\n\"itsma/itsma-smarta-saw-con-5\"\n\"itsma/itsma-smarta-saw-con-a-0\"\n\"itsma/itsma-smarta-saw-con-a-1\"\n\"itsma/itsma-smarta-saw-con-a-2\"\n\"itsma/itsma-smarta-saw-con-a-3\"\n\"itsma/itsma-smarta-saw-con-a-4\"\n\"itsma/itsma-smarta-saw-con-a-5\"\n\"itsma/itsma-smarta-sawmeta-con-0\"\n\"itsma/itsma-smarta-sawmeta-con-1\"\n\"itsma/itsma-smarta-sawmeta-con-a-0\"\n\"itsma/itsma-smarta-sawmeta-con-a-1\"\n)\n\nmountNFS() {\n    local VOLUME_FOLDER_NAME=$1\n    mount -t nfs -o nfsvers=${NFS_VERSION} ${NFS_SERVER}:/${VOLUME_FOLDER_NAME} ${MOUNT_POINT}/${VOLUME_FOLDER_NAME}\n    if [ $? -eq 0 ] || [ $? -eq 32 ]; then\n        echo \"Successfully mount ${VOLUME_FOLDER_NAME}\"\n        sed -i '$a\\'\"$NFS_SERVER:/${VOLUME_FOLDER_NAME} $MOUNT_POINT/${VOLUME_FOLDER_NAME} nfs nfsvers=${NFS_VERSION} 0 0\" /etc/fstab\n    else\n        echo \"Could not mount ${VOLUME_FOLDER_NAME}\"\n        exit 1\n    fi\n}\n\nmake_volume() {\n    local VOLUME=$1\n    local VOLUME_FOLDER_NAME=$2\n    pushd $(pwd)\n    cd ${MOUNT_POINT}/${VOLUME_FOLDER_NAME}\n    local MOUNTED_PV=${MOUNT_POINT}/${VOLUME_FOLDER_NAME}/${NFS_PARENT}/${VOLUME}\n    if [ ! -d ${MOUNTED_PV} ]; then\n        mkdir -p ${MOUNTED_PV}\n    fi\n    chown -R ${SUITE_USER_UID}:${SUITE_USER_GID} ${MOUNTED_PV}\n    chmod g+w ${MOUNTED_PV}\n    chmod g+s ${MOUNTED_PV}\n    chmod u+w ${MOUNTED_PV}\n    chmod u+s ${MOUNTED_PV}\n    popd\n}\n\nmountNFS ${GENERIC_VOLUME_PATH}\nmountNFS ${SMARTA_VOLUME_PATH}\n\nfor i in \"${arr1[@]}\"; do\n    make_volume ${i} ${GENERIC_VOLUME_PATH}\ndone\n\nfor i in \"${arr2[@]}\"; do\n    make_volume ${i} ${SMARTA_VOLUME_PATH}\ndone\n\n</pre>\n</li>\n<li>Run the following commands to configure volumes:\n\t<pre>chmod 755 createNFS.sh\nsudo ./createNFS.sh &lt;mount_path_ip&gt; &lt;generic_volume_path&gt; &lt;smarta_volume_path&gt; &lt;system_user_id&gt; &lt;system_group_id&gt;\n</pre>\n\tWhere,\n\n\t<ul>\n<li><strong>&lt;mount_path_ip&gt;</strong> is the IP address of the Azure Netapp file.</li>\n<li><strong>&lt;generic_volume_path&gt;</strong> is the mount path without the IP address. For example, if the mount path is <strong>10.1.3.4:/generic</strong>, your <strong>&lt;generic_volume_path&gt;</strong> should be <strong>generic</strong>.</li>\n<li><strong>&lt;smarta_volume_path&gt;</strong> is the mount path without the IP address. For example, if the mount path is <strong>10.1.3.4:/smarta</strong> your <strong>&lt;smarta_volume_path&gt;</strong> should be <strong>smarta</strong>.</li>\n<li><strong>&lt;system_user_id&gt;</strong> and <strong>&lt;system_group_id&gt;</strong>: specify the operating system user ID and group ID respectively that are used to run the process in the container. Both values must be 1999 or a number between 100000 and 2000000000 (for example, UID=100001 and GID=100002). </li>\n</ul>\n<p>You can find your <strong>&lt;mount_path_ip&gt;</strong>, <strong>&lt;generic_volume_path&gt;</strong>, and <strong>&lt;smarta_volume_path&gt;</strong> by navigating to the Azure portal &gt; <b>Azure NetApp Files</b> &gt; the created NetApp Files instance &gt; <b>Volumes</b>.</p>\n</li>\n</ol>\n<h2>Azure NetApp Files dynamic provision.</h2>\n<p>To prepare storage volumes using Azure NetApp Files dynamic provision, see<a href=\"/doc/423/26.1/preparepvsaks\" title=\" Prepare persistent storage for ESM on Azure\"> Prepare persistent storage for ESM</a>.</p>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}