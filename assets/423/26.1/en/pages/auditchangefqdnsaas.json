{
  "title": "Change FQDN for Audit in a managed Kubernetes environment",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>To change FQDN for Audit deployed in a deployment using managed Kubernetes, perform the following tasks.</p>\n<h3>Prerequisites for AWS (with EKS)</h3>\n<p>Bind the new FQDN with the Application Load Balancer. Do the following:</p>\n<ol>\n<li>Log in to the AWS Management Console with your AWS account.</li>\n<li>Navigate to <b>All services</b> &gt; <b>Networking &amp; Content Delivery</b> &gt; <b>Route 53</b> &gt; <b>Hosted Zone</b>.</li>\n<li>Click your domain and then click your record set.</li>\n<li>On the <b>Alias</b> tab, click <b>Yes</b>.</li>\n<li>On the <b>Alias Target</b> tab, type the created audit load balancer's DNS name, for example, <strong>dualstack.eks-alb-wj-347689543.us-west-2.elb.amazonaws.com</strong>.</li>\n<li>On the <b>Evaluate Target Health</b> tab, click <b>Yes</b>.</li>\n<li>Leave other settings as is, and click <b>Save Record Set</b>.</li>\n<li>\n<p>Import the self-signed certificate to AWS Certificate Manager (ACM) and replace the application load balancer certificate that's bound in the listener.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-important-icon\"></div>\n<div class=\"admonition-content admonition-important-content\">Currently, services integrated with ACM only support the <code>RSA_1024</code> and <code>RSA_2048</code> algorithms.</div>\n</div>\n<p>To do this, follow these steps:</p>\n<ol>\n<li>Run the following command on the bastion node (managed Kubernetes): \n\t\t<pre>aws acm import-certificate --certificate file://&lt;server.crt&gt; --private-key file://&lt;server.key&gt; --certificate-chain file://&lt;ca.crt&gt; --region &lt;region&gt;\n</pre>\n</li>\n<li>Go to <b>EC2</b> &gt; <b>LOAD BALANCING.</b> Select the application load balancer you created for audit and click <b>Listeners</b>. Select the port 443 listener and then click <b>Edit.</b></li>\n<li>For <b>Default SSL certificate</b>, select <b>From ACM (recommended)</b> and then select the certificate that you uploaded.</li>\n</ol>\n</li>\n</ol>\n<h3 id=\"Azure_.28AKS.29\">Update values.yaml (managed Kubernetes)</h3>\n<p>Navigate to your custom <strong>values.yaml</strong> file with properties configured for the Audit deployment, update the <strong>global.externalAccessHost</strong> parameter value with the new FQDN, for example, audit.new.com. This is a required parameter.</p>\n<h3>Update Audit deployment (managed Kubernetes)</h3>\n<p>Perform the following to trigger the Audit service upgrade:</p>\n<ol>\n<li>On the bastion node, navigate to OPTIC Management Toolkit (OMT) installation directory:\n\t<pre>cd OMT_External_K8s_2x.x-xxx/bin</pre>\n</li>\n<li>Run the following command:\n\t<pre>./helm upgrade Audit &lt;Audit<em> </em>Service<em> Chart</em>&gt; -n &lt;Audit Namespace&gt; -f &lt;Values<em> YAML File</em>&gt;</pre>\n</li>\n</ol>\n<p>where,</p>\n<p><em>&lt;Audit Service Chart&gt;</em> is the new tar file containing the Audit installation charts.</p>\n<p><em>&lt;Audit Namespace&gt;</em> is the namespace where you have deployed the Audit service.</p>\n<p><em>&lt;Values YAML File&gt;</em> is your custom <b>values.yaml </b>file with new FQDN.</p>\n<p>For example:</p>\n<pre>./helm upgrade audit audit-&lt;version&gt;.tgz -n auditns -f values.yaml</pre>\n<h3>Update Audit FQDN for all audit producers ( audit integration)</h3>\n<ol>\n<li>\n<p>Edit <strong>audit-client-secret</strong> by running the following command:</p>\n<pre>kubectl edit secret audit-client-secret -n &lt;SMAX<i> Namespace</i>&gt;\n</pre>\n<p>For example,</p>\n<pre>kubectl edit secret audit-client-secret -n itsma-5bsdi</pre>\n</li>\n<li>Update the new FQDN of Audit in the <strong>audit-client-secret</strong> for the property <strong>auditEngineHostname</strong>.\n\t<p><strong>Note</strong>: The secrets will be in base64 encoded format. You need to decode it from base64 format and update the hostname. Convert it to base64 encoded value and update the file.<br/>\n\tFor example:</p>\n<pre>auditEngineHostname=abcd-fqdn.abc.com</pre>\n</li>\n<li>Save the secret.</li>\n</ol>\n<h3 id=\"Import_the_audit_service_certificate_into_the_suite\">Import the Audit service certificate into the suite</h3>\n<p>To enable the suite to connect to the Audit service, you need to import the Audit service engine certificate to the suite's trusted key store and IdM's key store.</p>\n<ol>\n<li id=\"Export_the_Audit_service_engine_certificate\">\n<p>To export the Audit service engine certificate, and to enable Audit for the suite platform, see <a href=\"/doc/423/26.1/importcertificatehelm\" title=\"Import CA certificate into the suite\">Import CA certificate into the suite</a>. </p>\n</li>\n<li>\n<p>Run the following command on a control plane node (embedded Kubernetes deployments) to restart the suite's platform pod.</p>\n<pre> kubectl rollout restart deployment itom-xruntime-platform -n &lt;suite namespace&gt;</pre>\n</li>\n<li>\n<p>Run the following command on a control plane node (embedded Kubernetes deployments) or the bastion node (managed Kubernetes deployments) to restart the IdM pod.</p>\n<pre>kubectl rollout restart deployment idm -n &lt;suite namespace&gt;</pre>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}