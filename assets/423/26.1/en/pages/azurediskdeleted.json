{
  "title": "Azure Disk has been deleted accidentally",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This topic describes how to restore your Azure Disk if you've accidentally deleted it. Note that the steps below only restore your Azure Disk itself and the data stored in Azure Disk won't be restored.</p>\n<h2>Step 1: Clean up the old PVCs and PVS</h2>\n<ol>\n<li>List and delete the old PVCs:\n\t<pre>kubectl get pvc --all-namespaces|grep con-|grep azuredisk-premium &gt;unused-pvc.yaml\nkubectl delete -f unused-pvc.yaml</pre>\n</li>\n<li>List and delete the old PVs:\n\t<pre>kubectl get pv|grep Released&gt; unused-pv.yaml\nkubectl delete -f unused-pv.yaml\n</pre>\n</li>\n</ol>\n<h2>Step 2: Create new PVCs and PVs for Smart Analytics and RabbitMQ</h2>\n<ol>\n<li><span id=\"cke_bm_3746C\" style=\"display: none;\"> </span>Create a YAML file named <strong>idol-and-rabbitmq-pvcs.yaml</strong> to describe your old PVCs for Smart Analytics and RabbitMQ. Below is an example.\n\n\t<div class=\"Admonition_Tip\"><span class=\"autonumber\"><strong>Tip  </strong></span>The YAML file below describes a typical setting where all Smart Analytics StatefulSets have <code>1</code> replicas and RabbitMQ StatefulSet has <code>3</code>. You need to adjust the YAML file based on your actual Smart Analytics and RabbitMQ settings. To get your current Smart Analytics content pod number, run this command on the bastion node: <code>kubectl get pods -n &lt;namespace&gt; | grep con-</code> . For the typical setting described in our provided example, the command results should resemble the following: \n\n\t<pre>smarta-saw-con-0                   2/2     Running     0          6d22h\nsmarta-saw-con-a-0                 2/2     Running     0          6d22h\nsmarta-sawarc-con-0                2/2     Running     0          6d22h\nsmarta-sawarc-con-a-0              2/2     Running     0          6d22h\nsmarta-sawmeta-con-0               2/2     Running     0          6d22h\nsmarta-sawmeta-con-a-0             2/2     Running     0          6d22h</pre>\n<p>where you need to define 6 Smart Analytics PVCs for the listed pods.</p>\n<p>If your environment uses more pods and resources, for example, StatefulSet <code>smarta-saw-con</code> has <font face=\"monospace\">3</font> replicas, in addition to the PVC <strong>itsma-smarta-saw-con-0</strong> in the example, you also need to add the other ones: <strong>itsma-smarta-saw-con-1</strong> and <strong>itsma-smarta-saw-con-2</strong>.</p>\n</div>\n<div class=\"Admonition_Note\"><span class=\"autonumber\"><strong>Note</strong></span>  All the resource requirements are defined based on <strong>small </strong>or<strong> medium</strong> suite size. Note that for PVC <strong>itsma-smarta-saw-con-0</strong> and PVC <strong>itsma-smarta-saw-con-a-0</strong>, the storage size is defined as 15 Gi for the <strong>small</strong> suite size and 30 Gi for <strong>medium</strong>.</div>\n<pre>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: itsma-smarta-saw-con-0\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: &lt;15Gi for small size, 30Gi for medium size&gt;\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: itsma-smarta-saw-con-a-0\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: &lt;15Gi for small size, 30Gi for medium size&gt;\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: itsma-smarta-sawarc-con-0\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 20Gi\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: itsma-smarta-sawarc-con-a-0\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 20Gi\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: itsma-smarta-sawmeta-con-0\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 15Gi\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: itsma-smarta-sawmeta-con-a-0\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 15Gi\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: rabbitmq-infra-rabbitmq-0\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 2G\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: rabbitmq-infra-rabbitmq-1\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 2G\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: rabbitmq-infra-rabbitmq-2\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 2G\n  storageClassName: azuredisk-premium\n  volumeMode: Filesystem\n</pre>\n</li>\n<li>Delete the Smart Analytics and RabbitMQ PVCs by running this command on the bastion:\n\t<pre>kubectl delete -f idol-and-rabbitmq-pvcs.yaml -n $(kubectl get namespaces|grep itsma|head -n 1|awk '{print $1}')</pre>\n</li>\n<li>Create the Smart Analytics and RabbitMQ PVCs with this command:\n\t<pre>kubectl create -f idol-and-rabbitmq-pvcs.yaml -n $(kubectl get namespaces|grep itsma|head -n 1|awk '{print $1}')</pre>\n</li>\n<li>Check if the new PVCs are bound successfully:\n\t<pre>kubectl get pvc -n $(kubectl get namespaces|grep itsma|head -n 1|awk '{print $1}') | grep smarta-saw\n\nkubectl get pvc -n $(kubectl get namespaces|grep itsma|head -n 1|awk '{print $1}') | grep rabbitmq</pre>\n</li>\n</ol>\n<h2>Step 3: Perform a full reindex</h2>\n<p>After restore, you need to perform a <a href=\"/doc/423/26.1/fullreindex#Full_reindex_for_the_suite_that_is_deployed_on_AWS_(EKS),_Azure_(AKS),_or_GCP%22\">full reindex</a> for Smart Analytics to ensure the search and index performance.</p>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}