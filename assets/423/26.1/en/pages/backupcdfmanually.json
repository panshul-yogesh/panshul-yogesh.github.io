{
  "title": "Back up OMT data manually",
  "content": "<div class=\"mw-parser-output\"><p>If you don't have the privileges or ability to take snapshots of the VMs in your environment, you can back up OMT (previously known as CDF) manually.</p><div class=\"Admonition_Important\"><strong>Important:</strong> The disk space required to upgrade OMT is at least 20% of the size of the <code>&lt;CDF_HOME&gt;</code> directory plus a further 10 GB (on all control plane nodes and worker nodes). Make sure that you still have sufficient space after you have created your backup files.</div><div class=\"transcontent stn-end--BackupIntro\"></div><h2>Back up the Alertmanager rules</h2><div class=\"transcontent stn-begin--BackupAlertmanager\"></div><p>If you have configured Prometheus Alertmanager rules by using command line flags and a configuration file, the rules will be lost when you upgrade OMT.  We recommend that you back up the rules before you perform the upgrade. There is no need to do this if you configured Alertmanager rules by using a Helm command. </p><div class=\"transcontent stn-end--BackupAlertmanager\"></div><h2 class=\"mw-headline\" id=\"Back_up_CDF_installation_files\">Back up OMT data</h2><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-BackupCDF|CDFdata|N\"></span><p>To back up the data, run the <code>backup_recover.sh</code> command on each control plane node. Your terminal resembles the following:</p><pre><code>[root@myhost scripts]# cd $CDF_HOME/scripts\n\n[root@myhost scripts]# ./backup_recover.sh -m backup -b /opt/backup -t /opt/tmp\n\nThis script will back up the following items. Please wait while Creating Backup...\n - Node configuration\n - etcd\n - Vault\n - Kubernetes data\n - Velero release settings (if deployed)\n - Embedded PostgreSQL databases (if deployed)\n\n[INFO] 2023-08-08 01:57:17 : Back up node configuration\n[INFO] 2023-08-08 01:57:18 : Back up etcd data\n[INFO] 2023-08-08 01:57:19 : Back up Vault data\n[INFO] 2023-08-08 01:57:20 : Back up Kubernetes data\n[INFO] 2023-08-08 01:57:21 : Back up Helm release settings of Velero\n[INFO] 2023-08-08 01:57:24 : Back up embedded PostgreSQL databases\n[INFO] 2023-08-08 01:57:24 : Could not find deployment itom-pg-backup; skip embedded PostgreSQL databases backup.\nPlease input passphrase to encrypt backup package:\nConfirm the encryption passphrase:\n\nBackup complete.\n\nThe backup file cdf-br-myhost.com-20230808015726.enc is placed in /opt/backup.\nThis file can be used to recover the environment in case of loss of control plane nodes. Please store it securely.</code></pre><p>The following data are backed up after running the command:</p><dl><dd><ul><li>OMT installation files</li><li>etcd data</li><li>cdf-cluster-host ConfigMap</li><li>vault-params-key Vault keys</li><li>Vault credentials</li><li>Velero helm release setting (applicable only when you've deployed Velero)</li><li>Embedded PostgreSQL databases (applicable only when embedded databases are used)</li></ul><div class=\"Admonition_Note\"><strong>Note</strong>: the etcd data and Vault data are encrypted. Store the key and the backup file securely.</div></dd></dl><p><br/></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-BackupCDF|CDFdata|N\"></span><h2 class=\"mw-headline\" id=\"Back_up_CDF_database_data\">Back up the external OMT database</h2><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-BackupCDF|ExternalDatabase|N\"></span><p>OpenText recommends you to back up the external database frequently according to the business requirements.<br/>\nIf you used an external database (PostgreSQL or Oracle) to install OMT, you need to back up the external database. Refer to the related database manual for the detailed backup steps.</p><p><br/></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-BackupCDF|ExternalDatabase|N\"></span><h2 class=\"mw-headline\" id=\"Back_up_data_in_exported_NFS_directories\">Back up data in exported NFS directories</h2><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-BackupCDF|NFSFolders|N\"></span><ol>\n<li>\n<p>Run the following command on any of the control plane nodes to list all the PV claims and related details.<br/>\n<code>kubectl get pv</code><br/>\n\tYour terminal resembles the following:</p>\n<pre>root@sh ~]# kubectl get pv\nNAME                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                       STORAGECLASS     REASON   AGE\ndb-single                   5Gi        RWX            Retain           Bound    core/db-single-vol          dbsinglevol               27h\ndemo-tjqlo-demo-de-volume   5Gi        RWX            Recycle          Bound    demo-tjqlo/demo-de-volume   demodevolume              27h\ndemo-tjqlo-global-volume    5Gi        RWX            Recycle          Bound    demo-tjqlo/global-volume    globalvolume              27h\ndemo-tjqlo-volume4          5Gi        RWX            Recycle          Bound    demo-tjqlo/volume4          volume4                   27h\nitom-logging                1Mi        RWX            Retain           Bound    core/itom-logging-vol       itomloggingvol            27h\nitom-vol                    5Gi        RWX            Retain           Bound    core/itom-vol-claim         cdf-default               27h\n</pre>\n</li>\n<li>\n<p>Run the following command on any of the control plane nodes to get the PV claims and details about NFS volumes. You can identify the NFS server on which each PV is located by referring to the <code>Server</code> entry in the <code>Source</code> section of the output, and the path to each PV by referring to the <code>Path</code> entry in the <code>Source</code> section.</p>\n<pre><code>kubectl describe pv &lt;pv name&gt;</code></pre>\n<p><br/>\n\tIn this command, <code>&lt;pv name&gt;</code> is a placeholder for the name of the PV for which you want to get more information. After you run the command, your terminal resembles the following:</p>\n<pre><code>[root@myhost scripts]# kubectl describe pv itom-vol\nName:            itom-vol\nLabels:          &lt;none&gt;\nAnnotations:     kubectl.kubernetes.io/last-applied-configuration:\n                   {\"apiVersion\":\"v1\",\"kind\":\"PersistentVolume\",\"metadata\":{\"annotations\":{},\"name\":\"itom-vol\"},\"spec\":{\"accessModes\":[\"ReadWriteMany\"],\"capa...\n                 pv.kubernetes.io/bound-by-controller: yes\nFinalizers:      [kubernetes.io/pv-protection]\nStorageClass:    cdf-default\nStatus:          Bound\nClaim:           core/itom-vol-claim\nReclaim Policy:  Retain\nAccess Modes:    RWX\nVolumeMode:      Filesystem\nCapacity:        5Gi\nNode Affinity:   &lt;none&gt;\nMessage:\nSource:\n    Type:      NFS (an NFS mount that lasts the lifetime of a pod)\n    Server:    nfsserver.myhost.com\n    Path:      /var/vols/itom/core\n    ReadOnly:  false\nEvents:        &lt;none&gt;\n</code></pre>\n</li>\n<li>Back up the NFS exported volumes manually. The NFS volumes vary in different deployments.<br/>\n<br/>\n\tIf using embedded PostgreSQL, back up the following PV claims:\n\t<ul>\n<li>itom-vol-claim</li>\n<li>db-single-vol</li>\n<li>itom-logging-vol</li>\n</ul>\n<p> <br/>\n\tIf using external databases, back up the following PV claims:\n</p>\n<ul>\n<li>itom-vol-claim</li>\n<li>itom-logging-vol</li>\n</ul>\n</li>\n</ol>\n<p><br/>\n</p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-BackupCDF|NFSFolders|N\"></span><div class=\"transcontent stn-begin--relatedTopics\"></div><h2 class=\"mw-headline\" id=\"Related_topics\">Related topics</h2><p><a href=\"/doc/423/26.1/upgradebackupcdf\" title=\"SMAX:25.1/UpgradeBackupCdf\">Back up OMT data before upgrade</a></p><div class=\"transcontent stn-end--relatedTopics\"></div></div>",
  "modifiedon": "2025-10-24 08:51:12"
}