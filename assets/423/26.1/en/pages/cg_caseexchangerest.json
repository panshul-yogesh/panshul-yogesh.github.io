{
  "title": "Attachments",
  "content": "<div class=\"mw-parser-output\"><br/><p id=\"Introduction\">This topic explains how to add attachments to records using APIs.  Adding an attachment to a record in Service Management is a 2-step process as follows.</p>\n<ol>\n<li>Upload the file to Service Management as an attachment</li>\n<li>Link the uploaded attachment to a record.</li>\n</ol>\n<p>The sample scenario uses the Postman REST API client to upload and link an attachment to an Incident record in Service Management. If you use a different REST API client, refer to its official documentation for detailed instructions.</p>\n<div>\n<h2>Prerequisites</h2>\n<p>To follow the instructions in this topic, you must know how to do the following:</p>\n<ul>\n<li>Configure and use the Postman REST API client.</li>\n<li>Import users into Service Management.</li>\n</ul>\n</div>\n<h2><span style=\"font-size: clamp(1.59375rem, 18.7895px + 1.39803vw, 2.125rem);\">Upload a file to Service Management</span></h2>\n<h3>Set up the REST client</h3>\n<p>Use the Case Exchange API to upload the file to Service Management. The URL uses the format <code>https://&lt;MasterNode&gt;/rest/&lt;tenantId&gt;/ces/attachment/</code>.</p>\n<p>To set up Postman to use the API complete the following steps:</p>\n<ol>\n<li>Set the action to <strong>POST.</strong></li>\n<li>Enter the Case Exchange API URL.</li>\n</ol>\n<h3>Set the request headers</h3>\n<ol>\n<li>Go to the <strong>Headers </strong>tab</li>\n<li>Add the following two headers:\n\t<ul>\n<li><strong>Content-Type</strong>: Set to <em>multipart/form-data;boundary=YYYY</em>. The boundary <em>YYYY </em>is just an example. If you use a different boundary value, make sure you update the content in the body to use the same. See the <strong>Create the request body</strong> section.</li>\n<li><strong>User-Agent</strong>: Set to <em>Apache-HttpClient/4.4.1</em>. This allows Postman to pass authorization to Service Management based on a logged-in UI session. Make sure there is an active Service Management session in the tenant to which you are making a request.</li>\n</ul>\n<a class=\"image\" href=\"\"> <img alt=\"attachments 1.png\" data-file-height=\"501\" data-file-width=\"888\" height=\"501\" src=\"../../../images/attachments_1_90e21116.png\" width=\"888\"/> </a></li>\n</ol>\n<h3>Create the request body</h3>\n<ol>\n<li>Go to the <strong>Body </strong>tab.</li>\n<li>Choose the <strong>raw</strong> option.</li>\n<li>Add the content for the request body in the <strong>Body </strong>tab. It must contain the following information:\n\t<ul>\n<li>Attachment file name.</li>\n<li>Attachment type.</li>\n<li>Attachment content.</li>\n</ul>\n\tThe sample format for the request body resembles the following:\n\n\t<pre><code>--YYYY\n\nContent-Disposition: form-data; name=\"files[]\"; filename=\"test.txt\"\nContent-Type: text/plain\n\nThis is coming from Postman.\n\n--YYYY</code></pre>\n<p>Where:</p>\n<ul>\n<li><b>--YYYY: </b>Is the boundary indicator. In the example, the boundary value is YYYY. Make sure this matches the value set for the content-type header. For setting the content-type header, see <strong>Set the request headers</strong> section.</li>\n<li><b>Content-Disposition:</b> Contains the attachment filename. In the example, the file name is <strong>test.txt</strong>. Replace this with your attachment's filename.</li>\n<li><strong>Content-type:</strong> Contains the media type and subtype of the attachment’s MIME type. You can find a list of these MIME types <a href=\"http://www.sitepoint.com/web-foundations/mime-types-complete-list/\" rel=\"nofollow\" target=\"1\" title=\"here\">here</a>. In the example, the type is text/plain. Replace it with the MIME type of your attachment.</li>\n<li><strong>Request body</strong>: Contains the attachment's content. In the example, the content is a text that reads \"This is coming from Postman\".</li>\n</ul>\n<br/>\n\tThe following image shows the settings in Postman:\n\t<div><a class=\"image\" href=\"\"> <img alt=\"attachments 2.png\" data-file-height=\"520\" data-file-width=\"888\" height=\"520\" src=\"../../../images/attachments_2_b64c2fb2.png\" width=\"888\"/> </a></div>\n</li>\n<li>Click <strong>Send. </strong></li>\n</ol>\n<p>This will create an attachment named test.txt in Service Management with the text \"This is coming from Postman\".</p>\n<h2>Upload a binary file to Service Management</h2>\n<p>The steps to attach binary files such as media files, executables, or databases to Service Management using Postman is similar to attaching text files, except for the following differences:</p>\n<ul>\n<li>In the <strong>Set the request headers</strong> section, don't specify the Content-Type header in the <strong>Headers </strong>tab.\n\n\t<div><a class=\"image\" href=\"\"> <img alt=\"attachments 3.png\" data-file-height=\"383\" data-file-width=\"888\" height=\"383\" src=\"../../../images/attachments_3_7f459307.png\" width=\"888\"/> </a></div>\n</li>\n<li>\n<p>In the <strong>Create the request body</strong> section, you must select the file to upload. Complete the following steps to select the file. If you are using Postman, it automatically sets the <strong>Content-Disposition</strong> and <strong>Content-Type</strong> keys. </p>\n<ol>\n<li>\n<p>In the <strong>keys </strong>column, enter <strong>files[].</strong></p>\n</li>\n<li>\n<p>Select <strong>File</strong> from the drop down list on the right of the <strong>value </strong>column.</p>\n</li>\n<li>\n<p>Click <strong>Choose Files</strong> to select the file to attach.</p>\n<div><a class=\"image\" href=\"\"> <img alt=\"attachments 4.png\" data-file-height=\"383\" data-file-width=\"888\" height=\"383\" src=\"../../../images/attachments_4_ab0f9c57.png\" width=\"888\"/> </a></div>\n</li>\n<li>Click <strong>Send.</strong></li>\n</ol>\n</li>\n</ul>\n<div>This will create a binary attachment in Service Management.</div>\n<h2>Review the results</h2>\n<p>After you upload the file to Service Management using the API, check the response. It contains the information needed to attach the file to a specific record in Service Management. See the following sample response:</p>\n<div><a class=\"image\" href=\"\"> <img alt=\"response 1.png\" data-file-height=\"249\" data-file-width=\"855\" height=\"249\" src=\"../../../images/response_1_5ef340c0.png\" width=\"855\"/> </a></div>\n<h2>Link the attachment to an Incident record</h2>\n<p>After you upload the file to Service Management, you must attach it to a record. In this sample scenario shows how to attach it to an Incident record.</p>\n<p>To attach the file to an Incident record, you must update the <strong>IncidentAttachments </strong>element with information from the API response. For a sample response, see the <strong>Review the results</strong> section.</p>\n<p>The <strong>IncidentAttachments </strong>element includes a <strong>complexTypeProperties</strong> array that can contain one or more <strong>properties</strong> elements. The <strong>properties </strong>element stores the following attachment attributes:</p>\n<ul>\n<li><strong>id:</strong> Set this using the <strong>guid </strong>value from API response.</li>\n<li><strong>file_name:</strong> File name of the attachment. Use the <b>name </b>value from the API response.</li>\n<li><strong>file_extension:</strong> File extention type of the attachment. Use the file extension from the <b>name </b>value from the API response. For example, if the file name is test.txt, set this value to <strong>.txt</strong>.</li>\n<li><strong>size:</strong> The <strong>contentLength </strong>value from the API response.</li>\n<li><strong>mime_type:</strong> The <strong>contentType </strong>value from the API response.</li>\n<li><strong>Creator:</strong> The user that added the attachment (current logged in user's id or email).</li>\n</ul>\n<h3>Update an attachment in an Incident record</h3>\n<p>You can use one of the following standard REST APIs to link the attachment to a Incident record:</p>\n<ul>\n<li>EMS REST API</li>\n<li>Case Exchange API (URL format: <code>https://&lt;MasterNode&gt;/rest/&lt;tenantId&gt;/ces/</code>).</li>\n</ul>\n<div>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-caution-icon\"></div><div class=\"admonition-content admonition-caution-content\"><div>This example replaces any previously linked attachments in the incident. To preserve existing attachments and add a new attachment see <strong>Add an attachment to an Incident record</strong> section.</div></div></div>\n</div>\n<div>In our example, the request body for updating the incident with id ‘27496’ would resemble the following:</div>\n<pre>{  \n   \"entities\":[  \n      {  \n         \"entity_type\":\"Incident\",\n         \"properties\":{  \n            \"Id\":\"27496\",       \n            \"IncidentAttachments\":\"{\n                 \\\"complexTypeProperties\\\":[\n                      {\n                        \\\"properties\\\":{ \n                            \\\"id\\\":\\\"eac57a20-76e5-4318-842e-e46d3b6269c5\\\",\n                            \\\"file_name\\\":\\\"test.txt\\\",\n                            \\\"file_extension\\\":\\\"txt\\\",\n                            \\\"size\\\":\\\"36\\\",\n                            \\\"mime_type\\\":\\\"text/plain\\\",\n                            \\\"Creator\\\":\\\"my.email@mf.com\\\"\n                                       }\n                      }\n                  ]\n             }\"\n         }\n      }\n   ],\n   \"operation\":\"UPDATE\"\n}\n</pre>\n<h3 id=\"Adding_attachments_to_an_Incident\">Add an attachment to an Incident record</h3>\n<p>To add an attachment to an Incident record instead of overwriting existing attachments, you must do the following before making the call to link attachment:</p>\n<ul>\n<li>Make a REST API request using the GET method to extract Incident record.</li>\n<li>In the response, go to the  <strong>IncidentAttachments </strong>element's <strong>complexTypeProperties </strong>array.</li>\n<li>In the <strong>complexTypeProperties </strong>array, add a new <strong>properties </strong>element.</li>\n<li>Edit the newly added <strong>properties </strong>element and update the attributes with values for the new attachment.</li>\n<li>Make the API call to link the attachment to the Incident record. For details, see <strong>Update an attachment in an Incident record</strong> section.</li>\n</ul>\n<h2 id=\"Creating_the_REST_body_using_JAVA\">Creating the REST body using JAVA</h2>\n<p>You can apply the same concepts you used with Postman to create requests using a script or application. The sample code in this section shows how to construct the request body using  a Java File object. The File object is referred as <strong>fi</strong> in the code sample.</p>\n<p><strong>Points to remember:</strong></p>\n<ul>\n<li>Apply the multi-part/form data approach. </li>\n<li>Extract the file content and place it in the body of the request.</li>\n<li>Specify the Content-Type.</li>\n<li>This code only supports files of type .jpg, .pdf, and.txt. You can extend it to support other types.<br/>\n\t </li>\n</ul>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>The sample code presents one way to create the request body. It should not be interpreted as the best or only way to perform this function.  We don't provide official support for it in any way.</div></div></div>\n<pre>// Attachment file\nFile fi = new File(…);\n\n// Get file extension\nString extension = \"\";\n int i = fi.toString().lastIndexOf('.'); \nif (i &gt; 0) { \n    extension = fi.toString().substring(i+1);\n } \nString contentType = \"text/plain\"; \nif ( extension.equals(\"jpg\"))\n     contentType = \"image/jpeg\";\n if ( extension.equals(\"pdf\")) \n    contentType = \"application/pdf\";\n if ( extension.equals(\"png\"))\n     contentType = \"image/png\";\n\n// Generate prefix and suffix \nString prefix = \"--YYYY\\n\" + \n        \"Content-Disposition: form-data; name=\\\"files[]\\\"; filename=\\\"\"+ fi.getName()\n         +\"\\\"\\n\" + \n        \"Content-Type: \"+ contentType + \"\\n\" +\n         \"\\n\";  String suffix = \"\\n\" + \"--YYYY--\\n\";\n\n// Calculate total payload length \nlong payloadLength = prefix.length() + fi.length() + suffix.length();\n\n// Setup connection\nHttpsURLConnection con = …\ncon.setRequestMethod(\"POST\");\n\n// Other headers\n…\n\n// Set HTTP connection output stream for POST body as non-cached fixed length\n// The full content of the body is not stored in memory \ncon.setDoOutput(true);\n con.setFixedLengthStreamingMode(payloadLength);\n OutputStream os = con.getOutputStream(); \nDataOutputStream ds = new DataOutputStream(os);\n\n// Write prefix to stream (as ASCII) \nds.writeBytes(prefix);  \n\n// Write file content to stream (as binary 8-bit octets)\n InputStream is = new FileInputStream(fi); \nbyte[] buffer = new byte[1024]; \nint bytesRead; \nwhile ((bytesRead = is.read(buffer)) != -1 ) {\n     ds.write(buffer, 0 , bytesRead); \n}  \n\n// Write suffix to stream (as ASCII) ds.writeBytes(suffix);  ds.close();\n// Handle HTTP response …</pre>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}