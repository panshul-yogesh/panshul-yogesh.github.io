{
  "title": "Change database user password encryption from md5 to scram-sha-256",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>If your PostgreSQL database requires the user password to be encrypted with scram-sha-256 and your system still uses md5, you can follow the steps below to switch from md5 to scram-sha-256.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">\n<p>The procedure provided in this topic will cause a system downtime, therefore, we recommend that you perform this operation during system maintenance. </p>\n</div>\n</div>\n<ol>\n<li>\n<p>(Optional) You can identify the password encryption by running the following SQL command with the database administrator account.</p>\n<p><code>SELECT rolpassword, rolname from pg_authid;</code>  </p>\n<p>For any Service Management database user rows, the value of the column <strong>rolpassword</strong> starting with <strong>md5 </strong>identifies that the passwords are encrypted using md5 and kept in the database. From <a href=\"/doc/423/26.1/changedbapswdinvault\" title=\"Change the password of DB owner or DBA in Vault\">here</a>, you can find the user names of Service Management databases.  </p>\n</li>\n<li>\n<p>Update Service Management database users' passwords saved in Vault. For details, see <a href=\"/doc/423/26.1/changedbapswdinvault\" title=\"Change the password of DB owner or DBA in Vault\">Change the password of DB owner or DBA in Vault</a>.<br/>\n<strong>Note: </strong>You can skip this step if you are certain that you know all these Service Management database users' passwords and have confirmed that the passwords are correct. This will allow you to avoid restarting the database-related pods at the end of this procedure.</p>\n</li>\n<li>\n<p>For each Service Management database user and the DBA user, run the following SQL command to update the password:<br/>\n<code>set password_encryption='scram-sha-256';<br/>\n\talter user &lt;xxxx&gt; with password '&lt;password&gt;';</code></p>\n<p><strong>Note: </strong>The password should be identical to the password updated in step 2.</p>\n</li>\n<li>\n<p>Start a new PostgreSQL database connection and check the <strong>password_encryption</strong> setting in the database by running the following SQL command.</p>\n<p><code>SHOW password_encryption;</code></p>\n</li>\n<li>\n<p>If the result is <strong>md5</strong>, change the <strong>password_encryption</strong> parameter to <strong>scram-sha-256</strong>.</p>\n<ul>\n<li>\n<p>For EKS, follow the instructions described in <a href=\"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_WorkingWithDBInstanceParamGroups.html\" title=\"Working with DB parameter groups\">Working with DB parameter groups</a>.</p>\n</li>\n<li>\n<p>For AKS, follow the instructions described in <a href=\"https://learn.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-server-parameters\" title=\"Server parameters in Azure Database for PostgreSQL - Flexible Server\">Server parameters in Azure Database for PostgreSQL - Flexible Server</a>.</p>\n</li>\n<li>\n<p>For GCP, follow the instructions described in <a href=\"https://cloud.google.com/sql/docs/postgres/flags\" title=\"Configure database flags\">Configure database flags</a>.</p>\n</li>\n<li>\n<p>For on-premises, add the following line to the <code>postgresql.conf</code> file. <br/>\n<code>password_encryption = 'scram-sha-256'</code><br/>\n\t\tThen, reload the configuration by running the following SQL command.<br/>\n<code>select pg_reload_conf();</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p>(Optional) Repeat step 1 to make sure the password encryption has been switched to scram-sha-256.</p>\n</li>\n<li>\n<p>For an on-premises database, change <strong>md5</strong> to <strong>scram-sha-256</strong> for all Service Management users in the <code>pg_hba.conf</code> file. Then, reload the configuration by running:<br/>\n<code>select pg_reload_conf();</code></p>\n</li>\n<li>\n<p>If you have updated passwords in Vault as described in step 2, restart the database-related pods. You can use the <b>passwordManagement.sh</b> script described in <a href=\"/doc/423/26.1/changedbapswdinvault\" title=\"Change the password of DB owner or DBA in Vault\">Change the password of DB owner or DBA in Vault</a> to find out the pods to be restarted.</p>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}