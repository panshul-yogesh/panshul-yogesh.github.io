{
  "title": "Change PVC sizes",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>Usually, a StorageClass provisioner can automatically expand the size of the storage class without downtime. The following method is only for those that can't expand the disk size automatically.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-important-icon\"></div>\n<div class=\"admonition-content admonition-important-content\">Always check with your storage admin for a resizing solution. Only if your storage admin hasn't such a solution, follow the general guidelines below to resize your storage.</div>\n</div>\n<h2>PV access mode</h2>\n<p>SMA uses two Persistent Volume (PV) access modes: </p>\n<ul>\n<li>ReadWriteOnce (RWO). For RWO, we recommend you stop the application, delete and recreate the Persistent Volume Claim (PVC). This requires reindexing or introduces downtime. </li>\n<li>ReadWriteMany (RWX). For RWX, we recommend you first back up all data except log files and then expand the disk and recover data. </li>\n</ul>\n<p>Use the following command to identify the access mode of the PV: </p>\n<pre><code>kubectl get pv</code></pre>\n<h2>How to resize an RWO PVC</h2>\n<p>For RWO, there's no need to back up data. Create a new PVC to replace the old one.</p>\n<h3>Back up current settings</h3>\n<ol>\n<li>Before taking action, we strongly recommend you back up the current configuration settings for deployments or statefulsets for which you want to expand their size, by running the following commands:\n\t<pre><code>#list the name\nkubectl get statefulset  -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \")\n#Replace  statefuleset name by yours.\nkubectl get statefulset  -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \") &lt;statefulset_name&gt; -o yaml &gt; ~/&lt;statefulset_name&gt;.yaml\n</code></pre>\n</li>\n<li>Go to the home folder and double-check if you have created the yaml file with the correct content.</li>\n</ol>\n<h3>Stop the application</h3>\n<p>Run the following command to stop the SMA service. If you want to resize rabbitmq, stop the 3 pods at the same time; if you want to resize smarta-saw-con-0, you also need to resize smarta-saw-con-a-0 because they're mirror applications which you must change at the same time.</p>\n<pre><code>kubectl scale statefulset -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \") smarta-saw-con --replicas=0\nkubectl scale statefulset -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \") smarta-saw-con-a --replicas=0</code></pre>\n<h3>Delete the PVC</h3>\n<ol>\n<li>Wait for the pod to get stopped, and then run the following command to delete the PVC:\n\t<pre><code>kubectl delete pvc -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \") itsma-smarta-saw-con-0 itsma-smarta-saw-con-a-0</code></pre>\n</li>\n<li>If you see the PVC remains in terminating status for a long time, perform the following steps:\n\t<ol start=\"1\">\n<li>Run the following command:\n\t\t<pre><code>kubectl edit pvc itsma-smarta-saw-con-0 -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \")</code></pre>\n</li>\n<li>Remove the following lines, and then save the file:</li>\n</ol>\n</li>\n</ol>\n<pre><code>  finalizers:\n  - kubernetes.io/pvc-protection</code></pre>\n<h3>Create the PVC with a new size</h3>\n<ol>\n<li>On a control plane node or the bastion machine, create a file named <strong>pvc_new.yaml</strong> with the following content:\n\n\t<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: itsma-smarta-saw-con-0\n  namespace: &lt;namespace&gt;\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 20G\n  storageClassName: cdf-default\n  volumeMode: Filesystem\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: itsma-smarta-saw-con-a-0\n  namespace:  &lt;namespace&gt;\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 20G\n  storageClassName: cdf-default\n  volumeMode: Filesystem\n\n</code></pre>\n</li>\n<li>Change the default size 20G to a proper value, replace &lt;namespace&gt; with your <strong>itsma-xxxx</strong> namespace, and then run the following command to create a new PVC:</li>\n</ol>\n<pre><code>kubectl create -f pvc_new.yaml</code></pre>\n<h3>Start the application</h3>\n<p>Start the application and check if the pod is up and running.</p>\n<pre><code>kubectl scale statefulset -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \") smarta-saw-con --replicas=1\nkubectl scale statefulset -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \") smarta-saw-con-a --replicas=1</code></pre>\n<h2>How to resize an RWX PVC</h2>\n<p>As a PVC of this type is used by multiple applications, you must be extremely careful when resizing the PV, such as global-volume and smartanalytics-volume. </p>\n<p>The following steps use global-volume as an example.</p>\n<h3>Create a temporary PVC</h3>\n<ol>\n<li>Create a new file named <strong>global_volume_pvc_temp.yaml</strong> with the following content:\n\n\t<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: global-volume-tmp\n  namespace: &lt;namespace&gt;\nspec:\n  accessModes:\n  - ReadWriteMany\n  resources:\n    requests:\n      storage: 20G\n  storageClassName: cdf-default\n  volumeMode: Filesystem</code></pre>\n</li>\n<li>Replace the namespace and storage size with a proper value and then create this new PVC:\n\t<pre><code>kubectl create -f global_volume_pvc_temp.yaml</code></pre>\n</li>\n</ol>\n<h3>Back up files to the temporary PVC</h3>\n<ol>\n<li>Reinstall <a href=\"/doc/423/26.1/tookitcontainer\" title=\"Support Assistant\">Support Assistant</a> and you'll find that temporary PVC is mounted.</li>\n<li>Enter the Support Assistant container and back up all files from global-volume to global-volume-tmp. This may take a few minutes or even hours depending on the volume size. We can use the <strong>rsync</strong> command to sync files.\n\t<pre><code>nohup rsync -a --exclude 'global-volume/logs' /global-volume/* /global-volume-tmp &amp;</code></pre>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-important-icon\"></div>\n<div class=\"admonition-content admonition-important-content\">Verify the backup has been completed successfully; otherwise, you won't be able to get the files back after deleting the old PVC.</div>\n</div>\n</li>\n</ol>\n<h3>Shut down the system and delete the old PVC</h3>\n<ol>\n<li>Follow the instructions <a href=\"/doc/423/26.1/shutdownsuitesystem\" title=\"here\">here</a> to stop Service Management.</li>\n<li>Run the following command to delete PVC global-volume:\n\t<pre><code>kubectl delete pvc global-volume -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \")</code></pre>\n</li>\n</ol>\n<h3>Create the global-volume PVC with a new size</h3>\n<ol>\n<li>Repeat step <em>Create a temporary PVC</em> to create a new volume with a new size for global-volume.</li>\n<li>Start the Support Assistant container only:\n\t<pre><code>kubectl scale deployment itom-toolkit -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \")  --replicas=1</code></pre>\n</li>\n<li>Enter the container and use the <strong>rsync </strong>command to copy the files from /global-volume-tmp to global-volume.</li>\n</ol>\n<h3>Start the system</h3>\n<ol>\n<li>Start the Service Management and keep the system running for a few days to make sure everything is fine.</li>\n<li>Schedule a maintenance window to shut down the system and delete the temporary PVC.</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}