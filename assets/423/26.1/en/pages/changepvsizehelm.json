{
  "title": "Change PVC sizes (Helm)",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This topic will guide you on how to increase your volume size according to your volume provisioning solutions; static or dynamic volume provisioning, on a Helm deployment. </p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-important-icon\"></div>\n<div class=\"admonition-content admonition-important-content\">Always check with your storage admin about the volume provisioning solution and a resizing solution for the volume you are try to resize . Only if your storage admin hasn't such a solution, follow the general guidelines below to resize your storage.</div>\n</div>\n<h2>Using a static volume provisioning?</h2>\n<p>For static volume provisioning, your volumes share the whole backend storage settings and quota. If you'll like to increase your file system storage, you need to increase the backend storage size. Check with your storage admin for information on how to complete such operations.</p>\n<h2>Using a dynamic volume provisioning?</h2>\n<p>Before increasing the storage size, check your backend storage settings to confirm your backend storage size is enough for the new size you plan to use. If not, increase the backend storage size before continuing with this section. Check with your storage admin for information on how to complete such operation.</p>\n<p>Use the following steps to increase your storage volume size.</p>\n<h5>Grant necessary permission [Azure only]</h5>\n<p><br/>\nTo leverage dynamic solution on Azure, you first need to assign AKS Contributor role to the target storage account. That way AKS can automatically extend the volume size on it.  Use the following steps to assign AKS Contributor role:</p>\n<ol>\n<li>Get your AKS managed identity ID with the following command. The output, <code>&lt;IDENT1ITY_ID&gt;</code>, will be used in the next step.\n\n\t<pre>az aks show --name &lt;aks_cluster_name&gt; --resource-group &lt;resource_group_name&gt; --query  \"identity.principalId\" -o tsv</pre>\n<p>where:</p>\n<ul>\n<li><code>&lt;resource_group_name&gt;</code>: The name of the resource group. Do <b>NOT</b> use your cluster's resource group name with the format <code>MC_&lt;resource_group&gt;_&lt;aks_cluster_name&gt;_&lt;location&gt;</code>.</li>\n<li><code>&lt;aks_cluster_name&gt;</code>: The name of the Kubernetes cluster.</li>\n</ul>\n<p>Example:</p>\n<pre>az aks show --name test-aks --resource-group test-group --query  \"identity.principalId\" -o tsv\n99217d2e-xxc9-42b8-8a92-9bfxxxxad0b4</pre>\n</li>\n<li>Assign AKS Contributor role to the managed identity for the storage account.\n\t<pre>az role assignment create --assignee &lt;IDENTITY_ID&gt; --role \"Contributor\" --scope /subscriptions/&lt;subscription_name_or_id&gt;/resourceGroups/&lt;resource_group_name&gt;/providers/Microsoft.Storage/storageAccounts/&lt;storage_account_name&gt;</pre>\n<p>where:</p>\n<ul>\n<li><code>&lt;IDENTITY_ID&gt;</code>: The output from an earlier command.</li>\n<li><code>&lt;subscription_name_or_id&gt;</code>: Your subscription name or ID. You can get this by navigating to the Azure portal <b>Home</b> page &gt; <b>Subscriptions</b>.</li>\n<li><code>&lt;resource_group_name&gt;</code>: The name of the resource group. Do <b>NOT</b> use your cluster's resource group name with the format <code>MC_&lt;resource_group&gt;_&lt;aks_cluster_name&gt;_&lt;location&gt;</code>.</li>\n<li><code>&lt;storage_account_name&gt;</code> The name of the created FileStorage account.</li>\n</ul>\n<p>Example:</p>\n<pre><code>az role assignment create --assignee 99217d2e-xxc9-42b8-8a92-9bfxxxxad0b4 --role \"Contributor\" --scope /subscriptions/6f33f7c2-xx9f-4cde-b090-e4xxxx475109/resourceGroups/test-group/providers/Microsoft.Storage/storageAccounts/testStorageAccount\n</code></pre>\n</li>\n</ol>\n<h5>Resize volume</h5>\n<p>Use the following steps to increase the storage volume.</p>\n<p>The examples in this section uses Azure NetApp Files as storage and data-volume as volume.</p>\n<ol>\n<li>Update the size of your PVC. The new size should be larger than the previous one.\n\t<pre><code>kubectl patch pvc &lt;pvc-name&gt; --patch='{\"spec\": {\"resources\": {\"requests\": {\"storage\": \"&lt;new-size&gt;\"}}}}' -n &lt;namespace&gt;  \n</code></pre>\n<p>Example:</p>\n<pre><code>kubectl patch pvc data-volume --patch='{\"spec\": {\"resources\": {\"requests\": {\"storage\": \"300Gi\"}}}}' -n itsma\npersistentvolumeclaim/data-volume patched\n</code></pre>\n</li>\n<li>\n<p>Confirm the PVC is configured to the new size.</p>\n<pre>kubectl get pvc -n itsma-xxxx data-volume\n</pre>\n<p>The output should resemble the following.</p>\n<pre> NAME          STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS         AGE\ndata-volume   Bound    pvc-73a4ddc1-xxxx-4043-xxxx-ddbca0811fb5   300Gi      RWX            azure-netapp-files   14d</pre>\n\tThe backend storage will require some time before the changes take effect. If the size remains unchanged after few minutes, use the following command to check the PVC events to get more information. \n\n\t<pre>kubectl describe pvc -n itsma data-volume\n</pre>\n<p>Use the output to monitor the update progress. The output should resemble the following</p>\n<pre>Events:\n  Type     Reason                      Age                From                                    Message\n  ----     ------                      ----               ----                                    -------\n  Warning  ExternalExpanding           93s (x2 over 12m)  volume_expand                           waiting for an external controller to expand this PVC\n  Normal   Resizing                    93s (x2 over 12m)  external-resizer csi.trident.netapp.io  External resizer is resizing volume pvc-73a4ddc1-87e9-4043-876b-ddbca0811fb5\n  Normal   VolumeResizeSuccessful      50s (x2 over 11m)  external-resizer csi.trident.netapp.io  Resize volume succeeded\n  Normal   FileSystemResizeSuccessful  49s (x2 over 11m)  kubelet                                 MountVolume.NodeExpandVolume succeeded for volume \"pvc-73a4ddc1-87e9-4043-876b-ddbca0811fb5\" aks-nodepool1-24279364-vmss00004r\n  Normal   FileSystemResizeSuccessful  47s (x2 over 11m)  kubelet                                 MountVolume.NodeExpandVolume succeeded for volume \"pvc-73a4ddc1-87e9-4043-876b-ddbca0811fb5\" aks-nodepool1-24279364-vmss00004q\n  Normal   FileSystemResizeSuccessful  2s (x2 over 11m)   kubelet                                 MountVolume.NodeExpandVolume succeeded for volume \"pvc-73a4ddc1-87e9-4043-876b-ddbca0811fb5\" aks-nodepool1-24279364-vmss00004p</pre>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}