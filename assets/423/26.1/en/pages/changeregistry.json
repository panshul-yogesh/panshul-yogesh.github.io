{
  "title": "Change the registry setting",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This topic guides  you on how to change to a new registry for your deployment.</p>\n<h2>Prerequisite</h2>\n<p>Before you change the registry setting to the new registry, make sure you have completed the following:</p>\n<ul>\n<li>You've uploaded the images to the new registry. For details, refer to the platform-specific topic on <strong>Download and upload container images</strong> for your deployment.</li>\n<li>You've created a new secret to store the new image registry credentials. For details, see <a href=\"/doc/423/26.1/installesmcli#Prepare_container_registry_secret_(external_K8s_only)\" title=\"Prepare container registry secret\">Prepare container registry secret</a>.</li>\n</ul>\n<h2>Update the registry setting</h2>\n<p>To update to the new registry, follow these steps:</p>\n<ol>\n<li>[Optional] If you don't remember the path of your custom <strong>my-values.yaml</strong> file, run the following command to get your yaml file.\n\n\t<pre>helm get values &lt;ESM_RELEASE_NAME&gt; -n &lt;ESM_NAMESPACE&gt; &gt; my-values.yaml</pre>\n\tWhere <strong>ESM_RELEASE_NAME</strong> is the release name, which you can obtain by using the following command:\n\n\t<pre>helm list -n &lt;ESM_NAMESPACE&gt; | awk '{print $1}'</pre>\n\tWhere <strong>ESM_NAMESPACE</strong> is the unique namespace of the ESM Helm chart deployment.</li>\n<li>You need save new registry info in <strong>new-registry.yaml</strong> file<strong>.</strong>\n<table>\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Required</th>\n<th scope=\"col\">Default</th>\n<th scope=\"col\">Example</th>\n</tr>\n<tr>\n<td><strong>global.docker.registry</strong></td>\n<td>The docker registry from where the required images will get pulled from.</td>\n<td>Yes</td>\n<td><strong>localhost:5000</strong></td>\n<td><strong>registry.example.<br/>\n\t\t\t\tcom:443</strong></td>\n</tr>\n<tr>\n<td><strong>global.docker.orgName</strong></td>\n<td>The docker organization name.</td>\n<td>Yes</td>\n<td><strong>hpeswitom</strong></td>\n<td><strong>hpeswitom</strong></td>\n</tr>\n<tr>\n<td><strong>global.docker.imagePullSecret</strong></td>\n<td>The K8s secret that contains the credentials required to pull images from the specified docker registry.</td>\n<td>Yes</td>\n<td><strong>registrypullsecret</strong></td>\n<td><strong>registrypullsecret</strong></td>\n</tr>\n<tr>\n<td><strong>global.docker.imagePullPolicy</strong></td>\n<td>The image pull policy.</td>\n<td>Optional</td>\n<td><strong>IfNotPresent</strong></td>\n<td>\n<p><strong>IfNotPresent</strong></p>\n</td>\n</tr>\n</thead>\n</table>\n\tIn the following example, update the parameters with values from your environment for the new registry. Save the updated content to <strong>new-registry.yaml </strong>file<b>:</b>\n<pre>  global:\n    docker:\n      imagePullPolicy: IfNotPresent\n      imagePullSecret: registrypullsecretnew\n      orgName: hpeswitom\n      registry: itom-docker.xxxxartifactory.swinfra.net:443</pre>\n</li>\n<li>Run the following command to clean up unused jobs before applying the changes. \n\t<pre>kubectl get job -n &lt;ESM_NAMESPACE&gt;|grep -v NAME | awk '{print $1}'|xargs kubectl delete job -n &lt;ESM_NAMESPACE&gt;</pre>\n\tWhere <strong>&lt;ESM_NAMESPACE&gt;</strong> is the unique namespace of the ESM Helm chart deployment.</li>\n<li>Run the following command to apply the update:\n\t<pre>helm upgrade &lt;ESM_RELEASE_NAME&gt; -n &lt;ESM_NAMESPACE&gt; &lt;ESM_HELM_CHART_PATH&gt; -f my-values.yaml -f new-registry.yaml</pre>\n\tWhere <strong>&lt;ESM_HELM_CHART_PATH&gt;</strong>  is the absolute path of the helm package. For example:\n\n\t<pre>helm upgrade sma -n itsma ESM_Helm_Chart-2x.x.x/charts/esm-1.0.0+2x.x-xxx.tgz -f my-values.yaml -f new-registry.yaml</pre>\n</li>\n<li>Most pods would have restarted, it may take about 10 minutes for the pods to be ready. Run the following command to make sure all suite pods are ready.\n\t<pre> kubectl get pod -n &lt;ESM_RELEASE_NAME&gt; <esm_namespace> |grep -v 1/1|grep -v 2/2|grep -v 3/3|grep -v 4/4|grep -v Completed </esm_namespace></pre>\n\tWhere <strong>&lt;ESM_RELEASE_NAME&gt;</strong> <esm_namespace>is the unique namespace of the ESM deployment. </esm_namespace></li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}