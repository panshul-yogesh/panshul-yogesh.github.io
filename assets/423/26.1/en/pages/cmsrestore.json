{
  "title": "Restore the UD/UCMDB deployment when upgrade fails (containerized UD/UCMDB)",
  "content": "<div class=\"mw-parser-output\">\n<h2>Scenario 1 - the containerized UD/UCMDB deployment is still functioning but data is missing or corrupted</h2>\n<ol>\n<li>\n<p>Stop the UD/UCMDB deployment</p>\n<p>On the control plane node, run the following command:</p>\n<pre>/opt/kubernetes/scripts/cdfctl.sh runlevel set -l DOWN -n &lt;namespace-of-CMS-deployment&gt;</pre>\n<p>Wait for a few minutes until the UD/UCMDB deployment has fully stopped.</p>\n</li>\n<li>\n<p>Restore UD/UCMDB databases, including the UCMDB database, IdM database, and Autopass database.</p>\n</li>\n<li>\n<p>Restore the following data in NFS volumes:</p>\n<table>\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Component</p>\n</th>\n<th scope=\"col\">\n<p>NFS volume name</p>\n</th>\n<th scope=\"col\">\n<p>Directory</p>\n</th>\n<th scope=\"col\">\n<p>Description</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>UCMDB Gateway</p>\n</td>\n<td>\n<p>ucmdb-data-volume</p>\n</td>\n<td>\n<p>&lt;ucmdb-data-volume&gt;/cms-gateway</p>\n</td>\n<td>\n<p>Data generated by the UCMDB Gateway</p>\n</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p>Restart the UD/UCMDB deployment.</p>\n<p>On the control plane node, run the following command:</p>\n<pre>/opt/kubernetes/scripts/cdfctl.sh runlevel set -l UP -n &lt;namespace-of-CMS-deployment&gt;</pre>\n</li>\n</ol>\n<h2 id=\"Disaster_Recovery_Process\">Scenario 2 - the containerized UD/UCMDB deployment is corrupted or failing</h2>\n<p>Make sure you always perform troubleshooting by following instructions in <a href=\"/doc/423/26.1/troubleshootcms\">Troubleshoot UD/UCMDB</a>.</p>\n<p>If this still can't resolve the issue, follow the instructions below to restore the containerized UD/UCMDB deployment. </p>\n<ol>\n<li>\n<p>Uninstall UD/UCMDB: </p>\n<ol start=\"1\">\n<li>Delete the UD/UCMDB deployment</li>\n<li>Remove persistent volumes</li>\n<li>Clean the NFS volumes</li>\n</ol>\n<p>For details, see <a href=\"/doc/423/26.1/cmswithsmaxuninstallcms\">Uninstall UD/UCMDB</a>.</p>\n</li>\n<li>\n<p>Create a new deployment.</p>\n<p>For details, see <a href=\"/doc/423/26.1/cmswithsmaxcreatedeployment\">Create a new deployment for UD/UCMDB</a>.</p>\n</li>\n<li>\n<p>Restore secret.</p>\n<p>Create a new secret using the backup secret .yaml file:</p>\n<pre>kubectl apply -f cms-secret_backup_yyyy-mm-dd.yaml -n &lt;namespace-of-cms&gt;</pre>\n</li>\n<li>\n<p>Re-create NFS volumes (in the NFS server).</p>\n<p>For details, see <a href=\"/doc/423/26.1/cmswithsmaxcreatenfsvolumes\">Configure NFS volumes for UD/UCMDB</a>.</p>\n</li>\n<li>\n<p>Restore the following data in NFS volumes:</p>\n<table>\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Component</p>\n</th>\n<th scope=\"col\">\n<p>NFS volume name</p>\n</th>\n<th scope=\"col\">\n<p>Directory</p>\n</th>\n<th scope=\"col\">\n<p>Description</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>UCMDB Gateway</p>\n</td>\n<td>\n<p>ucmdb-data-volume</p>\n</td>\n<td>\n<p>&lt;ucmdb-data-volume&gt;/cms-gateway</p>\n</td>\n<td>\n<p>Data generated by the UCMDB Gateway</p>\n</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p>Re-create PVs using the same configuration (<b>ucmdb-pv.yaml</b>)</p>\n<p>For details, see <a href=\"/doc/423/26.1/cmswithsmaxpreparepvs\">Create persistent volumes for UD/UCMDB</a>.</p>\n</li>\n<li>\n<p>Re-install UD/UCMDB deployment with the same configuration (<b>my-values.yaml</b>) and the same helm chart.</p>\n<p>For details, see <a href=\"/doc/423/26.1/installcmswithsmaxinstallcms\">Install UD/UCMDB on OMT</a>.</p>\n</li>\n</ol>\n<div class=\"transcontent stn-end--RestoreCms\"> </div>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}