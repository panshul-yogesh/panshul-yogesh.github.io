{
  "title": "Restore UD/UCMDB when upgrade fails (managed Kubernetes)",
  "content": "<div class=\"mw-parser-output\">\n<div></div>\n<h2 id=\"Scenario_1_-_the_containerized_CMS_deployment_is_still_functioning_but_data_are_missing_or_corrupted\">Scenario 1 - the containerized UD/UCMDB deployment is still functioning but data is missing or corrupted</h2>\n<ol>\n<li>\n<p>Stop the UD/UCMDB deployment.</p>\n<p>On the bastion node, navigate to the OMT installation directory:</p>\n<pre>cd OMT_External_K8s_2n.n-nnn/scripts/</pre>\n<p>Run the following command:</p>\n<pre>./cdfctl.sh runlevel set -l DOWN -n &lt;namespace-of-CMS-deployment&gt;</pre>\n<p>Wait for a few minutes until the UD/UCMDB deployment has fully stopped.</p>\n</li>\n<li>\n<p>Restore UD/UCMDB databases, including the UCMDB database, IdM database, and Autopass database.</p>\n</li>\n<li>\n<p>Restore the following data in NFS volumes:</p>\n<table>\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Component</p>\n</th>\n<th scope=\"col\">\n<p>NFS volume name</p>\n</th>\n<th scope=\"col\">\n<p>Directory</p>\n</th>\n<th scope=\"col\">\n<p>Description</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>UCMDB Gateway</p>\n</td>\n<td>\n<p>ucmdb-data-volume</p>\n</td>\n<td>\n<p>&lt;ucmdb-data-volume&gt;/cms-gateway</p>\n</td>\n<td>\n<p>Data generated by the UCMDB Gateway</p>\n</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p>Restart the UD/UCMDB deployment.</p>\n<p>On the bastion node, navigate to the OMT installation directory:</p>\n<pre>cd OMT_External_K8s_2n.n-nnn/scripts/</pre>\n<p>Run the following command:</p>\n<pre>./cdfctl.sh runlevel set -l UP -n &lt;namespace-of-CMS-deployment&gt;</pre>\n</li>\n</ol>\n<h2 id=\"Scenario_2 -_the_containerized_CMS_deployment_is_corrupted_or_failing\">Scenario 2 - the containerized UD/UCMDB deployment is corrupted or failing</h2>\n<p>Make sure you always perform troubleshooting by following instructions in <a href=\"/doc/423/26.1/troubleshootcms\" title=\"Troubleshoot UD/UCMDB\">Troubleshoot UD/UCMDB</a>.</p>\n<p>If this still can't resolve the issue, follow the instructions below to restore the containerized UD/UCMDB deployment. </p>\n<ol>\n<li>\n<p>Uninstall UD/UCMDB with these steps: </p>\n<ol start=\"1\">\n<li>Delete the UD/UCMDB deployment</li>\n<li>Remove persistent volumes</li>\n<li>Clean the NFS volumes</li>\n</ol>\n<p>For details, see <a href=\"/doc/423/26.1/uninstallcmswitheks\" title=\"Uninstall UD/UCMDB on AWS\">Uninstall UD/UCMDB on AWS</a>.</p>\n</li>\n<li>\n<p>Create a new deployment. For details, see <a href=\"/doc/423/26.1/createdeploymentekscms\" title=\"Create a new deployment for UD/UCMDB\">Create a new deployment for UD/UCMDB</a>.</p>\n</li>\n<li>\n<p>Restore secret.</p>\n<p>Create a new secret using the backup secret yaml file:</p>\n<pre>kubectl apply -f cms-secret_backup_yyyy-mm-dd.yaml -n &lt;namespace-of-cms&gt;</pre>\n</li>\n<li>\n<p>Recreate NFS volumes. For details, see <a href=\"/doc/423/26.1/configureefscms\" title=\"Configure EFS for UD/UCMDB\">Configure EFS for UD/UCMDB</a>.</p>\n</li>\n<li>\n<p>Restore the following data in NFS volumes:</p>\n<table>\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Component</p>\n</th>\n<th scope=\"col\">\n<p>NFS volume name</p>\n</th>\n<th scope=\"col\">\n<p>Directory</p>\n</th>\n<th scope=\"col\">\n<p>Description</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>UCMDB Gateway</p>\n</td>\n<td>\n<p>ucmdb-data-volume</p>\n</td>\n<td>\n<p>&lt;ucmdb-data-volume&gt;/cms-gateway</p>\n</td>\n<td>\n<p>Data generated by the UCMDB Gateway</p>\n</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p>Recreate PVs using the same configuration (<b>ucmdb-pv.yaml</b>). For details, see <a href=\"/doc/423/26.1/preparepersistentvolumesekscms\" title=\"Create persistent volumes for UD/UCMDB\">Create persistent volumes for UD/UCMDB</a>.</p>\n</li>\n<li>\n<p>Re-install UD/UCMDB deployment with the same configuration (<b>my-values.yaml</b>) and the same helm chart. For details, see <a href=\"/doc/423/26.1/installcmsoneks\" title=\"Install UD/UCMDB on AWS\">Install UD/UCMDB on AWS</a>.</p>\n</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}