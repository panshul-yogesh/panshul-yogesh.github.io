{
  "title": "Configure the application gateway for UD/UCMDB",
  "content": "<div class=\"mw-parser-output\">\n<p>To access UD/UCMDB, you need to create an application gateway on Azure and configure the listener on this application gateway. After the UD/UCMDB installation is done, perform the tasks in this section to create and configure an application gateway for UD/UCMDB. </p>\n<p>When configuring the application gateway and the load balancer for UD/UCMDB, use the ports specified in your customized <strong>values.yaml </strong>file.</p>\n<div>\n<table style=\"border-collapse:collapse; border-style:solid; border-color:#a3a3a3; border-width:0px\" title=\"\" valign=\"top\">\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Type</p>\n</th>\n<th scope=\"col\">\n<p>Port (see the value in the customized values.yaml file)</p>\n</th>\n<th scope=\"col\">\n<p>Example</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>Application gateway</p>\n</td>\n<td>\n<p>global.externalAccessPort</p>\n</td>\n<td>\n<p>443</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Load balancer</p>\n</td>\n<td>\n<p>itom-ingress-controller.nginx.service.httpsPort</p>\n</td>\n<td>\n<p>30443</p>\n</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"Configure_an_Azure_application_gateway_for_UD_UCMDB_with_the_load_balancer\" name=\"Configure_an_Azure_application_gateway_for_UD_UCMDB_with_the_load_balancer\" title=\"Configure an Azure application gateway for UD/UCMDB with the load balancer\"></a>Configure an Azure application gateway for UD/UCMDB with the load balancer</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Suite Admin</td>\n<td>Azure portal</td>\n</tr>\n</tbody>\n</table>\n<h3><a id=\"Step_1_Create_an_Azure_application_gateway\" name=\"Step_1_Create_an_Azure_application_gateway\" title=\"Step 1: Create an Azure application gateway\"></a>Step 1: Create an Azure application gateway</h3>\n<p>After installing the UD/UCMDB, follow these steps to create an Azure application gateway.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create an application gateway from the <a href=\"https://portal.azure.com/#create/Microsoft.ApplicationGateway-ARM\" rel=\"nofollow\" target=\"1\" title=\"Azure portal\">Azure portal</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Populate the following basic settings:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Subscription</b>: Select your subscription.</li><li style=\"margin-left: 40px; position: relative;\"><b>Resource group</b>: Use the same one as your VNet and VMs.</li><li style=\"margin-left: 40px; position: relative;\"><b>Application gateway name</b>: Enter a descriptive name.</li><li style=\"margin-left: 40px; position: relative;\"><b>Region</b>: Select the same region as your VNet.</li><li style=\"margin-left: 40px; position: relative;\"><b>Tier</b>: Select <b>Standard V2</b>.</li><li style=\"margin-left: 40px; position: relative;\">Under <b>Configure virtual network</b>, select your VNet for the environment and prepared subnet for Application gateway.</li></ul>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the <b>Frontends</b> page, set <b>Frontend IP address type</b> to <b>Public</b>. Click <b>Add new</b> for the public IP address and enter a name for it, and then click <b>OK</b>. <b>Note</b>: With the Application Gateway v2 SKU, you can only use public frontend IP configuration. Private frontend IP configuration is currently not enabled for this SKU.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Next: Backends &gt;</b>.</li></ol>\n<h3 id=\"Step_2:_Configure_a_backend_pool_for_port_3000\"><a id=\"Step_2_Configure_a_backend_pool\" name=\"Step_2_Configure_a_backend_pool\" title=\"Step 2: Configure a backend pool\"></a>Step 2: Configure a backend pool</h3>\n<p>Configure a backend pool for the UD/UCMDB Ingress controller https port. For this port, use the value of <strong>itom-ingress-controller.nginx.service.httpsPort </strong>that you defined in <a href=\"/doc/423/26.1/createvaluesyamlakscms#Networking_parameters\" title=\"the UD/UCMDB values.yaml file\">the UD/UCMDB values.yaml file</a>. This section takes port <strong>30443 </strong>as an example.</p>\n<p>To configure a backend pool, follow these steps:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the <b>Backends</b> page, click <b>Add a backend pool</b> to create a new backend pool for port <strong>30443</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Provide the following information:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Name</b>: enter a name.</li><li style=\"margin-left: 40px; position: relative;\"><b>Add backend pool without targets</b>: select <b>No</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Target type</b>: select <b>IP address or FQDN</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Target</b>: enter the IP address of the load balancer for port <strong>30443</strong>. You can obtain the IP address by running the command:\n\t\t<pre><code class=\"language-bash\">kubectl get svc itom-ingress-controller-svc -n &lt;UD/UCMDB-namespace&gt;\n</code></pre>\n</li></ul>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Add</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Next: Configuration&gt;</b>.</li></ol>\n<h3 id=\"Step_3:_Add_a_routing_rule\"><a id=\"Step_3_Add_a_routing_rule\" name=\"Step_3_Add_a_routing_rule\" title=\"Step 3: Add a routing rule\"></a>Step 3: Add a routing rule</h3>\n<p>On the <b>Configuration</b> page, follow these steps to add a routing rule.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <b>Add a rule</b> in the <b>Routing rules</b> column.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <b>Add a routing rule</b> window that opens, enter a name for the rule.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Set <strong>Priority </strong>to <strong>1</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">A routing rule requires a <strong>listener</strong>. The port for the <strong>listener </strong>is the value of <strong>global.externalAccessPort</strong> that you assigned in <a href=\"/doc/423/26.1/createvaluesyamlakscms#Networking_parameters\" title=\"the UD/UCMDB my-values.yaml file\">UD/UCMDB my-values.yaml file</a>.<span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"> </span></span>This section takes port <strong>443 </strong>as an example.<br/>\n\tClick the <strong>Listener </strong>tab to create a listener with the following settings:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Listener name</b>: Enter a name for the listener.</li><li style=\"margin-left: 40px; position: relative;\"><b>Frontend IP</b>: Select <b>Public</b> to choose the public IP that you created for the frontend.</li><li style=\"margin-left: 40px; position: relative;\"><b>Protocol</b>: Select <b>HTTPS</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Port</b>: enter <b>443</b>.</li><li style=\"margin-left: 40px; position: relative;\">In the <b>HTTPS Settings</b> section: First, create a certificate for the environment and export a pfx file from the certificate by following these steps:\n\t\t<ol start=\"1\" style=\"padding-left: 0px;\"><li style=\"--number-width: 22px; --number-spacing: 26px; margin-left: 62px; position: relative;\">Skip this step if you already have <code>server.crt</code> and <code>server.key</code> files for the hostname. If you don't, generate a certificate with these commands:\n\t\t\t<pre><code class=\"language-bash\">export hostname=\"{HOSTNAME}\"\necho US&gt;response.txt\necho CA&gt;&gt;response.txt\necho Palo Alto&gt;&gt;response.txt\necho EntIT Software LLC, a Micro Focus company&gt;&gt;response.txt\necho Support&gt;&gt;response.txt\necho $hostname&gt;&gt;response.txt\necho http://www.microfocus.com/cmdb&gt;&gt;response.txt\necho challenge&gt;&gt;response.txt\necho UD/UCMDB AKS Gateway SSL Certificate&gt;&gt;response.txt\nopenssl req -passout pass:&lt;server_csr_password&gt; -new -out server.csr &lt; response.txt\nmv privkey.pem server.key\nopenssl x509 -passin pass:&lt;server_csr_password&gt; -in server.csr -out server.crt -req -signkey server.key -days 3650</code></pre>\n\t\t\tIn these commands, {HOSTNAME} is the external access host of UD/UCMDB.</li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 65px; position: relative;\">\n<p>After the certificate is ready, export a pfx file from the certificate with this command:</p>\n<pre>openssl pkcs12 -export -passin pass:&lt;server_csr_password&gt; -passout pass:&lt;server_pfx_password&gt; -out server.pfx -inkey server.key -in server.crt</pre>\n</li></ol>\n<p>Then, click <strong>Upload a certificate</strong> to upload the certificate you created, and then select the pfx file you exported from the certificate.</p>\n</li><li style=\"margin-left: 40px; position: relative;\"><b>Cert name</b>: enter a name for the certificate.</li><li style=\"margin-left: 40px; position: relative;\"><b>Password</b>: Enter the password that you specified for the pfx file.</li><li style=\"margin-left: 40px; position: relative;\"><b>Additional settings</b>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><b>Listener type</b>: select <b>Basic</b>.</li><li style=\"margin-left: 52px; position: relative;\"><b>Error page URL</b>: select <b>No</b>.</li></ul>\n</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select the <b>Backend targets</b> tab, and then select the backend pool that you created for port <strong>30443</strong>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In <b>Backend settings</b>, click <b>Add new</b> to create a backend setting for port <strong>itom-ingress-controller.nginx.service.httpsPort</strong> that you defined in <a href=\"/doc/423/26.1/createvaluesyamlakscms#Networking_parameters\" title=\"the UD/UCMDB my-values.yaml file\">the UD/UCMDB my-values.yaml file</a>. This section takes port <strong>30443 </strong>as an example.\n\t<p>Run the following commands on the bastion node to create an RE_ca.cer file, which will be used when you configure a backend setting for port <strong>30443</strong>.</p>\n<pre>kubectl get cm -n &lt;UD/UCMDB namespace&gt; public-ca-certificates -o json |sed -n '/RE_ca.crt/ p'|sed 's/\\\\n//g'|sed 's/ //g' |sed 's/\"RE_ca.crt\":\"-----BEGINCERTIFICATE-----/-----BEGIN CERTIFICATE-----\\n/g' |sed 's/-----ENDCERTIFICATE-----\",/\\n-----END CERTIFICATE-----/g' &gt; RE_ca.cer\n</pre>\n<p>Follow these steps to add a backend setting:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 21px; --number-spacing: 25px; margin-left: 49px; position: relative;\">Click <b>Add new</b>.</li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 53px; position: relative;\">Enter a name for the backend setting.</li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 53px; position: relative;\">Provide the following information:\n\t\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><b>Backend protocol</b>: Choose <b>HTTPS</b>.</li><li style=\"margin-left: 52px; position: relative;\"><b>Backend port</b>: enter <strong>30443</strong>.</li><li style=\"margin-left: 52px; position: relative;\"><b>CER certificate</b>: choose the <code>RE_ca.cer</code> certificate file that you created.</li><li style=\"margin-left: 52px; position: relative;\"><b>Request time-out (seconds)</b>: enter <b>180</b>.</li><li style=\"margin-left: 52px; position: relative;\"><b>Override with new host name</b>: select <b>Yes</b>, choose <b>Override with specific domain name</b>, and then enter your external access host name.</li><li style=\"margin-left: 52px; position: relative;\"><b>Create custom probes</b>: select <b>Yes</b>. A custom probe is automatically created. You will configure this custom probe in the next step.</li></ul>\n</li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 53px; position: relative;\">Click <b>Add</b>.</li></ol>\n</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Next:Tags&gt;</b></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Next: Review+create&gt;</b>, and wait until the validation has passed.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Create</b>. The application gateway will be created in several minutes.</li></ol>\n<h3 id=\"Step_4:_Configure_a_health_probe_for_3000\"><a id=\"Step_4_Configure_a_health_probe_for_30443\" name=\"Step_4_Configure_a_health_probe_for_30443\" title=\"Step 4: Configure a health probe for 30443\"></a>Step 4: Configure a health probe for 30443</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Open the application gateway that you created in the previous step.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Health probe</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Open the custom health probe created in the previous step.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Configure the following parameters:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Protocol</b>: select <b>HTTPS</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Host</b>: Enter your external access host name.</li><li style=\"margin-left: 40px; position: relative;\"><b>Path</b>: enter <b>/cms</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Interval (seconds)</b>: enter <b>30</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Timeout (seconds)</b>: enter <b>5</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Unhealthy threshold</b>: enter <b>15</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>HTTP settings</b>: choose the one you created for port <strong>30443</strong>.</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Deselect <b>I want to test the backend health before adding the health probe</b>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Save</b>.</li></ol>\n<h3 id=\"Step_5:_Check_the_backend_health_for_port_3000\"><a id=\"Step_5_Check_the_backend_health_for_port_30443\" name=\"Step_5_Check_the_backend_health_for_port_30443\" title=\"Step 5: Check the backend health for port 30443\"></a>Step 5: Check the backend health for port 30443</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Open the application gateway that you created.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Backend health</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Make sure that the <b>Status</b> value is <b>Healthy</b> for port <strong>30443</strong>. This indicates that the application gateway has been configured successfully.</li></ol>\n<h2 id=\"Bind_the_external_access_host_name_with_the_application_gateway\"><a id=\"Bind_the_external_access_host_name_with_the_application_gateway\" name=\"Bind_the_external_access_host_name_with_the_application_gateway\" title=\"Bind the external access host name with the application gateway\"></a>Bind the external access host name with the application gateway</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Suite Admin</td>\n<td>DNS provider</td>\n</tr>\n</tbody>\n</table>\n<p>After configuring the application gateway to allow users to access UD/UCMDB with the external access host name, you need to bind the host name with the static IP address of the created application gateway <a href=\"https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FdnsZones\" title=\"in DNS zones\">in DNS zones</a>.</p>\n<p>To find your application gateway's IP address, navigate to the Azure portal &gt; <b>Application gateways</b>, click your application gateway name, and find the IP address under <b>Frontend public IP address</b>.</p>\n<p>Now you can access UD/UCMDB landing page with the following URLs where &lt;FQDN&gt; is the one that you bind with the application gateway.</p>\n<div>\n<table title=\"\" valign=\"top\">\n<thead>\n<tr>\n<th scope=\"col\">\n<p>To access</p>\n</th>\n<th scope=\"col\">\n<p>Enter the following URL in your web browser</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>UD/UCMDB landing page</p>\n</td>\n<td>\n<p><strong>https://&lt;FQDN&gt;:443/cms</strong></p>\n</td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>At the moment, you can only open the URL. To log in to UD/UCMDB as suite-admin, you must perform the Associate UD/UCMDB SuperAdmin role (AKS) task. </div></div></div>\n<h2><a id=\"Configure_Azure_Internal_loadbalancer_for_SMAX_and_UCMDB_internal_communication\" name=\"Configure_Azure_Internal_loadbalancer_for_SMAX_and_UCMDB_internal_communication\" title=\"Configure Azure Internal loadbalancer for SMAX and UCMDB internal communication\"></a>Configure Azure Internal loadbalancer for SMAX and UCMDB internal communication</h2>\n<p>This section outlines the process for configuring an <strong>internal load balancer (ILB)</strong> for Helm-based deployments on the Azure platform. Follow the instructions in this section to create and configure a new internal load balancer based on your deployment requirements.</p>\n<p>To ensure seamless communication between <strong>Service Management</strong> and the containerized <strong>UD/UCMDB</strong> on Azure, we recommend configuring an <strong>internal Load Balancer (ILB)</strong> between the <strong>Ingress service of Service Management</strong> and the <strong>Ingress service of UD/UCMDB</strong>. This configuration isolates internal integration traffic from external access, improving security and maintaining a clear separation between internal and external communication channels.</p>\n<p>The following diagram depicts how the integration ILB sets up the connection between Service Management and UD/UCMDB:</p>\n<div><span><a class=\"image\" href=\"\"> <img alt=\"smaz-ucmdb-ilb\" data-widget=\"image\" src=\"../../../images/Azure-ILB-Integration_d358cdf7.png\" style=\"width:937px;height:763px\"/> </a> </span></div>\n<div><span><span style=\"top: 4406px; left: 8px;\"><a class=\"image\" href=\"\"> <img alt=\"\" draggable=\"true\" role=\"presentation\" src=\"../../../images/wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw_d639b57c\" style=\"width:15px;height:15px\" title=\"Click and drag to move\"/> </a> </span></span></div>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>Replace the placeholder text within the angle brackets (&lt; &gt;) with the appropriate internal service name and the namespace you are using. For example, <code>&lt;service-name&gt;</code><service-name> should be replaced with the actual service name, and &lt;namespace&gt;<namespace> should be replaced with the correct namespace for your environment. </namespace></service-name></div></div></div>\n \n\n<div>\n<h3 id=\"Step_1_Create_an_Internal_Load_Balancer_using_annotation\"><a id=\"Step_1_Create_an_internal_load_balancer_using_annotation\" name=\"Step_1_Create_an_internal_load_balancer_using_annotation\" title=\"Step 1: Create an internal load balancer using annotation\"></a><a id=\"Step_1_Create_an_Internal_Load_balancer_using_annotation\" name=\"Step_1_Create_an_Internal_Load_balancer_using_annotation\" title=\"Step 1: Create an Internal Load balancer using annotation\"></a>Step 1: Create an internal load balancer using annotation</h3>\n<div>Create two internal load balancers in each of the namespaces:  [Service Management, UCMDB]</div>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to create an ILB for UCMDB.\n\n\t<div style=\"margin-left: 28px; position: relative;\">\n<pre><code>vi cms-internal-loadbalancer.yaml</code></pre>\n<div><strong>Sample yaml file</strong>:</div>\n</div>\n<div style=\"margin-left: 28px; position: relative;\">\n<pre><code class=\"language-yaml\">apiVersion: v1\nkind: Service\nmetadata:\n  name: &lt;internal-cms-servicename&gt;\n  namespace: &lt;cms-namespace&gt;\n  annotations:\n    service.beta.kubernetes.io/azure-load-balancer-internal: \"true\"\nspec:\n  type: LoadBalancer\n  selector:\n    app.kubernetes.io/instance: cms\n    app.kubernetes.io/name: itom-ingress-controller\n  ports:\n    - name: https\n      port: 443\n      targetPort: &lt;target port&gt;\n</code></pre>\n</div>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to create an ILB for Service Management.\n\t<div>\n<pre><code>vi smax-internal-loadbalancer.yaml</code></pre>\n<div><strong>Sample yaml file</strong>:</div>\n<div>\n<pre><code class=\"language-yaml\">apiVersion: v1\nkind: Service\nmetadata:\n  name: &lt;internal-smax-servicename&gt;\n\n  namespace: &lt;suite-namespace&gt;\n  annotations:\n    service.beta.kubernetes.io/azure-load-balancer-internal: \"true\"\nspec:\n  type: LoadBalancer\n  selector:\n    app.kubernetes.io/instance: esm\n    app.kubernetes.io/name: itom-ingress-controller\n  ports:\n    - name: https\n      port: 443\n      targetPort: &lt;TARGET PORT&gt;\n</code></pre>\n</div>\n</div>\n</li></ol>\n</div>\n<h3><a id=\"Step_2_Obtain_the_external_IP_address_of_the_created_internal_load_balancer_service\" name=\"Step_2_Obtain_the_external_IP_address_of_the_created_internal_load_balancer_service\" title=\"Step 2: Obtain the external IP address of the created internal load balancer service\"></a><a id=\"Step_2_Fetch_the_external_ip_of_the_created_internal_load_balancer_service\" name=\"Step_2_Fetch_the_external_ip_of_the_created_internal_load_balancer_service\" title=\"Step 2: Fetch the external ip of the created internal load balancer service\"></a>Step 2: Obtain the external IP address of the created internal load balancer service</h3>\n<div>Run the following commands:</div>\n<div>\n<pre><code class=\"language-bash\">kubectl get svc -n &lt;cms-namespace&gt; | grep internal \nkubectl get svc -n &lt;suite-namespace&gt; | grep internal\n</code></pre>\n</div>\n<div>\n<h3><a id=\"Step_3_Configure_private_DNS_records_for_Service_management_and_UCMDB\" name=\"Step_3_Configure_private_DNS_records_for_Service_management_and_UCMDB\" title=\"Step 3: Configure private DNS records for Service management and UCMDB\"></a><a id=\"Step_3_Configure_Private_DNS_Records_for_Service_management_and_UCMDB\" name=\"Step_3_Configure_Private_DNS_Records_for_Service_management_and_UCMDB\" title=\"Step 3: Configure Private DNS Records for Service management and UCMDB\"></a>Step 3: Configure private DNS records for Service management and UCMDB </h3>\n<div>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"> Navigate to <strong>Azure Portal </strong>→ <strong>Private DNS Zones</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create two DNS A records for Service Management and UCMDB.<br/>\n\tExample format:   <code>  int.&lt;FQDN&gt;</code>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Record 1</strong>: \n\t\t<pre><code>Name: int.sigmacms\nIP Address: &lt;Private IP of SMAX&gt;\n</code></pre>\n</li><li style=\"margin-left: 40px; position: relative;\"><strong>Record 2</strong>:\n\t\t<pre><code>Name: int.cms.sigmacms\nIP Address: &lt;Private IP of CMS&gt;\n</code></pre>\n</li></ul>\n</li></ol>\n</div>\n</div>\n<h3><a id=\"Step_4_Create_an_internal_ingress_for_Service_Management_and_UD_UCMDB\" name=\"Step_4_Create_an_internal_ingress_for_Service_Management_and_UD_UCMDB\" title=\"Step 4: Create an internal ingress for Service Management and UD/UCMDB\"></a><a id=\"Step_4_Create_an_internal_ingress_for_Service_Management_and_UC_UCMDB\" name=\"Step_4_Create_an_internal_ingress_for_Service_Management_and_UC_UCMDB\" title=\"Step 4: Create an internal ingress for Service Management and UC/UCMDB\"></a>Step 4: Create an internal ingress for Service Management and UD/UCMDB</h3>\n<div>\n<p>To enable <strong>Service Management</strong> and the containerized <strong>UD/UCMDB to</strong> work seamlessly on Azure, configure an <strong>internal Load Balancer (ILB)</strong> between the <strong>Ingress service of Service Management</strong> and the <strong>Ingress service of UD/UCMDB</strong>. This approach ensures that internal integration traffic is <strong>isolated from external access</strong>, enhancing security and maintaining a clear separation between internal and external communication.</p>\n<h4><a id=\"Prepare_a_certificate\" name=\"Prepare_a_certificate\" title=\"Prepare a certificate\"></a>Prepare a certificate</h4>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>CN name and Subject Alternative Name (SAN) must be aligned with your project name and the fully qualified domain name (FQDN) specified for it<cms_fqdn>. Replace <cms_fqdn>with the actual FQDN used in your environment. </cms_fqdn></cms_fqdn></div></div></div>\n<div>A certificate for the Load Balancer will be used to achieve the integration between Service Management and UD/UCMDB.  Create the server certificate and server certificate key for  <code>int.sigmacms </code> <code>int.cms.sigmacms</code></div>\n</div>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to generate a certificate for UD/UCMDB\n\n\t<pre><code>openssl req -x509 -newkey rsa:2048 -sha256 -days 365 \\\n  -nodes -keyout cms.key -out cms.crt \\\n  -subj \"/CN=&lt;hostname&gt;\" \\\n  -addext \"subjectAltName=DNS:&lt;hostname&gt;\"\n</code></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to generate a certificate for Service Management</li></ol>\n<div style=\"margin-left: 28px; position: relative;\">\n<div>\n<pre><code>openssl req -x509 -newkey rsa:2048 -sha256 -days 365 \\\n  -nodes -keyout smax.key -out smax.crt \\\n  -subj \"/CN=&lt;hostname&gt;\" \\\n  -addext \"subjectAltName=DNS:&lt;hostname&gt;\"\n</code></pre>\n</div>\n</div>\n<h4><a id=\"Add_the_created_certificate_to_Kubernetes_secrets\" name=\"Add_the_created_certificate_to_Kubernetes_secrets\" title=\"Add the created certificate to Kubernetes secrets\"></a>Add the created certificate to Kubernetes secrets</h4>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to add the service management certificate to Kubernetes secrets:\n\n\t<pre><code>kubectl create secret tls &lt;secret-name&gt; \\\n  --cert &lt;smax-certificate-file&gt;.crt \\\n  --key &lt;smax-key-file&gt;.key \\\n  --namespace &lt;suite-namespace&gt;\n</code></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to add the UD/UCMDB certificate to Kubernetes secrets:\n\t<pre><code>kubectl create secret tls &lt;secret-name&gt; \\\n  --cert &lt;cms-certificate-file&gt;.crt \\\n  --key &lt;cms-key-file&gt;.key \\\n  --namespace &lt;cms-namespace&gt;</code></pre>\n</li></ol>\n<h4><a id=\"Set_up_mTLS_between_Service_Management_and_UD_UCMDB\" name=\"Set_up_mTLS_between_Service_Management_and_UD_UCMDB\" title=\"Set up mTLS between Service Management and UD/UCMDB\"></a>Set up mTLS between Service Management and UD/UCMDB</h4>\n<div>Mutual TLS (mTLS) ensures secure, two-way authentication and encrypted communication between Service Management and UD/UCMDB, preventing unauthorized access and data breaches. </div>\n<p>Complete the following steps to set up mTLS.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Extract the server certificates from Service Management and UD/UCMDB.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Add Service Management’s server certificate to UD/UCMDB.\n\t<pre><code class=\"language-bash\">kubectl edit configmap  default-ca-certificates -n itsma</code></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Add UD/UCMDB's server certificate to Service Management\n\t<pre><code class=\"language-bash\">kubectl edit configmap  default-ca-certificates -n cms</code></pre>\n</li></ol>\n<div>The updated file will resemble the following where &lt;cert-name&gt; is:</div>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\"><strong>smax.crt</strong>: for Service Management</li><li style=\"margin-left: 28px; position: relative;\"><strong>cms.cert</strong>: for UD/UCMDB</li></ul>\n<pre><code class=\"language-yaml\">...\n...\ncms.crt: |\n  &lt;BEGIN CERTIFICATE&gt;\n  ......\n  &lt;END CERTIFICATE&gt;\n...\n...</code></pre>\n<h3><a id=\"Step_5_Apply_the_internal_ingress_configuration\" name=\"Step_5_Apply_the_internal_ingress_configuration\" title=\"Step 5: Apply the internal ingress configuration\"></a>Step 5: Apply the internal ingress configuration</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Apply internal ingress configuration for service management integration:\n\t<pre><code>kubectl apply -f SMAX-integration—internal-ingress.yaml</code></pre>\n\tSee the following sample yaml file where <strong>&lt;service-management-internal-lb-service-name&gt; </strong>is the service name for the suite's internal loadbalancer.\n\n\t<pre><code class=\"language-yaml\">apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: &lt;suite-internal-ingressname&gt;\n  namespace: &lt;suite-namespace&gt;\n  annotations:\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\n    nginx.ingress.kubernetes.io/proxy-read-timeout: \"180\"\n    nginx.ingress.kubernetes.io/proxy-send-timeout: \"180\"\n    nginx.ingress.kubernetes.io/health-check-path: \"/healthz\"\n    nginx.ingress.kubernetes.io/proxy-body-size: \"64m\"\n    nginx.ingress.kubernetes.io/affinity: cookie\n    nginx.ingress.kubernetes.io/force-ssl-redirect: \"true\"\n    nginx.ingress.kubernetes.io/session-cookie-name: route\n    nginx.ingress.kubernetes.io/use-private-ip: \"true\"\n    nginx.ingress.kubernetes.io/request-timeout: \"180\"\n    meta.helm.sh/release-name: &lt;suite-release-name&gt;\n    meta.helm.sh/release-namespace: &lt;suite-namespace&gt;\n  labels:\n    app.kubernetes.io/instance: esm\n    app.kubernetes.io/managed-by: Helm\n    app.kubernetes.io/name: idm\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: int.&lt;fqdn&gt;\n    http:\n      paths:\n      - path: /*\n        pathType: ImplementationSpecific\n        backend:\n          service:\n            name: &lt;service-management-internal-lb-service-name&gt;\n            port:\n              number: 443\n  tls:\n  - hosts:\n    - int.&lt;fqdn&gt;\n    secretName: nginx-default-secret\n</code></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Apply internal ingress configuration for CMS integration:\n\t<pre><code>kubectl apply -f cms-integration—internal-ingress.yaml</code></pre>\n\tSee the following sample yaml file where <strong>&lt;cms-service-name&gt;</strong> is the CMS service name.\n\n\t<pre><code class=\"language-yaml\">cat cms-internal-ingress.yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: &lt;cms-internal-ingressname&gt;\n  namespace:&lt;cms-namespace&gt;\n  annotations:\n    nginx.ingress.kubernetes.io/backend-protocol: \"HTTPS\"\n    nginx.ingress.kubernetes.io/proxy-read-timeout: \"180\"\n    nginx.ingress.kubernetes.io/proxy-send-timeout: \"180\"\n    nginx.ingress.kubernetes.io/health-check-path: \"/healthz\"\n    nginx.ingress.kubernetes.io/proxy-body-size: \"64m\"\n    nginx.ingress.kubernetes.io/affinity: cookie\n    nginx.ingress.kubernetes.io/force-ssl-redirect: \"true\"\n    nginx.ingress.kubernetes.io/session-cookie-name: route\n    nginx.ingress.kubernetes.io/use-private-ip: \"true\"\n    nginx.ingress.kubernetes.io/request-timeout: \"180\"\n    meta.helm.sh/release-name: &lt;cms-release-name&gt;\n    meta.helm.sh/release-namespace: &lt;cms-namespace&gt;\n  labels:\n    app.kubernetes.io/managed-by: Helm\nspec:\n  ingressClassName: nginx\n  rules:\n  - host: int.&lt;fqdn&gt;\n    http:\n      paths:\n      - path: /*\n        pathType: ImplementationSpecific\n        backend:\n          service:\n            name: &lt;cms-service-name&gt;\n            port:\n              number: 443\n  tls:\n  - hosts:\n    - int.&lt;fqdn&gt;\n    secretName: nginx-default-secret\n</code></pre>\n</li></ol>\n<h3><a id=\"Step_6_Update_the_service_URL_for_internal_communication\" name=\"Step_6_Update_the_service_URL_for_internal_communication\" title=\"Step 6: Update the service URL for internal communication\"></a>Step 6: Update the service URL for internal communication</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Update the cms <code>values.yaml </code>file to point IDM service URL to internal DNS name.\n\n\t<pre><code class=\"language-yaml\">idm:\n    idmAuthUrl: https://&lt;SMAX-External-FQDN&gt;/idm-service\n    idmIntegrationAdmin: cms-integration-admin\n    idmServiceUrl: https://int.&lt;SMAX-Internal-FQDN&gt;/idm-service\n    internal: false\n    orgAware: false</code></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Perform helm upgrade.</li></ol>\n<h3><a id=\"Verify_the_connectivity_between_Service_Management_and_UCMDB\" name=\"Verify_the_connectivity_between_Service_Management_and_UCMDB\" title=\"Verify the connectivity between Service Management and UCMDB\"></a><a id=\"Verify_the_connectivity_from_Service_Management_and_UCMDB\" name=\"Verify_the_connectivity_from_Service_Management_and_UCMDB\" title=\"Verify the connectivity from Service Management and UCMDB\"></a>Verify the connectivity between Service Management and UCMDB</h3>\n<div>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Login into <code>https://&lt;SMAX-External-FQDN&gt;/bo</code></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Tenant</strong> &gt; <strong>Applicatio</strong><strong>n Settings </strong>&gt; <strong>Native SACM  settings.</strong></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Test Connection.</strong></li></ol>\n</div>\n</div>",
  "modifiedon": "2026-02-05 11:30:18"
}