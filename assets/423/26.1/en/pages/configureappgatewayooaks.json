{
  "title": "Configure the application gateway for OO",
  "content": "<div class=\"mw-parser-output\">\n<p class=\"mw-empty-elt\">To access OO, create an application gateway on Azure and configure the listener on this application gateway. After installing OO, perform the tasks in this section to create and configure an application gateway for OO. </p>\n<p>When configuring the application gateway and the load balancer for OO, use the ports specified in your customized <strong>values.yaml </strong>file.</p>\n<div>\n<table style=\"border-collapse:collapse; border-style:solid; border-color:#a3a3a3; border-width:0px\" title=\"\" valign=\"top\">\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Type</p>\n</th>\n<th scope=\"col\">\n<p>Port (see the value in the customized values.yaml file)</p>\n</th>\n<th scope=\"col\">\n<p>Recommended</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>Application gateway</p>\n</td>\n<td>\n<p><code>global.externalAccessPort</code></p>\n</td>\n<td>\n<p>443</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Load balancer</p>\n</td>\n<td>\n<p><code>global.nginx.httpsPort</code></p>\n</td>\n<td>\n<p>31443</p>\n</td>\n</tr>\n</tbody>\n</table>\n<h2><a id=\"Configure_a_load_balancer_for_OO\" name=\"Configure_a_load_balancer_for_OO\" title=\"Configure a load balancer for OO\"></a>Configure a load balancer for OO</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Suite Admin</td>\n<td>Bastion node</td>\n</tr>\n</tbody>\n</table>\n<p>To configure a load balancer for OO, follow these steps:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to assign an external IP address for the OO load balancer:\n\t<pre>kubectl patch services itom-ingress-controller-svc -p '{\"metadata\":{\"annotations\":{\"service.beta.kubernetes.io/azure-load-balancer-internal\": \"true\"}},\"spec\":{\"type\":\"LoadBalancer\"}}' -n &lt;OO namespace&gt;\n</pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command until the command output displays the load balancer's external IP address, instead of \"<strong>Pending</strong>\" :\n\t<pre>kubectl get svc itom-ingress-controller-svc -n &lt;OO NAMESPACE&gt;</pre>\n<p>Where,</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">\n<p><code>&lt;OO NAMESPACE&gt;</code><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"> </span></span>is the unique namespace of the OO deployment created in <a href=\"/doc/423/26.1/createdeploymentaksoo\" title=\"Create a new deployment for OO\">Create a new deployment for OO</a>.</p>\n</li></ul>\n</li></ol>\n<h2><a id=\"Configure_an_Azure_application_gateway_for_OO_with_the_load_balancer\" name=\"Configure_an_Azure_application_gateway_for_OO_with_the_load_balancer\" title=\"Configure an Azure application gateway for OO with the load balancer\"></a>Configure an Azure application gateway for OO with the load balancer</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Suite Admin</td>\n<td>Azure portal</td>\n</tr>\n</tbody>\n</table>\n<h3><a id=\"Step_1_Create_an_Azure_application_gateway\" name=\"Step_1_Create_an_Azure_application_gateway\" title=\"Step 1: Create an Azure application gateway\"></a>Step 1: Create an Azure application gateway</h3>\n<p>After the OO installation, follow these steps to create an Azure application gateway.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create an application gateway from the <a href=\"https://portal.azure.com/#create/Microsoft.ApplicationGateway-ARM\" rel=\"nofollow\" target=\"1\" title=\"Azure portal\">Azure portal</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Populate the following basics settings:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Subscription</b>: Select your subscription.</li><li style=\"margin-left: 40px; position: relative;\"><b>Resource group</b>: Use the same one as your VNet and VMs.</li><li style=\"margin-left: 40px; position: relative;\"><b>Application gateway name</b>: Enter a descriptive name.</li><li style=\"margin-left: 40px; position: relative;\"><b>Region</b>: Select the same region as your VNet.</li><li style=\"margin-left: 40px; position: relative;\"><b>Tier</b>: Select <b>Standard V2</b>.</li><li style=\"margin-left: 40px; position: relative;\">Under <b>Configure virtual network</b>, select your VNet for the environment. For the subnet, you need to select <b>Manage subnet configuration</b> to create a subnet. On the <b>Subnets</b> page, select <b>+ Subnet</b> and keep the default settings.</li></ul>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the <b>Frontends</b> page, set <b>Frontend IP address type</b> to <b>Public</b>. Click <b>Add new</b> for the public IP address and enter a name for it, and then click <b>OK</b>. <b>Note</b>: With the Application Gateway <strong>v2</strong> SKU, you can only use public front end IP configuration. Private front end IP configuration isn't enabled for this SKU.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Next: Backends &gt;</b>.</li></ol>\n<h3><a id=\"Step_2_Configure_a_back_end_pool\" name=\"Step_2_Configure_a_back_end_pool\" title=\"Step 2: Configure a back end pool\"></a>Step 2: Configure a back end pool</h3>\n<p>Configure a back end pool for the OO Ingress controller HTTPS port. For this port, use the value of <code>global.nginx.httpsPort</code>. This section takes port <strong>31443</strong>.</p>\n<p>To configure a back end pool, follow these steps:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the <b>Backends</b> page, click <b>Add a backend pool</b> to create a new back end pool for port <strong>31443</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Enter the following information:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Name</b>: enter a name.</li><li style=\"margin-left: 40px; position: relative;\"><b>Add backend pool without targets</b>: select <b>No</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Target type</b>: select <b>IP address or FQDN</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Target</b>: enter the IP address of the load balancer for port <strong>31443</strong>. You can obtain the IP address by running the command: \n\t\t<pre><code>kubectl get svc itom-ingress-controller-svc -n &lt;OO namespace&gt;</code></pre>\n</li></ul>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Add</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Next: Configuration&gt;</b>.</li></ol>\n<h3 id=\"Step_3:_Add_a_routing_rule\"><a id=\"Step_3_Add_a_routing_rule\" name=\"Step_3_Add_a_routing_rule\" title=\"Step 3: Add a routing rule\"></a>Step 3: Add a routing rule</h3>\n<p>On the <b>Configuration</b> page, follow these steps to add a routing rule.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <b>Add a rule</b> in the <b>Routing rules</b> column.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <b>Add a routing rule</b> window that opens, enter a name for the rule.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">A routing rule requires a <strong>listener</strong>. The port for the <strong>listener </strong>is the value of <strong>global.externalAccessPort</strong> that you assigned in the OO <strong>values.yaml</strong> file.<span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"> </span></span>This section takes port <strong>443</strong>.<br/>\n\tClick the <strong>Listener </strong>tab to create a listener with the following settings:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Listener name</b>: Enter a name for the listener.</li><li style=\"margin-left: 40px; position: relative;\"><b>Frontend IP</b>: Select <b>Public</b> to choose the public IP that you created for the front end.</li><li style=\"margin-left: 40px; position: relative;\"><b>Protocol</b>: Select <b>HTTPS</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Port</b>: enter <b>443</b>.</li><li style=\"margin-left: 40px; position: relative;\">In the <b>HTTPS Settings</b> section: First, create a certificate for the environment and export a <strong>pfx</strong> file from the certificate by following these steps:\n\t\t<ol start=\"1\" style=\"padding-left: 0px;\"><li style=\"--number-width: 21px; --number-spacing: 25px; margin-left: 61px; position: relative;\">Skip this step if you already have <code>server.crt</code> and <code>server.key</code> files for the hostname. If you don't, generate a certificate with these commands: <!--cke_bookmark_383S-->\n<pre><code>export hostname=\"{HOSTNAME}\"\n\necho US&gt;response.txt\n\necho CA&gt;&gt;response.txt\n\necho Palo Alto&gt;&gt;response.txt\n\necho &lt;CompanyName&gt;&gt;&gt;response.txt\n\necho Support&gt;&gt;response.txt\n\necho $hostname&gt;&gt;response.txt\n\necho http://www.&lt;CompanyWebsite&gt;.com&gt;&gt;response.txt\n\necho challenge&gt;&gt;response.txt\n\necho OO AKS Gateway SSL Certificate&gt;&gt;response.txt\n\nopenssl req -passout pass:&lt;server_csr_password&gt; -new -out server.csr &lt; response.txt\n\nmv privkey.pem server.key\n\nopenssl x509 -passin pass:&lt;server_csr_password&gt; -in server.csr -out server.crt -req -signkey server.key -days 3650</code></pre>\n<!--cke_bookmark_383E--><br/>\n\t\t\tIn these commands, {HOSTNAME} is the external access host of OO.</li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 65px; position: relative;\">\n<p>After the certificate is ready, export a <strong>pfx</strong> file from the certificate with this command:</p>\n<pre>openssl pkcs12 -export -passin pass:&lt;server_csr_password&gt; -passout pass:&lt;server_pfx_password&gt; -out server.pfx -inkey server.key -in server.crt</pre>\n</li></ol>\n<p>Then, click <strong>Upload a certificate</strong> to upload the certificate you created, and then select the <strong>pfx</strong> file you exported from the certificate.</p>\n</li><li style=\"margin-left: 40px; position: relative;\"><b>Cert name</b>: enter a name for the certificate.</li><li style=\"margin-left: 40px; position: relative;\"><b>Password</b>: Enter the password that you specified for the <strong>pfx</strong> file.</li><li style=\"margin-left: 40px; position: relative;\"><b>Additional settings</b>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><b>Listener type</b>: select <b>Basic</b>.</li><li style=\"margin-left: 52px; position: relative;\"><b>Error page URL</b>: select <b>No</b>.</li></ul>\n</li></ul>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select the <b>Backend targets</b> tab, and then select the back end pool that you created for port <strong>31443</strong>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In <b>HTTP settings</b>, click <b>Add new</b> to create an HTTP setting for port <strong>global.nginx.httpsPort</strong> that you defined in <a href=\"/doc/423/26.1/399-createconfigureyaml\" title=\"the OO values.yaml file\">the OO values.yaml file</a>. This section takes port <strong>31443</strong>.\n\t<p>Run the following commands on the bastion node to create an <strong>RE_ca.cert</strong> file. Use this file when you configure an HTTP setting for port <strong>31443</strong>.</p>\n<pre>kubectl get cm -n &lt;OO namespace&gt; public-ca-certificates -o json |sed -n '/RE_ca.crt/ p'|sed 's/\\\\n//g'|sed 's/ //g' |sed 's/\"RE_ca.crt\":\"-----BEGINCERTIFICATE-----/-----BEGIN CERTIFICATE-----\\n/g' |sed 's/-----ENDCERTIFICATE-----\",/\\n-----END CERTIFICATE-----/g' &gt; RE_ca.cer\n</pre>\n<p>Follow these steps to add an HTTP setting:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 21px; --number-spacing: 25px; margin-left: 49px; position: relative;\">Click <b>Add new</b>.</li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 53px; position: relative;\">Enter a name for the HTTP setting.</li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 53px; position: relative;\">Enter the following information:\n\t\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><b>Backend protocol</b>: Choose <b>HTTPS</b>.</li><li style=\"margin-left: 52px; position: relative;\"><b>Backend port</b>: enter <strong>31443</strong>.</li><li style=\"margin-left: 52px; position: relative;\"><b>CER certificate</b>: choose the <code>RE_ca.cer</code> certificate file that you created.</li><li style=\"margin-left: 52px; position: relative;\"><b>Request time-out (seconds)</b>: enter <b>180</b>.</li><li style=\"margin-left: 52px; position: relative;\"><b>Override with new host name</b>: select <b>Yes</b>, choose <b>Override with specific domain name</b>, and then enter your external access hostname.</li><li style=\"margin-left: 52px; position: relative;\"><b>Create custom probes</b>: select <b>Yes</b>. A custom probe is automatically created. You will configure this custom probe in the next step.</li></ul>\n</li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 53px; position: relative;\">Click <b>Add</b>.</li></ol>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Next:Tags&gt;</b></li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Next: Review+create&gt;</b>, and wait until the validation has passed.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Create</b>. The application gateway will get created in several minutes.</li></ol>\n<h3 id=\"Step_4:_Configure_a_health_probe_for_3000\"><a id=\"Step_4_Configure_a_health_probe_for_31443\" name=\"Step_4_Configure_a_health_probe_for_31443\" title=\"Step 4: Configure a health probe for 31443\"></a>Step 4: Configure a health probe for 31443</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Open the application gateway that you created in the previous step.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Health probe</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Open the custom health probe created in the previous step.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Configure the following parameters:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><b>Protocol</b>: select <b>HTTPS</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Host</b>: enter your external access hostname.</li><li style=\"margin-left: 40px; position: relative;\"><b>Path</b>: enter <b>/oo</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Interval (seconds)</b>: enter <b>30</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Timeout (seconds)</b>: enter <b>5</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>Unhealthy threshold</b>: enter <b>15</b>.</li><li style=\"margin-left: 40px; position: relative;\"><b>HTTP settings</b>: choose the one you created for port <strong>31443</strong>.</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Deselect <b>I want to test the backend health before adding the health probe</b>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Save</b>.</li></ol>\n<h3 id=\"Step_5:_Check_the_backend_health_for_port_3000\"><a id=\"Step_5_Check_the_back_end_health_for_port_31443\" name=\"Step_5_Check_the_back_end_health_for_port_31443\" title=\"Step 5: Check the back end health for port 31443\"></a>Step 5: Check the back end health for port 31443</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Open the application gateway that you created.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Backend health</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Make sure that the <b>Status</b> value is <b>Healthy</b> for port <strong>31443</strong>.</li></ol>\n<h2 id=\"Bind_the_external_access_host_name_with_the_application_gateway\"><a id=\"Bind_the_external_access_host_name_with_the_application_gateway\" name=\"Bind_the_external_access_host_name_with_the_application_gateway\" title=\"Bind the external access host name with the application gateway\"></a>Bind the external access host name with the application gateway</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Suite Admin</td>\n<td>DNS provider</td>\n</tr>\n</tbody>\n</table>\n<p>To allow users to access OO with the external access hostname, bind the hostname with the static IP address of the application gateway you created.</p>\n<p>To find your application gateway's IP address, navigate to <strong>Azure portal</strong> &gt; <b>Application gateways</b>, click your application gateway name, and find the IP address under <b>Frontend public IP address</b>.</p>\n<p>Now you can access OO with the following URLs where &lt;FQDN&gt; is the one that you bind with the application gateway.</p>\n<div>\n<table title=\"\" valign=\"top\">\n<thead>\n<tr>\n<th scope=\"col\">\n<p>To access</p>\n</th>\n<th scope=\"col\">\n<p>Enter the following URL in your web browser</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>OO landing page</p>\n</td>\n<td>\n<p><strong>https://&lt;FQDN&gt;:443/oo</strong></p>\n</td>\n</tr>\n<tr>\n<td>\n<p>Autopass</p>\n</td>\n<td>\n<p><strong>https://&lt;FQDN&gt;:443/autopass</strong></p>\n</td>\n</tr>\n</tbody>\n</table>\n</div>\n</div>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}