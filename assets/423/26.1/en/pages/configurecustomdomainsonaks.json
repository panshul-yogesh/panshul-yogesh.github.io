{
  "title": "Configure custom domains (AKS)",
  "content": "<div class=\"mw-parser-output\"><p>If SMA is deployed on Azure with AKS, perform the following steps to configure a custom domain per tenant. </p><h2 id=\"Prerequisite\">Prerequisites</h2><p>Before you begin, complete the following prerequisite steps:</p><ol><li>Prepare one or more certificate files for your custom domains. For details, see the relevant section in <a _ngcontent-c23=\"\" href=\"/doc/423/26.1/configurecustomdomainsfortenants\" title=\"Configure custom domains for tenants\">Configure custom domains for tenants</a>. For example, you prepare one wildcard SAN certificate for your custom domains (ca.crt, server.crt, and server.key).</li><li>Rename the CA certificate file to .cer format. For example, rename ca.crt to ca.cer. You will need to upload the CER certificate to Azure. </li><li>Export the server certificate to a pfx file (in this example, certificate.pfx):\n\t<pre><code>openssl pkcs12 -export -out certificate.pfx -inkey server.key -in server.crt</code></pre>\n\tWhen prompted, enter a password for the pfx file. Make a note of the password, which will be needed when you upload the pfx file later.</li></ol><h2><br/>\nStep 1: Bind the custom domains with the application gateway</h2><p>To allow users to access SMA services with the custom domains, you need to bind the custom domains with the static IP address of the application gateway for the suite.</p><p>To find your application gateway's IP address, navigate to the Azure portal &gt; <b>Application gateways</b>, click your application gateway name, and find the IP address under <b>Frontend public IP address</b>.</p><h2>Step 2: Configure the custom domains in Suite Administration</h2><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-ConfigureCustomDomainsOnPremises|custom_domain_bo|N\"></span><p>To do this, follow these steps:</p>\n<ol>\n<li>Log in to Suite Administration as suite-admin.</li>\n<li>Open an active tenant record.</li>\n<li>Make sure that the original tenant URL (<code>https://&lt;EXTERNAL_ACCESS_HOST&gt;/saw/ess?TENANTID=XXXXXXXX</code>) displayed in the <strong>General</strong> tab is accessible.</li>\n<li>From the <strong>General</strong> tab, enter a fully qualified domain name in the <strong>Custom domain</strong> field. For example, enter <strong>customer1.example.com</strong>. Note that each custom domain value must be unique. <br/>\n<strong>Note</strong>: The custom domain must be at least a third-level domain such as <strong>customer1.example.com</strong>. In other words, <strong>example.com</strong> isn't supported. See the following figure for an example. <a class=\"image\" href=\"/file/images/6/68/SMA_2020.02_shortURL_custom_domain_field.png\" title=\"/file/images/6/68/SMA_2020.02_shortURL_custom_domain_field.png\"> <img alt=\"SMA 2020.02 shortURL custom domain field.png\" src=\"../../../images/SMA_2020.02_shortURL_custom_domain_field_700f9c62.png\"/> </a></li>\n<li>Save the tenant record. </li>\n<li>Repeat the steps for the rest of the tenants that need a custom domain. </li>\n<li>Launch each https://&lt;custom domain&gt; URL in a browser to test the configurations. For example: <strong><a href=\"https://customer1.example.com\" target=\"1\">https://customer1.example.com</a></strong>. You should be able to log in to the tenant as the tenant admin. </li>\n</ol>\n<p><br/>\n</p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-ConfigureCustomDomainsOnPremises|custom_domain_bo|N\"></span><h2>Step 3: Replace the suite certificate in Nginx</h2><p>Perform the following steps:</p><ol><li>Copy the server certificate and server key files (server.crt and server.key) that you have generated to the AKS bastion node.</li><li>Run the following command on the bastion node (replace the placeholders with your own server certificate and server key files, replace &lt;namespace&gt; with <strong>core</strong> or the suite namespace): \n\t<pre><code>kubectl patch secret nginx-default-secret -p '{\"data\":{\"tls.crt\":\"'$(base64 -w 0 &lt;server.crt&gt;)'\",\"tls.key\":\"'$(base64 -w 0 &lt;server.key&gt;)'\"}}' -n &lt;namespace&gt;</code></pre></li><li>Run the following command on the bastion node to activate the new certificate (replace &lt;suite namespace&gt; with your suite namespace (itsma-xxxxx)): \n\t<pre><code>kubectl get pods -n &lt;suite namespace&gt; | grep itom-ingress-controller | awk '{print $1}'| xargs kubectl delete pod -n &lt;suite namespace&gt;</code></pre></li></ol><h2>Step 4: Configure the custom domains in the application gateway</h2><p>Log in to the Azure portal, and repeat the following steps for each custom domain. </p><h3>Create a new listener for port 443 in the application gateway</h3><ol><li>Open the application gateway for the suite. </li><li>Click <strong>Listeners</strong>, and then click <strong>+Add listener</strong> to create a listener for port 443.</li><li>Provide the following information:\n\t<ul><li>Listener name: Enter a name for the listener.</li><li>Frontend IP: Select <strong>Public</strong>.</li><li>Port: enter <strong>443</strong>.</li><li>Protocol: select <strong>HTTPS</strong>.</li><li>Choose a certificate: Select <strong>Create new</strong>, select <strong>Upload a certificate</strong>, and then browse to the certificate.pfx file that you created previously. In the <strong>Cert name</strong> field, specify a name; in the <strong>Password</strong> field, enter the password that you specified when exporting the certificate.pfx file.</li><li>Additional settings:\n\t\t<ul><li>Listener type: select <strong>Multi Site</strong>.<br/>\n\t\t\tHost Name: enter the custom domain. For example: myhr.sma-ng.com.</li><li>Error page URL: select<strong> No</strong>.</li></ul></li></ul></li><li>Click <strong>Add</strong>.</li></ol><h3>Create an http-setting</h3><ol><li>Click <strong>HTTP settings</strong>, and then click <strong>+ Add</strong>.</li><li>Provide the following information:\n\t<ul><li>HTTP settings name: enter a name. </li><li>Backend protocol: Choose <strong>HTTPS</strong>.</li><li>Backend port: enter <strong>443</strong>.<br/>\n\t\tChoose a certificate: Select <strong>Create new</strong>, and then in the <strong>CER certificate</strong> field browse to the ca.cer file that you created (you need to rename your ca.crt file to ca.cer first).</li><li>Override with new host name: select <strong>Yes</strong>, choose <strong>Override with specific domain name</strong>, and then enter your custom domain (for example: myhr.sma-ng.com).</li><li>Request time-out (seconds): enter <strong>180</strong>.</li><li>Use custom probe: select <strong>Yes</strong>, and then select the existing custom probe that was created for port 443.</li></ul></li><li>Click <strong>Save</strong>. The HTTP setting configuration for port 443 is completed.</li></ol><h3>Create a routing rule</h3><ol><li>Click <strong>Rules</strong>, and then click <strong>+Request routing rule</strong>.</li><li>Select <strong>Add a rule</strong> in the Routing rules column.</li><li>In the <strong>Add a routing rule</strong> window that opens, enter a name for the rule.</li><li>A routing rule requires a listener. On the <strong>Listener</strong> tab, in the <strong>Listener</strong> field, select the listener that you created for the custom domain.</li><li>On the <strong>Backend targets</strong> tab, select <strong>Backend pool</strong> as the target type, and then in the <strong>Backend target</strong> field select the existing backend pool for port 443.</li><li>In the <strong>HTTP settings</strong> field, select the HTTP setting that you created for the custom domain.</li><li>Click <strong>Save</strong>. The configuration for port 443 is completed.</li></ol><h2 id=\"AKS-Howtoconfigureshort-URLinaks-Reconfigurehttp-setting/listenercertificatesforprimaryURL\">Step 5: Reconfigure the new certificate for the external access host in the application gateway</h2><p>Perform the following steps to upload the new certificate to the application gateway settings for the external access host of the suite, for ports 443 and 5443. </p><h3>For port 443</h3><p>Perform the following steps.</p><h4>Reconfigure the new CA certificate in the http setting</h4><ol><li>Click <strong>HTTP settings</strong>, and open the existing http setting for port 433 that has the external access host FQDN configured. </li><li>Click <strong>Add certificate</strong>, click <strong>Select existing</strong>, and then select the new ca.cer file, which you have already uploaded. </li></ol><h4>Update the health probe</h4><ol><li>Open the existing health probe for port 443.</li><li>For the <strong>Pick host name from backend HTTP settings</strong> option, change the setting from <strong>No</strong> to <strong>Yes</strong>.</li></ol><h3>For port 5443</h3><h4>Reconfigure the new CA certificate in the http setting</h4><ol><li>Click <strong>HTTP settings</strong>, and open the existing http setting for port 5433 that has the external access host FQDN configured. </li><li>Click <strong>Add certificate</strong>, click <strong>Select existing</strong>, and then select the new ca.cer file, which you have already uploaded. </li></ol><h2 id=\"Step_5:_Reconfigure_SAML_authentication_(accounts_with_SAML_authentication_only)\">Step 6: Reconfigure SAML authentication (accounts with SAML authentication only)</h2><p>If SAML authentication was set up on the account associated with the tenant, <a href=\"/doc/423/26.1/configureauthenticationinidm#Download_metadata_from_the_suite\" title=\"Download metadata from the suite\">Download metadata from the suite</a> and <a href=\"/doc/423/26.1/configureauthenticationinidm#Add_Relying_Party_Trust_in_ADFS\" title=\"Add Relying Party Trust in ADFS\">Add Relying Party Trust in ADFS</a> after the custom domain configuration.</p><h2>Step 7: Test the configuration</h2><p>Launch the following URLs:</p><ul><li>Tenant URLs: https://&lt;custom domain&gt; (user: the tenant admin)</li><li>OMT management portal: https://&lt;External Access Host&gt;:5443 (user: admin)</li><li>Suite Administration: https://&lt;External Access Host&gt;/bo (user: suite-admin)</li></ul><p>Make sure that there is no certificate security warning displayed in the browser address bar, and you can successfully log in.</p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}