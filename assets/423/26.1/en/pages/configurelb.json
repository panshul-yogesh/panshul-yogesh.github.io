{
  "title": "Configure a load balancer for the control plane",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n<th>Privileges required</th>\n</tr>\n<tr>\n<td>System administrator</td>\n<td>Internal load balancer</td>\n<td>Root</td>\n</tr>\n</tbody>\n</table>\n<p>OMT supports high availability (HA) through either load balancers (that are provided by you) or Keepalived (that's provided by OMT). The configuration of a load balancer for the control plane is therefore optional; you can instead configure Keepalived to achieve HA.  </p>\n<p>A load balancer manages the distribution of internal traffic between all control plane and worker nodes. It balances the traffic to all control plane nodes for the internal services that are accessed by all nodes in the cluster. Usually, users outside the cluster can't access these services. Therefore, users outside the cluster also shouldn't have access to the load balancer.</p>\n<div class=\"Admonition_Note\"><strong>Note: </strong>You can also set up a load balancer to balance the outside traffic to all control plane nodes or worker nodes for the OMT services and application. This can be a separete load balancer, or you can configure a single load balancer for both the control plane and application access. You must set the parameter <code>LOAD_BALANCER_HOST</code> in the <code>install.properties</code> file, which could be either IP or FQDN. Set the parameter <code>EXTERNAL_ACCESS_HOST</code> to the external load balancer, which must be FQDN. If we just use a combined load balancer, the two parameters can be the same.</div>\n<p>The following services and ports must be open for load balancing:</p>\n<ul>\n<li>Kubernetes: 8443</li>\n<li>Etcd: 4001</li>\n</ul>\n<p>OMT supports the following load balancers:</p>\n<ul>\n<li>Nginx</li>\n<li>F5</li>\n<li>AWS</li>\n<li>Azure</li>\n<li>Google</li>\n<li>Apache web server</li>\n</ul>\n<p>This topic uses Nginx as an example to explain how to configure a load balancer.</p>\n<h3 class=\"mw-headline\" id=\"Configure_nginx\">Install and configure Nginx</h3>\n<ol>\n<li>Install Nginx on the load balancer. In this example, the load balancer is <code>mylb.lb.com</code>.</li>\n<li>Conduct a health check for the upstreams to make sure the traffic is always transferred to a valid server.</li>\n<li>Enable sticky session for the load balancer. </li>\n<li>Make sure the Nginx configuration file on the load balancer contains the following settings:\n\t<pre>stream {\n    upstream k8s {    #upstream for kubernetes service\n        least_conn;\n        server &lt;control plane node 1&gt;:8443 max_fails=3 fail_timeout=5;    #master node 1\n        server &lt;control plane node 2&gt;:8443 max_fails=3 fail_timeout=5;    #master node 2\n        server &lt;control plane node 3&gt;:8443 max_fails=3 fail_timeout=5;    #master node 3\n    }\n \n    upstream etcd {    #upstream for etcd service\n        least_conn;\n        server &lt;control plane node 1&gt;:4001 max_fails=3 fail_timeout=5;    #master node 1\n        server &lt;control plane node 2&gt;:4001 max_fails=3 fail_timeout=5;    #master node 2\n        server &lt;control plane node 3&gt;:4001 max_fails=3 fail_timeout=5;    #master node 3\n    }\n    server {    #listen on port 4001 and proxy to etcd service\n        listen 4001;\n        proxy_pass etcd;\n    }\n    server {    #listen on port 8443 and proxy to kubernetes service\n        listen 8443;\n        proxy_pass k8s;\n    }\n}\n</pre>\n<p>Replace all the placeholders with the appropriate FQDNs.</p>\n</li>\n</ol>\n<h3 class=\"mw-headline\" id=\"Configure_CDF_parameters\">Configure installation parameters</h3>\n<p>In a later step, you will configure the <code>install.properties</code> file. When you do, you must configure the following parameters:</p>\n<ul>\n<li><code>LOAD_BALANCER_HOST</code><br/>\n\tConfigure the <code>LOAD_BALANCER_HOST</code> parameter with the IPv4 address or FQDN of the host where the load balancer is installed. All cluster nodes must be able to access this host.</li>\n<li><code>KUBE_DNS_HOSTS</code> (only in non-DNS environments)<br/>\n\tIf the load balancer can't be resolved directly, you must set up host name resolution in a <code>hosts</code> file. Add the following line to the file:\n\t<pre><code>&lt;external load balancer IP&gt; &lt;external load balancer host name&gt;</code></pre>\n<p>For example:</p>\n<pre><code>192.0.2.1 mylb.lb.com</code></pre>\n<p>Then, configure the value of the <code>KUBE_DNS_HOSTS</code> parameter to the hosts file.</p>\n</li>\n</ul>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}