{
  "title": "Configure a load balancer for UD/UCMDB port 8443 (OpenShift)",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>After the UD/UCMDB installation, you need to get the actual node port of the frontend ingress, and then add traffic map rules to the load balancer. The port map points from port 8443 to the actual node ports.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\"> You should have already install Nginx on the bastion node when <a href=\"/doc/423/26.1/configurelbforport5443\" title=\"configuring a load balancer for port 3000\">configuring a load balancer for port 5443</a>. Use the same Nginx as a load balancer for the UD/UCMDB port 8443. </div>\n</div>\n<p>Follow these steps:</p>\n<ol>\n<li>Get the node port of the frontend ingress service:\n\t<pre><code>kubectl get svc itom-ingress-controller-svc -n ucmdb-prod -o jsonpath='{range .spec.ports[?(@.name == \"https\")]}{.nodePort}{\"\\n\"}{end}'</code></pre>\n</li>\n<li>Configure the nginx configuration file (<strong>nginx.conf</strong>) for the application load balancer or the network load balancer.\n\t<ul>\n<li><strong>For application load balancer:</strong><br/>\n\t\tMake sure the nginx configuration file (<strong>nginx.conf</strong>) contains the following settings.\n\t\t<pre><code>http {\n    upstream cmsrouter8443 {    #upstream for cms\n        least_conn;\n        keepalive 32;\n        server &lt;control plane node 1&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0;     #control plane node 1\n        server &lt;control plane node 2&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0;     #control plane node 2\n        server &lt;control plane node 3&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0;     #control plane node 3\n    } \n    server { #listen on 8443 and proxy to cms\n        listen 8443  ssl http2;\n        ssl_certificate                         /root/server.crt;       #certificate generated by customers\n        ssl_certificate_key                  /root/server.key;      #key generated by customers \n        location ^~ / {\n            proxy_set_header Host            \"&lt;external load balancer&gt;:8443\";\n            proxy_pass                              https://cmsrouter8443 ;\n        }\n    } \n  \n}</code></pre>\n</li>\n<li><strong>For network load balancer</strong>: <br/>\n\t\tAdd the following lines to <strong>nginx.conf</strong>, and replace <strong>&lt;node port&gt;</strong> with the value you have obtained from step 1:\n\t\t<pre><code>stream {\n    upstream cmsrouter8443 { #upstream for 8443\n         least_conn;\n         server &lt;control plane node 1 IP address&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0; #control plane node 1\n         server &lt;control plane node 2 IP address&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0; #control plane node 2\n         server &lt;control plane node 3 IP address&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0; #control plane node 3\n    }\n\n    server {\n         listen 8443;\n         proxy_pass cmsrouter8443;\n     }\n }</code></pre>\n</li>\n</ul>\n</li>\n<li>Restart Nginx:\n\t<pre><code>nginx -s reload</code></pre>\n</li>\n<li>Verify that you can open the UCMDB UI: <strong>https://&lt;EXTERNAL_ACCESS_HOST&gt;/cms</strong>. <br/>\n\tNote that at the moment you can only open the URL. To log in to UD/UCMDB as <strong>suite-admin</strong>, you must perform the <a href=\"/doc/423/26.1/associatecmssuperadminroleopenshift\" title=\"Associate UD/UCMDB SuperAdmin role (OpenShift)\">Associate UD/UCMDB SuperAdmin role (OpenShift)</a> task.</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}