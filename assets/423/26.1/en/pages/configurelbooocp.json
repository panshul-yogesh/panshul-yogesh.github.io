{
  "title": "Configure a load balancer for OO on OpenShift",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>After the installing OO Containerized on OpenShift, you need to get the actual node port of the front end ingress, and then add traffic map rules to the load balancer. The port map points from port 9443 to the actual node ports.</p>\n<p>If you installed Nginx on the bastion node when configuring a load balancer, use the same Nginx as a load balancer for the OO port 9443. </p>\n<p>Follow these steps:</p>\n<ol>\n<li>Get the node port of the front end ingress service:\n\t<pre><code>kubectl get svc itom-ingress-controller-svc -n oo-prod -o jsonpath='{range .spec.ports[?(@.name == \"https\")]}{.nodePort}{\"\\n\"}{end}'</code></pre>\n</li>\n<li>Configure the Nginx configuration file (<strong>nginx.conf</strong>) for the application load balancer or the network load balancer.\n\t<p><strong>For application load balancer:</strong><br/>\n\tMake sure the Nginx configuration file (<strong>nginx.conf</strong>) contains the following settings.</p>\n<pre><code>http {\n    upstream oorouter9443 {    #upstream for 00\n        least_conn;\n        keepalive 32;\n        server &lt;control plane node 1&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0;     #control plane node 1\n        server &lt;control plane node 2&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0;     #control plane node 2\n        server &lt;control plane node 3&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0;     #control plane node 3\n    } \n    server { #listen on 9443 and proxy to oo\n        listen 9443  ssl http2;\n        ssl_certificate                      /root/server.crt;      #certificate generated by customers\n        ssl_certificate_key                  /root/server.key;      #key generated by customers \n        location ^~ / {\n            proxy_set_header Host            \"&lt;external load balancer&gt;:9443\";\n            proxy_pass                              https://oorouter9443 ;\n            client_max_body_size            4096m;\n            proxy_read_timeout              300s;\n        }\n    } \n  \n}</code></pre>\n<p><strong>For network load balancer</strong>: <br/>\n\tAdd the following lines to <strong>nginx.conf</strong>, and replace <strong>&lt;node port&gt;</strong> with the value you have obtained from step 1:</p>\n<pre><code>stream {\n    upstream oorouter9443 { #upstream for 9443\n         least_conn;\n         server &lt;control plane node 1 IP address&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0; #control plane node 1\n         server &lt;control plane node 2 IP address&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0; #control plane node 2\n         server &lt;control plane node 3 IP address&gt;:&lt;node port&gt; max_fails=0 fail_timeout=0; #control plane node 3\n    }\n\n    server {\n         listen 9443;\n         proxy_pass oorouter9443;\n     }\n }</code></pre>\n</li>\n<li>Restart Nginx:\n\t<pre><code>nginx -s reload</code></pre>\n</li>\n</ol>\n<p>Verify that you can open the OO UI: <strong>https://&lt;EXTERNAL_ACCESS_HOST&gt;:&lt;EXTERNAL_ACCESS_PORT&gt;/oo</strong>. <br/>\nNote that at the moment you can't login as a tenant isn't configured. You can only open the URL. </p>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}