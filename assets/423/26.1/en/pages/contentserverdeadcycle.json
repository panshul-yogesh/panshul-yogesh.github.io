{
  "title": "The content server restarts in a dead cycle due to the drecompact operation",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>The content server exits because it cannot complete the <code>drecompact</code> operation.</p>\n<p>When the content server restarts, it tries to resume the <code>drecompact</code> operation. Since the <code>drecompact</code> operation cannot be recovered, the content server is in a dead cycle of restart.</p>\n<p>The Index log displays the following content.</p>\n<pre>12/01/2023 12:02:10 [1] 30-Normal: DRECOMPACT summary:\n12/01/2023 12:02:10 [1] 30-Normal: Stage: A (Start Compaction), Time: 0 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: B (Refindex Compaction), Time: 5 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: C-I (Nodetable switch), Time: 0 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: C-II (Numeric Compaction), Time: 15 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: C-III (Geoindex Compaction), Time: 0 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: D-I (Dynterm Compaction), Time: 7 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: D-II (Unstemmed Compaction), Time: 7 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: D-III (Phrase Compaction), Time: 0 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: E (Nodetable Compaction), Time: 40 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: F (Reference Nodetable Compaction), Time: 38 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Stage: G (Best Term Compaction), Time: 0 seconds\n12/01/2023 12:02:10 [1] 30-Normal: Compact interrupted: 4 remaining stages not attempted.</pre>\n<p>The application log displays the following content.</p>\n<pre>12/01/2023 12:02:10 [1] 70-Error: Unable to complete Compact Stage G, compact abandoned\n12/01/2023 12:02:10 [1] 99-Always: Compaction was abandoned. Exiting....</pre>\n<h2>Cause</h2>\n<p>This issue may arise for several reasons, one of which is the content pod being restarted during the <code>drecompact</code> operation. In this case, refer to Solution 3.</p>\n<h2>Solution</h2>\n<p>Try either of the following solutions to work around this issue.</p>\n<h3>Solution 1</h3>\n<ol>\n<li>\n<p>Run the following command to scale in the problematic statefulset to 0.</p>\n<p><code>kubectl scale sts smarta-saw-con -n itsma-xxxx --replicas=0</code></p>\n</li>\n<li>\n<p>For each pod of the statefulset above, run the following command to remove dbbt.db from the data directory.</p>\n<p><code>rm -f ${DATA_DIR}/dynterm/dbbt.db</code></p>\n</li>\n<li>\n<p>Run the following command to scale out statefulset to the original size.</p>\n<p><code>kubectl scale sts smarta-saw-con -n itsma-xxxx --replicas=${ORIGINAL_SIZE}</code></p>\n</li>\n</ol>\n<h3>Solution 2</h3>\n<p>Copy the data from the mirror content to the data directory on the problematic content server.</p>\n<p>For example, if this issue occurs on smarta-saw-con-0, follow these steps as a workaround.</p>\n<ol>\n<li>\n<p>Shut down the content server by running the following command.</p>\n<p><code>kubectl scale sts smarta-saw-con -n itsma-xxxx --replicas=0</code></p>\n</li>\n<li>\n<p>Shut down the mirror content server by running the following command.</p>\n<p><code>kubectl scale sts smarta-saw-con-a -n itsma-xxxx --replicas=0</code></p>\n</li>\n<li>Clear the data directory on smarta-saw-con-0 on the NFS server.</li>\n<li>\n<p>Copy all data from the data diectory on smarta-saw-con-a-0 to the data diectory on smarta-saw-con-0 by running the following command.</p>\n<p><code>cp -rf /var/vols/itom/itsma/itsma-smarta-saw-con-a-0/smarta-saw-con-a-0/data/* /var/vols/itom/itsma/itsma-smarta-saw-con-0/smarta-saw-con-0/data/</code></p>\n</li>\n<li>\n<p>Restore smarta-saw-con pods by running the following command.</p>\n<p><code>kubectl scale sts smarta-saw-con -n itsma-xxxx --replicas=x</code></p>\n</li>\n<li>\n<p>Restore smarta-saw-con-a pods by running the following command.</p>\n<p><code>kubectl scale sts smarta-saw-con-a -n itsma-xxxx --replicas=x</code></p>\n</li>\n</ol>\n<h2>Solution 3</h2>\n<p>Before restarting any content pod or upgrading the system, make sure that all <code>drecompact</code> operations are complete.</p>\n<ol>\n<li>Log in to Suite Administration.</li>\n<li>Navigate to <strong>Configurations </strong>&gt; <b>Smart Analytics</b>, and click <b>Go to Smart Analytics</b>.</li>\n<li>In Smart Analytics Assistant, enter the following action for each content pod and click <b>RUN</b>.\n\t<pre>https://&lt;content pod name&gt;/action=indexerGetStatus&amp;MaxResults=20&amp;IndexCmd=DRECOMPACT</pre>\n\tFor example:<br/>\n\tRun <code>https://smarta-saw-con-0:1443/action=indexerGetStatus&amp;MaxResults=2<span style=\"font-size: 14px;\">0&amp;IndexCmd=DRECOMPACT</span></code><span style=\"font-size: 14px;\"> </span>to check content pod <strong>smarta-saw-con-0</strong><br/>\n\tRun <code>https://smarta-sawarc-con-0:1443/action=indexerGetStatus&amp;MaxResults=20&amp;IndexCmd=DRECOMPACT</code> to check content pod <strong>smarta-sawarc-con-0</strong>.</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}