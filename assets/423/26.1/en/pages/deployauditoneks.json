{
  "title": "Deploy Audit on AWS (EKS)",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This section provides the steps required to install the Audit service on AWS (EKS).</p>\n<h2 id=\"Generate_vault_secrets_for_the_CMS_charts\">Generate vault secrets for the Audit charts</h2>\n<p>Perform the following tasks to generate vault secrets for the Audit charts:</p>\n<ol>\n<li>\n<p>On the bastion node, navigate to the OPTIC Management Toolkit (OMT) installation directory:</p>\n<pre>cd OMT_External_K8s_2x.x-xxx/scripts/</pre>\n</li>\n<li>\n<p>Run the following command to generate vault secrets (If this command fails, add <em>sudo</em> at the beginning of the command and run it again):</p>\n<pre>./gen_secrets.sh -n &lt;Audit Namespace&gt; -c &lt;Audit Chart File&gt; -o &lt;Secrets YAML File&gt;</pre>\n<p>where,</p>\n<p><em>&lt;Audit Namespace&gt;</em> is the unique namespace of the Audit deployment.<br/>\n<em>&lt;Audit Chart File&gt;</em> is the tar file containing the Audit installation charts (<strong>audit-&lt;version&gt;.tgz</strong>).<br/>\n<em>&lt;Secrets YAML File&gt;</em> is the YAML file that stores the Audit secrets. Specify the file name (for example, <strong>audit-secrets.yaml</strong>), and then the script will generate this YAML file after you run the script. You will need to use this file when you run the command to install Audit later.</p>\n<p>For example:</p>\n<pre>./gen_secrets.sh -n auditns -c audit-&lt;version&gt;.tgz -o audit-secrets.yaml</pre>\n</li>\n<li>\n<p>The vault secret utility prompts you for the following passwords: <strong>audit_db_pass_key</strong>,<strong> idm_transport_user_pass_key</strong>, and<strong> idm_super_user_pass_key</strong>. IdM must have the IdM transport user and the super user (for example, <strong>suite-admin</strong>). If you want to use new users, give the transport user and super user permissions to these users.</p>\n</li>\n</ol>\n<p>The following table describes the vault secret keys:</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Key</th>\n<th scope=\"col\">Required</th>\n<th scope=\"col\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>audit_db_pass_key</strong></td>\n<td>Yes</td>\n<td>Audit database password. This password corresponds to <strong>auditService.database.user</strong> parameter in the values.yaml file.</td>\n</tr>\n<tr>\n<td><strong>idm_transport_user_pass_key</strong></td>\n<td>Yes</td>\n<td>\n<p>IdM transport user password. This password corresponds to <strong>auditGateway.deployment.idmTransportUser </strong>parameter in the values.yaml file.</p>\n</td>\n</tr>\n<tr>\n<td><strong>idm_super_user_pass_key</strong></td>\n<td>Yes</td>\n<td>IdM super user password. This password corresponds to <strong>auditService.idm.superUser </strong>parameter in the values.yaml file (for example, <strong>suite-admin</strong>).</td>\n</tr>\n</tbody>\n</table>\n<h3>IdM transport user password</h3>\n<p>Following is a command to retrieve the idmTransportUser password from the IdM container:</p>\n<pre>kubectl exec &lt;IDM POD&gt; -n &lt;ESM NAMESPACE&gt; -c idm -- get_secret idm_transport_user_password_secret_key</pre>\n<p>For example,</p>\n<pre>kubectl exec idm-7b87f8bbfc-bwswl -n itsma-qcml0 -c idm -- get_secret idm_transport_user_password_secret_key</pre>\n<h2>Install the service</h2>\n<p>To complete the deployment, you will need to install the Audit service using Helm.</p>\n<p>Run the following command:</p>\n<pre>$helm install &lt;Audit Release Name&gt; &lt;Audit Service Chart&gt; -n &lt;Audit Namespace&gt; -f values.yaml -f audit-secrets.yaml --set-file \"caCertificates.cert_one\\.crt\"=/path/to/cert_one.crt --set-file \"caCertificates.cert_two\\.crt\"=/path/to/cert_two.crt\n</pre>\n<p>where,<br/>\n<em>&lt;Audit Release Name&gt; </em>is the unique release name that you need to specify for the Audit deployment. You need to use the same release name as specified here when you upgrade Audit in the future.<br/>\n<em>&lt;Audit Service Chart&gt;</em> is the tar file containing the Audit installation charts.<br/>\n<em>&lt;Audit Namespace&gt;</em> is the unique namespace you created for the Audit service.<br/>\n<em>&lt;Values YAML File&gt;</em> is your <b>values.yaml </b>file with properties configured for the Audit deployment.<br/>\n<em>&lt;Secrets YAML File&gt; </em>is the YAML file that stores the Audit secrets. Specify the file name (for example, <strong>audit-secrets.yaml</strong>).<br/>\nThe certificates are passed by using the --set-file option. In the below example, you can see the suite (go to the suite login screen and download the suite root certificate from the browser), DB, and Internal ALB certificates are passed. You need to pass the Internal ALB certificate, as the communication between Audit gateway and Audit engine is through internal ALB.</p>\n<p>For example:</p>\n<pre>$helm install audit audit-&lt;version&gt;.tgz -n auditns -f values.yaml -f audit-secrets.yaml --set-file \"caCertificates.RE_ca_idmcrt\"=./RE_ca_idm.crt --set-file \"caCertificates.RE_ca_dbcrt\"=./RE_ca_db.crt --set-file \"caCertificates.RE_ca_intAlb\"=./RE_ca_intAlb.crt\n</pre>\n<h2>Verify the installation</h2>\n<p>To verify if you have installed the Audit service successfully, do the following:</p>\n<ol>\n<li>\n<p>Log in to the bastion node.</p>\n</li>\n<li>\n<p>Run the following command to make sure that all pods are ready:</p>\n<pre>kubectl get pod -n &lt;Audit Namespace&gt; |grep -v 1/1|grep -v 2/2|grep -v 3/3|grep -v 4/4|grep -v Completed</pre>\n<p>where,</p>\n<p><em>&lt;Audit Namespace&gt;</em> is the namespace where you have deployed the Audit Helm chart.</p>\n<p>This command returns a list of abnormal pods. When it returns no results, all pods are ready.</p>\n</li>\n</ol>\n<h2>(Optional) Enable Audit menu for existing active tenants</h2>\n<p>If there are active tenants in the system before installing Audit, you can enable the Audit menu in the agent interface for each of these tenants. To do so, you should run the <strong>EnableAuditMegaMenu.bin</strong>, which is part of the Audit Helm package.</p>\n<h3>Enable Audit menu for all active tenants</h3>\n<p>To enable the Audit menu for all the active tenants, follow these steps:</p>\n<ol>\n<li>\n<p>Navigate to the audit install directory <strong>audit-&lt;version&gt; </strong>that you created when downloading the Audit Helm chart. For example:</p>\n<pre>cd &lt;audit_install-dir&gt;/audit-2x.x</pre>\n</li>\n<li>\n<p>Run the following command to enable Audit:</p>\n<pre>./EnableAuditMegaMenu.bin -f &lt;Service Management Hostname&gt; -p &lt;Service Management Port&gt; -a &lt;Audit Service URL&gt;</pre>\n<p>For example:</p>\n<pre>./EnableAuditMegaMenu.bin -f smax.example.com -p 443 -a https://audit.example.com:443</pre>\n</li>\n<li>When prompted for a password, give the password for the seeded integration user.</li>\n</ol>\n<h3>Enable Audit menu for a specific active tenant</h3>\n<p>To enable the Audit menu for a specific active tenant, follow these steps:</p>\n<ol>\n<li>\n<p>Navigate to the audit install directory <strong>audit-&lt;version&gt; </strong>that you created when downloading the Audit Helm chart. For example:</p>\n<pre>cd &lt;audit_install-dir&gt;/audit-2x.x</pre>\n</li>\n<li>\n<p>Run the following command to enable Audit:</p>\n<pre>./EnableAuditMegaMenu.bin -f &lt;Service Management hostname&gt; -p &lt;Service Management port&gt; -a &lt;Audit Service URL&gt; -t &lt;Tenant ID&gt;</pre>\n<p>For example:</p>\n<pre>./EnableAuditMegaMenu.bin -f smax.example.com -p 443 -a https://audit.example.com:443 -t 123456</pre>\n</li>\n<li>\n<p>When prompted for a password, give the password of the seeded integration user.</p>\n</li>\n</ol>\n<h2>Related topic</h2>\n<ul>\n<li>To enable Audit on the Audit producer side, see <a href=\"/doc/423/26.1/enableaudit\" title=\"Enable Audit\">Enable Audit</a>.</li>\n<li>To obtain the database certificate, see <a href=\"/doc/423/26.1/changecertforpostgresql\" title=\"Enable SSL connections to external PostgreSQL after suite installation\">Enable SSL connections to external PostgreSQL after suite installation</a>.</li>\n<li>To obtain the suite CA certificate, see <a href=\"/doc/423/26.1/getsuitecacertificate\" title=\"Get the suite CA certificate\">Get the suite CA certificate</a>.</li>\n</ul>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}