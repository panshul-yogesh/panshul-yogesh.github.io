{
  "title": "Set up disaster recovery of OO",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This topic contains detailed instructions on how to recover Operations Orchestration Containerized (OO Containerized) in the event of a failure from the backup taken at an earlier point in time.  </p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" style=\"width: 500px;\">\n<thead>\n<tr>\n<th scope=\"col\">Role</th>\n<th scope=\"col\">Location</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Kubernetes Cluster Administrator</td>\n<td>AWS EKS cluster and OO Containerized Kubernetes objects</td>\n</tr>\n<tr>\n<td>Kubernetes Cluster Administrator</td>\n<td>Azure AKS Cluster and OO Containerized Kubernetes objects</td>\n</tr>\n</tbody>\n</table>\n<p>You can perform backup and disaster recovery of OO using Velero. Velero is an open source tool to backup and restore, perform disaster recovery, and migrate Kubernetes cluster resources and persistent volumes</p>\n<h2>Restore OO Containerized using Velero</h2>\n<p>This section contains instructions to restore OO Containerized using the Velero tool.</p>\n<h3>Prerequisites</h3>\n<ul>\n<li>To back up and restore the Kubernetes configurations and cluster, you must first set up <a href=\"https://velero.io/\" title=\"Velero\">Velero</a> according to your cloud deployment platforms.</li>\n<li>Make sure the Velero version works for your current Kubernetes version. It's recommended that you use the same Velero that is configured for the suite.</li>\n<li>Install and configure Velero.\n\t<ul>\n<li>See <a href=\"https://github.com/vmware-tanzu/velero-plugin-for-aws/tree/v1.3.0#Install-and-start-Velero\" target=\"_blank\" title=\"Install and start Velero\">Install and start Velero</a> to set up the Velero pod in the Velero namespace of the <strong>AWS</strong> environment.</li>\n<li>See <a href=\"https://github.com/vmware-tanzu/velero-plugin-for-microsoft-azure/tree/v1.3.1#install-and-start-velero\" target=\"_blank\" title=\"Install and start Velero\">Install and start Velero</a> to set up the Velero pod in the Velero namespace of the <strong>Azure</strong> environment.</li>\n</ul>\n</li>\n<li>Backup Kubernetes configurations. See <a href=\"https://velero.io/docs/v1.11/backup-reference/\" target=\"_blank\" title=\"Velero Backup Instructions\">Velero Backup Instructions</a>.</li>\n<li>Restore Kubernetes configurations. See <a href=\"https://velero.io/docs/v1.11/restore-reference/\" target=\"_blank\" title=\"Velero Restore Instructions\">Velero Restore Instructions</a>.</li>\n<li>The RDS and EFS/AFS are automatically backed up and restored through AWS/Azure services.</li>\n<li><strong>kubectl</strong> installed locally.</li>\n</ul>\n<h3>Restore OO Containerized</h3>\n<p>It's possible that the restored data on the Service Management database and OO Containerized database don't coincide. This means there could be inconsistencies between the tenant status on the Service Management and OO Containerized.</p>\n<p>The following timeline illustrates an example scenario.</p>\n<ul>\n<li>17 Nov 2022 16:00 - Service Management database backup was made. Tenant X <strong>is active</strong> at this point in time.</li>\n<li>17 Nov 2022 16:05 - Tenant X is <strong>deactivated</strong> on Service Management side. This action is logged on both Service Management and OO Containerized databases.</li>\n<li>17 Nov 2022 16:06 - OO Containerized database is backed up. At this point in time, tenant X is marked as <strong>active on Service Management database</strong><strong> backup</strong>, and <strong>deactivated on OO Containerized </strong><strong>database backup</strong>.</li>\n<li>17 Nov 2022 16:07 - cluster crashes. Restoration happens after some time, with these inconsistencies: <strong>On Service Management Side: Tenant X is active</strong> and <strong>On OO </strong><b>Containerized </b><strong>Side: Tenant X is deactivated</strong>.</li>\n</ul>\n<p>The OO Controller service contains a <strong>SYNC API</strong> that you can use to recover from a disaster.</p>\n<p>To address these inconsistencies, align the tenants on the OO Containerized and Service Management. Run the following commands on the bastion node:</p>\n<p>Run the following command on the bastion node to get <strong>values.yaml</strong> file from the OO deployment.</p>\n<pre><code>\nhelm get values &lt;oo_install_name&gt; -n &lt;oo_namespace&gt; &gt; /path/to/oo_deployment_values.yaml\n</code>\n</pre>\n<p>Where:</p>\n<ul>\n<li>&lt;<code>oo_install_name</code>&gt; is the name of the OO Containerized deployment that you specified when installing OO Containerized.</li>\n<li>&lt;<code>oo_namespace</code>&gt; is the unique namespace of the OO Containerized deployment.</li>\n</ul>\n<p>Run the following command on the bastion node to trigger tenant sync API.</p>\n<pre><code>helm upgrade &lt;oo_install_name&gt; -n &lt;oo_namespace&gt; &lt;path_to_oo_chart&gt; -f /path/to/oo_deployment_values.yaml --set ootenants-sync.deployment.activeTenants='&lt;comma_separated_tenant_IDs_list&gt;' --set ootenants-sync.deployment.inactiveTenants='&lt;comma_separated_tenant_IDs_list&gt;'</code></pre>\n<p>Where:</p>\n<ul>\n<li>&lt;<code>oo_install_name</code>&gt; is the name of the OO Containerized deployment that you specified when installing OO Containerized.</li>\n<li>&lt;<code>oo_namespace</code>&gt; is the unique namespace of the OO Containerized deployment.</li>\n<li>&lt;<code>OO_chart_file</code>&gt; is the file containing the OO Containerized installation charts.</li>\n<li>&lt;<code>ootenants-sync.deployment.activeTenants</code>&gt; is a comma separated list of active tenants that have OO capability enabled. Make sure to add a \\ before the comma separating the tenant IDs.</li>\n<li>&lt;<code>ootenants-sync.deployment.inactiveTenants</code>&gt; is a comma separated list of inactive tenants that have OO capability enabled. Make sure to add a \\ before the comma separating the tenant IDs.</li>\n</ul>\n<p>For example: </p>\n<pre><code>helm upgrade oo-prod -n oo-prod /root/oo.tgz -f /path/to/oo_deployment_values.yaml --set ootenants-sync.deployment.activeTenants=\"123456789\\,987654321\" --set ootenants-sync.deployment.inactiveTenants=\"111222333\\,999888777\"</code></pre>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}