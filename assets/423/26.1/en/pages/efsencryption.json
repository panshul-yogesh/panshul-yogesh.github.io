{
  "title": "Enable EFS encryption",
  "content": "<div class=\"mw-parser-output\">\n<div></div>\n<p>Amazon Elastic File System (EFS) supports two forms of encryption for file systems:</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">data encryption in transit</li><li style=\"margin-left: 28px; position: relative;\">rest</li></ul>\n<p>You can enable data encryption at rest when creating an Amazon EFS file system. You can enable data encryption in transit when you mount the file system.</p>\n<h2><a id=\"Enable_encryption_in_transit_if_OO_is_already_deployed\" name=\"Enable_encryption_in_transit_if_OO_is_already_deployed\" title=\"Enable encryption in transit, if OO is already deployed\"></a>Enable encryption in transit, if OO is already deployed</h2>\n<p>To enable Amazon EFS encryption in transit, you require an Amazon EFS Container Storage Interface (CSI) driver. See the <a href=\"http://docs.aws.amazon.com/eks/latest/userguide/efs-csi.html\" title=\"Amazon EFS CSI driver\">Amazon EFS CSI driver</a> documentation to deploy the Amazon EFS CSI driver for your Amazon EKS cluster. Get the file system ID of the existing Amazon EFS file system. You'll need to enter this file system ID while recreating the persistent volume.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the bastion node, run the following command to stop OO.\n\t<pre><code>cd OMT_External_K8s_2x.x-xxx/scripts/\n./cdfctl.sh runlevel set -l DOWN -n &lt;OO_NAMESPACE&gt;</code></pre>\n\tWhere<strong> </strong><code>&lt;OO_NAMESPACE&gt;</code> is the unique namespace of the OO deployment. Use the namespace that you specified in the <a href=\"/doc/423/26.1/createoocdeploymenteks\" title=\"Create a new deployment for OO in EKS\">Create a new deployment for OO in EKS</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Wait until all the pods get terminated under the OO namespace.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Delete existing OO persistent volume claims.\n\t<pre><code>kubectl delete -f &lt;path_to_pvc_yaml&gt;</code></pre>\n\tWhere &lt;<code>path_to_pvc_yaml</code>&gt;is the path of the YAML file used while <a href=\"/doc/423/26.1/399-preparepvooceks\" title=\"creating persistent volume claims\">creating persistent volume claims</a>. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Delete existing OO persistent volume.\n\t<pre><code>kubectl delete -f &lt;path_to_pv_yaml&gt;</code></pre>\n\tWhere &lt;<code>path_to_pvc_yaml</code>&gt;is the path of the YAML file used while <a href=\"/doc/423/26.1/399-preparepvooceks\" title=\"creating persistent volume\">creating persistent volume</a>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create the <strong>volumes-encrypted.yaml</strong> file. Copy content from the sample encrypted volume YAML file. See the section \"Sample of the encrypted YAML file\".</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>volumes-encrypted.yaml</strong><b> </b>file, replace all &lt;<code>file_system_id</code>&gt; values with actual Amazon Elastic File System ID.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>volumes-encrypted.yaml</strong><b> </b>file, replace all &lt;<code>NFS_directory_path</code>&gt; values with the actual Amazon Elastic File System directory paths mapped to each volume.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create OO persistent volume. Run the following command:\n\t<pre><code>kubectl create -f &lt;path_to_volumes-encrypted.yaml&gt;</code></pre>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create OO persistent volume claim. Run the following command:\n\t<pre><code>kubectl create -f &lt;path_to_pvc_yaml&gt;</code></pre>\n\tWhere &lt;<code>path_to_pvc_yaml</code>&gt;is the path of YAML file used while <a href=\"/doc/423/26.1/399-preparepvooceks\" title=\"creating persistent volume claims\">creating persistent volume claims</a>. </li><li style=\"--number-width: 19px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Start OO. Run the following command:\n\t<pre><code>cd OMT_External_K8s_2x.x-xxx/scripts/\n./cdfctl.sh runlevel set -l UP -n &lt;OO_NAMESPACE&gt;</code></pre>\n\tWhere &lt;<code>OO_NAMESPACE</code>&gt; is the unique namespace of the OO deployment. Use the namespace that you specified in the <a href=\"/doc/423/26.1/createoocdeploymenteks\" title=\"Create a new deployment for OO in EKS\">Create a new deployment for OO in EKS</a>.</li></ol>\n<h2><a id=\"Enable_encryption_at_rest_if_OO_is_already_deployed\" name=\"Enable_encryption_at_rest_if_OO_is_already_deployed\" title=\"Enable encryption at rest, if OO is already deployed\"></a>Enable encryption at rest, if OO is already deployed</h2>\n<p>If OO is already deployed, follow these steps to enable encryption at rest. </p>\n<p>After creating the EFS file system, you can't change it's encryption setting. You can't modify an unencrypted file system to make it encrypted. Instead, you can create a new encrypted file system and copy the data from the old EFS file system or replicate the existing file system.</p>\n<p>To enable encryption at rest:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create a new encrypted file system or replicate the existing EFS file system.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Update persistent volume to use the new filesystem.</li></ol>\n<h3><a id=\"Create_a_new_encrypted_file_system\" name=\"Create_a_new_encrypted_file_system\" title=\"Create a new encrypted file system\"></a>Create a new encrypted file system</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create a new encrypted file system. See <a href=\"https://docs.aws.amazon.com/efs/latest/ug/encryption-at-rest.html\" title=\"Encrypting data at rest\">Encrypting data at rest</a>. Ensure to copy all the data from the old EFS.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Get the filesystem ID.</li></ol>\n<h3><a id=\"Replicate_the_existing_EFS_file_system\" name=\"Replicate_the_existing_EFS_file_system\" title=\"Replicate the existing EFS file system\"></a>Replicate the existing EFS file system</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Replicate the existing EFS file system. See <a href=\"https://repost.aws/knowledge-center/efs-turn-on-encryption-at-rest\" title=\"Turn on encryption at rest for an EFS\">Turn on encryption at rest for an EFS</a>. Ensure to sync all the data from the source.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Get the filesystem ID</li></ol>\n<h3><a id=\"Update_persistent_volume_to_use_the_new_filesystem\" name=\"Update_persistent_volume_to_use_the_new_filesystem\" title=\"Update persistent volume to use the new filesystem\"></a>Update persistent volume to use the new filesystem</h3>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the bastion node, run the following command to stop OO.\n\t<pre><code>cd OMT_External_K8s_2x.x-xxx/scripts/\n./cdfctl.sh runlevel set -l DOWN -n &lt;OO_NAMESPACE&gt;</code></pre>\n\tWhere &lt;<code>OO_NAMESPACE</code>&gt; is the unique namespace of the OO deployment. Use the namespace that you specified in the <a href=\"/doc/423/26.1/createoocdeploymenteks\" title=\"Create a new deployment for OO in EKS\">Create a new deployment for OO in EKS</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Delete the existing OO persistent volume claims. Run the following command:\n\t<pre><code>kubectl delete -f &lt;path_to_pvc_yaml&gt;</code></pre>\n\tWhere &lt;<code>path_to_pvc_yaml</code>&gt;is the path of YAML file created while <a href=\"/doc/423/26.1/399-preparepvooceks\" title=\"creating persistent volume claims\">creating persistent volume claims</a>. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Delete existing OO persistent volume.\n\t<pre><code>kubectl delete -f &lt;path_to_pv_yaml&gt;</code></pre>\n\tIf encryption in transit is enabled, &lt;<code>path_to_pv_yaml</code>&gt; is the path of <strong>volumes-encrypted.yaml</strong> file created when enabling encryption in transit.<br/>\n\tIf encryption in transit isn't enabled, &lt;<code>path_to_pv_yaml</code>&gt; is the path of YAML file created while <a href=\"/doc/423/26.1/399-preparepvooceks\" title=\"creating persistent volume\">creating persistent volume</a><em>.</em></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Update the OO persistent volume YAML file:<br/>\n\tIf encryption in transit is enabled: in the <strong>volumes-encrypted.yaml </strong>file update the <code>csi.volumeHandle</code> parameter value with the filesystem ID captured when creating a new encrypted file system. See the section \"Create a new encrypted file system\".<br/>\n\tIf encryption in transit isn't enabled: in the <strong>volumes.yaml </strong>file, update value of the <code>nfs.server</code> partameter with the new EFS file system value.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create OO persistent volume. Run the following command:\n\t<pre><code>kubectl create -f &lt;path_to_pv_yaml&gt;</code></pre>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Create OO persistent volume claim. Run the following command:</p>\n<pre><code>kubectl create -f &lt;path_to_pvc_yaml&gt;</code></pre>\n<p>Where &lt;<code>path_to_pvc_yaml</code>&gt;is the path of the YAML file used while <a href=\"/doc/423/26.1/399-preparepvooceks\" title=\"creating persistent volume claims\">creating persistent volume claims</a>. </p>\n</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Start OO. Run the following command:\n\t<pre><code>cd OMT_External_K8s_2x.x-xxx/scripts/\n./cdfctl.sh runlevel set -l UP -n &lt;OO_NAMESPACE&gt;</code></pre>\n\tWhere &lt;<code>OO_NAMESPACE</code>&gt; is the unique namespace of the OO deployment. Use the namespace that you specified in the <a href=\"/doc/423/26.1/createoocdeploymenteks\" title=\"Create a new deployment for OO in EKS\">Create a new deployment for OO in EKS</a>.</li></ol>\n<h2><a id=\"Sample_of_the_encrypted_YAML_file\" name=\"Sample_of_the_encrypted_YAML_file\" title=\"Sample of the encrypted YAML file\"></a>Sample of the encrypted YAML file</h2>\n<p>To use encryption in transit, use the following template:</p>\n<pre><code># OO Config Volume\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: oo-config-vol\nspec:\n  accessModes:\n  - ReadWriteMany\n  capacity:\n    storage: 1Gi  \n  persistentVolumeReclaimPolicy: Retain\n  # (optional) provide the Storage Class Name used for this volume\n  storageClassName: \"\"\n  volumeMode: Filesystem\n  csi:\n    driver: efs.csi.aws.com\n    # example: &lt;filesystem_id&gt;:/var/vols/itom/oo/oo_config_vol\n    volumeHandle: &lt;filesystem_id&gt;:&lt;NFS_directory_path&gt;\n    volumeAttributes:\n      encryptInTransit: \"true\"\n\n---\n\n# OO Data volume\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: oo-data-vol\nspec:\n  accessModes:\n  - ReadWriteMany\n  capacity:\n    storage: 1Gi  \n  persistentVolumeReclaimPolicy: Retain\n  # (optional) provide the Storage Class Name used for this volume\n  storageClassName: \"\"\n  volumeMode: Filesystem\n  csi:\n    driver: efs.csi.aws.com\n    # example: &lt;filesystem_id&gt;:/var/vols/itom/oo/oo_data_vol\n    volumeHandle: &lt;filesystem_id&gt;:&lt;NFS_directory_path&gt;\n    volumeAttributes:\n      encryptInTransit: \"true\"\n\n---\n\n# OO Logs Volume\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: oo-logs-vol\nspec:\n  accessModes:\n  - ReadWriteMany\n  capacity:\n    storage: 5Gi  \n  persistentVolumeReclaimPolicy: Retain\n  # (optional) provide the Storage Class Name used for this volume\n  storageClassName: \"\"\n  volumeMode: Filesystem\n  csi:\n    driver: efs.csi.aws.com\n    # example: &lt;filesystem_id&gt;:/var/vols/itom/oo/oo_logs_vol\n    volumeHandle: &lt;filesystem_id&gt;:&lt;NFS_directory_path&gt;\n    volumeAttributes:\n      encryptInTransit: \"true\"\n\n---\n\n# OO RAS specific logs volume\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: oo-ras-logs-vol\nspec:\n  accessModes:\n    - ReadWriteMany\n  capacity:\n    storage: 5Gi  \n  persistentVolumeReclaimPolicy: Retain\n  # (optional) provide the Storage Class Name used for this volume\n  storageClassName: \"\"\n  volumeMode: Filesystem\n  csi:\n    driver: efs.csi.aws.com\n    # example: &lt;filesystem_id&gt;:/var/vols/itom/oo/oo_ras_logs_vol\n    volumeHandle: &lt;filesystem_id&gt;:&lt;NFS_directory_path&gt;\n    volumeAttributes:\n      encryptInTransit: \"true\"\n\n---\n\n# OO DB Maintenance and export volume\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: oo-data-export-vol\nspec:\n  accessModes:\n  - ReadWriteMany\n  capacity:\n    storage: 90Gi\n  persistentVolumeReclaimPolicy: Retain\n  # (optional) provide the Storage Class Name used for this volume\n  storageClassName: \"\"\n  volumeMode: Filesystem\n  csi:\n    driver: efs.csi.aws.com\n    # example: &lt;filesystem_id&gt;:/var/vols/itom/oo/oo_data_export_vol\n    volumeHandle: &lt;filesystem_id&gt;:&lt;NFS_directory_path&gt;\n    volumeAttributes:\n      encryptInTransit: \"true\"</code></pre>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}