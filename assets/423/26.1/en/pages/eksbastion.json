{
  "title": "Configure bastion",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p><br/>\nThis topic describes how to create and configure a bastion node. The bastion node communicates with the Kubernetes cluster and we use it for deploying the SMA suite and troubleshooting.</p>\n<h2 class=\"mw-headline\" id=\"Create_bastion_instance\">Create a bastion instance</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>IT / Server administrator</td>\n<td>AWS Management Console</td>\n</tr>\n</tbody>\n</table>\n<p>To create a machine as bastion, follow these steps: </p>\n<ol>\n<li>Go to <b>All services</b> &gt; <b>Management &amp; Governance</b> &gt; <b>CloudFormation</b>.</li>\n<li>Click <b>Create stack </b>&gt;<b> With new resources(standard)</b>, click <b>Template is ready</b> &gt; <b>Upload a template file</b> &gt; <b>Choose file </b>to select a template file under directory <code>../Cloud Deployment x.x.x/../byok/smax-cloudformation-aws </code>in <a href=\"/doc/423/26.1/downloadcloudpackage\" title=\"the cloud deployment package\">the cloud deployment package</a> as below: \n\t<ul>\n<li>If you want to deploy the bastion on a public subnet, select the <code>smax-bastion.template</code> file.</li>\n<li>If you want to deploy the bastion on a private subnet, select the <code>smax-bastion-private.template</code> file.</li>\n</ul>\n</li>\n<li>Click <b>Next</b> and populate the following fields:\n\t<ul>\n<li><b>Stack name:</b> Give a name to this stack, such as <em>sma-bastion</em><strong>.</strong></li>\n<li><b>VPC ID:</b> Select the created VPC from the drop-down list.</li>\n<li><b>Public/Private Subnet for Bastion instance:</b> Select a created public/private subnet. If you select a public subnet, enable the <b>Auto-assign public IPv4</b> attribute of the public subnet.</li>\n<li><strong>Bastion AMI ID</strong>: The AMI ID to create bastion. Leave as <strong>default </strong>if you wish to use the recommended AMI ID based on the Bastion type you selected. If specified, the system will generate bastion according to your input. See AWS document to <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/finding-an-ami.html\" title=\"Find a Linux AMI\">Find a Linux AMI</a>. To avoid issues when creating bastion, make sure your AMI architecture is <strong>x_86_64</strong>, your root device type is <strong>ebs</strong>.  </li>\n<li><b>Bastion Instance Type:</b> Select an instance type from the drop-down list. See <a href=\"/doc/423/26.1/ekssizing#Hardware_requirements_for_bastion\" title=\"Sizing considerations\">Sizing considerations</a>.</li>\n<li><b>Bastion instance Root Volume Size:</b> Specify a size in GB for the root EBS volume. See <a href=\"/doc/423/26.1/ekssizing#Hardware_requirements_for_bastion\" title=\"Sizing considerations\">Sizing considerations</a>.</li>\n<li><b>Key Pair for SSH access Bastion instance:</b> Select the created EC2 key pair.</li>\n<li><strong>The security group for the Bastion</strong>/<b>BastionSecurityGroup</b>: Select the security group created for the bastion node.</li>\n</ul>\n</li>\n<li>Click <b>Next</b> &gt; <b>Next</b>, acknowledge the required capabilities, and click <b>Submit</b>. Wait until the stack creation finishes and you can check the results on the <b>Outputs</b> tab.</li>\n</ol>\n<h2 class=\"mw-headline\" id=\"Configure_bastion_instance\">Configure the bastion instance</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>IT / Server administrator</td>\n<td>Bastion</td>\n</tr>\n</tbody>\n</table>\n<div class=\"Admonition_Important\"><span class=\"autonumber\">Important</span>: Don't customize any ClusterRoles (for example, <code>cluster-admin</code>) in the system to avoid potential issues. </div>\n<p>After successfully creating the bastion, configure the bastion by running these commands:</p>\n<ol>\n<li>Log in to the bastion: <code>ssh -i &lt;private_key_pem_file&gt; ec2-user@&lt;bastion_ip&gt;</code></li>\n<li>Install Docker.\n\t<pre>sudo yum install -y docker</pre>\n</li>\n<li>Enable Docker and empower to run Docker commands as non-root.\n\t<pre>sudo groupadd docker\t\nsudo usermod -a -G docker ${USER}\nsudo usermod -a -G docker root\nsudo systemctl enable docker\nsudo systemctl start docker</pre>\n</li>\n<li>Download and install the <code>kubectl</code> binary for your cluster's <a href=\"/doc/423/26.1/ekssupportmatrix#&lt;span_id=%22Supportmatrixforcloud-baseddeployment-Operatingsystems%22&gt;Managed_Kubernetes_clusters&lt;/span&gt;\" title=\"Kubernetes version\">Kubernetes version</a> using the steps described in the <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/install-kubectl.html\" title=\"AWS documentation\">AWS documentation</a>.</li>\n<li>You must install the AWS CLI version 2 by following the <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html\" title=\"AWS document\">AWS document</a>; otherwise, unexpected errors may occur. \n\t<div class=\"Admonition_Important\"><span class=\"autonumber\">Important</span>: AWS CLI versions 1 and 2 use the same AWS command name. If you have AWS CLI version 1 installed, see <a href=\"https://docs.aws.amazon.com/cli/latest/userguide/cliv2-migration.html\" title=\"Migrating from AWS CLI version 1 to version 2\">Migrating from AWS CLI version 1 to version 2</a>.</div>\n</li>\n<li>Configure AWS CLI options:\n\t<pre>aws configure</pre>\n<p>You will get a prompt for AWS CLI configuration values.</p>\n<ul>\n<li>Your <code>AWS Access Key ID</code> and <code>AWS Secret Access Key</code> are provided when creating a new AWS account.\n\n\t\t<div class=\"Admonition_Note\"><b>Note</b>   If you don't have access to Security Credentials, contact your AWS administrators to check it.</div>\n</li>\n<li><code>Default region name</code> is the region you selected for your created resources, such as <em>us-gov-west-1</em>.</li>\n<li><code>Default output format</code> is the default output format you want to specify, such as <em>json</em>.</li>\n</ul>\n</li>\n<li>Configure and check the connectivity from <code>kubectl </code>to the EKS cluster:\n\t<pre>aws eks update-cluster-config --name &lt;eks_cluster_name&gt; --resources-vpc-config endpointPublicAccess=false,endpointPrivateAccess=true --region &lt;cluster_region&gt;\n</pre>\n<p>Wait several minutes until the cluster status is <strong>Active</strong>, and then you can run the following command to check the status:</p>\n<pre>aws eks describe-cluster --region=&lt;cluster_region&gt; --name &lt;eks_cluster_name&gt;\n</pre>\n<p>Fetch the kubeconfig:</p>\n<pre>aws eks --region &lt;cluster_region&gt; update-kubeconfig --name &lt;eks_cluster_name&gt;\n</pre>\n<p>Check the bastion connectivity to the EKS cluster:</p>\n<pre>kubectl get svc</pre>\n<p>In these commands, <code>&lt;cluster_region&gt;</code> is the region you selected for the EKS you created, such as <em>us-east-2</em> and <code>&lt;eks_cluster_name&gt;</code> is the cluster name you created.</p>\n</li>\n<li>Test worker nodes status:\n\t<pre>kubectl get nodes</pre>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}