{
  "title": "Build EKS cluster (FIPS mode)",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>IT / Kubernetes Cluster administrator</td>\n<td>AWS Management Console</td>\n</tr>\n</tbody>\n</table>\n<p>To use Amazon Elastic Kubernetes Service (EKS) to install and manage the suite on AWS, you need to perform the following tasks to create an EKS cluster and then launch the EKS cluster worker nodes.</p>\n<h2 id=\"Create_EKS_cluster\">Create an EKS cluster</h2>\n<ol>\n<li>Log in to the AWS Management Console and switch to the selected region.</li>\n<li>Go to <b>All services</b> &gt; <b>Management &amp; Governance</b> &gt; <b>CloudFormation.</b> </li>\n<li>Click <b>Create stack </b>&gt; select <strong>With new resources (standard)</strong>, click <b>Template is ready</b> &gt; <b>Upload a template file</b> &gt; <b>Choose file</b>, and then select the <code>smax-eks.template</code> file under directory <code>../Cloud Deployment x.x.x/../byok/smax-cloudformation-aws </code>in the <a href=\"/doc/423/26.1/downloadcloudpackage\" title=\"Download the cloud deployment package\">cloud deployment package</a>.<code> </code></li>\n<li>Click <b>Next</b> and populate the following fields:\n\t<ul>\n<li><b>Stack name:</b> Give a name to this stack, such as <em>sma-eks</em>.</li>\n<li><b>VPC ID:</b> Select the created VPC from the drop-down list.</li>\n<li><b>Subnets for EKS Cluster:</b> Select the three private subnets created.</li>\n<li><b>EKS Cluster Name:</b> Enter the EKS cluster name you defined in the <a href=\"/doc/423/26.1/eksvpc\" title=\"Prepare VPC\">Prepare VPC</a><i> </i>step.\n\t\t<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">You must use the same EKS cluster name when creating VPC, EKS cluster, and worker nodes; otherwise, the suite installation will fail.</div>\n</div>\n</li>\n<li><b>EKS Cluster Version:</b> Select a <a href=\"/doc/423/26.1/ekssupportmatrix\" title=\"Support matrix for EKS deployment\">supported EKS version</a>.</li>\n<li><b>EKS Cluster Security Group:</b> Select the security group created for the control plane.</li>\n</ul>\n</li>\n<li>Click <b>Next</b> &gt; <b>Next</b>, acknowledge the required capabilities, and click <b>Submit</b>. Wait until the stack creation is completed, and check the results on the <b>Outputs</b> tab.\n\t<div class=\"admonition\">\n<div class=\"admonition-icon admonition-tip-icon\"></div>\n<div class=\"admonition-content admonition-tip-content\"> \n\t<ul>\n<li>Take a note of the<b> NodeInstanceRole</b> value on the <b>Outputs</b> tab. You will need it to launch worker nodes in the next section.</li>\n<li>After the EKS cluster is created, the system creates a security group for the EKS cluster (<code><strong>eks-cluster-sg-*</strong></code>)<em>. </em>You will need it when <a href=\"/doc/423/26.1/configureeksefshelm#Launch_EFS\" title=\"launching EFS\">launching EFS</a> and <a href=\"/doc/423/26.1/eksdatabase#Create_an_RDS_instance\" title=\"Creating RDS\">creating RDS</a> later.</li>\n</ul>\n</div>\n</div>\n</li>\n<li>Check if your VPC has been properly tagged so that the EKS cluster can discover it. For details, see the AWS document <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/network_reqs.html#vpc-tagging\" rel=\"nofollow\" target=\"1\" title=\"AWS VPC tagging\">VPC tagging requirements</a>.</li>\n</ol>\n<h2 id=\"Launch_EKS_cluster_worker_nodes\">Launch EKS cluster worker nodes</h2>\n<p>Use the following steps to launch EKS cluster worker nodes for FIPS mode enabled installations.</p>\n<ol>\n<li>Log in to the AWS Management Console and switch to the selected region.</li>\n<li>Go to <b>All services</b> &gt;<strong>EC2</strong>. From the left navigation pane, click <strong>Launch Templates</strong> &gt; <strong>Create launch template</strong>. Name the template and populate the following fields:\n\t<ul>\n<li><strong>UseCustomizedImage</strong>: Set to <strong>True </strong>to use your own customized image to build work nodes. Else leave as is.\n\t\t<ul>\n<li><strong>AMI ID of the custom image for the worker nodes</strong>: If you set <strong>UseCustomizedImageID</strong>=true, input the ID of the AMI to be used to build the node group. Else leave as is.</li>\n<li><strong>Snapshot ID of the AMI volume</strong>: If you set <strong>UseCustomizedImageID</strong>=true, input the ID of the volume snapshot of the node group AMI. Else leave as is.</li>\n</ul>\n</li>\n<li><strong>Amazon machine image (AMI)</strong>: Select the AMI you created earlier. See <a href=\"/doc/423/26.1/createfipsami\" title=\"Create a FIPS-enabled AMI\">Create a FIPS-enabled AMI</a>.</li>\n<li><strong>AmiType</strong>: For normal EKS users, select AL2_x86_64 AMI type. Ignore this parameter if you are using custom AMI.</li>\n<li><strong>Instance type</strong>: Select an instance type from the drop-down list. See <a href=\"/doc/423/26.1/ekssizing#Hardware_requirements_for_Bastion\" title=\"Sizing considerations (EKS)\">Sizing considerations (EKS)</a>.</li>\n<li><strong>Key pair (login)</strong>: Select the created EC2 key pair.</li>\n<li><strong>Network settings</strong>: Select <strong>Virtual Private Cloud</strong>.</li>\n<li><strong>Security groups</strong>: Select the cluster's security group to allow the EKS cluster to communicate with worker. For example, eks-cluster-sg-*.</li>\n<li><strong>Storage</strong>: Enter <strong>100 </strong>in the <strong>Size (GiB)</strong> field.</li>\n<li><strong>CapacityType</strong>: Select <strong>ON_DEMAND </strong>for production as SPOT instance may be unstable. For R&amp;D, we recommend you select <strong>SPOT</strong> instance due to its cost-saving abilities.</li>\n</ul>\n\tClick <strong>Create launch </strong><strong>template</strong> to launch the template.</li>\n<li>Go to <strong>All services</strong> &gt; <strong>EKS </strong>&gt; <strong>Clusters </strong>and select the EKS cluster name you defined in the <a href=\"/doc/423/26.1/eksvpc\" title=\"Prepare VPC\">Prepare VPC</a><i> </i>step:\n\t<p>Note You must use the same EKS cluster name when creating the  VPC, EKS cluster, and worker nodes; otherwise, the suite installation will fail.</p>\n<ol start=\"1\">\n<li>Click <strong>Configuration </strong>&gt; <strong>Compute </strong>&gt; <strong>Add node group</strong>. Name the node group and populate the following fields:\n\n\t\t<ul>\n<li><strong>Node IAM Role</strong>: Enter the<b> NodeInstanceRole</b> value collected on the <b>Outputs</b> tab when the EKS cluster is created successfully (see <a href=\"/doc/423/26.1/eksclusterfips#Create_EKS_cluster\" title=\"Create an EKS cluster\">Create an EKS cluster</a> ).</li>\n<li>Enable the <strong>Use launch template</strong> button.\n\t\t\t<ul>\n<li>Launch Template Name: Select the template created in step 2 above.</li>\n<li>Launch template version: Select the latest version from the drop-down list.</li>\n</ul>\n</li>\n<li><strong>Kubernetes labels</strong>: Click <strong>Add label</strong> and add the following labels.\n\t\t\t<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Key</th>\n<th scope=\"col\">Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Worker</td>\n<td>label</td>\n</tr>\n<tr>\n<td>Role</td>\n<td>loadbalancer</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n</li>\n<li><span id=\"cke_bm_5507C\" style=\"display: none;\"> </span>Click <strong>Next </strong>and enter the following fields under Node Group scaling configuration:\n\t\t<ul>\n<li><strong>Minimum size</strong>:  Enter the minimum number of worker nodes per Availability Zone. For example, 1.</li>\n<li><strong>Maximum size:</strong> Enter the maximum number of worker nodes per Availability Zone. For example, 3.</li>\n<li><strong>Desired size</strong>: Enter the desired number of worker nodes by referring to the <a href=\"/doc/423/26.1/ekssizing\" title=\"Sizing considerations for EKS deployment\">Sizing guides (EKS)</a>.</li>\n</ul>\n</li>\n<li>Click <strong>Next </strong>&gt; <strong>Next </strong>&gt; <strong>Create.</strong> </li>\n</ol>\n</li>\n</ol>\n<h2>Launch EKS cluster worker nodes for UD/UCMDB</h2>\n<p>This task is required only when you need to install UD/UCMDB. See <a href=\"/doc/423/26.1/ekssizing\" title=\"Sizing considerations for EKS deployment\">Sizing guides (EKS)</a> for information about the additional EKS cluster worker nodes required to deploy UD/UCMDB.</p>\n<p>To launch EKS cluster worker nodes, repeat the <a href=\"/doc/423/26.1/eksclusterfips#Launch_EKS_cluster_worker_nodes\" title=\"EKS Cluster\">previous task</a> as you performed to launch EKS cluster worker nodes for the suite.</p>\n<p>The only difference is that you need to use the following label for UD/UCMDB in <strong>Kubernetes labels</strong> when adding the node group.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Key</th>\n<th scope=\"col\">Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Worker</td>\n<td>cms</td>\n</tr>\n<tr>\n<td>Role</td>\n<td>loadbalancer</td>\n</tr>\n</tbody>\n</table>\n<p>After you create the worker nodes for UD/UCMDB, you can run the following command to check whether the <strong>cms </strong>label is successfully assigned to the worker nodes:</p>\n<pre>kubectl get nodes --show-labels</pre>\n<p>Review the output to see if you can see<code> <strong>Worker:cms</strong></code> as the label for the worker nodes.</p>\n<h2>Related topics</h2>\n<ul>\n<li>For information on EKS, see <a href=\"https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html\" title=\"AWS EKS\">Amazon EKS</a>.</li>\n<li>For information on AMI, see <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html\" title=\"AWS AMI\">Amazon Machine Images</a>.</li>\n</ul>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}