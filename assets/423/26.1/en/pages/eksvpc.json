{
  "title": "Prepare VPC",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>IT / Network administrator</td>\n<td>AWS Management Console</td>\n</tr>\n</tbody>\n</table>\n<p>To deploy OMT and the suite on AWS with EKS, you must prepare a Virtual Private Cloud (VPC) first and place the other resources in this prepared VPC.</p>\n<p>There are three options when deploying a VPC, this section describes these options.</p>\n<p>The first two options are for the scenario where your IT policy allows you to deploy public subnets with private subnets in a single VPC and you need to follow the architecture mentioned in <a href=\"/doc/423/26.1/eksbeforeinstall\" title=\"Before you begin (EKS)\">Before you begin</a>.<br/>\n<a class=\"image\" href=\"/file/images/thumb/2/24/SMA-X_on_AWS_2019.11-BYOK2-5.png/800px-SMA-X_on_AWS_2019.11-BYOK2-5.png\" title=\"/file/images/thumb/2/24/SMA-X_on_AWS_2019.11-BYOK2-5.png/800px-SMA-X_on_AWS_2019.11-BYOK2-5.png\"> <img alt=\"SMA-X on AWS 2019.11-BYOK2-5.png\" data-file-height=\"972\" data-file-width=\"921\" height=\"844\" src=\"../../../images/800px-SMA-X_on_AWS_2019.11-BYOK2-5_8bf57ad8.png\" width=\"800\"/> </a></p>\n<p>The third option is for the scenarios where your IT policy doesn't allow public subnets to work with private subnets in a single VPC and you have the flexibility to deploy on different cloud deployments on AWS. However, you need to work with your IT/Network administrator to figure out the detailed solutions for this deployment. The below diagram is one example for your reference.<br/>\n<a class=\"image\" href=\"/file/images/thumb/8/84/SMA-X_on_AWS_2019.11-BYOK2_2VPC.png/1000px-SMA-X_on_AWS_2019.11-BYOK2_2VPC.png\" title=\"/file/images/thumb/8/84/SMA-X_on_AWS_2019.11-BYOK2_2VPC.png/1000px-SMA-X_on_AWS_2019.11-BYOK2_2VPC.png\"> <img alt=\"SMA-X on AWS 2019.11-BYOK2 2VPC.png\" data-file-height=\"1943\" data-file-width=\"2199\" height=\"884\" src=\"../../../images/1000px-SMA-X_on_AWS_2019.11-BYOK2_2VPC_1a52c773.png\" width=\"1000\"/> </a></p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">You need to consult your IT/Network administrator in the cloud to choose which option to start with. </div>\n</div>\n<h2 class=\"mw-headline\" id=\"Option._1:_Deploy_in_new_VPC\">Option 1: Deploy in new VPC</h2>\n<p>To create a new VPC by using CloudFormation, follow these steps:</p>\n<ol>\n<li>Log in to the AWS Management Console and switch to the selected region.</li>\n<li>Go to <b>All services</b> &gt; <b>Management &amp; Governance</b> &gt; <b>CloudFormation</b>.</li>\n<li>Click <b>Create stack</b> &gt; <b>With new resources(standard)</b>, click <b>Template is ready</b> &gt; <b>Upload a template file</b> &gt; <b>Choose file</b> and select the <code>smax-network-with-vpc.template</code> file under directory <code>../Cloud Deployment x.x.x/../byok/smax-cloudformation-aws</code> in the <a href=\"/doc/423/26.1/downloadcloudpackage\" title=\"Download the cloud deployment package\">cloud deployment package</a>.</li>\n<li>Click <b>Next</b> and populate the following fields:\n\t<ul>\n<li><b>Stack name:</b> Give a name to this stack, such as <em>sma-network</em>.</li>\n<li><b>VPC Name:</b> Give a name to this VPC, such as <em>sma-vpc</em>.</li>\n<li><b>VPC CIDR:</b> Define a CIDR for this VPC.</li>\n<li><b>EKS Cluster Name:</b> Give a name to your EKS cluster.\n\t\t<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">You will need this EKS cluster name when you build the EKS cluster and launch worker nodes later.</div>\n</div>\n</li>\n<li><b>Availability Zone</b>: Select three availability zones from the drop-down list and each availability zone must be different, such as <em>us-east-1c,us-east-1b, us-east-1c</em>.</li>\n<li><b>Public Subnet 1/2/3 CIDR:</b> Define a CIDR block for each public subnet. Public subnets will be used to deploy bastion instance, load balancer, and NAT Gateway.</li>\n<li><b>Private Subnet 1/2/3 CIDR:</b> Define a CIDR block for each private subnet. Private subnets will be used to deploy the EKS cluster, worker nodes, and EFS.</li>\n<li><b>Database Subnet 1/2 CIDR:</b> Define a CIDR block for each database subnet. Database subnets will be used to deploy RDS.</li>\n<li><strong>Bastion security group CIDR</strong>: Define the CIDR block for bastion security group ingress.</li>\n</ul>\n</li>\n<li>Click <b>Next</b> &gt; <b>Next</b> &gt; <b>Submit</b>. Wait until the stack creation finishes and you can check the results on the <b>Outputs</b> tab. The template creates three security groups automatically for the control plane node, worker nodes, and the bastion node. You will need these security groups later when <a href=\"/doc/423/26.1/ekscluster#Create_an_EKS_cluster\" title=\"creating the EKS cluster\">creating the EKS cluster</a>, <a href=\"/doc/423/26.1/ekscluster#Launch_EKS_cluster_worker_nodes\" title=\"launching working nodes\">launching working nodes</a>, and <a href=\"/doc/423/26.1/eksbastion\" title=\"creating the bastion node\">creating the bastion node</a>/<a href=\"/doc/423/26.1/configureeksefshelm\" title=\"EFS\">EFS</a>/<a href=\"/doc/423/26.1/eksdatabase#Create_an_RDS_instance\" title=\"RDS\">RDS</a> respectively.</li>\n</ol>\n<h2 class=\"mw-headline\" id=\"Option._2:_Deploy_in_the_existing_VPC\">Option 2: Deploy in the existing VPC</h2>\n<p>If you need to deploy the suite in an existing VPC and your IT policy allows private subnets and public subnets to be deployed in the same VPC, follow these steps:</p>\n<ol>\n<li>Log in to the AWS Management Console and switch to the selected region.</li>\n<li>Tag your VPC so that the EKS cluster can discover it. For details, see the AWS document <a class=\"external text\" href=\"https://docs.aws.amazon.com/eks/latest/userguide/network_reqs.html#vpc-tagging\" rel=\"nofollow\" target=\"1\" title=\"VPC tagging requirements\">VPC tagging requirements</a>.</li>\n<li>Go to <b>All services</b> &gt; <b>Networking &amp; Content Delivery</b> &gt; <b>VPC</b>.</li>\n<li>Select the existing VPC and make sure <b>DNS resolution</b> and <b>DNS hostnames</b> are enabled.\n\t<ul>\n<li><b>Actions</b> &gt; <b>Edit DNS resolution</b>, tick the <b>Enable</b> option, and click <b>Save changes.</b></li>\n<li><b>Actions</b> &gt; <b>Edit DNS hostnames</b>, tick the <b>Enable</b> option, and click <b>Save changes.</b></li>\n</ul>\n</li>\n<li>Go to <b>All services</b> &gt; <b>Management &amp; Governance</b> &gt; <b>CloudFormation</b>.</li>\n<li>\n<p>Click <b>Create stack</b> &gt; <strong>With new resources(standard)</strong>, click <b>Template is ready</b> &gt; <b>Upload a template file</b> &gt; <b>Choose file</b> and select the <code>smax-network-without-vpc.template</code> file under directory <code>../Cloud Deployment x.x.x/../byok/smax-cloudformation-aws</code> in the <a href=\"/doc/423/26.1/downloadcloudpackage\" title=\"Download the cloud deployment package\">cloud deployment package</a>.</p>\n</li>\n<li>Click <b>Next</b> and populate the following fields.\n\t<ul>\n<li><b>Stack name:</b> Give a name to this stack, such as <em>sma-network-without-vpc</em>.</li>\n<li><b>VPC ID:</b> Select your target VPC from the drop-down list.</li>\n<li><b>VPC CIDR:</b> Enter the CIDR of the target VPC.</li>\n<li><b>EKS Cluster Name:</b> Give a name to your EKS cluster.\n\t\t<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">You will need this EKS cluster name when you build the EKS cluster and launch worker nodes later.</div>\n</div>\n</li>\n<li><b>Availability Zone</b>: Select three availability zones from the drop-down list and each availability zone must be different, <em>such as us-east-1c,us-east-1b, us-east-1c</em>.</li>\n<li><b>Public Subnet 1/2/3 CIDR:</b> Define a CIDR block for each public subnet. Public subnets will be used to deploy bastion instance, load balancer, and NAT Gateway.</li>\n<li><b>Private Subnet 1/2/3 CIDR:</b> Define a CIDR block for each private subnet. Private subnets will be used to deploy the EKS cluster, worker nodes, and EFS.</li>\n<li><b>Database Subnet 1/2 CIDR:</b> Define a CIDR block for each database subnet. Database subnets will be used to deploy RDS.</li>\n<li><strong>Bastion security group CIDR</strong>: Define the CIDR block for bastion security group ingress. </li>\n</ul>\n</li>\n<li>Click <b>Next</b> &gt; <b>Next</b> &gt; <b>Submit</b>. Wait until the stack creation finishes and you can check the results on the <b>Outputs</b> tab. The template creates three security groups automatically for the control plane node, worker nodes, and the bastion node. You will need these security groups later when <a href=\"/doc/423/26.1/ekscluster#Create_an_EKS_cluster\" title=\"creating the EKS cluster\">creating the EKS cluster</a>, <a href=\"/doc/423/26.1/ekscluster#Launch_EKS_cluster_worker_nodes\" title=\"launching working nodes\">launching working nodes</a>, and <a href=\"/doc/423/26.1/eksbastion\" title=\"creating the bastion node\">creating the bastion node</a>/<a href=\"/doc/423/26.1/configureeksefshelm\" title=\"Launch EFS\">EFS</a>/<a href=\"/doc/423/26.1/eksdatabase#Create_an_RDS_instance\" title=\"Launch RDS\">RDS</a> respectively.</li>\n</ol>\n<h2 class=\"mw-headline\" id=\"Option._3:_Deploy_on_existing_VPC_and_subnets\">Option 3: Deploy in existing VPC and subnets</h2>\n<p>If you need to deploy the suite in an existing VPC and subnets and your IT policy doesn't allow private subnets and public subnets to be deployed in the same VPC, follow these steps to check if your VPC and subnets meet the network requirements. If not, you need to manually update the network settings as required. </p>\n<p><b>Note:</b> As the application is mainly deployed inside the private VPC, this deployment is also called <strong>private network </strong>deployment.</p>\n<h3 class=\"mw-headline\" id=\"Step_1._Check_the_requirements_for_the_VPC_and_subnets_or_manually_prepare_them\">Step 1. Check the requirements for the VPC and subnets</h3>\n<ol start=\"1\">\n<li>The private VPC should have a CIDR of at least /21. Make sure DNS resolution and DNS hostnames are enabled. To do this:\n\t<ol start=\"1\">\n<li>Log in to the AWS Management Console and switch to the selected region.</li>\n<li>Go to <b>All services</b> &gt; <b>Networking &amp; Content Delivery</b> &gt; <b>VPC.</b>\n<ul>\n<li><b>Actions</b> &gt; <b>Edit DNS resolution</b>, tick the <b>Enable</b> option, and click <b>Save changes.</b></li>\n<li><b>Actions</b> &gt; <b>Edit DNS hostnames</b>, tick the <b>Enable</b> option, and click <b>Save changes.</b></li>\n</ul>\n</li>\n</ol>\n<p><b>List of VPC examples</b></p>\n<table>\n<tbody>\n<tr>\n<th>Item name</th>\n<th>Description</th>\n<th>Example</th>\n</tr>\n<tr>\n<td>public vpc</td>\n<td>The public VPC</td>\n<td>Existing VPC</td>\n</tr>\n<tr>\n<td>smax-vpc</td>\n<td>CIDR equal to or larger than 21, in private network</td>\n<td>CIDR: 10.0.0.0/16, with <b>DNS resolution</b> and <b>DNS hostname</b> enabled</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>Subnets\n\t<ul>\n<li>Three subnets should sit in at least two Availability Zones, better to sit in three Availability Zones, with a CIDR of at least /24, configured as private subnets. (No direct internet access).</li>\n<li>Two subnets sit in two Availability Zones, for the database.  </li>\n</ul>\n<p><b>List of subnet examples</b></p>\n<table>\n<tbody>\n<tr>\n<th>Item name</th>\n<th>Description</th>\n<th>Example</th>\n</tr>\n<tr>\n<td>smax-PrivateSubnet1</td>\n<td>Private Subnet1, CIDR equal or larger than 24</td>\n<td>CIDR: 10.0.10.0/24</td>\n</tr>\n<tr>\n<td>smax-PrivateSubnet2</td>\n<td>Private Subnet2, CIDR equal or larger than 24</td>\n<td>CIDR: 10.0.20.0/24</td>\n</tr>\n<tr>\n<td>smax-PrivateSubnet3</td>\n<td>Private Subnet3, CIDR equal or larger than 24</td>\n<td>CIDR: 10.0.30.0/24</td>\n</tr>\n<tr>\n<td>smax-DataBaseSubnet1</td>\n<td>Database Subnet1</td>\n<td>CIDR: 10.0.40.0/24</td>\n</tr>\n<tr>\n<td>smax-DataBaseSubnet2</td>\n<td>Database Subnet2</td>\n<td>CIDR: 10.0.50.0/24</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>Security groups\n\t<p><b>List of security group examples</b> (only inbound rules are listed; outbound rules are kept as default).</p>\n<table>\n<tbody>\n<tr>\n<th>Item name</th>\n<th>Description</th>\n</tr>\n<tr>\n<td>smax-EKS-ControlPlane-Security-Group</td>\n<td>Security group for EKS Cluster Control Plane</td>\n</tr>\n<tr>\n<td>smax-WorkerNode-Security-Group*</td>\n<td>Security group for Worker nodes</td>\n</tr>\n<tr>\n<td>smax-EFS-Security-Group</td>\n<td>Security group for EFS</td>\n</tr>\n<tr>\n<td>smax-BastionSecurityGroup</td>\n<td>Security group for Bastion</td>\n</tr>\n<tr>\n<td>smax-RDS-Security-Group</td>\n<td>Security group for RDS</td>\n</tr>\n</tbody>\n</table>\n\t*The security group of 'smax-WorkerNode-Security-Group' is generated by EKS automatically when the managed worker nodes are used. Here are the steps to get the security group of worker node group:<br/>\n\tPrerequisite: <a href=\"/doc/423/26.1/ekscluster\" title=\"Build EKS cluster\">EKS cluster</a> is already prepared.<br/>\n\t1. Log in to the AWS Management Console and switch to the selected region.<br/>\n\t2. Go to <strong>All services</strong> &gt; <strong>Containers</strong> &gt; <strong>Elastic Kubernetes Services</strong>.<br/>\n\t3. Find your cluster and click it.<br/>\n\t4. Switch to the tab of <strong>Networking</strong>. Note down the security group for \"Cluster security group\".\n\n\t<ul>\n<li>Configuration example of Security group for smax-EKS-ControlPlane-Security-Group. For more information, see <a class=\"external free\" href=\"https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html\" rel=\"nofollow\" target=\"1\" title=\"Configure security group\">https://docs.aws.amazon.com/eks/latest/userguide/sec-group-reqs.html</a>.\n\n\t\t<table>\n<tbody>\n<tr>\n<th>Item name</th>\n<th>Inbound Protocol</th>\n<th>Port range</th>\n<th>Source</th>\n<th>Description</th>\n</tr>\n<tr>\n<td rowspan=\"2\">smax-EKS-ControlPlane-Security-Group</td>\n<td>All traffic</td>\n<td>All</td>\n<td>smax-WorkerNode-Security-Group*</td>\n<td>For worker node connection.</td>\n</tr>\n<tr>\n<td>HTTPS</td>\n<td>443</td>\n<td>smax-BastionSecurityGroup</td>\n<td>For bastion connection to the cluster control plane. For example you need run \"kubectl\" command on the bastion.</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>Configuration example of Security group for smax-WorkerNode-Security-Group.\n\t\t<table>\n<tbody>\n<tr>\n<th>Item name</th>\n<th>Inbound Protocol</th>\n<th>Port range</th>\n<th>Source</th>\n<th>Description</th>\n</tr>\n<tr>\n<td rowspan=\"4\">smax-WorkerNode-Security-Group</td>\n<td>All traffic</td>\n<td>All</td>\n<td>smax-WorkerNode-Security-Group*</td>\n<td>Allows node to communicate with each other.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>1025 - 65535</td>\n<td>smax-EKS-ControlPlane-Security-Group</td>\n<td>Allows worker Kubelets and pods to receive communication from the cluster control plane.</td>\n</tr>\n<tr>\n<td>SSH</td>\n<td>22</td>\n<td>smax-BastionSecurityGroup</td>\n<td>(Optional) For troubleshooting to login to the worker nodes from the bastion.</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>Configuration example of Security group for EFS.\n\t\t<table>\n<tbody>\n<tr>\n<th>Item name</th>\n<th>Inbound Protocol</th>\n<th>Port range</th>\n<th>Source</th>\n</tr>\n<tr>\n<td rowspan=\"8\">smax-EFS-Security-Group</td>\n<td>TCP</td>\n<td>20048</td>\n<td>smax-WorkerNode-Security-Group*</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>111</td>\n<td>smax-WorkerNode-Security-Group*</td>\n</tr>\n<tr>\n<td>UDP</td>\n<td>111</td>\n<td>smax-WorkerNode-Security-Group*</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>2049</td>\n<td>smax-WorkerNode-Security-Group*</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>20048</td>\n<td>smax-BastionSecurityGroup</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>111</td>\n<td>smax-BastionSecurityGroup</td>\n</tr>\n<tr>\n<td>UDP</td>\n<td>111</td>\n<td>smax-BastionSecurityGroup</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>2049</td>\n<td>smax-BastionSecurityGroup</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>Configuration example of Security group for Bastion.\n\t\t<table>\n<tbody>\n<tr>\n<th>Item name</th>\n<th>Inbound Protocol</th>\n<th>Port range</th>\n<th>Source</th>\n<th>Description</th>\n</tr>\n<tr>\n<td>smax-BastionSecurityGroup</td>\n<td>TCP</td>\n<td>22</td>\n<td>The IP address range of your local computer, or the range of IP addresses (in CIDR block notation) of networks you allow. </td>\n<td>Allows inbound SSH access from your local computer or networks you allow.</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>Configuration example of Security group for RDS.\n\t\t<table>\n<tbody>\n<tr>\n<th>Item name</th>\n<th>Inbound Protocol</th>\n<th>Port range</th>\n<th>Source</th>\n<th>Description</th>\n</tr>\n<tr>\n<td rowspan=\"2\">smax-RDS-Security-Group</td>\n<td>TCP</td>\n<td>5432</td>\n<td>smax-WorkerNode-Security-Group*</td>\n<td>Worker node</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>5432</td>\n<td>smax-BastionSecurityGroup</td>\n<td>Bastion node</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ul>\n</li>\n<li>Two or three subnets should sit in at least two Availability Zones, better to sit in three Availability Zones, configured as public subnets with the following components configured or other components enabling the provisioning of internet-facing load balancers in the subnets (usually on a different VPC peered with the private VPC).\n\t<ul>\n<li>NAT gateway\n\t\t<ol start=\"1\">\n<li>Open the Amazon VPC console at <a class=\"external free\" href=\"https://console.aws.amazon.com/vpc/home\" rel=\"nofollow\" target=\"1\" title=\"Amazon VPC  console\">https://console.aws.amazon.com/vpc/home</a>.</li>\n<li>Click <b>NAT Gateways &gt; Create NAT Gateway</b>.</li>\n<li>Select a public subnet in the peered public VPC.</li>\n<li>Associate Elastic IP.</li>\n<li>Click <b>Create a NAT Gateway</b>.</li>\n<li>After creating the NAT gateway, add a NAT gateway route entry in the route table associated with the private subnets.<br/>\n<a class=\"image\" href=\"/file/images/7/79/sma_1805_aws_private_subnet_routetable_2.png\" title=\"/file/images/7/79/sma_1805_aws_private_subnet_routetable_2.png\"> <img alt=\"sma 1805 aws private subnet routetable 2.png\" data-file-height=\"276\" data-file-width=\"678\" height=\"276\" src=\"../../../images/sma_1805_aws_private_subnet_routetable_2_712199a2.png\" width=\"678\"/> </a></li>\n</ol>\n</li>\n<li>Internet gateway\n\t\t<ol start=\"1\">\n<li>On the public VPC, go to the <b>Internet Gateway</b> console</li>\n<li>Click <b>Create internet gateway</b> if there is no Internet gateway attached to it. The system automatically creates two route tables after the VPC is created successfully. One of the tables automatically attaches to the Internet gateway. You need to name the two route tables respectively. For example, name one route table <b>example-sma-public-subnet-routetable</b> and it attaches to the Internet gateway, and name another route table <b>example-sma-private-subnet-routetable</b>.  \n\t\t\t<p><a class=\"image\" href=\"/file/images/7/79/sma_1805_aws_private_subnet_routetable_2.png\" title=\"/file/images/7/79/sma_1805_aws_private_subnet_routetable_2.png\"> <img alt=\"sma 1805 aws private subnet routetable 2.png\" data-file-height=\"276\" data-file-width=\"678\" height=\"276\" src=\"../../../images/sma_1805_aws_private_subnet_routetable_2_712199a2.png\" width=\"678\"/> </a></p>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n<h3 class=\"mw-headline\" id=\"Step_2._Prepare_the_other_network_requirements_listed_in_the_EKS_guide\">Step 2. Prepare the other network requirements listed in the EKS guide</h3>\n<p>See the details at <a class=\"external free\" href=\"https://docs.aws.amazon.com/eks/latest/userguide/network_reqs.html\" rel=\"nofollow\" target=\"1\" title=\"EKS network requirements\">https://docs.aws.amazon.com/eks/latest/userguide/network_reqs.html</a>.</p>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}