{
  "title": "OPB based email integration using EWS",
  "content": "<div class=\"mw-parser-output\">\n<p>This topic describes how to set up the email integration with the Exchange Online based on Exchange Web Services (EWS).</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>This topic documents only Exchange Online-specific configurations. For common content for all email integrations , such as the use case, and common Service Management configurations, see <a href=\"/doc/423/26.1/emailintegration\" title=\"Email Integration\">Email Integration</a>.</div></div></div>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div> The EWS integration supports both OAuth 2.0 ROPC and OAuth 2.0 client credentials authentication methods, but the OAuth 2.0 ROPC authentication is preferred because the EWS integration with the OAuth 2.0 client credentials authentication currently has some performance issues. </div></div></div>\n<h2 id=\"Prerequisites\"><a id=\"Set_up_the_Email_Integration_app_in_Azure\" name=\"Set_up_the_Email_Integration_app_in_Azure\" title=\"Set up the Email Integration app in Azure\"></a>Set up the Email Integration app in Azure</h2>\n<p>For the integration to work, you must register an app in Azure, and configure a client secret and permissions for the app. During the setup process, take note of the following information, which you will use when configuring Service Management:</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">Application (client) ID</li><li style=\"margin-left: 28px; position: relative;\">Directory (tenant) ID</li><li style=\"margin-left: 28px; position: relative;\">Client secret</li></ul>\n<h3><a id=\"Prerequisites\" name=\"Prerequisites\" title=\"Prerequisites\"></a>Prerequisites</h3>\n<p>Before you proceed, make sure that you have met the following prerequisites:</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">Azure Admin rights</li><li style=\"margin-left: 28px; position: relative;\">An existing tenant in the Azure Active Directory (Azure AD)</li><li style=\"margin-left: 28px; position: relative;\">You have already created an Office 365 email account that is used to receive emails from users.</li></ul>\n<h3><a id=\"Step_1_Register_an_application_for_the_integration_on_the_Azure_portal\" name=\"Step_1_Register_an_application_for_the_integration_on_the_Azure_portal\" title=\"Step 1. Register an application for the integration on the Azure portal\"></a>Step 1. Register an application for the integration on the Azure portal</h3>\n<ul style=\"padding-left: 0px;\"></ul>\n<p>Perform the following steps on the Azure portal to register an application for the email integration. </p>\n<ol start=\"1\" style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Open your Azure tenant. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click<strong> App registrations</strong> in the left pane, and click <strong>New registration</strong>. The <strong>Register an application</strong> page appears. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Configure the following settings:\n\t<ol start=\"1\" style=\"padding-left: 0px;\"><li style=\"--number-width: 21px; --number-spacing: 25px; margin-left: 49px; position: relative;\">Specify a Name. For example, <strong>SMAX</strong>. </li><li style=\"--number-width: 25px; --number-spacing: 29px; margin-left: 53px; position: relative;\">Select <strong>Accounts in this organizational directory only (xxxxx only - Single tenant)</strong>.</li></ol>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Register</strong>. </li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The application details page appears. You can find the <strong>Application (client) ID</strong> and <strong>Directory (tenant) ID</strong>. Make a note of the values.\n\t<div><a class=\"image\" href=\"\"> <img alt=\"/mediawiki/images/6/6d/SMAX_202105_teams_app_detail.png\" border=\"4\" file=\"/mediawiki/images/6/6d/SMAX_202105_teams_app_detail.png\" hspace=\"0\" src=\"../../../images/SMAX_202105_teams_app_detail_fdf06897.png\" style=\"width: 800px; height: 126px; margin: 0px; border: 4px solid black;\" vspace=\"0\"/> </a></div>\n</li></ol>\n<p>Then perform the remaining steps in this app registration.</p>\n<h3><a id=\"Step_2_Configure_a_client_secret_for_the_application\" name=\"Step_2_Configure_a_client_secret_for_the_application\" title=\"Step 2. Configure a client secret for the application\"></a>Step 2. Configure a client secret for the application</h3>\n<ol start=\"1\" style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Certificates &amp; secrets</strong> on the left pane. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the Client secrets section, click <strong>New client secret</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Enter a name, select an expiration period, and then click <strong>Add</strong>. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Make a note of the value of the client secret. Note that you won't be able to retrieve it after you perform another operation or leave this blade. <br/>\n<a class=\"image\" href=\"\"> <img alt=\"SMAX_202105_teams_app_secret\" border=\"4\" file=\"/mediawiki/images/e/ec/SMAX_202105_teams_app_secret.png\" hspace=\"0\" src=\"../../../images/SMAX_202105_teams_app_secret_9ba081a8.png\" style=\"width: 800px; height: 166px; margin: 0px; border: 4px solid black;\" vspace=\"0\"/> </a></li></ol>\n<h3><a id=\"Step_3_Configure_API_permissions_for_the_application\" name=\"Step_3_Configure_API_permissions_for_the_application\" title=\"Step 3. Configure API permissions for the application\"></a>Step 3. Configure API permissions for the application</h3>\n<ol start=\"1\" style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Click <strong>API permissions</strong> under Manage on the left pane.</p>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Click <strong>Add a permission</strong>.</p>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Select the <strong>Office 365 Exchange Online</strong> API and the following delegated permissions from the available options and click <strong>Add permissions</strong>. <br/>\n<br/>\n\tPermissions required if using the OAuth 2.0 ROPC authentication:</p>\n<pre>EWS.AccessAsUser.All\n\nMail.Read.All\n\nMail.ReadWrite.All\n\nMail.Send</pre>\n\tPermissions required if using the OAuth 2.0 client credentials authentication (select <strong>full_access_as_app </strong>in <strong>Application permissions</strong> &gt; <strong>Other permissions</strong>):\n\n\t<pre><code>EWS.AccessAsUser.All\nfull_access_as_app</code></pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Grant admin consent for &lt;your Azure tenant&gt;</strong>.</li></ol>\n<h2 id=\"Create_an_integration_user\"><a id=\"Create_an_integration_user\" name=\"Create_an_integration_user\" title=\"Create an integration user\"></a>Create an integration user</h2>\n<p>When you install an OPB agent later, you will need to specify a user, which will be used to connect the agent to Service Management. Pay attention to the following:</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">This user must be assigned the <b>OPB Remote Agent</b> role in Service Management.</li><li style=\"margin-left: 28px; position: relative;\">This user must be an integration user, rather than a federated user.</li></ul>\n<p>To prepare an integration user, follow these steps:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Create an integration user. See <a href=\"/doc/423/26.1/createuser\" title=\"How to create a user\">How to create an integration user</a>. </p>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to the agent interface as the tenant admin, navigate to <strong>Administration</strong> &gt; <strong>Master Data</strong> &gt; <strong>People</strong>, and then assign the<b> OPB Remote Agent</b> role to the user.</li></ol>\n<p>Later, when installing the OPB agent, specify this integration user's credentials.</p>\n<h2><a id=\"Install_the_OPB_agent\" name=\"Install_the_OPB_agent\" title=\"Install the OPB agent\"></a>Install the OPB agent</h2>\n<p>You must install the OPB agent on a machine that has access at all times to both the Exchange server and Service Management. Do not install the agent on laptops or machines that aren't actively maintained to have consistent uptime.</p>\n<p>In this example, we install the OPB agent on a Windows machine. For details, see <a href=\"/doc/423/26.1/opbinstall\" title=\"SMAX:25.1/OpbInstall\">How to use On-Premises Bridge agents on Windows</a>. Note that, when prompted to enter authentication credentials on the <b>Setup authentication</b> page, enter the user name and password of the integration user that you created.</p>\n<p><b>Note</b>: If you want to install on Linux, see <a href=\"/doc/423/26.1/opbinstalllinux\" title=\"SMAX:25.1/OpbInstallLinux\">How to use On-Premises Bridge agents on Linux</a>.</p>\n<h2><a id=\"Import_the_suite_CA_certificate_to_the_OPB_trusted_keystore\" name=\"Import_the_suite_CA_certificate_to_the_OPB_trusted_keystore\" title=\"Import the suite CA certificate to the OPB trusted keystore\"></a>Import the suite CA certificate to the OPB trusted keystore</h2>\n<p>This step is required for the OPB agent to connect to Service Management. For details, see <a href=\"/doc/423/25.1/opbinstall#How_to_import_the_suite_CA_certificate_to_the_OPB_trusted_keystore\" title=\"How to import the suite CA certificate to the OPB trusted keystore\">How to import the suite CA certificate to the OPB trusted keystore</a>.</p>\n<h2><a id=\"Add_the_OPB_agent\" name=\"Add_the_OPB_agent\" title=\"Add the OPB agent\"></a>Add the OPB agent</h2>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to the tenant as the tenant admin.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Go to <b>Administration</b> &gt; <b>Utilities</b> &gt; <b>Integration</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Add agent</b> on the left-side pane to add the OPB agent. For details, see <a href=\"/doc/423/25.1/emailintegration#Add_the_OPB_agent\" title=\"Add the OPB agent\">Add the OPB agent</a>. </li></ol>\n<h2><a id=\"Add_email_integration_credentials_to_the_OPB_agent\" name=\"Add_email_integration_credentials_to_the_OPB_agent\" title=\"Add email integration credentials to the OPB agent\"></a>Add email integration credentials to the OPB agent</h2>\n<h3><a id=\"Windows\" name=\"Windows\" title=\"Windows\"></a>Windows</h3>\n<p>Use the Endpoint Credentials Manager to add the email integration credentials to the OPB agent so that the agent can connect to the mail server.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Start</b> &gt; <b>Programs</b> &gt; <b>MicroFocus</b> &gt; <b>On-Premises Bridge Agent</b> &gt; <b>Endpoint Credentials Manager</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>New</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">From the drop-down list, select <b>OPB email integration - EWS</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>OK</b>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Enter the following information, and then click <strong>Save</strong>.\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">Select <strong>OAuth 2.0 ROPC</strong> or <strong>OAuth 2.0 client credentials</strong> as the authentication method.</li><li style=\"margin-left: 40px; position: relative;\">Enter the name that will appear in Service Management when you add the email integration endpoint. For example: <b>smax</b>.</li><li style=\"margin-left: 40px; position: relative;\">(Only if you selected <strong>OAuth 2.0 ROPC</strong>) Enter the email address (User field) and password for the email account that the email integration monitors for incoming emails.</li><li style=\"margin-left: 40px; position: relative;\">Enter the client secret that you created when registering the email integration app in Azure.</li><li style=\"margin-left: 40px; position: relative;\">(Optional) Enter the username and password for the proxy server.</li></ul>\n</li></ol>\n<h3><a id=\"Linux\" name=\"Linux\" title=\"Linux\"></a>Linux</h3>\n<p>Run the following command to add the email integration credentials to the OPB agent so that the agent can connect to the mail server.</p>\n<pre># change to util dir\ncd &lt;OPB_DIR&gt;/product/util/opb\n./credentials_mng_console.sh create -endpoint email-integration-domain-ews -name &lt;credential_name&gt; -user &lt;email_account&gt; -pass &lt;email_password&gt; -param emailIntegration.ews.property.authenticationMethod EWS -param emailIntegration.ews.property.clientSecret &lt;client_secret&gt; -param emailIntegration.ews.property.proxyUsername &lt;proxy_username&gt; -param emailIntegration.ews.property.proxyPassword &lt;proxy_password&gt;</pre>\n<p>Where</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" style=\"width: 500px;\">\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>&lt;credential_name&gt;</td>\n<td>The name of the credentials record to be created.</td>\n</tr>\n<tr>\n<td>&lt;email_account&gt;</td>\n<td>The email address that the email integration monitors for incoming emails.</td>\n</tr>\n<tr>\n<td>&lt;email_password&gt;</td>\n<td>The password for the email address.</td>\n</tr>\n<tr>\n<td>&lt;client_secret&gt;</td>\n<td>The client secret for the application you registered on Azure.</td>\n</tr>\n<tr>\n<td>\n<p>&lt;proxy_username&gt;</p>\n</td>\n<td>\n<p>(Optional) The username for the proxy server.</p>\n<p>If this value is omitted, omit <code>-param emailIntegration.ews.property.proxyUsername</code> as well in the above command.</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>&lt;proxy_password&gt;</p>\n</td>\n<td>\n<p>(Optional) The password for the proxy server.</p>\n<p>If this value is omitted, omit <code>-param emailIntegration.ews.property.proxyPassword</code> as well in the above command.</p>\n</td>\n</tr>\n</tbody>\n</table>\n<ul style=\"padding-left: 0px;\"></ul>\n<h2 id=\"Set_up_an_integration_endpoint\"><a id=\"Set_up_an_integration_endpoint\" name=\"Set_up_an_integration_endpoint\" title=\"Set up an integration endpoint\"></a>Set up an integration endpoint</h2>\n<p>Perform the following steps to set up an integration point:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the agent interface, navigate to <b>Administration</b> &gt; <b>Utilities</b> &gt; <b>Integration</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click the <b>Endpoints</b> tab.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Add</b>, and then enter the following information:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">Endpoint type: select <b>Email integration</b>.</li><li style=\"margin-left: 40px; position: relative;\">Endpoint name: enter the name that you specified when adding the endpoint credentials. For example: <b>smax</b>.</li><li style=\"margin-left: 40px; position: relative;\">Running on agent: Select the OPB agent that you have configured.</li></ul>\n<a class=\"image\" href=\"\"> <img alt=\"SMAX add emailintg endpoint.png\" data-file-height=\"262\" data-file-width=\"459\" src=\"../../../images/SMAX_add_emailintg_endpoint_ff3290f3.png\" style=\"width: 459px; height: 262px;\"/> </a></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>ADD</b>. The endpoint is added.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select the endpoint, and then click <b>Configure</b>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Configure the required settings.</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Mail protocol</strong>: EWS</li><li style=\"margin-left: 40px; position: relative;\"><strong>Mail server host</strong>: The host name of the Exchange server.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Service path</strong>: Keep the default value (<code>EWS/Exchange.asmx</code>)</li><li style=\"margin-left: 40px; position: relative;\"><strong>Application (client) ID</strong>, <b>Directory (tenant) ID</b>: The ID generated when you register the Email Integration app in Azure.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Version</strong>: The version of Exchange Online you use.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Authentication method</strong>: Select <strong>OAuth 2.0 ROPC </strong>or<strong> OAuth 2.0 client credentials. </strong></li><li style=\"margin-left: 40px; position: relative;\"><strong>Mail from</strong>: enter an email address as the email sender in the notification emails sent to users. This field is required only if you selected the <strong>OAuth 2.0 client credentials </strong>method.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Credentials</strong>: The credential you configured in OPB Credential Manager.</li></ul>\n<p>For details, see the email integration section in <a href=\"/doc/423/26.1/opbuseendpoints\" title=\"Use endpoints\">Use endpoints</a>.</p>\n</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Test connection</b>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Save</b>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Enable</b> to enable automatic email synchronization.</li></ol>\n<h2><a id=\"Complete_other_Service_Management_configurations\" name=\"Complete_other_Service_Management_configurations\" title=\"Complete other Service Management configurations\"></a>Complete other Service Management configurations</h2>\n<p>Complete the rest of the configuration in the Configure email integration topic (from the <a href=\"/doc/423/25.1/emailintegration#Enable_request_creation_from_email_in_the_default_offering\" title=\"Enable request creation from email... section\">Enable request creation from email... section</a> till the end).</p>\n</div>",
  "modifiedon": "2025-12-04 19:15:43"
}