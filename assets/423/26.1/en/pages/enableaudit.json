{
  "title": "Enable Audit",
  "content": "<div class=\"mw-parser-output\"><br/><p>After you have installed the audit service, you need to connect your system to the Audit service. </p>\n<h2>Prerequisite</h2>\n<p>You must have already installed the audit service. Currently, you can install the Audit service in an on-premises environment or on AWS with EKS. See <a href=\"/doc/423/26.1/installauditservice\" title=\"(Optional) Install the Audit service on-premises\">(Optional) Install the Audit service on-premises</a> and <a href=\"/doc/423/26.1/createauditdeploymenteks\" title=\"Create a new deployment for Audit service\">Install the Audit service on AWS (EKS)</a>.</p>\n<ol>\n</ol>\n<h2>Prepare an audit integration user</h2>\n<p>In the IdM Admin Portal, you need to prepare an audit integration user so that the system can use it to create audit data. The tenant that the integration user belongs to is called the audit integration tenant. Use the <strong>sysbo</strong> tenant as the integration tenant. </p>\n<p>You will need to specify this user and the tenant later when creating an audit client configuration file (<strong>audit-client-cfg.properties</strong>). </p>\n<p>The user must be of the System type and have the CREATE_AUDIT permission to create audit data. To prepare this user, follow these steps:</p>\n<ol>\n<li>Log in to the IdM Admin Portal as suite-admin. </li>\n<li>From the organization list, open <strong>sysbo</strong>.</li>\n<li>Click <strong>Users</strong>, create a new user, and set the Type to <strong>SYSTEM</strong>. <br/>\n<a class=\"image\" href=\"\"> <img alt=\"SMAX202202_audit_intg_user.png\" border=\"0\" file=\"/mediawiki/images/b/b9/SMAX202202_audit_intg_user.png\" height=\"333\" hspace=\"0\" src=\"../../../images/SMAX202202_audit_intg_user_67a4cfaf.png\" style=\"width: 800px; height: 333px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a></li>\n<li>In the Direct Roles section, add the <b>audit-management</b> role to the user. This out-of-the-box role has the <strong>CREATE_AUDIT</strong> permission.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"audit_management_role.png\" border=\"0\" file=\"/mediawiki/images/0/09/audit_management_role.png\" height=\"218\" hspace=\"0\" src=\"../../../images/audit_management_role_adf38028.png\" style=\"width: 800px; height: 218px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a></li>\n</ol>\n<h2>Export the Audit service engine certificate</h2>\n<p>To enable the suite to connect to the Audit service, you need to import the Audit service engine certificate to the keystores of Service Management, IdM, and UD/UCMDB.</p>\n<p>It's highly recommended that you get the correct Root CA certificate from the engineer who creates and administers the Audit service deployment. If this isn't possible, you can export the Root CA certificate from the browser as follows. </p>\n<ol>\n<li>Open the Audit engine URL in a web browser: https://&lt;auditEngineHostname&gt;:&lt;auditEnginePort&gt;/audit-service-engine. The values of <em>&lt;auditEngineHostname&gt;</em> and<em> &lt;auditEnginePort&gt;</em> will correspond to the values of these properties in the <strong>create_secret.yaml</strong> file (audit client configuration file) that you will be creating later.</li>\n<li>Export the certificate (for example, <strong>audit.cer</strong>) in the base-64 encoding format. As an example, the following are steps in Google Chrome:\n\t<ol start=\"1\">\n<li>Click the lock icon before the URL on the address bar.</li>\n<li>Click <strong>Certificate</strong>.</li>\n<li>On the <strong>Certification Path</strong> tab, select the site <strong>root </strong>certificate (the topmost one), and then click <strong>View Certificate</strong>. If this tab shows only one certificate, the <strong>View Certificate</strong> option isn't available and you need to directly go to the next step.</li>\n<li>On the <strong>Details</strong> tab, click <strong>Copy to File</strong>.</li>\n<li>In the <strong>Certificate Export Wizard</strong>, click<strong> Next</strong>.  </li>\n<li>Select the <strong>Base-64 encoded X.509 (.CER)</strong> format, and click <strong>Next</strong>.</li>\n<li>Follow the rest of the instructions and export the certificate.</li>\n</ol>\n</li>\n</ol>\n<h2>Enable Audit for Service Management and IdM</h2>\n<p>Perform the following steps to enable Audit for Service Management and IdM. </p>\n<ol>\n<li>Edit the enableAudit-values.yaml file.</li>\n<li> Apply the changes and import Audit certificate to Service Management.</li>\n<li>Run a REST call to the Create Tenant in Audit API for existing tenants.</li>\n<li>Enable audit log output in IdM.</li>\n</ol>\n<p>See below for the detailed steps.</p>\n<h3>Edit the enableAudit-values.yaml file</h3>\n<p>Go to the ESM_Helm_Chart-2x.x.x/samples/ directory, and edit the enableAudit-values.yaml file by specifying the following parameters in the file.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" style=\"width: 500px;\">\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>enableAudit.auditEngine.hostname<br/>\n\t\t\tenableAudit.auditEngine.port</strong></td>\n<td>\n<p>For an on-premises deployment: These are the <strong>global.externalAccessHost</strong> and <strong>global.externalAccessPort </strong>values that are defined in the values.yaml file during the Audit service installation.</p>\n<p>For an EKS deployment: these are the &lt;integration_hostname&gt; and &lt;ingress_controller_port&gt; values that you specify when creating an integration ALB between Service Management and the Audit service (see <a href=\"/doc/423/26.1/integrationalbaudit\" title=\"Create application load balancer for Audit service\">Create an integration ALB between Service Management and the Audit service</a>).</p>\n</td>\n</tr>\n<tr>\n<td>\n<p><strong>enableAudit.auditIntegration.username<br/>\n\t\t\tenableAudit.auditIntegration.password</strong></p>\n</td>\n<td>The user name and password (Base64 encoded) of the audit integration user that you have prepared. For example, <strong>auditIntegrationUser</strong>.</td>\n</tr>\n<tr>\n<td>\n<p><strong>enableAudit.auditUi.endpoint<br/>\n\t\t\tenableAudit.auditUi.port</strong></p>\n</td>\n<td>The FQDN and port of the Audit UI that is accessible to external users.</td>\n</tr>\n</tbody>\n</table>\n<h3>Apply the changes and import Audit certificate to Service Management</h3>\n<p>Perform the following steps on the control plane node or the bastion node. </p>\n<ol>\n<li>Get your my-values.yaml file:\n\t<pre>helm get values &lt;ESM_Release_Name&gt; -n &lt;ESM namespace&gt; &gt; my-values.yaml</pre>\n<p>where: &lt;ESM_Release_Name&gt; is the unique release name of the ESM deployment.</p>\n</li>\n<li>Open your my-values.yaml file and paste the content of the root CA certificate in parallel with the global settings (there is no indent before the caCertificates line) to import the audit service certificate into Service Management:\n\t<pre>caCertificates:  \n  audit_ca.cert: &lt;cert-file-base64-encoded&gt; or PEM</pre>\n</li>\n<li>Run a Helm upgrade:\n\t<pre>helm upgrade &lt;ESM_Release_Name&gt; &lt;ESM_CHART_FILE&gt; -n &lt;ESM namespace&gt; -f &lt;my-values.yaml&gt; -f &lt;enableAudit-values.yaml&gt;</pre>\n</li>\n<li>Restart the IdM pod:\n\t<pre>kubectl rollout restart deployment idm -n &lt;ESM namespace&gt;</pre>\n</li>\n<li>Restart the platform pod:\n\t<pre>kubectl rollout restart deployment itom-xruntime-platform -n &lt;ESM namespace&gt;</pre>\n</li>\n</ol>\n<h3>Run a REST call to the Create Tenant in Audit API for existing tenants</h3>\n<p>To enable Audit for a tenant, the system must create the tenant in Audit. To do this, the system calls the <strong>Create Tenant in Audit API</strong> during the deployment of a tenant. However, this is impossible for an existing tenant, which you have deployed before installing the Audit service. For this reason, you must manually run a REST call to the <strong>Create Tenant in Audit API</strong>. For details, see <a href=\"/doc/423/26.1/audittenantlifecycleapis\" title=\"Audit tenant lifecycle APIs\">Audit tenant lifecycle APIs</a>.</p>\n<h3>Enable audit log output in IdM</h3>\n<p>By default, audit log output is disabled in IdM. To enable audit, you must enable IdM audit data output as follows:</p>\n<ol>\n<li>Log in to the IdM Admin Portal as suite-admin: https://&lt;host&gt;/idm-admin.</li>\n<li>Go to <strong>System Settings</strong> and select the <strong>AUDIT</strong> tab.</li>\n<li>Select the destination as <strong>HTTP (Audit Service)</strong>. <br/>\n\tBy default, the destination is set to <strong>Disable</strong>, which means audit logs and events are not generated. Change the destination to HTTP (Audit Service) to enable audit for IdM.</li>\n</ol>\n<h2>Enable audit for UD/UCMDB</h2>\n<p>Before you enable the Audit service for UD/UCMDB, make sure UD/UCMDB uses shared IdM with Service Management.</p>\n<p>Perform the following steps to connect UD/UCMDB to the audit service.</p>\n<h3>Prepare an audit integration user</h3>\n<p>You can use the one created for Service Management or create a new one. For details, see the \"Prepare an audit integration user\" section above. </p>\n<h3>Prepare the connection </h3>\n<ol>\n<li>\n<p>Replace the <strong>&lt;user_password&gt;</strong> with the <b>audit integration user </b>password in the following command, and then run it. </p>\n<pre><code>kubectl get secret cms-secret -n &lt;UD/UCMDB_NAMESPACE&gt; -o json | jq --arg pass \"$(echo &lt;USER_PASSWORD&gt; | base64)\" '.data[\"idm_audit_integration_password\"]=$pass'  | kubectl apply -f -</code></pre>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"> </div>\n<div class=\"admonition-content admonition-note-content\">If you already set the  <strong>idm_audit_integration_password</strong> during the UD/UCMDB installation, skip this step.</div>\n</div>\n</li>\n<li>\n<p>Edit the <strong>values.yaml</strong> file using a text editor, and then add the following parameters under the IdM component. Use the same values that you specify for Service Management. See the \"Enable Audit for Service Management and IdM' section for details. </p>\n<ul>\n<li><strong>auditEngineHostname </strong></li>\n<li><strong>auditEnginePort</strong><strong> </strong></li>\n<li><strong>auditIntegrationUser</strong></li>\n</ul>\n</li>\n<li>\n<p>Add the audit service certificate to UD/UCMDB:</p>\n<ol start=\"1\">\n<li>Use the already generated audit service certificate. Convert the <strong>.cer </strong>extension to <strong>.crt</strong>:\n\n\t\t<pre><code>openssl x509 -inform PEM -in &lt;filepath&gt;/certificate.cert -out certificate.crt</code></pre>\n</li>\n<li>Add the certificate in the <strong>values.yaml</strong> file under the <strong>caCertificates </strong>parameter:\n\t\t<div><a class=\"image\" href=\"\"> <img alt=\"CMS_2022.11_AuditCert.png\" border=\"0\" file=\"/mediawiki/images/1/14/CMS_2022.11_AuditCert.png\" height=\"460\" hspace=\"0\" src=\"../../../images/CMS_2022.11_AuditCert_75dd13cd.png\" style=\"width:612px;height:460px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\" width=\"612\"/> </a></div>\n</li>\n</ol>\n</li>\n<li>\n<p>Save the <strong>values.yaml </strong>file.</p>\n</li>\n<li>\n<p>Run the following command to upgrade the deployment:</p>\n<pre><code>helm upgrade &lt;UD/UCMDB_RELEASE_NAME&gt; &lt;PATH_TO_UCMDB_CHART.TGZ&gt; -n &lt;UD/UCMDB_NAMESPACE&gt; -f &lt;PATH_TO_VALUES.YAML&gt;</code></pre>\n</li>\n<li>\n<p>The UD/UCMDB pods automatically restart. If this doesn't happen, you have to manually restart the UD/UCMDB pods for the changes to take effect:</p>\n<pre><code>kubectl rollout restart sts itom-ucmdb -n &lt;UD/UCMDB_NAMESPACE&gt; </code></pre>\n</li>\n<li>Run the following command to verify if the audit service certificate is in the returned response file:  \n\t<pre><code>kubectl get cm -n &lt;UD/UCMDB_NAMESPACE&gt; default-ca-certificate -o yaml</code></pre>\n</li>\n</ol>\n<h3>Enable the audit events</h3>\n<h>\n<p>The audit events are disabled by default. To enable the audit events, follow these steps:</p>\n<ol>\n<li>\n<p>On the UCMDB server, go to <strong>JMX Console &gt; UCMDB:service=Settings Services &gt; setGlobalSettingValue</strong><strong>.</strong></p>\n</li>\n<li>\n<p>In the <strong>name </strong>field, enter <strong>audit.events.enabled</strong><strong>.</strong></p>\n</li>\n<li>\n<p>In the <strong>value </strong>field, enter <strong>true.</strong></p>\n</li>\n<li>\n<p>Click <strong>Invoke. </strong></p>\n</li>\n</ol>\n<h2>Grant audit permissions to users</h2>\n<p>By default, the suite-admin user has permission to view both system-level audit data and tenant-level audit data, and the tenant admin has permission to view tenant-level audit data. For information about audit roles and permissions, see <a href=\"/doc/423/26.1/auditrolespermissions\" title=\"Audit roles and permissions\">Audit roles and permissions</a>.</p>\n<p>If other account users of the tenant need to access audit data, you need to give them audit permissions as follows:</p>\n<ol>\n<li>Log in to the Service Management agent interface as the tenant admin. </li>\n<li>Navigate to <strong>Administration</strong> &gt; <strong>People</strong> &gt; <strong>Groups</strong>. Out of the box, there are two groups: <strong>view-system-level-audit</strong>, and <strong>view-tenant-level-audit</strong>.<strong> </strong>Users in these groups have access to system-level audit data and tenant-level audit data, respectively. </li>\n<li>Add users to these groups as needed. </li>\n</ol>\n<h2>Add the Audit service domain to your list of authorized domains</h2>\n<p>If Service Management and the Audit service use different FQDNs, you need to make the Audit service domain an authorized domain:</p>\n<ol>\n<li>Log in to the agent interface as the tenant admin, and navigate to <strong>Administration</strong> &gt; <strong>Configuration</strong> &gt; <strong>Application Settings</strong>.</li>\n<li>in the <strong>Authorized domains for navigation</strong> field, add the FQDN of the Audit service to the list. </li>\n</ol>\n<p>If you skip this step, when users try to navigate to the Audit UI from the Agent Interface (<strong>Administration</strong> &gt; <strong>Utilities</strong> &gt; <strong>Audit</strong>), an error occurs. </p>\n<h2>Verify the audit configurations</h2>\n<p>Log in to the IdM, Service Management, and UD/UCMDB interfaces, perform appropriate operations to trigger the generation of audit records, and then log in to the Audit UI to verify the audit records. You can log in to IdM as suite-admin, and log in to Service Management and UD/UCMDB as the tenant admin. </p>\n<p>For a list of events that will trigger the generation of audit records, see <a href=\"/doc/423/26.1/auditevents\" title=\"Audit events\">Audit events</a>. </p>\n<p>For information about how to access the Audit UI, see <a href=\"/doc/423/26.1/viewauditdata\" title=\"Audit UI\">Audit UI</a>. </p>\n</h>\n<p> </p>\n<div> </div>\n<p> </p>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}