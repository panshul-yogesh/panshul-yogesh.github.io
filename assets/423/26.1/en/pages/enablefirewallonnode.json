{
  "title": "Enable a firewall in the suite environment",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>Your SMA production environment is normally behind a corporate firewall as required by your security policy; however, to install and run OMT and SMA, certain ports must be open in the firewall.</p>\n<p>This document provides detailed instructions on how to open the required ports on all nodes before you start the OMT installation.</p>\n<div class=\"Admonition_Note\"><span class=\"autonumber\">Note</span>\n<ul>\n<li>When a firewall is enabled before OMT deployment, OMT will open firewall ports 3000, 5000, 5443 automatically during the deployment. Because these three ports are exposed with the hostPort mode in the Kubernetes cluster, Docker will add the iptable rules to open these ports automatically. You can't block these firewall ports with firewall-cmd anymore. However, if you enable a firewall after OMT is deployed, you have to open all the firewall ports listed below.</li>\n<li>If you installed the suite with your firewall disabled and want to enable the firewall after installation, follow the instructions in <a href=\"/doc/423/26.1/enablefirewallafterinstall\" title=\"Enable a firewall after installation\">Enable a firewall after installation</a>.</li>\n</ul>\n</div>\n<h2 class=\"mw-headline\" id=\"Security_recommendations\">Security recommendations</h2>\n<p>We recommend that you add the following iptable rules on each target server. The table below also lists the ports that must be open on each target server, if you want to open a firewall. The default policy of the INPUT chain must be \"ACCEPT\" to open the firewall or to add required iptables rules. If it's not \"ACCEPT\", contact your IT system administrator to change the policy. <br/>\nTo check the default policy of the INPUT chain, run the following command: </p>\n<pre>iptables -S | grep -- '-P INPUT'</pre>\n<p>To see if a port is in use, run the following command:</p>\n<pre>netstat -antp | grep &lt;''port_number''&gt;</pre>\n<h2 class=\"mw-headline\" id=\"Ports_that_must_be_open_in_your_firewall\">Ports that must be open in your firewall</h2>\n<p>The section lists the ports that must be open in your firewall for inbound and outbound connections.  Note that the inbound and outbound port tables use the following terms:</p>\n<ul>\n<li>Control plane: a Kubernetes (k8s) control plane node</li>\n<li>Worker: a k8s worker node</li>\n<li>NFS: a Network File System server for the k8s cluster</li>\n<li>Node: any of the k8s cluster nodes (control plane nodes and worker nodes).</li>\n<li>Client host: can be a host from which the end user's browser connects to the suite or a web services client host</li>\n</ul>\n<h3 class=\"mw-headline\" id=\"Ports_for_inbound_connections\">Ports for inbound connections</h3>\n<p>If you need to enable a firewall in your suite environment, make sure that the following ports are open in your firewall settings as inbound rules.<br/>\n<br/>\nMake sure that each port listed in the \"Target port\" column is available on the \"Target server\", regardless of your firewall status. <br/>\n<br/>\nFor example, port 2380 must be available on all the control plane nodes and port 10250 must be available on all control plane nodes and worker nodes.<br/>\n<br/>\nThe \"Direction\" column shows the network communication directions. For example, <code>Control plane and worker -&gt; NFS </code>means the network communication is from the control plane<code> nodes and worker</code> nodes to <code>NFS</code>; <code>Control plane</code><code> &lt;-&gt; Control plane </code>means this is two-way network communication.</p>\n<div class=\"Admonition_Note\"><span class=\"autonumber\">Note</span>\n<p>The ports that are highlighted are for k8s internal communications only and are referred to as \"internal ports\" in this document.</p>\n</div>\n<table>\n<tbody>\n<tr>\n<th>Target server</th>\n<th>Protocol Layer 4/Layer 7</th>\n<th>Source server</th>\n<th>Target port</th>\n<th>Service</th>\n<th>Source port</th>\n<th>Direction</th>\n<th>Description</th>\n</tr>\n<tr>\n<td colspan=\"1\" rowspan=\"20\">Control plane</td>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10259</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Access by localhost only</td>\n<td>Kubernetes port. </td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10257</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Access by localhost only</td>\n<td>Kubernetes port. </td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10248</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Access by localhost only</td>\n<td>Kubernetes port. </td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10249</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Access by localhost only</td>\n<td>Kubernetes port. </td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>4001</td>\n<td>etcd</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane</td>\n<td>Etcd service port. All the cluster nodes should be able to access this port for the client connection.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>2380</td>\n<td>etcd</td>\n<td>*</td>\n<td>Control plane &lt;-&gt; Control plane</td>\n<td>Etcd service port. All the control plane nodes should be able to access this port for the etcd cluster communication.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>8200</td>\n<td>vault</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane</td>\n<td>Vault port. All the cluster nodes should be able to access this port for the client connection.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>8201</td>\n<td>vault</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane</td>\n<td>Vault port. All the cluster nodes should be able to access this port for peer member connection.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>8443</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>API server port. All the cluster nodes should be able to access this port for the client connection.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10250</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>Kubernete port. All the cluster nodes should be able to access this port for internal communication.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10251</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>Kubernetes port. All the cluster nodes should be able to access this port for the internal communication.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10252</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>Kubernetes port. All the cluster nodes should be able to access this port for internal communication.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10256</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>Kubernetes port. All the cluster nodes should be able to access this port for internal communication.</td>\n</tr>\n<tr>\n<td>\n<p>TCP</p>\n</td>\n<td>\n<p>Client host</p>\n</td>\n<td>\n<p>3000</p>\n</td>\n<td>\n<p>SuiteFronted</p>\n</td>\n<td>*</td>\n<td>All clients -&gt; Ingress Node</td>\n<td>\n<p>The port is exposed on the ingress node. All clients should be able to access this port.</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>TCP</p>\n</td>\n<td>\n<p>Client host &amp; Nodes</p>\n</td>\n<td>\n<p>5443</p>\n</td>\n<td>\n<p>MngPortal</p>\n</td>\n<td>*</td>\n<td>All clients -&gt; Ingress node</td>\n<td>\n<p>The port is exposed on the ingress node. All clients should be able to access this port.</p>\n</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Client host &amp; Nodes</td>\n<td>5444</td>\n<td>MngPortal</td>\n<td>*</td>\n<td>All clients -&gt; Ingress node</td>\n<td>The port is exposed on the ingress node. All nodes should be able to access this port when using 2-way certificate authentication.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>5000</td>\n<td>Local registry</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>All the nodes should be able to access this port to communicate with the local registry.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Client host &amp; Nodes</td>\n<td>443</td>\n<td>SMA portal</td>\n<td>*</td>\n<td>All clients -&gt; Ingress node</td>\n<td>Access to the SMA portal by external clients</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Client host &amp; Control plane node</td>\n<td>22</td>\n<td>ssh</td>\n<td>*</td>\n<td>All clients -&gt; Control plane</td>\n<td>SSH access to nodes by external clients. During the installation, you need to open port 22 from the first control plane node.</td>\n</tr>\n<tr>\n<td>UDP</td>\n<td>Nodes</td>\n<td>8472</td>\n<td>Flannel</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>All cluster nodes should be able to access this port. This port is for communication between worker nodes and control plane nodes when you have configured the FLANNEL_BACKEND_TYPE parameter to vxlan.</td>\n</tr>\n<tr>\n<td colspan=\"1\" rowspan=\"7\">Worker</td>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10248</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Access by localhost only</td>\n<td>Kubernetes port. </td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10249</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Access by localhost only</td>\n<td>Kubernetes port. </td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10250</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>Kubernete port. All the cluster nodes should be able to access this port for internal communication.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10256</td>\n<td>Kubernetes</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>Kubernetes port. All the cluster nodes should be able to access this port for internal communication.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Client host &amp; Control plane node</td>\n<td>22</td>\n<td>ssh</td>\n<td>*</td>\n<td></td>\n<td>SSH access to nodes by external clients. During the installation, you need to access this port from first control plane node. </td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>5000</td>\n<td>Local registry</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>All the nodes should be able to access this port to communicate with the local registry</td>\n</tr>\n<tr>\n<td>UDP</td>\n<td>Nodes</td>\n<td>8472</td>\n<td>\n<p>Flannel</p>\n</td>\n<td>*</td>\n<td>Control plane and worker -&gt; Control plane and worker</td>\n<td>All cluster nodes should be able to access this port. This port is for communication between worker nodes and control plane nodes when you have configured the parameter FLANNEL_BACKEND_TYPE to vxlan.</td>\n</tr>\n<tr>\n<td rowspan=\"3\">NFS</td>\n<td>TCP/NFS UDP/NFS</td>\n<td>Nodes</td>\n<td>111</td>\n<td>NFS</td>\n<td>*</td>\n<td>Control plane and worker -&gt; NFS</td>\n<td>NFS server port. All cluster nodes should be able to access this port.</td>\n</tr>\n<tr>\n<td>TCP/NFS</td>\n<td>Nodes</td>\n<td>2049</td>\n<td>NFS</td>\n<td>*</td>\n<td>Control plane and worker -&gt; NFS</td>\n<td>NFS server port. All the cluster nodes should be able to access this port.</td>\n</tr>\n<tr>\n<td>TCP/NFS</td>\n<td>Nodes</td>\n<td>20048</td>\n<td>NFS</td>\n<td>*</td>\n<td>Control plane and worker -&gt; NFS</td>\n<td>NFS server port. All the cluster nodes should be able to access this port.</td>\n</tr>\n<tr>\n<td>Postgres</td>\n<td>TCP</td>\n<td>Nodes</td>\n<td>External database port</td>\n<td>postgres</td>\n<td>*</td>\n<td></td>\n<td>Access to the postgres server by all nodes</td>\n</tr>\n<tr>\n<td>SMTP Server</td>\n<td>\n<p>TCP</p>\n</td>\n<td>Nodes</td>\n<td>25/465/587</td>\n<td>smtp</td>\n<td>*</td>\n<td></td>\n<td>SMTP Server</td>\n</tr>\n</tbody>\n</table>\n<p class=\"mw-headline\"><br/>\nYou can run the following command to check whether a port is in use or not:<br/>\n<code>netstat -antp | grep &lt;<i>port_number_to_check</i>&gt;</code></p>\n<ul>\n<li>For all the listed ports except 111, 2049, and 20048, if the return value shows that the port is being listened by an application, this port is occupied. Contact your IT administrator to stop the application so that the port isn't blocked. If there is no return value, the port is available.</li>\n<li>For the listed ports for the NFS server,  three ports (111, 2049, and 20048) are listened by the NFS services if you have already set up the NFS server. Run command <code>cat /etc/services |grep -e rpcbind -e \"Network File System\" -e mountd</code> to check which NFS services are listening on these ports. Your output resembles the following:          \n\t<pre><code>[root@sh~]# cat /etc/services |grep -e rpcbind -e  \"Network File System\" -e mountd\nsunrpc          111/tcp         portmapper rpcbind      # RPC 4.0 portmapper TCP\nsunrpc          111/udp         portmapper rpcbind      # RPC 4.0 portmapper UDP\nnfs             2049/tcp        nfsd shilp      # Network File System\nnfs             2049/udp        nfsd shilp      # Network File System\nnfs             2049/sctp       nfsd shilp      # Network File System\nmountd          20048/tcp               # NFS mount protocol\nmountd          20048/udp               # NFS mount protocol\nnfsrdma         20049/tcp               # Network File System (NFS) over RDMA\nnfsrdma         20049/udp               # Network File System (NFS) over RDMA\nnfsrdma         20049/sctp              # Network File System (NFS) over RDMA</code></pre>\n\tMake sure the ports are occupied by the NFS services are shown as above: 2049 (<b>nfs</b>), 20048 (<b>mountd</b>), and 111 (<b>portmapper</b>). If not, contact your IT administrator to stop the application, so that the port isn't blocked. If there is no return value, the port is available.</li>\n</ul>\n<h3 class=\"mw-headline\" id=\"Ports_for_outbound_connections\"><br/>\nPorts for outbound connections</h3>\n<p>In general, the inbound rules above should be good enough in terms of security. If you have a more strict security policy, you can set <b>outbound</b> rules in your firewall according to the following table.</p>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Protocol</th>\n<th>Target server</th>\n<th>Port</th>\n<th>Service</th>\n<th>Description</th>\n</tr>\n<tr>\n<td colspan=\"1\" rowspan=\"18\">Control plane &amp; worker</td>\n<td>TCP</td>\n<td>Nodes</td>\n<td>4001</td>\n<td>etcd</td>\n<td>Etcd service port for client connection</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Control plane</td>\n<td>2380</td>\n<td>etcd</td>\n<td>Etcd service port for etcd cluster communication</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>8200</td>\n<td>vault</td>\n<td>Vault port for client connection</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>8201</td>\n<td>vault</td>\n<td>Vault port for peer member connection</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>8443</td>\n<td>Kubernetes</td>\n<td>API server port for internal communication</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10250</td>\n<td>Kubernetes</td>\n<td>Kubernete port for internal communication</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10251</td>\n<td>Kubernetes</td>\n<td>Kubernete port for internal communication</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10252</td>\n<td>Kubernetes</td>\n<td>Kubernete port for internal communication</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Nodes</td>\n<td>10256</td>\n<td>Kubernetes</td>\n<td>Kubernete port for internal communication</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Client host &amp; Nodes</td>\n<td>22</td>\n<td>ssh</td>\n<td>SSH access to nodes by external clients.</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Client host &amp; Nodes</td>\n<td>5443</td>\n<td>OMT management portal</td>\n<td>Access to the OMT management portal by external clients</td>\n</tr>\n<tr>\n<td>TCP</td>\n<td>Client host &amp; Nodes</td>\n<td>443</td>\n<td> SMA portal</td>\n<td>Access to SMA portal by external clients </td>\n</tr>\n<tr>\n<td>\n<p>TCP</p>\n</td>\n<td>\n<p>Database Server</p>\n</td>\n<td>\n<p>External database port</p>\n</td>\n<td>\n<p>database</p>\n</td>\n<td>\n<p>Access database</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>TCP</p>\n</td>\n<td>\n<p>NFS/EFS</p>\n</td>\n<td>\n<p>2049</p>\n</td>\n<td>\n<p>NFS</p>\n</td>\n<td>\n<p>Access NFS</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>UDP</p>\n</td>\n<td>Nodes</td>\n<td>\n<p>8472</p>\n</td>\n<td>\n<p>Flannel</p>\n</td>\n<td>\n<p>Flannel port for internal communication </p>\n</td>\n</tr>\n<tr>\n<td>\n<p>TCP</p>\n</td>\n<td>SMTP Server</td>\n<td>25/465/587</td>\n<td>smtp</td>\n<td>\n<p>Connect to the SMTP server</p>\n</td>\n</tr>\n<tr>\n<td>\n<p>TCP</p>\n</td>\n<td>\n<pre>*.google.com &amp; *.googleapis.com\n</pre>\n</td>\n<td>\n<p>5228-5230</p>\n</td>\n<td> Notification</td>\n<td>To use google notification. For more details:<br/>\n<a class=\"external free\" href=\"https://firebase.google.com/docs/cloud-messaging/concept-options#messaging_ports_and_your_firewall\" rel=\"nofollow\" target=\"1\" title=\"external link\">https://firebase.google.com/docs/cloud-messaging/concept-options#messaging_ports_and_your_firewall</a></td>\n</tr>\n<tr>\n<td>UDP</td>\n<td>DNS Server</td>\n<td>53</td>\n<td>DNS</td>\n<td>For connection from coredns to the external DNS Server</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"Enable_masquerade_setting_when_a_firewall_is_enabled\">Enable masquerade setting when a firewall is enabled</h2>\n<p style=\"text-align:start; margin-bottom:12px\"><span style=\"font-size:15px\"><span style=\"font-weight:400\"><span style=\"font-style:normal\"><span style=\"line-height:inherit !important\"><span style=\"letter-spacing:0.2px\"><span style=\"color:rgba(0, 0, 0, 0.87)\"><span style='font-family:Roboto, \"Helvetica Neue\", sans-serif'><span style=\"font-variant-ligatures:normal\"><span style=\"white-space:normal\"><span style=\"background-color:#ffffff\"><span style=\"text-decoration-thickness:initial\"><span style=\"text-decoration-style:initial\"><span style=\"text-decoration-color:initial\">You must enable the masquerade settings only when the firewall is enabled.<br/>\nPerform the following steps to enable masquerade settings on all control plane nodes and worker nodes when the firewall is enabled.<br/>\nRun the following command to check whether the masquerade setting is enabled:</span></span></span></span></span></span></span></span></span></span></span></span></span><br/>\n<code>firewall-cmd --query-masquerade</code></p>\n<ul>\n<li>If the returned value is \"FirewallD isn't running\", the firewall isn't enabled. You don't need to perform the following steps.</li>\n<li>If the returned value is \"yes\", then the masquerade is enabled.</li>\n<li>If the returned value is \"no\", run the following commands to enable masquerade in the firewall.<br/>\n<code>firewall-cmd --add-masquerade --permanent<br/>\n\tfirewall-cmd --reload</code></li>\n</ul>\n<h2 id=\"Enable_vrrp_protocol_for_Keepalived_in_a_multiple-control_plane_node_deployment_when_a_firewall_is_enabled\" tabindex=\"-1\">Enable vrrp protocol for Keepalived in a multiple-control plane node deployment when a firewall is enabled</h2>\n<p style=\"text-align:start; margin-bottom:12px\"><span style=\"font-size:15px\"><span style=\"font-weight:400\"><span style=\"font-style:normal\"><span style=\"line-height:inherit !important\"><span style=\"letter-spacing:0.2px\"><span style=\"color:rgba(0, 0, 0, 0.87)\"><span style='font-family:Roboto, \"Helvetica Neue\", sans-serif'><span style=\"font-variant-ligatures:normal\"><span style=\"white-space:normal\"><span style=\"background-color:#ffffff\"><span style=\"text-decoration-thickness:initial\"><span style=\"text-decoration-style:initial\"><span style=\"text-decoration-color:initial\">If you want to set up a multiple-control plane node HA environment by setting the </span></span></span></span></span></span></span></span></span></span></span></span></span><code>HA_VIRTUAL_IP</code><span style=\"font-size:15px\"><span style=\"font-weight:400\"><span style=\"font-style:normal\"><span style=\"line-height:inherit !important\"><span style=\"letter-spacing:0.2px\"><span style=\"color:rgba(0, 0, 0, 0.87)\"><span style='font-family:Roboto, \"Helvetica Neue\", sans-serif'><span style=\"font-variant-ligatures:normal\"><span style=\"white-space:normal\"><span style=\"background-color:#ffffff\"><span style=\"text-decoration-thickness:initial\"><span style=\"text-decoration-style:initial\"><span style=\"text-decoration-color:initial\"><code style=\"font-size:0.866666em; color:#323435; font-family:Inter-Regular; font-weight:400; padding:0px; border-radius:3px; border:none; word-break:break-word\"> </code>parameter<font face=\"monospace\"> </font>in the</span></span></span></span></span></span></span></span></span></span></span></span></span><code> install.properties</code><span style=\"font-size:15px\"><span style=\"font-weight:400\"><span style=\"font-style:normal\"><span style=\"line-height:inherit !important\"><span style=\"letter-spacing:0.2px\"><span style=\"color:rgba(0, 0, 0, 0.87)\"><span style='font-family:Roboto, \"Helvetica Neue\", sans-serif'><span style=\"font-variant-ligatures:normal\"><span style=\"white-space:normal\"><span style=\"background-color:#ffffff\"><span style=\"text-decoration-thickness:initial\"><span style=\"text-decoration-style:initial\"><span style=\"text-decoration-color:initial\"><code style=\"font-size:0.866666em; color:#323435; font-family:Inter-Regular; font-weight:400; padding:0px; border-radius:3px; border:none; word-break:break-word\"> </code>file, make sure the </span></span></span></span></span></span></span></span></span></span></span></span></span><code>vrrp</code><span style=\"font-size:15px\"><span style=\"font-weight:400\"><span style=\"font-style:normal\"><span style=\"line-height:inherit !important\"><span style=\"letter-spacing:0.2px\"><span style=\"color:rgba(0, 0, 0, 0.87)\"><span style='font-family:Roboto, \"Helvetica Neue\", sans-serif'><span style=\"font-variant-ligatures:normal\"><span style=\"white-space:normal\"><span style=\"background-color:#ffffff\"><span style=\"text-decoration-thickness:initial\"><span style=\"text-decoration-style:initial\"><span style=\"text-decoration-color:initial\"> protocol is enabled when you have enabled the firewall on the node. The </span></span></span></span></span></span></span></span></span></span></span></span></span>vrrp<span style=\"font-size:15px\"><span style=\"font-weight:400\"><span style=\"font-style:normal\"><span style=\"line-height:inherit !important\"><span style=\"letter-spacing:0.2px\"><span style=\"color:rgba(0, 0, 0, 0.87)\"><span style='font-family:Roboto, \"Helvetica Neue\", sans-serif'><span style=\"font-variant-ligatures:normal\"><span style=\"white-space:normal\"><span style=\"background-color:#ffffff\"><span style=\"text-decoration-thickness:initial\"><span style=\"text-decoration-style:initial\"><span style=\"text-decoration-color:initial\"> protocol is used by Keepalived to support virtual IP.</span></span></span></span></span></span></span></span></span></span></span></span></span> In most default settings, the vrrp protocol is enabled. If you have used some custom settings for the server or if Keepalived doesn't work well, run the following command on the node to enable the vrrp protocol:<br/>\n<code>firewall-cmd --add-protocol vrrp<br/>\nfirewall-cmd --reload</code></p>\n<h2 class=\"mw-headline\" id=\"Example:_Enable_a_firewall_for_inbound_connections\">Example: Enable a firewall for inbound connections</h2>\n<p>For your reference, the following steps use firewalld as an example.</p>\n<h3 id=\"Step_1:_Enable_firewalld_on_each_master,_worker,_or_NFS_server\"><span class=\"mw-headline\" id=\"Step_1:_Enable_firewalld_on_each_master.2C_worker.2C_or_NFS_server\">Step 1: Enable firewalld on each control plane node, worker node, or NFS server</span></h3>\n<p>Run the following commands on all of the control plane nodes, worker nodes, and NFS server(s):</p>\n<pre># systemctl start firewalld\n# systemctl enable firewalld\n</pre>\n<h3 id=\"Step_2:_Block_all_inbound_connections_on_each_master,_worker,_or_NFS_server\"><span class=\"mw-headline\" id=\"Step_2:_Block_all_inbound_connections_on_each_master.2C_worker.2C_or_NFS_server\">Step 2: Block all inbound connections on each control plane node, worker node, or NFS server</span></h3>\n<p>Run the following commands on all of the control plane nodes, worker nodes, and NFS server(s):</p>\n<pre># firewall-cmd --permanent --zone=public --set-target=DROP\n# firewall-cmd --reload\n</pre>\n<h3 class=\"mw-headline\" id=\"Step_3:_Enable_k8s_networking_on_each_master_or_worker\">Step 3: Enable k8s networking on each control plane node or worker</h3>\n<p>Run the following commands on all of the control plane nodes and worker nodes:</p>\n<pre># firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 1 -o docker0 -j ACCEPT -m comment --comment \"docker subnet\"\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 1 -i docker0 -j ACCEPT -m comment --comment 'kube-proxy redirects'\n# firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 1 -o cni0 -j ACCEPT -m comment --comment \"flannel subnet\"\n# firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 1 -i cni0 -j ACCEPT -m comment --comment \"flannel subnet\" \n# firewall-cmd --permanent --direct --add-rule ipv4 nat POSTROUTING 1 -s 172.16.0.0/16 ! -d 172.16.0.0/16 -j MASQUERADE\n</pre>\n<p>Where: 172.16.0.0/16 is the default value of the <b>POD_CIDR</b> parameter in the <code>install.properties</code> file. Change it if you use a different value.</p>\n<h3 class=\"mw-headline\" id=\"Step_4:_Open_the_internal_ports_on_each_master_or_worker\">Step 4: Open the internal ports on each control plane node or worker node</h3>\n<p>The following ports are for k8s internal communications and must be handled differently. Note that these ports are highlighted in the table of inbound connection ports above. 8472 is a UDP port, and the rest of them are TCP ports.</p>\n<ul>\n<li>For control plane nodes: 4001 8200 8201 2380 8443 10250 10251 10252 10255 8472</li>\n<li>For worker nodes: 10250 10251 10252 10255 8472</li>\n</ul>\n<p>For example, perform the following steps on each control plane node for port 4001 (the steps for the other internal ports are similar):</p>\n<ol>\n<li>Run the following commands to configure inbound rules for two internal IP addresses:\n\t<pre># firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"127.0.0.1\" port protocol=\"tcp\" port=\"4001\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"172.16.0.0/16\" port protocol=\"tcp\" port=\"4001\" accept\"\n</pre>\n<div class=\"Admonition_Note\"><span class=\"autonumber\">Note</span>\n<p>172.16.0.0/16 is the default value of the <b>POD_CIDR</b> parameter in the <b>install.properties</b> file. If you defined a different value, change it to your value.</p>\n</div>\n</li>\n<li>Run the following commands to configure inbound rules for all of the control plane nodes and worker nodes (using three control plane nodes and n worker nodes for example):\n\t<pre># firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 1 IP&gt;\" port protocol=\"tcp\" port=\"4001\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 2 IP&gt;\" port protocol=\"tcp\" port=\"4001\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 3 IP&gt;\" port protocol=\"tcp\" port=\"4001\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;worker node 1 IP&gt;\" port protocol=\"tcp\" port=\"4001\" accept\"\n... \n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;worker node n IP&gt;\" port protocol=\"tcp\" port=\"4001\" accept\"\n</pre>\n</li>\n</ol>\n<h3 id=\"Step_5:_Open_the_remaining_ports_on_each_master,_worker,_or_NFS_server\"><span class=\"mw-headline\" id=\"Step_5:_Open_the_remaining_ports_on_each_master.2C_worker.2C_or_NFS_server\">Step 5: Open the remaining ports on each control plane node, worker node, or NFS server</span></h3>\n<p>The remaining ports aren't for k8s internal communications and aren't highlighted in the table of ports for inbound connections:</p>\n<ul>\n<li>For control plane nodes: 3000 5443 5444 5000 443 22</li>\n<li>For worker nodes: 22</li>\n<li>For NFS servers: 111 2049 20048</li>\n</ul>\n<p>All of these ports are TCP ports except that 111 is also a UDP port. The following are examples of how to open these ports on a server.</p>\n<div class=\"Admonition_Note\"><span class=\"autonumber\">Note</span>\n<p>You need to run the <code>firewall-cmd --reload</code> command to make your settings take effect.</p>\n</div>\n<p><i><b>Example 1: On the NFS server, enable inbound connections from all nodes to the UDP/TCP port 111</b></i></p>\n<p>Run the following commands to enable UDP port 111:</p>\n<pre># firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 1 IP&gt;\" port protocol=\"udp\" port=\"111\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 2 IP&gt;\" port protocol=\"udp\" port=\"111\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 3 IP&gt;\" port protocol=\"udp\" port=\"111\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;worker node 1 IP&gt;\" port protocol=\"udp\" port=\"111\" accept\"\n...\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;worker node n IP&gt;\" port protocol=\"udp\" port=\"111\" accept\"\n</pre>\n<p>Run the following commands to enable TCP port 111:</p>\n<pre># firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 1 IP&gt;\" port protocol=\"tcp\" port=\"111\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 2 IP&gt;\" port protocol=\"tcp\" port=\"111\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 3 IP&gt;\" port protocol=\"tcp\" port=\"111\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;worker node 1 IP&gt;\" port protocol=\"tcp\" port=\"111\" accept\"\n...\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;worker node n IP&gt;\" port protocol=\"tcp\" port=\"111\" accept\"\n</pre>\n<p><i><b>Example 2: On a control plane node, enable inbound connections from each client host and all k8s nodes to TCP port 443</b></i></p>\n<p>If you want to allow any remote machines to access this port, you can use the following command:</p>\n<pre># firewall-cmd --permanent --zone=public --add-port=443/tcp</pre>\n<p>Alternatively, you can use the following commands to allow inbound connections to TCP port 443 from only the specified source addresses:</p>\n<pre># firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 1 IP&gt;\" port protocol=\"tcp\" port=\"443\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 2 IP&gt;\" port protocol=\"tcp\" port=\"443\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;control plane node 3 IP&gt;\" port protocol=\"tcp\" port=\"443\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;worker node 1 IP&gt;\" port protocol=\"tcp\" port=\"443\" accept\"\n...\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;worker node n IP&gt;\" port protocol=\"tcp\" port=\"443\" accept\"\n# firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"&lt;IP address of client host&gt;\" port protocol=\"tcp\" port=\"443\" accept\"\n</pre>\n<h3 class=\"mw-headline\" id=\"Step_6:_Open_the_required_ports_on_the_PostgreSQL_database_server_and_email_server\">Step 6: Open the required ports on the PostgreSQL database server and email server</h3>\n<p>Make sure that the required ports are open. For details, see the table of ports for inbound connections.</p>\n<h3 class=\"mw-headline\" id=\"Step_7:_Verify_the_firewall_settings\">Step 7: Verify the firewall settings</h3>\n<p>You can use one of the following commands to check if a port is open on a host (ports 5443 and 22 are used here for example):</p>\n<ul>\n<li>https:<br/>\n<code>curl -v -k https://&lt;hostname&gt;:5443</code></li>\n<li>http:<br/>\n<code>curl -v &lt;hostname&gt;:22</code></li>\n</ul>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}