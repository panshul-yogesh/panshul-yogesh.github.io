{
  "title": "Enable TLS connections to external PostgreSQL",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-EnableTlsExternalPostgreSQL||N\"></span><p class=\"mw-empty-elt\">\n</p><p>When sending a TLS connection request to an external PostgreSQL/AlloyDB Omni server that has TLS enabled, UD/UCMDB acts as a client. To enable UD/UCMDB to connect to the external PostgreSQL/AlloyDB Omni server through TLS, you must import the PostgreSQL/AlloyDB Omni CA certificate into UD/UCMDB. This can be done either during or after the UD/UCMDB installation.</p>\n<p>This topic describes how to enable PostgreSQL/AlloyDB Omni TLS connections when installing UD/UCMDB or after UD/UCMDB is installed.</p>\n<p>Additionally, this topic also describes how to replace the PostgreSQL/AlloyDB Omni CA certificate file in UD/UCMDB when the certificate is about to expire or is no longer valid.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">The PostgreSQL/AlloyDB Omni CA certificate (for example, <b>PG_CA.crt</b>) must be in <b>PEM</b> format. The CA certificate can be single-level or multi-level. If multi-level, the CA certificate must include the entire CA certificate chain (the root CA certificate and all intermediate CA certificates).<br/>\n<p><code>cat thirdCA.crt&gt;&gt;PG_CA.crt<br/>\ncat secondCA.crt&gt;&gt;PG_CA.crt<br/>\ncat rootCA.crt&gt;&gt;PG_CA.crt</code>\n</p>\n<p>The screenshot below is an example of a multi-level CA certificate chain:</p>\n<div><a class=\"image\" href=\"/file/images/1/19/ca-cert.png\" title=\"/file/images/1/19/ca-cert.png\"> <img alt=\"ca-cert\" src=\"../../../images/ca-cert_a92eace4.png\"/> </a></div>\n</div>\n</div>\n<h2>Obtain the PostgreSQL/AlloyDB Omni CA certificate</h2>\n<p>Follow the instructions on how to obtain the PostgreSQL/AlloyDB Omni CA certificate for your PostgreSQL/AlloyDB Omni server according to its deployment platform.</p>\n<h3>On-premises</h3>\n<p>When the PostgreSQL/AlloyDB Omni server is on-premises, use the CA certificate that you configure when enabling TLS for the PostgreSQL/AlloyDB Omni server.</p>\n<h3>AWS</h3>\n<p>Download a root certificate that works for all AWS Regions from the <a href=\"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html\" title=\"Amazon Relational Database Service\">Amazon Relational Database Service</a> website.</p>\n<h2>Prepare UD/UCMDB configuration with connection to external PostgreSQL/AlloyDB Omni through TLS</h2>\n<p>In your UD/UCMDB configuration file (the custom <strong>my-</strong><b>values.yaml</b>), insert the following parameters.</p>\n<div>\n<table>\n<thead>\n<tr>\n<th>Parameter</th>\n<th>Description</th>\n<th>Example</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><b>global.database.tlsEnabled</b></td>\n<td>Enable TLS connection to database server.</td>\n<td><b>true</b></td>\n</tr>\n<tr>\n<td><b>caCertificates</b></td>\n<td>The content of the database server CA<br/>\n<p>\t\t\tcertificate encoded by base64.<br/>\n\t\t\t <br/>\n\t\t\tRun the following command on a Linux<br/>\n\t\t\tsystem to encode the CA certificate:<br/>\n</p>\n<code>base64 &lt; pg-ca.pem</code></td>\n<td>\n<p>Example:</p>\n<p>caCertificates:<br/>\n\t\t\t  postgresql.crt: |<br/>\n\t\t\t    &lt;certificate content<br/>\n\t\t\t    base64 encoded&gt;<br/>\n\t\t\t  probe-postgresql.crt: |<br/>\n\t\t\t    &lt;certificate content<br/>\n\t\t\t    base64 encoded&gt;<br/>\n<br/>\n\t\t\tSee the screenshot below.</p>\n</td>\n</tr>\n<tr>\n<td><b>ucmdbserver.deployment.<br/>\n\t\t\tdatabase.tlsCert</b></td>\n<td>(Required when <b>tlsEnabled </b>is <b>true</b>) The<br/>\n<p>\t\t\tname of the key for the PostgreSQL/AlloyDB Omni<br/>\n\t\t\tcertificate defined in the <b>caCertificates </b><br/>\n</p>\n\t\t\tparameter.</td>\n<td> postgresql.crt</td>\n</tr>\n<tr>\n<td><b>ucmdbprobe.deployment.<br/>\n\t\t\tdatabase.tlsCert</b></td>\n<td>\n<p>(Required when <b>tlsEnabled </b>is <b>true</b>) The<br/>\n\t\t\tname of the key for the external PostgreSQL/AlloyDB Omni  <br/>\n\t\t\tdatabase certificate defined in the <b>caCertificates </b><br/>\n\t\t\tparameter.</p>\n</td>\n<td>probe-postgresql.crt</td>\n</tr>\n</tbody></table>\n<p><br/>\n</p>\n<a class=\"image\" href=\"/file/images/f/fd/cms2020.08_CaCertExample.PNG\" title=\"/file/images/f/fd/cms2020.08_CaCertExample.PNG\"> <img alt=\"cms2020\" src=\"../../../images/cms2020.08_CaCertExample_3984ce35.PNG\"/> </a></div>\n<h2>Enable TLS connections to external PostgreSQL/AlloyDB Omni during the UD/UCMDB installation</h2>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">\n<ul>\n<li>Before you proceed, make sure that you have already enabled TLS on the PostgreSQL/AlloyDB Omni server.</li>\n<li>Before you proceed, make sure that you have prepared a UD/UCMDB configuration file with connection to external PostgreSQL/AlloyDB Omni through TLS</li>\n</ul>\n</div>\n</div>\n<p>Follow the installation guide to deploy UD/UCMDB with TLS connections to the external PostgreSQL/AlloyDB Omni databases.</p>\n<h2>Enable TLS connections to external PostgreSQL/AlloyDB Omni after the UD/UCMDB installation</h2>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">\n<ul>\n<li>Before you proceed, make sure that you have already enabled TLS on the PostgreSQL/AlloyDB Omni server.</li>\n<li>Before you proceed, make sure that you have prepared a UD/UCMDB configuration file with connection to external PostgreSQL/AlloyDB Omni through TLS.</li>\n<li>This operation will cause system downtime. Perform this operation in a planned maintenance window.</li>\n</ul>\n</div>\n</div>\n<p>On the control plane node, run the following command:</p>\n<pre>helm upgrade &lt;<em>UD/UCMDB RELEASE NAME</em>&gt; &lt;<em>UD/UCMDB CHART FILE</em>&gt; --namespace &lt;<em>NAMESPACE</em>&gt; -f &lt;<em>VALUES YAML FILE</em>&gt;</pre>\n<p>Where,</p>\n<ul>\n<li><code>&lt;<em>UD/UCMDB RELEASE NAME</em>&gt;</code> is the release name of the UD/UCMDB deployment.</li>\n<li><code>&lt;<em>UD/UCMDB CHART FILE</em>&gt;</code> is the tar file containing the UD/UCMDB installation charts.</li>\n<li><code>&lt;<em>NAMESPACE</em>&gt;</code> is the namespace where UD/UCMDB is deployed.</li>\n<li><code>&lt;<em>VALUES YAML FILE</em>&gt;</code> is the custom <strong>my-</strong><b>values.yaml</b> file with properties configured for the UD/UCMDB deployment.</li>\n</ul>\n<p>For example:</p>\n<pre>helm upgrade ucmdb-prod ucmdb-helm-charts/charts/cms-<span class=\"_MF_Product_Version\">202x.xx</span>.xxx.tgz --namespace ucmdb-prod -f my-values.yaml</pre>\n<h2>Replace the PostgreSQL/AlloyDB Omni CA certificate in UD/UCMDB</h2>\n<p>If you want to replace the PostgreSQL/AlloyDB Omni CA certificate because it is about to expire or no longer valid, follow these steps:</p>\n<ol>\n<li>Update the UD/UCMDB configuration file to replace the PostgreSQL/AlloyDB Omni CA certificate as described in the <em>Prepare UD/UCMDB configuration with connection to external PostgreSQL</em><i>/AlloyDB</i> Omni <em> through TLS</em> section above.</li>\n<li>Follow the instructions in the <em>Enable TLS connections to external PostgreSQL/AlloyDB Omni after the UD/UCMDB installation</em> section above.</li>\n<li>Restart UD/UCMDB. See <a href=\"/doc/403/25.1/restartcms\" title=\"Restart UD/UCMDB\">Restart UD/UCMDB</a>.</li>\n</ol>\n<p><br/>\n</p><p><br/>\n</p>\n<p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-EnableTlsExternalPostgreSQL||N\"></span></div><p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}