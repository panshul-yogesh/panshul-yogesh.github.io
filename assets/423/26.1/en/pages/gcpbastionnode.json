{
  "title": "Configure bastion node",
  "content": "<div class=\"mw-parser-output\">\n<div></div>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>IT / Server administrator</td>\n<td>GCP Console</td>\n</tr>\n</tbody>\n</table>\n<p>A bastion node communicates with the GKE cluster and you can use it for suite deployment and troubleshooting. Follow these steps to create a bastion node:</p>\n<ol style=\"padding-left: 0px;\">\n<li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to the Google Cloud Platform Console at <a class=\"external free\" href=\"https://console.cloud.google.com/\" rel=\"nofollow\" target=\"1\" title=\"https://console.cloud.google.com/\">https://console.cloud.google.com/</a>.</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Compute Engine</b> &gt; <b>VM instances</b> &gt; <b>CREATE INSTANCE</b>.</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Give the VM a name and populate the following fields:\n\t<ul style=\"padding-left: 0px;\">\n<li style=\"margin-left: 40px; position: relative;\"><b>Region</b>: Select the same region as the prepared VPC.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Zone</b>: Select a zone from the drop-down list.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Machine type</b>: See <a href=\"/doc/423/26.1/gcpsizing#Hardware_requirements_for_bastion\" title=\"Sizing guide\">Sizing guide</a>.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Boot disk</b>: Click <b>Change</b> and update the settings as recommended in <a href=\"/doc/423/26.1/gcpsizing#Hardware_requirements_for_bastion\" title=\"Sizing guide\">Sizing guide</a>.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Identity and API access</b>: Select <b>Compute Engine default service account</b> and <b>Allow full access to all Cloud APIs</b>.</li>\n</ul>\n</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>Networking, disks, security, Management, sole tenancy</b> &gt; <b>Networking</b> and configure network settings as follows:\n\t<ul style=\"padding-left: 0px;\">\n<li style=\"margin-left: 40px; position: relative;\"><b>Network tags</b>: Give a tag name to this VM. For example, <em>bastion</em>.</li>\n<li style=\"margin-left: 40px; position: relative;\">Under <b>Network interfaces</b>, click the arrow down icon  <a class=\"image\" href=\"\"> <img alt=\"GetImageArrow\" border=\"0\" file=\"/mediawiki/images/0/01/GetImageArrow.png\" hspace=\"0\" src=\"../../../images/GetImageArrow_3c9e7e87.png\" style=\"width:37px;height:35px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\"/> </a>  to change the following settings of the default network interface:\n\t\t<ul style=\"padding-left: 0px;\">\n<li style=\"margin-left: 52px; position: relative;\"><b>Network</b>: Select the prepared VPC.</li>\n<li style=\"margin-left: 52px; position: relative;\"><b>Subnetwork</b>: Select the subnet prepared for the bastion.</li>\n<li style=\"margin-left: 52px; position: relative;\"><b>Network Service Tier:</b> Select <strong>Network Service Tier</strong>. Note that some VPC regions don't support <strong>Standard </strong>Network Service Tier. <strong>Premium </strong>and <strong>Standard </strong>tiers vary in performance, latency, and cost. For more information, see the GCP document <a class=\"external text\" href=\"https://cloud.google.com/network-tiers/docs/overview\" rel=\"nofollow\" target=\"1\" title=\"Network tier overview\">Network tier overview</a>.</li>\n<li style=\"margin-left: 52px; position: relative;\"><b>External IPv4 address</b>: Select Create IP <strong>address</strong>. In the pop-up window, name the new IP, and click <strong>RESERVE</strong>.<span style=\"display: none;\"> </span></li>\n</ul>\n</li>\n</ul>\n</li>\n<li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Leave the remaining settings as is and click <b>Create</b>.</li>\n</ol>\n<p>After the VM is created successfully, you can connect to the VM using the Google Cloud Platform Console or a third-party tool.</p>\n<h2 class=\"mw-headline\" id=\"Open_firewall_to_bastion\"><a id=\"Open-firewall-to-bastion-node\" name=\"Open-firewall-to-bastion-node\" title=\"Open firewall to bastion node\"></a>Open firewall to bastion node</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>IT / Network administrator</td>\n<td>GCP Console</td>\n</tr>\n</tbody>\n</table>\n<p>To allow SSH access to the bastion node, you need to set up an Ingress firewall rule with the steps below:</p>\n<ol style=\"padding-left: 0px;\">\n<li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Collect the bastion's network tag by navigating to <b>Computer Engine</b> &gt; <b>VM instances</b>. Click the created bastion. On the <b>Details</b> page, write down the bastion's <b>Network tag</b>.</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <b>VPC network</b> &gt; <b>Firewall </b>&gt; <b>CREATE FIREWALL RULE</b>.</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Name this rule and populate the following fields:\n\t<ul style=\"padding-left: 0px;\">\n<li style=\"margin-left: 40px; position: relative;\"><b>Network</b>: Select the VPC you created.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Direction of traffic</b>: Select <b>Ingress</b>.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Action on match</b>: Select <b>Allow</b>.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Targets</b>: Select <b>Specified target tags</b>.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Target tags</b>: Type the bastion's network tag collected in step 1.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Source IP ranges</b>: When connecting from an external SSH client, you may restrict this source IP range to where you can connect with ensured security.</li>\n<li style=\"margin-left: 40px; position: relative;\"><b>Protocol and ports</b>: Select <b>Specified protocols and ports</b>, check <b>tcp</b>, and type <b>22</b> as the port.</li>\n</ul>\n</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Leave the remaining settings as is and click <b>CREATE</b>.</li>\n</ol>\n<h2 class=\"mw-headline\" id=\"Configure_bastion_node\"><a id=\"Configure-bastion-node\" name=\"Configure-bastion-node\" title=\"Configure bastion node\"></a>Configure bastion node</h2>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>IT / Server administrator</td>\n<td>Bastion node</td>\n</tr>\n</tbody>\n</table>\n<p>To get the bastion node ready for the suite installation, follow these steps:</p>\n<ol style=\"padding-left: 0px;\">\n<li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to the bastion node using SSH. You can use the GCP Console or a third-party tool.</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to install <strong>kubectl</strong>, the commandline tool.\n\t<pre>sudo yum install -y kubectl</pre>\n</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following commands to install and initialize Google SDK with the Compute Engine default service account. Remember to select the Compute Engine default service account when asked.\n\t<pre>sudo yum install -y google-cloud-sdk\ngcloud init</pre>\n</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"> Install auth plugin\n\t<pre><code>sudo yum install google-cloud-sdk-gke-gcloud-auth-plugin</code></pre>\n</li>\n<li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following commands to set up kubectl access to your cluster.\n\t<pre>gcloud config set project &lt;project_id&gt;\ngcloud container clusters get-credentials --region &lt;region&gt; &lt;gke_cluster_name&gt;</pre>\n\twhere:\n\n\t<ul style=\"padding-left: 0px;\">\n<li style=\"margin-left: 40px; position: relative;\"><strong>&lt;project_id&gt;</strong> is your own project ID.</li>\n<li style=\"margin-left: 40px; position: relative;\"><strong>&lt;region&gt;</strong> is the region of the created Kubernetes cluster.</li>\n<li style=\"margin-left: 40px; position: relative;\"><strong>&lt;gke_cluster_name&gt;</strong> is the name of the created Kubernetes cluster.</li>\n</ul>\n</li>\n<li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following commands to test Kubernetes access.\n\t<pre>kubectl get nodes\nkubectl get pods --all-namespaces</pre>\n</li>\n<li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following commands to install Docker.\n\t<pre>sudo yum install -y yum-utils\nsudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nsudo yum install -y docker-ce docker-ce-cli containerd.io</pre>\n</li>\n<li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following commands to enable Docker and empower to run Docker commands as non-root.\n\t<pre>sudo groupadd docker\nsudo usermod -a -G docker ${USER}\nsudo systemctl start docker\nsudo systemctl enable docker</pre>\n</li>\n<li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log out and log in again to the bastion to enable the Docker group.</li>\n</ol>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>Do not customize any ClusterRoles (for example, cluster-admin) in the system to avoid potential issues. </div></div></div>\n<p class=\"mw-headline\">If you experience issues connecting to the bastion node, refer to <a href=\"/doc/423/26.1/noconnectgkefrombastion\" target=\"_blank\" title=\"Not able to connect to bastion\">Not able to connect to bastion</a> for more details.</p>\n<h2><a id=\"External-references\" name=\"External-references\" title=\"External references\"></a>External references</h2>\n<ul style=\"padding-left: 0px;\">\n<li style=\"margin-left: 28px; position: relative;\">For bastion node information, see <a class=\"external text\" href=\"https://cloud.google.com/compute/docs/instances/create-start-instance\" rel=\"nofollow\" target=\"1\" title=\"Create and start a VM\">Create and start a VM</a>.</li>\n<li style=\"margin-left: 28px; position: relative;\">For steps of connecting to the bastion node, see <a class=\"external text\" href=\"https://cloud.google.com/compute/docs/instances/connecting-to-instance#gcetools\" rel=\"nofollow\" target=\"1\" title=\"Connect from GCP Console\">Connect from GCP Console</a> or <a class=\"external text\" href=\"https://cloud.google.com/compute/docs/instances/connecting-advanced#thirdpartytools\" rel=\"nofollow\" target=\"1\" title=\"Connect via third-party tool\">Connect via third-party tool</a>.</li>\n<li style=\"margin-left: 28px; position: relative;\">For short-term access token information, see <a class=\"external text\" href=\"https://cloud.google.com/container-registry/docs/advanced-authentication#access_token\" rel=\"nofollow\" target=\"1\" title=\"Access token\">Access token</a>.</li>\n</ul>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}