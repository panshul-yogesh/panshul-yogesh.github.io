{
  "title": "Configure GCP external application load balancer",
  "content": "<div class=\"mw-parser-output\">\n<p>In order to allow external clients to access the Suite services, you should expose the Suite service. This topic describes how to expose the Suite services using with GCP External Load Balancer (LB).</p>\n<h2>Prerequisite<!--cke_bookmark_13863S--><!--cke_bookmark_13863E--></h2>\n<p>Before you deploy the external LB, make sure the following requirements are satisfied:</p>\n<ul>\n<li>You are able to run <code>gcloud </code>and <code>kubectl </code>commands on the bastion node.</li>\n<li>GKE clusters have external Application Load Balancers enabled by default. You must not disable it. </li>\n</ul>\n<h2>Expose Suite services with GKE external LB</h2>\n<ol>\n<li>Reserve a static global IP address for the external LB\n\t<pre><code class=\"language-bash\">gcloud compute addresses create smax-external-lb --global --ip-version IPV4   \ngcloud compute addresses describe smax-external-lb --global --format=\"get(address)\"</code></pre>\n</li>\n<li>Bind the static IP address with the Suite's FQDN (also referred to as the external access host name) in your DNS provider.</li>\n<li>Create an SSL policy that defines the minimum TLS version and the allowed encryption ciphers by running the below command on the bastion node. (This ssl policy can be shared across all ESM products)\n\t<pre><code class=\"language-bash\">gcloud compute ssl-policies create esm-ssl-strict-policy --profile RESTRICTED --min-tls-version 1.2</code></pre>\n</li>\n<li>Copy the following content to a file named <strong>smax-lb-config.yaml</strong> on the bastion node.\n\t<pre><code class=\"language-yaml\">apiVersion: networking.gke.io/v1beta1\nkind: FrontendConfig\nmetadata:\n  name: smax-external-lb-frontendconfig\nspec:\n  sslPolicy: esm-ssl-strict-policy\n  redirectToHttps:\n    enabled: true\n    responseCodeName: MOVED_PERMANENTLY_DEFAULT\n\n---\napiVersion: cloud.google.com/v1\nkind: BackendConfig\nmetadata:\n  name: smax-lb-backendconfig\nspec:\n  timeoutSec: 180\n  healthCheck:\n    checkIntervalSec: 10\n    timeoutSec: 10\n    healthyThreshold: 1\n    unhealthyThreshold: 3\n    type: HTTPS\n    requestPath: /healthz\n    port: 8443</code></pre>\n</li>\n<li>Create the<b> smax-external-lb-frontendconfig</b> FrontendConfig resource.\n\t<pre><code>kubectl create -f smax-lb-config.yaml -n &lt;smax-namespace&gt;</code></pre>\n<!--cke_bookmark_6912S--><!--cke_bookmark_6912E--></li>\n<li>Copy the following content to a file named <strong>smax-external-lb-svc.yaml</strong> on the bastion node. \n\t<pre><code class=\"language-yaml\">apiVersion: v1\nkind: Service\nmetadata:\n  annotations:\n    cloud.google.com/neg: '{\"ingress\": true}'\n    cloud.google.com/backend-config: '{\"ports\": {\"8443\":\"smax-lb-backendconfig\"}}'\n    cloud.google.com/app-protocols: '{\"https-port\":\"HTTPS\"}'\n\n  name: smax-external-lb-svc\nspec:\n  ports:\n  - name: https-port\n    port: 8443\n    protocol: TCP\n    targetPort: 8443\n  selector:\n    app: itom-nginx-ingress\n    app.kubernetes.io/instance: &lt;selector-app-instance&gt;\n    app.kubernetes.io/name: &lt;selector-app-name&gt;\n  sessionAffinity: None\n  type: ClusterIP\n</code></pre>\n</li>\n<li>Update the <strong>smax-external-lb-svc.yaml</strong>  YAML file and replace the <strong>&lt;selector-app-instance&gt;</strong> and <strong>&lt;selector-app-name&gt;</strong> placeholder with values from the deployment. Run the following command to get the values:\n\t<pre><code>kubectl get svc -n &lt;itsma_namespace&gt; itom-ingress-controller-svc -o json |jq .metadata.labels</code></pre>\n<div>In the following sample output, <strong>&lt;selector-app-instance&gt;</strong> value is sma and <strong>&lt;selector-app-name&gt;</strong> value is nginx.\n\n\t<pre><code>{\n  ...\n  \"app.kubernetes.io/instance\": \"sma\",\n  \"app.kubernetes.io/name\": \"nginx\",\n  ...\n}</code></pre>\n</div>\n</li>\n<li>Create the <strong>smax-external-lb-svc</strong> service resource.\n\t<pre><code>kubectl create -f smax-external-lb-svc.yaml -n &lt;smax-namespace&gt;</code></pre>\n<!--cke_bookmark_9713S--><!--cke_bookmark_9713E--></li>\n<li>Copy the following content to a file named <strong>smax-external-lb-ingress.yaml</strong> on the bastion node. <!--cke_bookmark_21999S-->\n<pre><code class=\"language-yaml\">apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: \"sma-external-lb-ing\"\n  annotations:\n    networking.gke.io/v1beta1.FrontendConfig: \"smax-external-lb-frontendconfig\"\n    kubernetes.io/ingress.class: gce\n    kubernetes.io/ingress.global-static-ip-name: \"smax-external-lb\"\n    kubernetes.io/ingress.allow-http: \"false\"\nspec:\n  tls:\n    - secretName: nginx-default-secret\n  rules:\n    - http:\n        paths:\n          - backend:\n              service: \n                name: \"smax-external-lb-svc\"\n                port: \n                  number: 8443\n            path: /*\n            pathType: ImplementationSpecific</code></pre>\n<!--cke_bookmark_21999E--></li>\n<li>Create the <strong>sma-external-lb-ing</strong> ingress resource.\n\t<pre><code>kubectl create -f smax-external-lb-ingress.yaml -n &lt;smax-namespace&gt;</code></pre>\n</li>\n<li>Log in to suite administration interface, for example, <strong><em>https://&lt;external access host name&gt;/bo</em>, </strong> as suite-admin and verify the configuration.</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}