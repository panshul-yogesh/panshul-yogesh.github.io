{
  "title": "Ingress service is pending on GCP after upgrade",
  "content": "<div class=\"mw-parser-output\">\n<p>If you've set up a Layer 7 load balancer to work with the suite deployed on GCP, the <strong>itom-ingress-controller-svc</strong> service is pending after the suite upgrade. You can check the status of the <strong>itom-ingress-controller-svc</strong> service with this command:</p>\n<pre>kubectl get svc --all-namespaces|grep itom-ingress-controller-svc\n</pre>\n<h2>Cause </h2>\n<p>The service type of Ingress is automatically changed from <strong>NodePort</strong> to <strong>LoadBalancer</strong> after the upgrade.</p>\n<h2>Solution</h2>\n<p>To reconfigure the service type of <strong>itom-ingress-controller-svc</strong> back to <strong>NodePort</strong>, follow these steps:</p>\n<ol>\n<li>Edit the <strong>itom-ingress-controller-svc</strong> service YAML file:\n\n\t<ol start=\"1\">\n<li>\n<p>Locate the YAML file in directory <code>&lt;Filestore_server&gt;:/var/vols/itom/itsma/global-volume/yamls_output/2021.05/itom-ingress-x.x.x/yamls/itom-ingress-controller-svc.yaml</code>.</p>\n</li>\n<li>Make sure you set the parameter <code>cloud.google.com/app-protocols</code> to <code>'{\"https-port\":\"HTTPS\"}'</code> so that the service backend uses HTTPS protocol.</li>\n</ol>\n<p>This YAML file should resemble the following example:</p>\n<pre>kind: Service\napiVersion: v1\nmetadata:\n  name: itom-ingress-controller-svc\n  namespace: &lt;suite-namespace&gt;\n  labels:\n    itsmaService: itom-ingress\n    itsmaRelease: \"2021.05\"\n  annotations:\n    cloud.google.com/app-protocols: '{\"https-port\":\"HTTPS\"}'\nspec:\n  selector:\n    app: itom-nginx-ingress\n  type: NodePort\n  ports:\n  - name: \"https-port\"\n    protocol: TCP\n    port: 443\n    targetPort: \"https-svc\"\n</pre>\n</li>\n<li>Run the following commands to recreate the modified YAML file:\n\t<pre>kubectl delete -f itom-nginx-ingress-byok-gcp-svc.yaml\nkubectl create -f itom-nginx-ingress-byok-gcp-svc.yaml\n</pre>\n</li>\n<li>Configure the load balancer health check path:\n\t<ol start=\"1\">\n<li>Log in to the Google Cloud Platform Console at <a href=\"https://console.cloud.google.com/\" rel=\"nofollow\" target=\"1\" title=\"https://console.cloud.google.com/\">https://console.cloud.google.com/</a> and navigate to <b>Network services</b> &gt; <b>Load balancing</b>.</li>\n<li>Click the created load balancer from the list. The load balancer uses the following format:<br/>\n<code>k8s-um-&lt;suite-namespace&gt;-suite-install-ingress-xxxxxxxx</code>.</li>\n<li>On the <b>Details</b> page, on the <b>Backend</b> tab, click <b>Health check</b>.</li>\n<li>On the <b>Health checks</b> page, click <b>Edit</b>, change <b>Request path </b>to <code>/healthz</code> , and click <b>Save</b>.</li>\n<li>It takes several minutes for the change to take effect. You can check whether workers are <b>Healthy</b> on the <b>Backend</b> tab of the Load Balancer details page.</li>\n</ol>\n</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}