{
  "title": "IDOL search may have performance issues because of the unstable content server",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>IDOL search may have the following performance issues when enabling the access filter in DashboardDefinition.</p>\n<ol>\n<li>In the result returned by the <code>kubectl get po -n itsma-xxx</code> command, the status of the saw-dah is 1/2.</li>\n<li>The saw-dah pod <span class=\"mstp_error_4_16_30\">auto-restarts</span> occasionally.</li>\n<li>The search function has poor performance.  For example in the <code>action.log</code> file, you could find many queries that took more than 10 seconds to finish.</li>\n<li>In the <code>action.log</code> file of saw-dah, more than 10% of the queries consist of <code>RLAC-OWNED-BY-GROUP,RLAC-OWNED-BY-PERSON,LAST-UPDATED-BY-PERSON,RLAC-CREATED-BY-PERSON</code>. But since the query line in the <code>action.log</code> file is encoded in URL format, you can use <code>RLAC%2DOWNED%2DBY%2DPERSON</code> or similar pattern to search the file for verification.</li>\n<li>In the application log of DAH, you will find that the status of the content server is very unstable and it affects the DAH server. Many logs can be found as shown below, indicating poor communication between DAH and the content server:\n\t<pre><span id=\"cke_bm_8536S\" style=\"display: none;\"> </span>06/09/2023 11:56:50 [10] 70-Error: Error: Could not connect to engine 1.\n\n06/09/2023 11:58:14 [6] 70-Error: SSL handshake failed: sslAccept returned -1, SSL error 0 in (nil)/(nil): (nil)\n\n06/09/2023 11:58:20 [5] 70-Error: SSL handshake failed: sslAccept returned -1, SSL error 0 in (nil)/(nil): (nil)\n\n06/09/2023 12:08:00 [0] 50-Warning: Engine 1 has responded, changing status to UP\n\n06/09/2023 12:08:00 [1] 70-Error: Engine 1 failed to respond within timeout.\n\n06/09/2023 12:08:00 [0] 50-Warning: Engine 1 is not responding, changing status to DOWN<span id=\"cke_bm_8536E\" style=\"display: none;\"> </span></pre>\n</li>\n</ol>\n<h2>Cause</h2>\n<p>This issue occurs because fields with incorrectly defined indexes are used in specific search conditions. </p>\n<p>Some match field (<code>RLAC-OWNED-BY-GROUP,RLAC-OWNED-BY-PERSON,LAST-UPDATED-BY-PERSON,RLAC-CREATED-BY-PERSON</code>) appear in query but have never been configured in <code>content.cfg</code>.</p>\n<p>As a result, the content server runs the matching condition in the query with the matching index. This leads to extended execution times for these poorly performing queries and consumes worker threads and other resources.</p>\n<h2>Solution</h2>\n<p>Perform the following steps as a workaround.</p>\n<ol>\n<li>\n<p>Update the <code>content.cfg</code> file as follows on all <code>saw-con</code> and <code>sawarc-con</code> pods (including <code>saw-con-a</code> and <code>sawarc-con-a</code>).</p>\n<ol start=\"1\">\n<li>Search for <code>[SetMatchFields]</code>.</li>\n<li>Search for the <code>PropertyFieldCSVs</code> definition that's closest to the search result in <em>step a</em>. Note that this definition must be within the <code>[SetMatchFields]</code> section.</li>\n<li>Append the following code to the end of the line that begins with <code>PropertyFieldCSVs</code>.\n\t\t<pre>,RLAC-OWNED-BY-GROUP,RLAC-OWNED-BY-PERSON,LAST-UPDATED-BY-PERSON,RLAC-CREATED-BY-PERSON</pre>\n<p>See the following screenshot as an example:</p>\n<div><a class=\"image\" href=\"/file/images/b/b7/IDOLPerformIssues.png\" title=\"/file/images/b/b7/IDOLPerformIssues.png\"> <img alt=\"IDOLPerformIssues\" border=\"0\" file=\"/mediawiki/images/b/b7/IDOLPerformIssues.png\" height=\"61\" hspace=\"0\" src=\"../../../images/IDOLPerformIssues_e01e758a.png\" style=\"width: 800px; height: 61px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a></div>\n</li>\n</ol>\n</li>\n<li>Restart all <code>saw-con</code> and <code>sawarc-con</code> pods (including <code>saw-con-a</code> and <code>sawarc-con-a</code>).\n\t<ol start=\"1\">\n<li>Get the current stateful set using <code>kubectl</code>, and take note of the replicas number (in the example below the number is 2)\n\t\t<pre>kubectl get sts -n &lt;namespace&gt;  | grep smarta | grep con\nsmarta-saw-con         2/2     347d\nsmarta-saw-con-a       2/2     347d\nsmarta-sawarc-con      2/2     347d\nsmarta-sawarc-con-a    2/2     347d\n</pre>\n</li>\n<li>Shut down the pods by scaling the stateful set down to zero replicas.\n\t\t<pre>kubectl scale sts smarta-saw-con  --replicas=0 -n &lt;namespace&gt;\nkubectl scale sts smarta-saw-con-a --replicas=0 -n &lt;namespace&gt;\nkubectl scale sts smarta-sawarc-con --replicas=0 -n &lt;namespace&gt;\nkubectl scale sts smarta-sawarc-con-a --replicas=0 -n &lt;namespace&gt;\n</pre>\n</li>\n<li>Wait for all pods to go offline, and then restart them by setting the replicas back to the original number.\n\t\t<pre>kubectl scale sts smarta-saw-con  --replicas=2 -n &lt;namespace&gt;\nkubectl scale sts smarta-saw-con-a --replicas=2 -n &lt;namespace&gt;\nkubectl scale sts smarta-sawarc-con --replicas=2 -n &lt;namespace&gt;\nkubectl scale sts smarta-sawarc-con-a --replicas=2 -n &lt;namespace&gt;\n</pre>\n</li>\n</ol>\n</li>\n<li>\n<p>To apply the configuration modification effectively, select one of the following options to proceed:</p>\n<ul>\n<li>Option 1: Run the following command on all <code>saw-con</code> and <code>sawarc-con</code> pods (including <code>saw-con-a</code> and <code>sawarc-con-a</code>).\n\n\t\t<pre>kubectl exec ${POD_NAME} -n ${YOUR_ITSMA_NAMESPACE} -- curl -k https://localhost:1444/DREREGENERATE?FieldProcessingSection=SetMatchFields</pre>\n<p>To verify the result of the Regenerate command execution, check the content logs for each content (<code>smarta-saw-con-0</code>, <code>smarta-saw-con-1</code>, <code>smarta-saw-con-a-0</code>, <code>smarta-saw-con-a-1</code>, etc.) You will find lines resembling the following:</p>\n<pre>&lt;NFS&gt;/logging-volume/idol/saw/content/smarta-saw-con-0\n\n  12/09/2023 10:27:23 [0] 30-Normal: Index Queue Command: /DREREGENERATE?FieldProcessingSection=SetMatchFields\n  12/09/2023 10:27:24 [1] 30-Normal: Index Queue Command: DREREGENERATE?FieldProcessingSection=SetMatchFields12/09/2023 10:27:24 [1] 30-Normal: Changing fields associated with processing section 'SetMatchFields'; regenerating Match index.\n  12/09/2023 10:27:24 [1] 30-Normal: Creating new numeric index for field -3\n  ...\n  ...\n  ...\n  ...\n  12/09/2023 10:27:25 [1] 30-Normal: Flushing 3 numeric cache entries (48 bytes) for field 55.\n  12/09/2023 10:27:25 [1] 30-Normal: Flushing 3 numeric cache entries (48 bytes) for field 57.\n  12/09/2023 10:27:25 [1] 30-Normal: Flushing 2 numeric cache entries (32 bytes) for field 69.\n  12/09/2023 10:27:26 [1] 30-Normal: Index command finished. Took 1.93 s\n\n</pre>\n</li>\n<li>Option 2: Perform a full reindex by python reindex script. </li>\n</ul>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\"> Depending on the number of documents, this process regenerates some index fields and may take a few seconds or a few minutes.</div>\n</div>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}