{
  "title": "Download and upload images for Audit service",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This section is specific to uploading Audit related images only, as you need to install Service Management before Audit installation. Before you deploy the Audit service, you need to</p>\n<ol>\n<li>Download the required audit and audit dependent images from Docker Hub or other registries</li>\n<li>Upload the images to your registry.</li>\n</ol>\n<h2 id=\"Generate_the_Image_Set\">Generate the Image Set</h2>\n<p>The generate_download_bundle.sh compares the images needed by the suite with the images that already exist in the cluster and generates a .zip file, <strong>offline-download.zip</strong>. This file enables you to download the required images from Docker Hub. Give the AWS credentials if prompted:</p>\n<pre>./generate_download_bundle.sh --chart &lt;Audit service Helm chart&gt; -o &lt;organization&gt; -d &lt;destination directory for the generated zip file&gt;</pre>\n<p>For example:</p>\n<pre>./generate_download_bundle.sh --chart Audit_Helm_Chart-2x.x/audit-helm-charts/charts/audit-1.2.0+2x.x.x-xx.tgz -o hpeswitom -d /tmp</pre>\n<p><br/>\nYou can find the <strong>offline-download.zip</strong> under the current working directory unless you specify the \"<code>-d</code>\" option. You will receive the following messages indicating that you have successfully generated the<strong> offline-download.zip</strong> file:</p>\n<pre>[INFO] 2020-07-31 17:58:46 : ** Generating the offline image download bundle ...\n[INFO] 2020-07-31 17:58:50 : Completed generation of offline-download.zip in /tmp\n</pre>\n<p>Then, you can find the image set file <strong>image-set.json</strong> in the current directory. This file contains a list of the required images and you will use it when you run the Python script to transfer the suite images in a later step.</p>\n<h2>Verify if you need to upload the images</h2>\n<p>Before you proceed to creating the ECR repositories and downloading and uploading the images, check if the <strong>image-set.json</strong> generated by <strong>generate_download_bundle.sh</strong> script isn't empty. If <strong>generate_download_bundle.sh</strong> is empty, you don't have to create ECR repositories or download and upload images. Follow these steps to verify that the <strong>image-set.json </strong>isn't empty:</p>\n<ol>\n<li>Change the directory to the destination directory provided while running the <strong>generate_download_bundle.sh</strong> script:\n\n\t<pre>cd /home/centos/audit-2x.x</pre>\n</li>\n<li>Unzip the <strong>offline-download.zip</strong> by running the following command:\n\t<pre>unzip offline-download.zip</pre>\n</li>\n<li>Print the content of <strong>image-set.json</strong> present in the <strong>offline-download</strong> directory:\n\t<pre>cat offline-download/image-set.json</pre>\n</li>\n</ol>\n<h2>Download the required installation images</h2>\n<ol>\n<li>Log on to the bastion node. If the bastion node can't access Docker Hub, transfer the  <strong>offline-download.zip</strong> file to a Linux server that can access Docker Hub.</li>\n<li>Extract the .zip package to a directory. If you can't access Docker Hub directly, set up the HTTP/HTTPS proxy. For example, run the following commands to set the HTTP/HTTPS proxy. Replace the placeholders with your actual server and port. <br/>\n<code>export http_proxy=\"&lt;http://PROXY_SERVER:PORT&gt;\"<br/>\n\texport https_proxy=\"&lt;https://PROXY_SERVER:PORT&gt;\"</code></li>\n<li>Go to the directory where you extracted the <strong>offline-download.zip</strong> package.</li>\n<li>Run the following command:<br/>\n\t \n\t<pre>./downloadimages.sh [-r &lt;image repository URL&gt;] [-u &lt;username&gt;]  [-d &lt;image download directory&gt;] [-c on|off] [-o &lt;org name&gt;]</pre>\n<br/>\n\tWhere:<br/>\n<em>&lt;image repository URL&gt;</em>: Specify the <code>-r</code> option if you want to download the images from a repository other than Docker Hub.<br/>\n\tReplace <em>&lt;username&gt;</em> with the Docker Hub username. If you don't specify the credentials here, when prompted you can specify them while running the command.<br/>\n<em>&lt;image download directory&gt;</em>: The directory where the container images get downloaded. The default value is /var/opt/cdf/offline.<br/>\n\tThe <code>-c</code> option helps to verify the digital signature of the images during the download. The default setting is off, which doesn't verify the signature.<br/>\n<em>&lt;org name&gt;</em>: The organization in the image registry that contains the images for installation. By default, this is <code>hpeswitom.</code> This option is mandatory if you aren't using the default organization name.</li>\n<li>To see the full list of options for the <strong>downloadimages.sh</strong> command, run the following command:\n\t<pre><code>./downloadimages.sh –h</code></pre>\n<p>The command also has a <code>-p</code> option to give your password. The <code>-p</code>  option doesn't support single quotes (that is, don't include single quotes in the password).</p>\n</li>\n</ol>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">\n<p><br/>\nBy selecting the -p option, you are disabling or bypassing security features, thereby exposing the system to increased security risks. By using this option, you understand and agree to assume all associated risks and hold OpenText harmless for the same.</p>\n<p>OpenText encourages you to use some other password options, which aren't provided by OpenText. By implementing the -p option, you may expose the system to increased security risks. You understand and agree to assume all associated risks and hold OpenText harmless for the same. It remains at all times your sole responsibility to assess its own regulatory and business requirements. OpenText doesn't represent or warrant that its products comply with any specific legal or regulatory standards applicable to you in conducting your business.</p>\n</div>\n</div>\n<h2>Upload images</h2>\n<ol>\n<li>Log on to the bastion node where you downloaded or copied the images.</li>\n<li>Run the following commands to retrieve the username and password of ECR, if you've installed AWS CLI version 1 when configuring the bastion:\n\t<pre>dockerLogin=$(aws ecr get-login --no-include-email --region &lt;ecr_region&gt;)\necrUserName=$(echo $dockerLogin | awk '{print $4}')\necrUserPassword=$(echo $dockerLogin | awk '{print $6}')\necrURL=$(echo $dockerLogin | awk '{print $7}' | awk -F/ '{print $3}')</pre>\n</li>\n<li>Run the following commands to retrieve the username and password of ECR, if you've installed AWS CLI version 2 when configuring the bastion:\n\t<pre>ecrUserName=AWS\necrUserPassword=$(aws ecr get-login-password)\necrURL=&lt;aws_account_id&gt;.dkr.ecr.&lt;region&gt;.amazonaws.com</pre>\n</li>\n<li>Go to the directory you extracted the <code>offline-download.zip</code> package into.</li>\n<li>Run the following command to upload the suite images to the local registry:\n\t<pre>./uploadimages.sh -r $ecrURL -u $ecrUserName -p $ecrUserPassword -d &lt;image download directory&gt; -o &lt;org name&gt;</pre>\n<br/>\n\tWhere:\n\t<p><em>&lt;image download directory&gt;</em>: The directory where the container images will get downloaded. The default value is <code>/var/opt/cdf/offline</code>. Specify the <code>-d </code> option if the images aren't available in the <code>/var/opt/cdf/offline/</code> directory. You can use the <code>-d</code> option multiple times when the images are in different directories. However, if you have specified the <code>-l</code> option to \"false\", then you can only specify one image directory. The images can be the images downloaded by the <strong>downloadimages.sh</strong>. Make sure the image file type matches the file extension. </p>\n<p><em>&lt;org name&gt;</em>: The organization in the image registry that contains the images for installation. By default, this is <code>hpeswitom.</code> This option is mandatory if you aren't using the default organization name. <br/>\n<code>--cleanup</code>: Delete the image source folder to save disk space. It only works when all images are uploaded successfully.</p>\n<p>To see the full list of options for the <code>uploadimages.sh</code> command, run the following command:</p>\n<pre>./uploadimages.sh -h </pre>\n</li>\n<li>Wait until the images are successfully uploaded. Your terminal resembles the following:\n\t<pre>Upload-process successfully completed.</pre>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}