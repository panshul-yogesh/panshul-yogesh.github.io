{
  "title": "Install an Audit patch (embedded Kubernetes)",
  "content": "<div class=\"mw-parser-output\">\n<p>This page contains the steps to apply an Audit service patch and an Audit collector patch to an on-premises environment. You need to apply both the Audit service patch and the Audit collector patch. For detailed information about Audit fixed issues, Audit service and Audit collector patch download links, and Audit service and Audit collector patch filenames, see the corresponding main patch release notes.</p>\n<h2 id=\"Back_up_Audit_service\"><a id=\"Back_up_Audit_service\" name=\"Back_up_Audit_service\" title=\"Back up Audit service\"></a>Back up Audit service</h2>\n<p>This section gives the steps to back up Audit files and data:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Back up audit database. For instructions about backing up PostgreSQL database, see the <a href=\"https://www.postgresql.org/docs/current/backup.html\" title=\"PostgreSQL documentation\">PostgreSQL documentation</a>.</p>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Back up all the configuration files that you are using. For example, <b>values.yaml</b> file, <strong>audit-secret.yaml</strong>, chart tar file, and certificates.</p>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Back up the <strong>itom-audit</strong><b>-pv.yaml</b> file.</p>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Back up the following data on the NFS volumes for the Audit deployment:</p>\n<table>\n<thead>\n<tr>\n<th scope=\"col\">Component</th>\n<th scope=\"col\">NFS volume name</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Example directory path</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Audit</td>\n<td><strong>as-vault-volume-&lt;Audit Namespace&gt;</strong></td>\n<td>Stores Audit configuration files.</td>\n<td>/var/vols/itom/audit/auditns/vault</td>\n</tr>\n<tr>\n<td>Audit</td>\n<td><strong>as-log-volume-&lt;Audit Namespace&gt;</strong></td>\n<td>Stores logs generated by Audit.</td>\n<td>/var/vols/itom/audit/auditns/log</td>\n</tr>\n</tbody>\n</table>\n</li></ol>\n<h2 id=\"Prepare_the_Audit_service_patch\"><a id=\"Prepare_the_Audit_service_patch\" name=\"Prepare_the_Audit_service_patch\" title=\"Prepare the Audit service patch\"></a>Prepare the Audit service patch</h2>\n<p>You need to download the patch on the control plane node. After that, follow these steps:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Extract the downloaded package and obtain the audit patch file (<strong>Audit_Helm_Chart-2x.x.xxx.zip</strong>) from the <strong>/Audit_Helm_Chart-2x.x.xxx/auditpkg-x.x.x+2x.x.x-xx/auditpkg-x.x.x+2x.x.x-xx/audit-helm-chart/audit</strong><strong>/charts</strong> directory.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Prepare the related images by following the instructions in <a href=\"/doc/423/26.1/installauditdownloadimages\" title=\"Download Audit images\">Download Audit images</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Upload container images for Audit to a registry by following the instructions in <a href=\"/doc/423/26.1/uploadauditimageshelm\" title=\"Upload container images for Audit to a registry\">Upload Audit images</a>.</li></ol>\n<h2 id=\"Deploy_the_Audit_service_patch\"><a id=\"Deploy_the_Audit_service_patch\" name=\"Deploy_the_Audit_service_patch\" title=\"Deploy the Audit service patch\"></a>Deploy the Audit service patch</h2>\n<p>Perform the following steps to apply the latest patch:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">First note down the namespace where you have installed the Audit service. Run the following command to get the namespace: \n\n\t<pre>kubectl get namespace</pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Refer to the <a href=\"/doc/423/26.1/configureaudityaml4audit\" title=\"Configure values.yaml for Audit service (on-premises)\">Configure values.yaml for Audit service (on-premises)</a> page and then update the backed up audit service values.yaml.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to deploy the patch:\n\t<pre>$helm upgrade &lt;Audit Release Name&gt; &lt;Audit Service Chart&gt; -n &lt;Audit Namespace&gt; -f &lt;Values YAML File&gt; -f &lt;<code>Secrets YAML File&gt;</code> --set-file \"caCertificates.cert_one\"=/path/to/cert_one.crt --set-file \"caCertificates.cert_two\"=/path/to/cert_two.crt --set-file \"caCertificates.RE_ca_custcrt\"=/path/to/customCA.crt\n</pre>\n<p>where,<br/>\n<em>&lt;Audit Release Name&gt;</em> is the release name of the Audit deployment that you specified when installing Audit.<br/>\n<em>&lt;Audit Service Chart&gt;</em> is the new tar file containing the Audit installation chart.<br/>\n<em>&lt;Audit Namespace&gt;</em> is the unique namespace you created for the Audit service.<br/>\n<em>&lt;Values YAML File&gt;</em> is your <b>values.yaml</b> file with properties configured for the Audit deployment.<br/>\n<em>&lt;Secrets YAML File&gt;</em> is the YAML file that stores the Audit secrets. Specify the file name (for example, <strong>audit-secret-backup.yaml</strong>). If you don't have this file, run the following command to get the file:</p>\n<pre>kubectl get secret itom-audit-secret -n &lt;auditns&gt; -o yaml &gt; audit-secret-backup.yaml</pre>\n<p>You can pass the certificates by using the <strong>--set-file</strong> option. You can pass the suite and database certificates.<br/>\n\tYou can find the <strong>values.yaml</strong>, <strong>audit-secret-backup.yaml</strong>, and the certificates in the backed up file.<br/>\n\tAn example command to deploy the patch:</p>\n<pre>$helm upgrade audit audit-&lt;version&gt;.tgz -n auditns -f values.yaml -f audit-secret-backup.yaml --set-file \"caCertificates.RE_ca_idmcrt\"=./RE_ca_idm.crt --set-file \"caCertificates.RE_ca_dbcrt\"=./RE_ca_db.crt --set-file \"caCertificates.RE_ca_custcrt\"=./rootCA.crt\n</pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to check if the Audit service pods are ready:\n\t<pre>kubectl get pod -n &lt;Audit Namespace&gt; |grep -v 1/1|grep -v 2/2|grep -v 3/3|grep -v 4/4|grep -v Completed</pre>\n<p>where,</p>\n<p><em>&lt;Audit Namespace&gt;</em> is the namespace where you have deployed the Audit Helm chart.</p>\n<p>This command returns a list of abnormal pods. When it returns no results, all pods are ready.</p>\n</li></ol>\n<h2 id=\"Verify_the_Audit_service_patch_installation\"><a id=\"Verify_the_Audit_service_patch_installation\" name=\"Verify_the_Audit_service_patch_installation\" title=\"Verify the Audit service patch installation\"></a>Verify the Audit service patch installation</h2>\n<p>Use the command below to verify the correct chart and app version are deployed.</p>\n<pre>helm list -n &lt;NAMESPACE&gt;</pre>\n<p>In the returned result, check <strong>CHART</strong> and <strong>APP VERSION</strong>, for example,</p>\n<pre>NAME    NAMESPACE     REVISION      UPDATED      STATUS        CHART                  APP VERSION\naudit   &lt;NAMESPACE&gt;   2                          deployed      audit-1.x.x+2x.x.x-xx<strong>   </strong>2x.x</pre>\n<h2 id=\"Audit_service_roll_back\"><a id=\"Audit_service_roll_back\" name=\"Audit_service_roll_back\" title=\"Audit service roll back\"></a>Audit service roll back</h2>\n<p>This patch supports rollback.</p>\n<p>List revision numbers of the release by running the following command:</p>\n<pre>helm history &lt;AUDIT RELEASE NAME&gt; -n &lt;NAMESPACE&gt;</pre>\n<p>Roll back the patch and revert to a previous revision number:</p>\n<pre>helm rollback &lt;AUDIT RELEASE NAME&gt; -n &lt;NAMESPACE&gt; &lt;REVISION NUMBER&gt;</pre>\n<h2 id=\"Deploy_the_Audit_collector_patch\"><a id=\"Deploy_the_Audit_collector_patch\" name=\"Deploy_the_Audit_collector_patch\" title=\"Deploy the Audit collector patch\"></a>Deploy the Audit collector patch</h2>\n<p>This topic details procedure to deploy the audit collector patch.</p>\n<div>\n<div>It is not required to install the Audit collector patch for the SMAX patch installation as the SMAX patch installation bundle installs the audit collector patch by default. </div>\n</div>\n<p>Follow these steps to patch the Audit collector.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Back up all the Audit collector configuration files. For example, audit collector values.yaml, audit collector chart tar file, audit collector secrets.yaml, and certificates.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Extract the downloaded package and obtain the patch file (<strong>Audit_Collector_Helm_Chart-2x.x.xxx.zip</strong>) from the <strong>/Audit_Collector_Helm_Chart-2x.x.xxx/auditcollectorpkg-x.x.x+2x.x.x-xx/auditcollectorpkg-x.x.x+2x.x.0-xx\\audit-collector-helm-chart</strong><strong>\\audit-collector\\charts</strong> directory.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Prepare the Audit collector images by following the instructions in <a href=\"/doc/423/26.1/auditcollectordownloadimages\" title=\"Download images for audit collector\">Download images for Audit collector</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Refer to the <a href=\"/doc/423/26.1/131-configureauditcollectoryaml\" title=\"Configure values.yaml for Audit collector (on-premises)\">Configure values.yaml for Audit collector (on-premises)</a> page and then update the backed up audit collector values.yaml. </li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Deploy the Audit collector patch file in the same namespace where the Audit producer is running.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to deploy the patch:\n\t<pre>$helm upgrade &lt;Audit Collector Release Name&gt; &lt;Audit Collector Chart&gt; -n &lt;Audit Producer Namespace&gt; -f values.yaml -f audit-collector-secrets.yaml --set-file \"caCertificates.cert_one\\.crt\"=/path/to/cert_one.crt --set-file \"caCertificates.cert_two\\.crt\"=/path/to/cert_two.crt\n</pre>\n<p>where,</p>\n<p><em>&lt;Audit Collector Release Name&gt; </em>is the release name of the Audit collector deployment that you specified when installing the Audit collector.<br/>\n<em>&lt;Audit Collector Chart&gt;</em> is the tar file containing the Audit collector installation charts.<br/>\n<em>&lt;Audit Producer Namespace&gt;</em> is the namespace where the Audit producer is running.<br/>\n<em>&lt;Values YAML File&gt;</em> is your <strong>values.yaml</strong> file with properties configured for the Audit collector deployment.<br/>\n<em>&lt;Audit Collector Secrets YAML file&gt;</em> is the file that gen_secret script generates and holds the Audit collector secrets.<br/>\n\tYou can pass certificates using the <code>--set-file</code> option. In the following example, you can see the suite and Audit service engine certificates. You can find the Audit collector <strong>values.yaml</strong>, <strong>audit-collector-secret-backup.yaml</strong>, and the certificates in the backed up file.</p>\n<p>An example command to deploy the Audit collector patch:</p>\n<pre>$helm upgrade audit-collector audit-collector-&lt;version&gt;.tgz -n itsma-cfpni -f values.yaml -f audit-collector-secret-backup.yaml --set-file \"caCertificates.idm\\.crt\"=idm.crt --set-file \"caCertificates.auditservice\\.crt\"=ase.crt</pre>\n</li></ol>\n<h2 id=\"Audit_collector_roll_back\"><a id=\"Audit_collector_roll_back\" name=\"Audit_collector_roll_back\" title=\"Audit collector roll back\"></a>Audit collector roll back</h2>\n<p>You can rollback the Audit collector patch.</p>\n<p>List revision numbers of the release by running the following command:</p>\n<pre>helm history &lt;Audit collector release name&gt; -n &lt;Audit producer namespace&gt;</pre>\n<p>Roll back the patch and revert to a previous revision number:</p>\n<pre>helm rollback &lt;Audit collector release name&gt; -n &lt;Audit producer namespace&gt; &lt;Revision number&gt;</pre>\n</div>",
  "modifiedon": "2026-02-02 07:34:29"
}