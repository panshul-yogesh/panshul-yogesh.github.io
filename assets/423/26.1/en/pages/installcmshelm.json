{
  "title": "(Optional) Install containerized UD/UCMDB",
  "content": "<div class=\"mw-parser-output\"><section begin=\"ContainerizedMtMode\"></section><p>The Native SACM and SAM solutions require a UD/UCMDB system to work with Service Management. Once you have completed the Service Management installation, you can continue to install UD/UCMDB on the same OMT cluster as the next deployment (Service Management is the first deployment). The following diagram shows the multi-deployment structure.</p><div><a class=\"image\" href=\"\"><img alt=\"/mediawiki/images/2/28/cmsWithSmax-SharedIdmArch_v2.jpg\" border=\"0\" file=\"/mediawiki/images/2/28/cmsWithSmax-SharedIdmArch_v2.jpg\" height=\"313\" hspace=\"0\" src=\"../../../images/cmsWithSmax-SharedIdmArch_v2_74060900.jpeg\" vspace=\"0\" width=\"800\"/></a></div><section end=\"ContainerizedMtMode\"></section><h2>Using Multi-Customer mode</h2><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\">UD/UCMDB and Service Management both have the concept of \"tenant,\" but it's important not to mix up the ideas of UCMDB tenants and Service Management tenants. Service Management tenants correspond with UCMDB customers, while Service Management data domains correspond with UCMDB tenants. When you have multiple tenants in Service Management, each of them needs to be associated with a UCMDB customer.\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" style=\"width: 500px;\"><thead><tr><th scope=\"col\">Service Management concepts</th><th scope=\"col\">Correlated UCMDB concepts</th></tr></thead><tbody><tr><td>Service Management tenant</td><td>UCMDB customer</td></tr><tr><td>Service Management data domain</td><td>UCMDB tenants</td></tr></tbody></table></div></div><p>Customer in UCMDB is a data isolation mechanism. The Multi-Customer solution enables the management of multiple separated customers on a single CMDB instance, with a complete separation of data between the customers. The following is a high-level overview of the Multi-Customer architecture.</p><div><a class=\"image\" href=\"\"><img alt=\"/mediawiki/images/2/24/cms2020.11_MC_architecture_3.png\" border=\"0\" file=\"/mediawiki/images/2/24/cms2020.11_MC_architecture_3.png\" height=\"449\" hspace=\"0\" src=\"../../../images/cms2020.11_MC_architecture_3_e17bfa84.png\" vspace=\"0\" width=\"800\"/></a></div><h3>Category of customers in UCMDB</h3><p>You can have the following three categories of customers:</p><ul><li><b>Default customer</b></li><li><b>Consumer customer</b></li><li><b>Provider customer</b></li></ul><h4>Default customer</h4><p>When the UCMDB server is installed, a default customer is created. The default customer is with customer ID 1, and the customer name and display label are \"Default Client.\" All the OOTB content will be loaded into this default customer. </p><h4>Provider customer</h4><p>In the Multi-Customer mode, the Provider customer is a system-level customer used to administer the UCMDB application and manage Consumer customers. You must have one and only one Provider customer in the system. Do not use the Provider customer to manage any business data. For details, see <a href=\"/doc/403/25.4/mcmanageprovidercustomer\" title=\"Manage the Provider customer\">Manage the Provider customer</a>.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\">In the out-of-the-box system, as soon as two or more customers exist in a UCMDB server, the default customer is referred to as the Provider customer. In this release, the default customer (that is, customer 1) must be used as the Provider customer in the Multi-Customer mode. </div></div><h4>Consumer customer</h4><p>A Consumer customer is a normal customer that consumes the data within its own customer territory. In a Multi-Customer implementation, there might be a number of Consumer customers.</p><h2>Using converged authorization solution</h2><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-sharedIdMOverview|ConvergedAuthIntro|N\"></span><p lang=\"EN-US\">The converged authorization solution enables the Service Management tenant admin to manage UD/UCMDB users, roles, and groups from one single user interface (the Service Management agent portal) when UD/UCMDB is deployed together with Service Management. While UD/UCMDB permissions are still managed in UCMDB Local Client, the solution removes the need for the suite admin to access the IdM Admin Portal for managing UD/UCMDB roles, groups, and users, and therefore streamlines the tenant admin's user administration workflow and reduces the maintenance cost. </p>\n<p lang=\"EN-US\">The UD/UCMDB user management flow under the converged authorization solution is as follows:  </p>\n<div><a class=\"image\" href=\"/file/images/general/convergedIdM24.4_v2.png\" title=\"/file/images/general/convergedIdM24.4_v2.png\"> <img alt=\"converged IdM\" height=\"297\" src=\"../../../images/convergedIdM24.4_v2_ae9d7c96.png\" width=\"1000\"/> </a></div>\n<p lang=\"EN-US\" xml:lang=\"EN-US\">When the system provisions a UCMDB customer, the UD/UCMDB out-of-the-box (OOTB) roles with built-in permissions are automatically seeded in IdM. The application field of these seeded UD/UCMDB roles is \"CMDB\".  The suite admin can do UD/UCMDB pre-authorization for the Service Management tenant admin in IdM by creating a UD/UCMDB admin group and associating the UD/UCMDB OOTB <strong>SuperAdmin </strong>role and the tenant admin user to this group, so that the Service Management tenant admin can access UD/UCMDB with the highest privilege of this UCMDB customer. After the suite admin enables Native SACM for the tenant, Service Management automatically replicates the seeded UD/UCMDB OOTB roles and the UD/UCMDB admin group from IdM to the Service Management agent interface.  </p>\n<p><br/>\n</p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-sharedIdMOverview|ConvergedAuthIntro|N\"></span><p>The following describes the UD/UCMDB installation process by using the converged authorization solution. This process includes the following steps:</p><ol><li>Prepare NFS and PostgreSQL servers and add worker nodes</li><li>Configure load balancers according to your network structure</li><li>Install UD/UCMDB</li></ol><h2>Prepare NFS and PostgreSQL servers and add worker nodes</h2><p>You need to use a separate NFS server and PostgreSQL server for UD/UCMDB, instead of using the same servers for the suite. </p><p>Before you begin, prepare separate servers for UD/UCMDB installation: </p><ol><li>Determine the hardware resources (worker nodes, NFS server, and PostgreSQL server) that are required for your UD/UCMDB deployment. For details, see <a href=\"/doc/423/26.1/sizingforotheroptions#Additional_hardware_requirements_for_CMS\" title=\"Additional hardware resources for UD/UCMDB\">Additional hardware resources for UD/UCMDB</a>. Note that the sizing recommendations are based on the consideration that the suite needs to use a classic data flow probe instead of the probe embedded in the containerized UD/UCMDB. </li><li>Prepare a separate NFS server and separate PostgreSQL database server, and required worker nodes for UD/UCMDB, according to your UD/UCMDB sizing profile. </li><li>Add the worker nodes to the OMT cluster. For details, see the <a href=\"/doc/406/25.4/addadditionalworker\" title=\"OMT documentation\">OMT documentation</a>. </li></ol><ul></ul><h2>Determine your load balancing option</h2><p>Follow the instructions below to select a load balancing option according to your network structure. </p><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\">Load balancing options described in this document use ports 443 (which you must not change to another port unless otherwise stated) and 3443 (which is only an example and can be changed to your own). </div></div><p>There are three load balancing options as described below. However, you need to work with your IT administrator or network administrator to develop a detailed solution according to your network structure. The diagrams below are examples for your reference only.</p><ul><li>Option 1 is for the scenario where your IT policy requires that any access from the Internet must go through a DMZ network and all traffic for UD/UCMDB integration purposes must not go through the network. So it is more secure than the other options. It's the most recommended one if all of the three options work for you.</li><li>Options 2 and 3 are for the scenario where your IT policy has no limitations on inbound and outbound traffic. Since the network isn't isolated from the Internet, these options aren't so secure as option 1. However, both of them are easy to set up, especially option 3, which requires no operational cost.</li></ul><h3>Option 1</h3><p>You need three load balancers, all of which are application load balancers that work through network layer 7:</p><ul><li>Two external load balancers in a DMZ network to handle Internet inbound traffic: one for end users to access the suite and OMT from the Internet, and the other for end users to access UD/UCMDB from the Internet. </li><li>An internal load balancer to handle only integration traffic between the suite and UD/UCMDB in your private network.</li></ul><p>The following diagram illustrates the network structure of option 1. </p><div><a class=\"image\" href=\"\"><img alt=\"/mediawiki/images/9/9c/option1-v2_(2).png\" border=\"0\" file=\"/mediawiki/images/9/9c/option1-v2_(2).png\" height=\"408\" hspace=\"0\" src=\"../../../images/option1-v2_2_4cf30622.png\" style=\"width: 800px; height: 408px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/></a></div><p>The following table describes the supported FQDN and port configurations for this option. </p><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\"><thead><tr><th scope=\"col\">Configuration</th><th scope=\"col\">Example 1</th><th scope=\"col\">Example 2</th></tr></thead><tbody><tr><td>Using the same port (443) and different FQDNs for the suite and UD/UCMDB. Note that the two FQDNs must have different domains (different portions after their first portion).<br/><br/><strong>Note</strong>: The internal load balancer uses different ports for the suite and UD/UCMDB (ports 443 and 3443 in the diagram are only examples and can be changed). </td><td><ul><li>Suite:  smax.example-domain-1.com:443</li><li>UD/UCMDB: cms.example-domain-2.com:443</li></ul><strong>Note</strong>: the network structure diagram for option 1 uses this example configuration.</td><td><ul><li>Suite: a.b.c:443</li><li>UD/UCMDB: d.a.b.c:443</li></ul></td></tr><tr><td>Using the same FQDN and different ports for the suite (port 443) and UD/UCMDB (port other than 443)</td><td><ul><li>Suite myhost.example-domain.com:443</li><li>UD/UCMDB: myhost.example-domain.com:3443</li></ul></td><td>N/A</td></tr></tbody></table><h3>Option 2</h3><p>You need two external load balancers to handle traffic from outside users and internal integration traffic between the suite and UD/UCMDB. They are both application load balancers. </p><p>The following diagram illustrates the network structure of option 2.  </p><div><a class=\"image\" href=\"\"><img alt=\"/mediawiki/images/1/15/option2-v2.png\" border=\"0\" file=\"/mediawiki/images/1/15/option2-v2.png\" height=\"380\" hspace=\"0\" src=\"../../../images/option2-v2_caca3798.png\" style=\"width: 800px; height: 380px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/></a></div><p>The following table describes the supported FQDN and port configurations for this option. </p><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\"><thead><tr><th scope=\"col\">Configuration</th><th scope=\"col\">Example 1</th><th scope=\"col\">Example 2</th></tr></thead><tbody><tr><td>Using the same port (443) and different FQDNs for the suite and UD/UCMDB. Note that the two FQDNs must have different domains (different portions after their first portion).</td><td><ul><li>Suite: smax.example-domain-1.com:443</li><li>UD/UCMDB: cms.example-domain-2.com:443</li></ul><strong>Note</strong>: the network structure diagram for option 2 uses this example configuration.</td><td><ul><li>Suite: a.b.c:443</li><li>UD/UCMDB: d.a.b.c:443</li></ul></td></tr><tr><td>Using the same FQDN and different ports for the suite (port 443) and UD/UCMDB (port other than 443)</td><td><ul><li>Suite: myhost.example-domain.com:443</li><li>UD/UCMDB: myhost.example-domain.com:3443</li></ul></td><td>N/A</td></tr></tbody></table><h3>Option 3</h3><p>This option applies if you have set up a high-availability environment by using multiple control plane nodes and use an HA virtual IP (defined in the <strong>values.yaml</strong> file of Service Management) to leverage Keepalived's high-availability feature instead of using an external load balancer. This option takes advantage of Keepalived to load balance the traffic for the suite and UD/UCMDB in a multi-deployment scenario.<br/><br/>\nWith an HA virtual IP configured, Keepalived handles end user traffic as before, and you can use this HA virtual IP for setting up an integration between UD/UCMDB and the suite. That said, you don't need to configure any load balancers.<br/><br/><br/><a class=\"image\" href=\"\"><img alt=\"/mediawiki/images/d/d9/option3-v2_(1).png\" border=\"0\" file=\"/mediawiki/images/d/d9/option3-v2_(1).png\" height=\"359\" hspace=\"0\" src=\"../../../images/option3-v2_1_a13d969d.png\" style=\"width: 800px; height: 359px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/></a></p><p>The following table describes the supported FQDN and port configuration for this option. </p><table border=\"1\" cellpadding=\"1\" cellspacing=\"1\"><thead><tr><th scope=\"col\">Configuration</th><th scope=\"col\">Example </th></tr><tr><td>Using the same FQDN and different ports for the suite (port 443) and UD/UCMDB (port other than 443).</td><td><ul><li>Suite:myhost.example-domain.com:443</li><li>UD/UCMDB: myhost.example-domain.com:3443</li></ul><strong>Note</strong>: the network structure diagram for option 3 uses this example configuration. </td></tr></thead></table><p><strong>Note</strong>: Using the same FQDN and the same port (443) for both the suite and UD/UCMDB isn't supported for option 3. </p><h2>Configure load balancers</h2><p>Follow the instructions below to implement one of the load balancing options described above according to your needs.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"> The procedures below use Nginx as an example. If you want to use other load balancers, use the guidelines below for reference. Since there are different versions of the Nginx server, this section doesn't discuss how to install the Nginx server. </div></div><h3>Prerequisites</h3><p>Meet the following prerequisites before you proceed.</p><ul><li><strong>Port requirements</strong>: make sure that the following ports are open for load balancing: 5443, 443, and the other port you need (for example:3443).</li><li><p><strong>Load balancing requirements for UD/UCMDB:</strong>  <br/>\n\t  # Allow websocket connections<br/>\n\tproxy_set_header Upgrade $http_upgrade;      <br/>\n\tproxy_set_header Connection \"upgrade\";</p></li><li><p><strong>SSL requirements</strong>: OMT supports only the following SSL ciphers for inbound connections. Make sure that the external balancer hosts support at least one of the ciphers listed here.</p><ul><li>ECDHE-RSA-AES128-GCM-SHA256</li><li>ECDHE-RSA-AES256-GCM-SHA384</li><li>ECDHE-RSA-AES128-SHA256</li><li>ECDHE-RSA-AES256-SHA384</li><li>ECDHE-ECDSA-AES128-GCM-SHA256</li><li>ECDHE-ECDSA-AES256-GCM-SHA384</li><li>ECDHE-ECDSA-AES128-SHA256</li><li>ECDHE-ECDSA-AES256-SHA384</li></ul></li></ul><h3>Option1: Configure Load balancers in a DMZ network</h3><p>Perform the following steps.</p><h4>Install the Nginx server</h4><p>Install three Nginx servers on different hosts. For details, see the Nginx documentation. </p><ul><li>Install one Nginx server in the DMZ for the suite and OMT (referred to as <strong>nginx-smax</strong>). Bind the external access host name of the suite to the Nginx server IP. This must be the same external access host name that you have configured in the <strong>values.yaml</strong> file of Service Management.</li><li>Install one Nginx server in the DMZ for UD/UCMDB (referred to as <strong>nginx-cms</strong>). </li><li>Install one Nginx server in a private network for integration (referred to as <strong>nginx-integration</strong>).</li></ul><h4>Prepare certificates for each Nginx server</h4><p>In a production environment, you are recommended to configure your own Nginx certificate for OMT and the suite, which must be signed by your corporate CA or a third-party CA.</p><ol><li>Prepare a server certificate (<strong>server.crt)</strong> and server key (<strong>server.key)</strong> separately for each of the three Nginx server FQDNs, and use CN=&lt;access host&gt; when generating the server certificate: \n\n\t<ul><li>For <strong>nginx-smax</strong>,<strong> </strong>&lt;access host&gt; is the external access host that's bound with the IP address of nginx-smax.</li><li>For <strong>nginx-cms</strong>, &lt;access host&gt; is the UD/UCMDB Nginx server hostname.</li><li>For <strong>nginx-integration</strong>, &lt;access host&gt; is the integration Nginx server hostname.</li></ul></li><li>Copy your certificate files to the corresponding Nginx host. You will need to configure the file paths in the nginx.conf file in a later step.</li></ol><h4 id=\"Configure_nginx\">Configure Nginx</h4><p>Configure the three Nginx servers: nginx-smax<em>, </em>nginx-cms, and nginx-integration.</p><h5><em>Configure nginx-smax</em></h5><p>Make sure the Nginx configuration file (nginx.conf) contains the following settings.</p><pre>http {\n    upstream management {     #upstream for management service\n        least_conn;\n        session_sticky;\n        keepalive 32;\n        server &lt;control plane node 1&gt;:5443 max_fails=3 fail_timeout=10s;     #control plane node 1\n        server &lt;control plane node 2&gt;:5443 max_fails=3 fail_timeout=10s;     #control plane node 2\n        server &lt;control plane node 3&gt;:5443 max_fails=3 fail_timeout=10s;     #control plane node 3\n    } \n    upstream suite-service {     #upstream for suite service\n        least_conn;\n        session_sticky;\n        keepalive 32;\n        server &lt;control plane node 1&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 1\n        server &lt;control plane node 2&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 2\n        server &lt;control plane node 3&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 3\n   }\n   \n    server { #listen on 5443 and proxy to management service\n        listen 5443  ssl;\n        ssl_certificate                         /root/server.crt;       #certificate generated by customers\n        ssl_certificate_key                  /root/server.key;      #key generated by customers \n        ssl_protocols TLSv1.2;\n        location ^~ / {\n            proxy_set_header Host            \"&lt;external access host&gt;:5443\";\n            proxy_pass                              https://management;\n        }\n    } \n\nserver { #listen on 443 and proxy to suite service \n        listen 443 ssl http2;\n        ssl_certificate /root/server.crt; #certificate generated by customers\n        ssl_certificate_key /root/server.key; #key generated by customers\n        ssl_protocols TLSv1.2; \n        location ^~ / { \n            proxy_set_header Host \"&lt;external access host&gt;:443\"; \n            proxy_pass https://suite-service;\n       } \n }\n \n}\n</pre><p>Replace the following placeholders with the related FQDNs and change your server certificate and server key paths:</p><ul><li>&lt;control plane node 1&gt;: FQDN of the first control plane node</li><li>&lt;control plane node 2&gt;: FQDN of the second control plane node</li><li>&lt;control plane node 3&gt;: FQDN of the third control plane node</li><li>&lt;external access host&gt;: the external access hostname of the suite (for ports 5443 and 443)</li><li>/root/server.crt and /root/server.key (for ports 5443 and 443): paths of the server certificate and server key files that you have generated for nginx-smax (<strong>server.crt</strong> and <strong>server.key</strong>)</li></ul><h5><em>Configure nginx-cms</em></h5><p>Make sure the Nginx configuration file (nginx.conf) contains the following settings.</p><pre>http {\n   upstream cms-service { #upstream for cms service \n       least_conn; \n       session_sticky;\n       keepalive 32;\n       server &lt;control plane node 1&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 1 \n       server &lt;control plane node 2&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 2 \n       server &lt;control plane node 3&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 3 \n} \n    server { #listen on 443 and proxy to cms service \n        listen 443 ssl; \n        ssl_certificate /root/server.crt; #certificate generated by customers \n        ssl_certificate_key /root/server.key; #key generated by customers \n        ssl_protocols TLSv1.2;\n        location ^~ / { \n            proxy_set_header Host \"&lt;nginx-cms host&gt;:443\";\n            proxy_pass https://cms-service; \n        } \n     }\n}\n</pre><p>Replace the following placeholders with the related FQDNs and change your server certificate and server key paths:</p><ul><li>&lt;control plane node 1&gt;: FQDN of the first control plane node</li><li>&lt;control plane node 2&gt;: FQDN of the second control plane node</li><li>&lt;control plane node 3&gt;: FQDN of the third control plane node</li><li>&lt;nginx-cms host&gt; (for port 443): UD/UCMDB Nginx server hostname</li><li>/root/server.crt and /root/server.key (for port 443): paths of the server certificate and server key files that you have generated for nginx-cms (<strong>server.crt</strong> and <strong>server.key</strong>)</li></ul><h5><em>Configure nginx-integration</em></h5><p>Make sure the Nginx configuration file (nginx.conf) contains the following settings.</p><pre>http {\n   \n    upstream suite-service {     #upstream for suite service\n        least_conn;\n        session_sticky;\n        keepalive 32;\n        server &lt;control plane node 1&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 1\n        server &lt;control plane node 2&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 2\n        server &lt;control plane node 3&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 3\n   }\n   upstream cms-service { #upstream for cms service \n       least_conn; \n       session_sticky;\n       keepalive 32;\n       server &lt;control plane node 1&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 1 \n       server &lt;control plane node 2&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 2 \n       server &lt;control plane node 3&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 3 \n}\n    server { #listen on 443 and proxy to suite service\n        underscores_in_headers on;\n        listen 443  ssl;\n        ssl_certificate                         /root/server.crt;       #certificate generated by customers\n        ssl_certificate_key                  /root/server.key;      #key generated by customers \n        ssl_protocols TLSv1.2;\n        location ^~ / {\n            proxy_set_header Host            \"&lt;<strong>nginx-integration</strong>&gt;:443\";\n            proxy_pass                             https://suite-service;\n            # Allow websocket connections       \n            proxy_set_header Upgrade $http_upgrade;       \n            proxy_set_header Connection \"upgrade\"; \n        }\n    }\n    server { #listen on 3443 and proxy to cms service \n        underscores_in_headers on;\n        listen 3443 ssl; \n        ssl_certificate /root/server.crt; #certificate generated by customers \n        ssl_certificate_key /root/server.key; #key generated by customers \n        ssl_protocols TLSv1.2;\n        location ^~ / { \n            proxy_set_header Host \"&lt;<strong>nginx-integration</strong>&gt;:3443\";\n            proxy_pass https://cms-service; \n            # Allow websocket connections       \n            proxy_set_header Upgrade $http_upgrade;       \n            proxy_set_header Connection \"upgrade\";\n        } \n     }\n}\n</pre><p>Replace the following placeholders with the related FQDNs and change your server certificate and server key paths:</p><ul><li>&lt;control plane node 1&gt;: FQDN of the first control plane node</li><li>&lt;control plane node 2&gt;: FQDN of the second control plane node</li><li>&lt;control plane node 3&gt;: FQDN of the third control plane node</li><li>&lt;nginx-integration&gt;: FQDN of the integration Nginx server</li><li>/root/server.crt and /root/server.key (for ports 3443 and 443): paths of the server certificate and server key files that you have generated for nginx-integration (<strong>server.crt</strong> and <strong>server.key</strong>)</li></ul><h4 id=\"Use_the_external_load_balancer_to_log_in\">Login URLs and integration URLs</h4><p>The following table describes the login URLs and URLs for the UD/UCMDB integration.</p><table class=\"Table\" style=\"border-collapse:collapse\"><thead><tr><th scope=\"col\">Type</th><th scope=\"col\">Item</th><th scope=\"col\">Value</th><th scope=\"col\">Example</th></tr></thead><tbody><tr><td colspan=\"1\" rowspan=\"3\">Login URL</td><td>OMT management portal URL</td><td>https://&lt;external access host&gt;:5443</td><td>https://smax.example-domain-1.com:5443</td></tr><tr><td>Suite URL</td><td>https://&lt;external access host&gt;:443</td><td>https://smax.example-domain-1.com:443</td></tr><tr><td>UD/UCMDB URL</td><td>https://&lt;nginx-cms host&gt;:443/cms</td><td>https://cms.example-domain-2.com:443/cms</td></tr><tr><td colspan=\"1\" rowspan=\"3\">Integration URL</td><td>URL for UD/UCMDB to access the suite</td><td>https://&lt;nginx-integration host&gt;:443</td><td>https://intl.gtw.mf.com:443</td></tr><tr><td>URL for the suite to access UD/UCMDB</td><td>https://&lt;nginx-integration host&gt;:3443</td><td>https://intl.gtw.mf.com:3443</td></tr><tr><td>URL for the suite to access UCMDB Gateway</td><td>https://&lt;nginx-integration host&gt;:3443/cms-gateway</td><td>https://intl.gtw.mf.com:3443/cms-gateway</td></tr></tbody></table><p><strong>Tip</strong>: You need the UCMDB Gateway URL when enabling the Native SACM and SAM solutions. See <a _ngcontent-c23=\"\" href=\"/doc/423/26.1/enablenativesacminsma\" title=\"Enable Native SACM in Service Management\">Enable Native SACM in Service Management</a> and <a _ngcontent-c23=\"\" href=\"/doc/423/26.1/enablesaminsmax\" title=\"Enable the SAM capability\">Enable the SAM capability</a>.</p><h3 id=\"firstHeading\" lang=\"en\">Option 2: Configure external load balancers in a network without DMZ</h3><p>Perform the following steps.</p><h4>Install the Nginx server</h4><p>Install two Nginx servers on different hosts, or on the same host.</p><ul><li>One Nginx server for the suite and OMT (referred to as <strong>nginx-smax</strong>). This Nginx server is used to handle requests from end users accessing from the Internet,  and it can also be used in the URL of the integration with UD/UCMDB. You need to bind the external access host name that you have configured in the <strong>values.yaml</strong> file of Service Management to the IP address of this Nginx server.</li><li>One Nginx server for UD/UCMDB (referred to as <strong>nginx-cms</strong>).</li></ul><h4>Prepare certificates for each Nginx server</h4><p>Prepare a server certificate and server key file (<strong>server.crt</strong> and <strong>server.key</strong>) separately for each of the two FQDNs, and use CN=&lt;access host&gt; when generating the server certificate:</p><ul><li>For <strong>nginx-smax</strong>,<strong> </strong>&lt;access host&gt; is the external access host name that's bound with the IP address of nginx-smax.</li><li>For <strong>nginx-cms</strong>, &lt;access host&gt; is the UD/UCMDB Nginx server host name.</li></ul><h4 id=\"Configure_nginx\">Configure Nginx</h4><p>Configure the Nginx servers as described below.</p><h5><em>configure nginx-smax</em></h5><p>Make sure the Nginx configuration file (nginx.conf) contains the following settings.</p><pre>http {\n    upstream management {     #upstream for management service\n        least_conn;\n        session_sticky;\n        keepalive 32;\n        server &lt;control plane node 1&gt;:5443 max_fails=3 fail_timeout=10s;     #control plane node 1\n        server &lt;control plane node 2&gt;:5443 max_fails=3 fail_timeout=10s;     #control plane node 2\n        server &lt;control plane node 3&gt;:5443 max_fails=3 fail_timeout=10s;     #control plane node 3\n    } \n    upstream suite-service {     #upstream for suite service\n        least_conn;\n        session_sticky;\n        keepalive 32;\n        server &lt;control plane node 1&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 1\n        server &lt;control plane node 2&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 2\n        server &lt;control plane node 3&gt;:443 max_fails=3 fail_timeout=10s;     #control plane node 3\n   }\n   \n    server { #listen on 5443 and proxy to management service\n        listen 5443  ssl;\n        ssl_protocols TLSv1.2;\n        ssl_certificate                         /root/server.crt;       #certificate generated by customers\n        ssl_certificate_key                  /root/server.key;      #key generated by customers \n        location ^~ / {\n            proxy_set_header Host            \"&lt;external access host&gt;:5443\";\n            proxy_pass                              https://management;\n        }\n    } \nserver { #listen on 443 and proxy to suite service \n        listen 443 ssl;\n        ssl_protocols TLSv1.2;\n        ssl_certificate /root/server.crt; #certificate generated by customers\n        ssl_certificate_key /root/server.key; #key generated by customers \n        location ^~ / { \n            proxy_set_header Host \"&lt;external access host&gt;:443\"; \n            proxy_pass https://suite-service;\n       } \n }\n \n}\n</pre><p>Replace the following placeholders with the related FQDNs and change your server certificate and server key paths:</p><ul><li>&lt;control plane node 1&gt;: FQDN of the first control plane node</li><li>&lt;control plane node 2&gt;: FQDN of the second control plane node</li><li>&lt;control plane node 3&gt;: FQDN of the third control plane node</li><li>&lt;external access host&gt;: the external access host name of the suite</li><li>/root/server.crt and /root/server.key (for ports 5443 and 443): paths of the server certificate and server key files that you have generated for nginx-smax (<strong>server.crt</strong> and <strong>server.key</strong>)</li></ul><h5><em>Configure nginx-cms</em></h5><p>Make sure the Nginx configuration file (nginx.conf) contains the following settings.</p><pre>http {\n   upstream cms-service { #upstream for cms service \n       least_conn; \n       session_sticky;\n       keepalive 32;\n       server &lt;control plane node 1&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 1 \n       server &lt;control plane node 2&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 2 \n       server &lt;control plane node 3&gt;:443 max_fails=3 fail_timeout=10s; #control plane node 3 \n} \n    server { #listen on 443 and proxy to cms service \n    underscores_in_headers on;\n        listen 443 ssl;\n        ssl_protocols TLSv1.2;\n        ssl_certificate /root/server.crt; #certificate generated by customers \n        ssl_certificate_key /root/server.key; #key generated by customers \n        location ^~ / { \n            proxy_set_header Host \"&lt;nginx-cms host&gt;:443\";\n            proxy_pass https://cms-service; \n            # Allow websocket connections\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection \"upgrade\";\n        } \n     }\n}\n</pre><p>Replace the following placeholders with the related FQDNs and change your server certificate and server key paths:</p><ul><li>&lt;control plane node 1&gt;: FQDN of the first control plane node</li><li>&lt;control plane node 2&gt;: FQDN of the second control plane node</li><li>&lt;control plane node 3&gt;: FQDN of the third control plane node</li><li>&lt;nginx-cms host&gt;: FQDN of the UD/UCMDB Nginx server host</li><li>/root/server.crt and /root/server.key (for port 443): paths of the server certificate and server key files that you have generated for nginx-cms (<strong>server.crt</strong> and <strong>server.key</strong>)</li></ul><h4 id=\"Use_the_external_load_balancer_to_log_in\">Login URLs and URLs for the UD/UCMDB integration</h4><p>The following table describes the login URLs and URLs for the UD/UCMDB integration.</p><table class=\"Table\" style=\"border-collapse:collapse\"><thead><tr><th scope=\"col\">Type</th><th scope=\"col\">Item</th><th scope=\"col\">Value</th><th scope=\"col\">Example</th></tr></thead><tbody><tr><td colspan=\"1\" rowspan=\"3\">Login URL</td><td>OMT management portal URL</td><td>https://&lt;external access host&gt;:5443</td><td>https://smax.example-domain-1.com:5443</td></tr><tr><td>Suite URL</td><td>https://&lt;external access host&gt;:443</td><td>https://smax.example-domain-1.com:443</td></tr><tr><td>UD/UCMDB URL</td><td>https://&lt;nginx-cms host&gt;:443/cms</td><td>https://cms.example-domain-2.com:443/cms</td></tr><tr><td colspan=\"1\" rowspan=\"3\">Integration URL</td><td>URL for UD/UCMDB to access the suite</td><td>https://&lt;nginx-smax host&gt;:443</td><td>https://smax.example-domain-1.com:443</td></tr><tr><td>URL for the suite to access UD/UCMDB</td><td>https://&lt;nginx-cms host&gt;:443</td><td>https://cms.example-domain-2.com:443</td></tr><tr><td>URL for the suite to access UCMDB Gateway</td><td>https://&lt;nginx-cms host&gt;:444/cms-gateway</td><td>https://cms.example-domain-2.com:443/cms-gateway</td></tr></tbody></table><p><strong>Tip</strong>: You need the UCMDB Gateway URL when enabling the Native SACM and SAM solutions. See <a _ngcontent-c23=\"\" href=\"/doc/423/26.1/enablenativesacminsma\" title=\"Enable Native SACM in Service Management\">Enable Native SACM in Service Management</a> and <a _ngcontent-c23=\"\" href=\"/doc/423/26.1/enablesaminsmax\" title=\"Enable the SAM capability\">Enable the SAM capability</a>.</p><h3>Option 3: use the existing Keepalived in the network structure</h3><p>This option leverages the existing Keepalived functionality and therefore doesn't use any external load balancers. </p><h4 id=\"Use_the_external_load_balancer_to_log_in\">Login URLs and URLs for the UD/UCMDB integration</h4><p>The following table describes the login URLs and URLs for the UD/UCMDB integration.</p><table class=\"Table\" style=\"border-collapse:collapse\"><thead><tr><th scope=\"col\">Type</th><th scope=\"col\">Item</th><th scope=\"col\">Value</th><th scope=\"col\">Example</th></tr></thead><tbody><tr><td colspan=\"1\" rowspan=\"3\">Login URL</td><td>OMT management portal URL</td><td>https://&lt;external access host&gt;:5443</td><td>https://myhost.example-domain.com:5443</td></tr><tr><td>Suite URL</td><td>https://&lt;external access host&gt;:443</td><td>https://myhost.example-domain.com:443</td></tr><tr><td>UD/UCMDB URL</td><td>https://&lt;external access host&gt;:3443/cms</td><td>https://myhost.example-domain.com:3443/cms</td></tr><tr><td colspan=\"1\" rowspan=\"3\">Integration URL</td><td>URL for UD/UCMDB to access the suite</td><td>https://&lt;external access host&gt;:443</td><td>https://myhost.example-domain.com:443</td></tr><tr><td>URL for the suite to access UD/UCMDB</td><td>https://&lt;external access host&gt;:3443</td><td>https://myhost.example-domain.com:3443</td></tr><tr><td>URL for the suite to access UCMDB Gateway</td><td>https://&lt;external access host&gt;:3443/cms-gateway</td><td>https://myhost.example-domain.com:3443/cms-gateway</td></tr></tbody></table><div class=\"admonition\"><div class=\"admonition-icon admonition-tip-icon\"></div><div class=\"admonition-content admonition-tip-content\"><strong> </strong>You need the UCMDB Gateway URL when enabling the Native SACM and SAM solutions. See <a _ngcontent-c23=\"\" href=\"/doc/423/26.1/enablenativesacminsma\" title=\"Enable Native SACM\">Enable Native SACM</a> and <a _ngcontent-c23=\"\" href=\"/doc/423/26.1/enablesaminsmax\" title=\"Enable SAM\">Enable SAM</a>.</div></div><h2>Install the containerized UD/UCMDB as the next deployment on the same OMT </h2><p>Perform the following steps to install UD/UCMDB on the same OMT on which the suite is installed:</p><ol><li><a href=\"/doc/423/26.1/cmswithsmaxdownloadcmschartpackage\" title=\"Download the UD/UCMDB chart package\">Download the UD/UCMDB chart package</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxdownloadcontainerimages\" title=\"Download container images for UD/UCMDB\">Download container images for UD/UCMDB</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxuploadinstallationimages\" title=\"Upload container images for UD/UCMDB to a registry\">Upload container images for UD/UCMDB to a registry</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxcreatenfsvolumes\" title=\"Configure NFS volumes for UD/UCMDB\">Configure NFS volumes for UD/UCMDB</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxpreparepvs\" title=\"Prepare persistent volumes for UD/UCMDB\">Prepare persistent volumes for UD/UCMDB</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxprepareexternaldb\" title=\"Prepare external databases for UD/UCMDB\">Prepare external databases for UD/UCMDB</a></li><li><a href=\"/doc/423/26.1/createcmsroleuserinsmaidm\" title=\"Create UD/UCMDB integration admin user in the suite IdM\">Create UD/UCMDB integration admin user in the suite IdM</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxcreateyaml\" title=\"Create my-values.yaml\">Create my-values.yaml</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxcreatedeployment\" title=\"Create a deployment for UD/UCMDB\">Create a deployment for UD/UCMDB</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxgeneratevault\" title=\"Generate vault secrets\">Generate vault secrets</a></li><li><a href=\"/doc/423/26.1/installcmswithsmaxinstallcms\" title=\"Install UD/UCMDB on OMT \">Install UD/UCMDB on OMT </a></li><li><a href=\"/doc/423/26.1/installcmswithsmaxverify\" title=\"Verify the installation\">Verify the installation</a></li><li><a href=\"/doc/423/26.1/associatecmssuperadminrole\" title=\"Associate UD/UCMDB SuperAdmin role\">Associate UD/UCMDB SuperAdmin role</a></li></ol><h2>Related topics</h2><ul><li><a _ngcontent-c23=\"\" href=\"/doc/423/26.1/enablenativesacminsma\" title=\"Enable Native SACM\">Enable Native SACM</a></li><li><a _ngcontent-c23=\"\" href=\"/doc/423/26.1/enablesaminsmax\" title=\"Enable SAM\">Enable SAM</a></li><li><a href=\"/doc/423/26.1/cmswithsmaxuninstallcms\" title=\"Uninstall containerized UD/UCMDB\">Uninstall containerized UD/UCMDB</a></li></ul></div>",
  "modifiedon": "2025-10-24 08:51:12"
}