{
  "title": "Integration Studio based Microsoft 365 email integration",
  "content": "<div class=\"mw-parser-output\"><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-smax_rebranding_admonition\"></span><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>Any mention of the term SMAX in this topic refers to Service Management, which was formerly known as Service Management Automation X (SMAX).</div></div></div><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-smax_rebranding_admonition\"></span><h2><a id=\"Overview\" name=\"Overview\" title=\"Overview\"></a>Overview</h2><p>The MS365 Email Integration solution leverages the Microsoft Graph API to seamlessly integrate Microsoft 365 email with your service management system. This integration enables automatic creation and updating of records from emails, enhancing efficiency and ensuring timely responses to user requests. The integration supports two main use cases:</p><div class=\"admonition\"><div class=\"admonition-icon admonition-caution-icon\"></div><div class=\"admonition-content admonition-caution-content\"><div>If you configure the solution to create records via email, email senders will also receive updates on the record, including solutions to their requests, through email notifications. It remains your sole responsibility to configure the solution properly to make sure that sensitive information is not exposed.</div></div></div><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><strong>Create Records from Emails</strong>: Automatically creates various types of records (requests, incidents, problems, changes) from emails sent to a specific Microsoft 365 mailbox.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><strong>Update Records by Emails</strong>: Updates existing records based on the content of the emails, allowing actions like approve/deny, accept/reject, add a comment, or provide info.</li></ol><p>From a scenario perspective, there are three scenarios:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><strong>Create Records from Emails</strong>: This scenario processes incoming emails to create new records in the service management system.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><strong>Update Records by Emails</strong>: This scenario processes incoming emails to update existing records in the service management system.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><strong>Manage Email Subscription</strong>: This scenario is crucial for both the create and update use cases. It handles the creation and renewal of subscriptions and ensures that the listener receives notifications and processes emails promptly.</li></ol><p>The <strong>Manage Email Subscription</strong> scenario ensures that the system remains updated and functional by renewing subscriptions daily, which is essential for the other two scenarios to operate smoothly. This setup helps maintain continuous and efficient email processing for both creating and updating records.</p><h2><a id=\"Create_records_from_emails\" name=\"Create_records_from_emails\" title=\"Create records from emails\"></a>Create records from emails</h2><h3 id=\"Overview\">Overview</h3><p>A listener or a scheduler can trigger this scenario.</p><p>When triggered by the listener, it runs in notified process mode. Here’s the data flow:</p><div><a class=\"image\" href=\"\"><img alt=\"Notified Process\" src=\"../../../images/ms365_email_notified_process2_516715a2.jpeg\" style=\"width: 859px; height: 400px;\"/></a></div><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">A user sends an email to Office 365.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The Change notification API notifies the <strong>Create records from emails</strong> scenario listener with mail ID.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The <strong>Create records from emails</strong> scenario gets the received email.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The <strong>Create records from emails</strong> scenario creates a record in Service Management.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The Notification service sends a notification for record creation.</li></ol><p>When triggered by the scheduler, it runs in scheduled process mode. Here’s the data flow:</p><div><a class=\"image\" href=\"\"><img alt=\"Notified Process\" src=\"../../../images/ms365_email_scheduled_process_c68b30bf.jpeg\" style=\"width: 859px; height: 399px;\"/></a></div><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Users send emails to Office 365.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The scheduler triggers the <strong>Create records from emails</strong> scenario hourly.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The <strong>Create records from emails sc</strong>enario retrieves the emails awaiting processing in the mailbox.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The <strong>Create records from emails</strong> scenario creates records in Service Management for each mail.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The Notification service sends notifications for every record creation.</li></ol><p style=\"margin-bottom: 8px; margin-left: 36px; text-indent: -0.38in; text-align: left;\"><span style=\"font-size: 14px;\">Here is how the email content is processed in the Service Management record:</span></p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">The email subject is used as the request title.</li><li style=\"margin-left: 28px; position: relative;\">The email body is used as the request description. Inline images and the mail body format will remain unchanged in the request description.</li><li style=\"margin-left: 28px; position: relative;\">Emails with attachments are downloaded as files with an .eml extension and added to the record attachment. The maximum size for an email, including inline images and attachments, is 10 MB. Emails that exceed this limit will be redirected to the Error folder without processing.</li></ul><h3><a id=\"Prerequisites\" name=\"Prerequisites\" title=\"Prerequisites\"></a>Prerequisites</h3><p>To set up the integration, make sure the following prerequisites are satisfied.</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">You have registered an app in the Azure Portal. During the app registration, enter this as the Web Redirect URL: <strong>https://&lt;Service Management FQDN&gt;/rest/&lt;Service Management tenant Id&gt;/opb/oauth/callback</strong>. Note that if you have configured a custom domain for the tenant, you can add another redirect URL for the custom domain (replace <strong>&lt;Service Management FQDN&gt;</strong> with the custom domain in the preceding URL).</li><li style=\"margin-left: 28px; position: relative;\">Note the app's application ID, which will be used in the Service Management endpoint to connect to the Graph API.</li><li style=\"margin-left: 28px; position: relative;\">You have added a client secret for the app. The Service Management endpoint uses the secret value to connect to the Graph API.</li><li style=\"margin-left: 28px; position: relative;\"><div>You have requested mailboxes for each record type. One record type requires one dedicated mailbox.</div></li><li style=\"margin-left: 28px; position: relative;\">If you want the email integration to monitor a shared mailbox (as opposed to a user mailbox), ask your Azure admin to create one and assign you the read and manage emails permission for it.</li><li style=\"margin-left: 28px; position: relative;\">You have assigned the appropriate permissions to the app.\n\t<p>If you use a user mailbox, assign the following delegated permissions:</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Mail.Read</strong> (to read the emails)</li><li style=\"margin-left: 40px; position: relative;\"><strong>Mail.ReadWrite</strong> (to move the emails to a different folder)</li><li style=\"margin-left: 40px; position: relative;\"><strong>User.Read</strong> (to get user details)</li></ul><p>If you use a shared mailbox, assign the following delegated permissions:</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Mail.Read.Shared</strong> (to read the emails)</li><li style=\"margin-left: 40px; position: relative;\"><strong>Mail.ReadWrite.Shared</strong> (to move the emails to a different folder)</li><li style=\"margin-left: 40px; position: relative;\"><strong>User.Read</strong> (to get user details)</li></ul><p>Each action might require different permissions. For details, see the <a href=\"https://learn.microsoft.com/en-us/graph/use-the-api\" title=\"Microsoft Graph API\">Microsoft Graph API</a> documentation.</p></li></ul><h3><a id=\"Set_up_the_integration\" name=\"Set_up_the_integration\" title=\"Set up the integration\"></a>Set up the integration</h3><p>To set up the email integration, complete these tasks.</p><h4><a id=\"Configure_mailbox\" name=\"Configure_mailbox\" title=\"Configure mailbox\"></a>Configure mailbox</h4><article data-scroll-anchor=\"true\" data-testid=\"conversation-turn-11\" dir=\"auto\"><p>To configure the mailbox, create the necessary folders and set up the mailbox rules.</p></article><h5><a id=\"Create_folders_in_mailbox\" name=\"Create_folders_in_mailbox\" title=\"Create folders in mailbox\"></a>Create folders in mailbox</h5><p>The Create records from emails scenario moves the emails to the relevant folder based on process status. Create the following folders directly under the root folder. </p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\"><strong>ToCreateRecord</strong>: Emails in this folder will be processed to create records.</li><li style=\"margin-left: 28px; position: relative;\"><strong>Processed:</strong> Emails that successfully create records will move to this folder.</li><li style=\"margin-left: 28px; position: relative;\"><strong>Errors:</strong> Emails that fail to create records will move to this folder.</li><li style=\"margin-left: 28px; position: relative;\"><strong>FromNotAllowedDomain:</strong> Emails from not allowed domains will move to this folder.</li><li style=\"margin-left: 28px; position: relative;\"><strong>Skipped:</strong> Emails that don't need processing, such as forwarded or replied messages, will move to this folder.</li></ul><h5><a id=\"Configure_mailbox_rules\" name=\"Configure_mailbox_rules\" title=\"Configure mailbox rules\"></a>Configure mailbox rules</h5><p>This solution uses mailbox rules to identify and exclude emails from disallowed domains, preventing them from being processed. Set the rules properly. Emails in the <strong>ToCreateRecord</strong> folder will be processed as records.</p><article data-scroll-anchor=\"false\" data-testid=\"conversation-turn-11\" dir=\"auto\"><p>Here are the example rules you can configure. Make sure they run in the specified order.</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p><strong>Move Replied or Forwarded Emails to Skipped Folder</strong></p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Name</strong>: Move replied or forwarded emails to the Skipped folder</li><li style=\"margin-left: 40px; position: relative;\"><strong>Condition</strong>: Subject includes keywords such as <strong>RE:, Re:, FW:, Fw:, </strong>and <strong>Automatic reply:</strong>.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Action</strong>: Move to Skipped</li><li style=\"margin-left: 40px; position: relative;\"><strong>Stop Processing More Rules</strong>: Yes</li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p><strong>Move Emails from Allowed Domains to ToCreateRecord Folder</strong></p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Name</strong>: Move emails from allowed domains to ToCreateRecord folder</li><li style=\"margin-left: 40px; position: relative;\"><strong>Condition</strong>: Sender address includes allowed domains, for example @CompanyA.com, @CompanyB.com</li><li style=\"margin-left: 40px; position: relative;\"><strong>Action</strong>: Move to ToCreateRecord</li><li style=\"margin-left: 40px; position: relative;\"><strong>Stop Processing More Rules</strong>: Yes</li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p><strong>Move All Other Emails to FromNotAllowedDomain Folder</strong></p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Name</strong>: Move all other emails to FromNotAllowedDomain folder</li><li style=\"margin-left: 40px; position: relative;\"><strong>Condition</strong>: Apply to all messages</li><li style=\"margin-left: 40px; position: relative;\"><strong>Action</strong>: Move to FromNotAllowedDomain</li><li style=\"margin-left: 40px; position: relative;\"><strong>Stop Processing More Rules</strong>: Yes</li></ul></li></ol><h4><a id=\"Prepare_integration_user\" name=\"Prepare_integration_user\" title=\"Prepare integration user\"></a>Prepare integration user</h4><p>We recommend creating a dedicated integration user for each integration.</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create an integration user. See <a href=\"/doc/423/26.1/createuser\" title=\"How to create an integration user\">How to create an integration user</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to Agent Interface as the tenant admin.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Administration &gt; Master Data &gt; People</strong>, locate the integration user, and assign the proper roles to access the required modules. At a minimum, the role should have the following permissions:<br/>\n\tTo integrate with the Request record type:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">The <strong>On-Premise Bridge/Integration Administrator</strong> permission</li><li style=\"margin-left: 40px; position: relative;\">The <b>View </b>permission to the Person record type</li><li style=\"margin-left: 40px; position: relative;\">The <b>View</b> and <strong>Create</strong> permissions to the Request record type</li></ul>\n\tTo integrate with the Incident, Problem, or Change record types:\n\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">The <b>View</b> permission to the Person record type</li><li style=\"margin-left: 40px; position: relative;\">The <b>View</b> and <strong>Create</strong> permissions to the relevant record type</li></ul>\n\tIf you want non-Service Management users to create records by email, please add <strong>Tenant Admin </strong>role. </li></ol><h4><a id=\"Create_an_endpoint\" name=\"Create_an_endpoint\" title=\"Create an endpoint\"></a>Create an endpoint</h4><p>Create an endpoint using the Rest Executor 2.0 endpoint type:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Administration &gt; Utilities &gt; Integration &gt; Endpoints</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Add</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <strong>Rest Executor 2.0</strong> as the endpoint type, enter a name for the endpoint (for example, Microsoft 365), and then click <strong>Add</strong>. The system creates the endpoint.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Configure</strong> and complete the following fields.\n\t<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\"><thead><tr><th scope=\"col\">Field</th><th scope=\"col\">Value</th></tr></thead><tbody><tr><td colspan=\"2\"><strong>General configuration</strong></td></tr><tr><td>Agent</td><td>Select <strong>Agentless</strong> for a direct connection to the Graph API.</td></tr><tr><td>Authentication type</td><td>Select <strong>OAuth 2.0</strong></td></tr><tr><td>Protocol</td><td>Select <strong>https</strong>.</td></tr><tr><td>Base URL</td><td>Enter the base URL of the Graph API: <strong>https://graph.microsoft.com</strong>.</td></tr><tr><td>Certificate type</td><td>Optional</td></tr><tr><td>Certificate format</td><td>Optional</td></tr><tr><td>Server certificate</td><td>Optional</td></tr><tr><td>Enable email notification for expired token</td><td>Optional</td></tr><tr><td>Recipients</td><td>Optional</td></tr><tr><td colspan=\"2\"><strong>Get Token configuration</strong></td></tr><tr><td>Grant Type</td><td><p>Authorization Code</p></td></tr><tr><td>Client ID</td><td>The application ID.</td></tr><tr><td>Client Secret</td><td>The client's secret value for the app.</td></tr><tr><td>Authorization URL</td><td><p>The URL can be found under <strong>Endpoints</strong> for the app in the Azure Portal (use the v2 one).</p><p>If you have enabled SAML SSO with Azure AD in Service Management and want to log in as a different user during the <em>Get token</em> process in the next step, add <code>&amp;prompt=login</code> at the end of the URL. Example: <strong>https://login.microsoftonline.com/&lt;Directory_Id&gt;/oauth2/v2.0/authorize?prompt=login</strong>.</p></td></tr><tr><td>Redirect URL</td><td>Automatically generated.</td></tr><tr><td>Token URL</td><td>The URL can be found under <strong>Endpoints</strong> for the app in the Azure Portal (use the v2 one).</td></tr><tr><td>Scope</td><td><p>Enter: <strong>https://graph.microsoft.com/.default offline_access</strong>.</p></td></tr><tr><td>State</td><td>Optional</td></tr><tr><td>Send client Id and secret</td><td>In body</td></tr></tbody></table></li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Get token</strong>, and then complete the login and consent process. If your endpoint configuration is correct, you will see the <b>Available </b>status in the <strong>Token status</strong> section after the process is finished.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Save</strong>.</li></ol><h4><a id=\"Create_an_integration\" name=\"Create_an_integration\" title=\"Create an integration\"></a>Create an integration</h4><p>Perform the following steps to create an integration based on the Microsoft Graph connector.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>Create one dedicated integration for each record type.</div></div></div><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Administration </strong>&gt; <strong>Utilities </strong>&gt; <strong>Integration </strong>&gt; <strong>Integration Studio</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>New</strong>, enter the name of your integration, and then click <strong>Save</strong>. The system displays the Integration page.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Details</strong> section, configure the integration user you created for the current Service Management system and activate the integration.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Connector-Endpoint mappings</strong> section, click <strong>Add</strong> to add a mapping.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <strong>Graph</strong> (under <strong>Microsoft</strong>) as the connector, select the Microsoft 365 endpoint created earlier, and then enter an alias for the mapping.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Save</strong>.</li></ol><h4><a id=\"Configure_the_scenario\" name=\"Configure_the_scenario\" title=\"Configure the scenario\"></a>Configure the scenario</h4><p>Perform the following steps to add and configure two Process email scenarios using the predefined template:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Add scenario</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Enter a name for the scenario. For example, enter \"Create records from emails\".</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Template</strong> field, select <strong>Create records from emails</strong> (under <strong>Microsoft Graph</strong>) from the list.\n\t<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>Using templates simplifies integration configuration compared to starting from scratch. If you don't use this option, you must manually add your logic, starting from a blank page.</div></div></div></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Keep <strong>Enable Listener</strong> selected and click <strong>Save</strong> to add the scenario.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>General </strong>section, select <strong>Active</strong>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Listener </strong>section, click <a class=\"image\" href=\"\"><img alt=\"Generate\" src=\"../../../images/Xie_Generate_d7e2194a.png\" style=\"width: 25px; height: 26px;\"/></a><strong> Generate</strong>. Provide the integration username and password and specify the expiration date of the webhook URL. Enter the email address of recipients who will receive notifications when the webhook URL expires.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Process logic</strong> section, locate <strong>Settings</strong>, add a rule with the following parameters, and click <strong>Save</strong>.\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>UseSharedMailbox</strong>: If set to <strong>true</strong>, the system will check emails in the shared mailbox specified in the <strong>SharedMailboxAddress</strong> parameter. If set to <strong>false</strong>, the system will check emails in the mailbox for the user who performed the <strong>get token</strong> operation on the Endpoint page instead.</li><li style=\"margin-left: 40px; position: relative;\"><strong>SharedMailboxAddress</strong>: The email address for the shared mailbox.</li><li style=\"margin-left: 40px; position: relative;\"><strong>AllowNonSMAXUser</strong>: If set to <strong>true</strong>, the system will create a contact with the sender's email and <strong>External Contact</strong> value as the name, and then create a record for the contact. For configurations on creating external contacts, refer to the <em>Create SMAX contact with external mail</em> step in the <strong>Process emails</strong> scenario. If set to <strong>false</strong>, the system requires the mail sender to be a valid system user when creating a record; if not, the request will not be created and the email will be moved to the error folder. </li><li style=\"margin-left: 40px; position: relative;\"><strong>AddEntireEmailAsAttachment:</strong> Adds the entire email as an attachment to the created record. Default value is <strong>true</strong>. To avoid adding<strong> </strong>the email as an attachment, set it to <strong>false.</strong></li><li style=\"margin-left: 40px; position: relative;\"><strong>AddAttachments: </strong>Adds each attachment individually to the created record. Default value is <strong>true</strong>. To avoid adding attachments, set it to <strong>false.</strong> </li><li style=\"margin-left: 40px; position: relative;\"><strong>ReceiveFolderName</strong>: The folder where emails are checked. </li><li style=\"margin-left: 40px; position: relative;\"><strong>SuccessFolderName</strong>: The folder where successfully processed emails are moved. You should have already created the folder when you completed the prerequisite tasks.</li><li style=\"margin-left: 40px; position: relative;\"><strong>ErrorFolderName</strong>: The folder where failed-to-process emails are moved. You should have already created the folder when you completed the prerequisite tasks.</li><li style=\"margin-left: 40px; position: relative;\"><strong>RecordType</strong>: Update this value if you want to customize the scenario to create record types other than requests. Note that you need to enter the record type name displayed above the left pane on the <strong>Processes and Rule</strong> tab of Studio.</li><li style=\"margin-left: 40px; position: relative;\"><strong>SettingsCacheName</strong>:<strong> </strong>The <strong>Process emails</strong> scenario stores the settings in local storage and shares them with the <strong>Manage email subscription</strong> scenario in the same integration. So, this value should be consistent in these two scenarios.</li><li style=\"margin-left: 40px; position: relative;\"><strong>EnableRichText</strong>:<strong></strong>If set to true, rich text formatting such as bold, italics, hyperlinks, and inline images are retained in the record description. If set to false, the record description is converted to plain text, removing all rich text formatting and inline images.\n\t\t<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>The <strong>EnableRichText </strong>parameter setting is available in versions 25.1.1 and above.</div></div></div></li><li style=\"margin-left: 40px; position: relative;\"><strong>MaxProcessMailCountByScheduler</strong>: The number of emails pulled from the mail server when the scheduler triggers the scenario. The maximum value is 1,000.</li><li style=\"margin-left: 40px; position: relative;\"><strong>IncidentDefaultActualService</strong>: The default actual service ID used when creating an incident. Configure this field if you set <strong>RecordType </strong>to <strong>Incident</strong>.\n\t\t<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>If set <strong>AllowNonSMAXUser </strong>is true, you must have the <strong>Tenant Admin role</strong> to create contact user success<strong>.</strong></div></div></div></li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Repeat steps 1 through 6 to configure the <strong>Manage email subscription</strong><span style=\"box-sizing: border-box; margin: 0px; padding: 0px;\"><strong> </strong></span>scenario. In step 3, select <strong>Manage email subscription</strong><strong> </strong>for the <strong>Template </strong>field.</li></ol><h4><a id=\"Validate_the_configuration\" name=\"Validate_the_configuration\" title=\"Validate the configuration\"></a><span style=\"font-size: clamp(1.3125rem, 15.4737px + 1.15132vw, 1.75rem);\">Validate the configuration</span></h4><p>Perform the following steps to validate that configurations are correct for two scenarios:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Go to the <strong>Create records from emails</strong> scenario.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Run scenario </strong>and confirm to run the selected scenario.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Execution history </strong>and wait until the scenario enters the <strong>Finish </strong>status. If the status is <strong>Failed</strong>, check if specific configurations are incorrect.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Go to the <strong>Manage email subscription</strong> scenario and repeat steps 2 and 3.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Send an email to the mailbox. If the <strong>Manage email subscription</strong> scenario works correctly, the <strong>Process emails</strong> scenario will be triggered by the listener immediately. </li></ol><h3><a id=\"Use_the_integration\" name=\"Use_the_integration\" title=\"Use the integration\"></a>Use the integration</h3><p>Select the scenario and click <strong style=\"font-size: 14px;\">Run scenario</strong><span style=\"box-sizing: border-box; margin: 0px; padding: 0px;\"><strong> </strong></span>to use the integration. We recommend setting up the scheduler to run these two scenarios regularly. To do this, follow these steps:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Administration </strong>&gt; <strong>Utilities </strong>&gt; <strong>Integration </strong>&gt; <strong>Integration Studio</strong> &gt; <strong>Scheduler</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Add</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Enter a name for the scheduler. For example, enter \"Hourly process emails\".</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">For <strong>Integration</strong>, select the integration created earlier.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">For <strong>Scenario</strong>, select <strong>Create records from emails</strong> from the list, and then click <strong>Next</strong>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Starts </strong>section, configure <strong>Time zone</strong> and <strong>Start date</strong>. In the <strong>Repeats </strong>section, configure a schedule for every<strong> 1 hour(s)</strong>. Then, click <strong>Next</strong>.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Save</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Repeat the above steps for the <strong>Manage email subscription</strong><b> </b>scenario. You should only run this scenario once a day.</li></ol><p>Once all configurations are complete, the system can automatically create records of the specified type from emails sent to a designated Microsoft 365 mailbox.</p><h3><a id=\"Customize_the_integration\" name=\"Customize_the_integration\" title=\"Customize the integration\"></a>Customize the integration</h3><p>You can customize the <strong>create records from emails</strong>\" scenario to meet your business requirements.</p><h4><a id=\"Customize_external_contact_creation\" name=\"Customize_external_contact_creation\" title=\"Customize external contact creation\"></a>Customize external contact creation</h4></article><p>The <strong>34 Create SMAX contact with external mail</strong> rule is used for creating contacts for external users. By default, the external user is created with:</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\"><strong>First Name</strong>: External</li><li style=\"margin-left: 28px; position: relative;\"><strong>Last Name</strong>: Contact</li><li style=\"margin-left: 28px; position: relative;\"><strong>UPN</strong>: External_Contact prefix plus sender email</li></ul><p>You can customize this rule to change the contact creation behavior.</p><h4><a id=\"Customize_request_creation\" name=\"Customize_request_creation\" title=\"Customize request creation\"></a>Customize request creation</h4><p>The <strong>75 Create SMAX request by impersonating user</strong> and <strong>77 Create SMAX request with integration user</strong> rules include configurations for request creation. You can modify these rules to include additional fields and data:</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">Rule 75: takes effect when a Service Management user creates a request.</li><li style=\"margin-left: 28px; position: relative;\">Rule 77: takes effect when a Service Management contact creates a request.</li></ul><h4><a id=\"Customize_the_scenario_to_create_incidents_changes_or_problems\" name=\"Customize_the_scenario_to_create_incidents_changes_or_problems\" title=\"Customize the scenario to create incidents, changes, or problems\"></a>Customize the scenario to create incidents, changes, or problems</h4><p>To customize the scenario for creating incidents, changes, or problems:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Change the <strong>RecordType</strong> in the <strong>Settings</strong> rule.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Go to rule <strong>76 Create SMAX Incident with integration user</strong> and make the following changes:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">Change <strong>Incident </strong>to the relevant record type name in the rule name.</li><li style=\"margin-left: 40px; position: relative;\">Modify the condition of the rule as follows:\n\t\t<pre><code>Settings.RecordType == '&lt;Replace this with record type&gt;';\n</code></pre></li><li style=\"margin-left: 40px; position: relative;\">Configure the required fields and values to create the record.</li></ul></li></ol><ol style=\"padding-left: 0px;\"></ol><h3><a id=\"Troubleshooting\" name=\"Troubleshooting\" title=\"Troubleshooting\"></a>Troubleshooting</h3><div>For troubleshooting information, see <a href=\"/doc/423/26.1/troubleshootms365emailintegration\" title=\"Troubleshoot email integration\">Troubleshoot Microsoft 365 email integration</a>.</div><div><span id=\"cke_bm_211S\" style=\"display: none;\"> </span><h2><a id=\"Update_records_by_emails\" name=\"Update_records_by_emails\" title=\"Update records by emails\"></a>Update records by emails</h2><h3 id=\"Overview\">Overview</h3><p>A listener or a scheduler can trigger this scenario.</p><p>When triggered by the listener, it runs in notified process mode. Here’s the data flow:</p><div><a class=\"image\" href=\"\"><img alt=\"Notified_Process\" src=\"../../../images/ms365__UpdateRecord_Notified_Process_bdb0c415.png\" style=\"width: 859px; height: 324px;\"/></a></div><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">A user sends an email to Office 365.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The Change notification API notifies the <strong>Update records by emails</strong> scenario listener with mail ID.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The <strong>Update records by emails</strong> scenario gets the received email.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The <strong>Update records by emails</strong> scenario updates a record in Service Management.</li></ol><p>When triggered by the scheduler, it runs in scheduled process mode. Here’s the data flow:</p><h3><a class=\"image\" href=\"\"><img alt=\"scheduled_Process\" src=\"../../../images/ms365_UpdateRecord_Scheduled_Process_3a3955f0.png\" style=\"width: 859px; height: 312px;\"/></a></h3><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Users send emails to Office 365.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The scheduler triggers the <strong>Update records by emails</strong> scenario hourly.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The <strong>Update records by emails</strong> scenario retrieves the emails awaiting processing in the mailbox.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">The <strong>Update records by emails</strong> scenario updates records in Service Management for each mail.</li></ol><p style=\"margin-bottom: 8px; margin-left: 36px; text-indent: -0.38in; text-align: left;\"><span style=\"font-size: 14px;\">Here is how the email content is processed in the Service Management record:</span></p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">The text comments in the <strong>APPOVE/DENY</strong> mail will be updated in the approver comments field for the associated task.</li><li style=\"margin-left: 28px; position: relative;\">The record Comments field will be updated with inline images and the text comments in the<strong> ADD A COMMENT/PROVIDE INFO/ACCEPT/REJECT</strong> mail.</li><li style=\"margin-left: 28px; position: relative;\">Emails are downloaded as files with an .eml extension and added to the record attachment. The maximum size for an email, including inline images and attachments, is 10 MB. Emails that exceed this limit will be redirected to the Error folder without processing.</li></ul><h3><a id=\"Activate_replies_to_emails\" name=\"Activate_replies_to_emails\" title=\"Activate replies to emails\"></a>Activate replies to emails</h3><div><div><div>The <strong>Update Records from Emails</strong> scenario supports updating Service Management records via incoming email in the following ways:</div><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">Via new email: The email is generated using action buttons that attach specific tokens to the email. Service Management checks the token to handle the reply and update the record.</li><li style=\"margin-left: 28px; position: relative;\">Via Response email: The email is generated in response to a service ticket using the email client's Reply button. Email tokens are not needed in this case. </li></ul><div>In both cases, the email message is added as a comment to the Service Management record.</div></div></div><div>For instructions enable record updation via email, see the following sections: </div><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">Configure mailbox rules</li><li style=\"margin-left: 28px; position: relative;\">Configure the scenario</li></ul><h4>Prerequisites</h4><p>To set up the integration, make sure the following prerequisites are satisfied.</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">You have registered an app in the Azure Portal. During the app registration, enter this as the Web Redirect URL: <strong>https://&lt;Service Management FQDN&gt;/rest/&lt;SMAX tenant Id&gt;/opb/oauth/callback</strong>. Note that if you have configured a custom domain for the tenant, you can add another redirect URL for the custom domain (replace <strong>&lt;Service Management FQDN&gt; </strong>with the custom domain in the preceding URL).</li><li style=\"margin-left: 28px; position: relative;\">Note the app's application ID, which will be used in the Service Management endpoint to connect to the Graph API.</li><li style=\"margin-left: 28px; position: relative;\">You have added a client secret for the app. The Service Management endpoint uses the secret value to connect to the Graph API.</li><li style=\"margin-left: 28px; position: relative;\"><div>You have requested mailboxes or each record type. One record type requires one dedicated mailbox.</div></li><li style=\"margin-left: 28px; position: relative;\">If you want the email integration to monitor a shared mailbox (as opposed to a user mailbox), ask your Azure admin to create one and assign you the read and manage emails permission for it.</li><li style=\"margin-left: 28px; position: relative;\">You have assigned the appropriate permissions to the app.\n\t<p>If you use a user mailbox, assign the following delegated permissions:</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Mail.Read</strong> (to read the emails)</li><li style=\"margin-left: 40px; position: relative;\"><strong>Mail.ReadWrite</strong> (to move the emails to a different folder)</li><li style=\"margin-left: 40px; position: relative;\"><strong>User.Read</strong> (to get user details)</li></ul><p>If you use a shared mailbox, assign the following delegated permissions:</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Mail.Read.Shared</strong> (to read the emails)</li><li style=\"margin-left: 40px; position: relative;\"><strong>Mail.ReadWrite.Shared</strong> (to move the emails to a different folder)</li><li style=\"margin-left: 40px; position: relative;\"><strong>User.Read</strong> (to get user details)</li></ul><p>Each action might require different permissions. For details, see the <a href=\"https://learn.microsoft.com/en-us/graph/use-the-api\" title=\"Microsoft Graph API\">Microsoft Graph API</a> documentation.</p></li></ul><h3>Set up the integration</h3><p>To set up the email integration, complete these tasks.</p><h4>Configure mailbox</h4><article data-scroll-anchor=\"true\" data-testid=\"conversation-turn-11\" dir=\"auto\"><p>To configure the mailbox, create the necessary folders and set up the mailbox rules.</p></article><h5><a id=\"Create_folder_in_mailbox\" name=\"Create_folder_in_mailbox\" title=\"Create folder in mailbox\"></a>Create folder in mailbox</h5><p>The Update record scenario moves the emails to the relevant folder based on process status. Create the following folders directly under the root folder. </p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\"><strong>ToUpdateRecord</strong>: Emails in this folder will be processed to update records.</li><li style=\"margin-left: 28px; position: relative;\"><strong>Processed:</strong> Emails that successfully create records will move to this folder.</li><li style=\"margin-left: 28px; position: relative;\"><strong>Errors:</strong> Emails that fail to create records will move to this folder.</li></ul><h5>Configure mailbox rules</h5><p>This solution uses mailbox rules to identify and exclude emails from disallowed domains, preventing them from being processed. Set the rules correctly. Emails in the <strong>ToCreateRecord</strong> folder will be processed as records.</p><article data-scroll-anchor=\"false\" data-testid=\"conversation-turn-11\" dir=\"auto\"><p>Here are the example rules you can configure. Make sure they run in the specified order.</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p><strong>Move automatic Replies or forwarded emails to Skipped Folder</strong></p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Name</strong>: Move replied or forwarded emails to Skipped folder</li><li style=\"margin-left: 40px; position: relative;\"><strong>Condition</strong>: Subject includes keywords such as <strong>FW:,</strong><strong>Fw:</strong>, and <strong>Automatic reply</strong>. Optionally, you can add the expressions such <strong>RE: </strong>and <strong>Re:</strong> to the condition when the <strong>reply to email</strong> feature is not activated.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Action</strong>: Move to Skipped</li><li style=\"margin-left: 40px; position: relative;\"><strong>Stop Processing More Rules</strong>: Yes</li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p><strong>Move Emails from Allowed Domains to ToUpdateRecord Folder</strong></p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Name</strong>: Move emails from allowed domains to the ToUpdateRecord<strong></strong>folder</li><li style=\"margin-left: 40px; position: relative;\"><span data-olk-copy-source=\"MessageBody\"><b>Condition: </b>The body of the sender message includes text such as <strong>*****</strong>. For example, \"Do not delete or change the authentication information below this line!*****\"</span></li><li style=\"margin-left: 40px; position: relative;\"><strong>Action</strong>: Move to ToUpdateRecord</li><li style=\"margin-left: 40px; position: relative;\"><strong>Stop Processing More Rules</strong>: Yes</li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p><strong>(Optional) Move Emails from Allowed Domains to ToUpdateRecord Folder, </strong>when the <strong>reply to email</strong> feature is activated.</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Name</strong>: Update the existing rule #2: Move emails from allowed domains to the ToUpdateRecord folder</li><li style=\"margin-left: 40px; position: relative;\"><span data-olk-copy-source=\"MessageBody\"><b>Condition: </b>The subject or body includes expressions such as </span><strong>RE:</strong>, <strong>Re:</strong>, and <strong>##Request</strong></li><li style=\"margin-left: 40px; position: relative;\"><strong>Action</strong>: Move to ToUpdateRecord</li><li style=\"margin-left: 40px; position: relative;\"><strong>Stop Processing More Rules</strong>: Yes</li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p><strong>Move All Other Emails to FromNotAllowedDomain Folder</strong></p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Name</strong>: Move all other emails to FromNotAllowedDomain folder</li><li style=\"margin-left: 40px; position: relative;\"><strong>Condition</strong>: Apply to all messages</li><li style=\"margin-left: 40px; position: relative;\"><strong>Action</strong>: Move to FromNotAllowedDomain</li><li style=\"margin-left: 40px; position: relative;\"><strong>Stop Processing More Rules</strong>: Yes</li></ul></li></ol><h4 class=\"mw-headline\" id=\"Configure_email_integration_settings\"><a id=\"Configure_email_integration_settings\" name=\"Configure_email_integration_settings\" title=\"Configure email integration settings\"></a>Configure email integration settings</h4><p>To configure email integration settings, from the agent interface, complete the following steps:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <b>Administration</b> &gt; <b>Configuration</b> &gt; <b>Service Portal Settings</b> &gt; <b>Feature Settings</b></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Configure the following email integration settings:</li></ol><ul style=\"margin-left: 40px; padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">Enable record creation and actions from email</li><li style=\"margin-left: 28px; position: relative;\">Select <strong>Integration Studio</strong> as the Email integration mode</li><li style=\"margin-left: 28px; position: relative;\">Enter the shared mailbox address in the Email address for updated record</li><li style=\"margin-left: 28px; position: relative;\">Enable approval through email</li></ul><p>For details, see <a href=\"/doc/423/26.1/setfeature\" title=\"Configure Service Portal feature settings\">Configure Service Portal feature settings</a>. </p><h4>Prepare integration user</h4><p>We recommend creating a dedicated integration user for each integration.</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Create an integration user. See <a href=\"/doc/423/26.1/createuser\" title=\"How to create an integration user\">How to create an integration user</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to Agent Interface as the tenant admin.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Administration &gt; Master Data &gt; People</strong>, locate the integration user and assign the proper roles to access the required modules. At a minimum, the role should have the following permissions:<br/>\n\tTo integrate with the Request record type:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">The <strong>On-Premise Bridge/Integration Administrator</strong> permission</li><li style=\"margin-left: 40px; position: relative;\">The <b>View </b>permission to the Person record type</li><li style=\"margin-left: 40px; position: relative;\">The <b>View</b> and <span style='color: rgb(0, 0, 0); font-family: Metric-Regular, \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;'><strong>Update</strong></span>permissions to the Request record type</li></ul>\n\tTo integrate with the Incident, Problem, or Change record types:\n\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">The <b>View</b> permission to the Person record type</li><li style=\"margin-left: 40px; position: relative;\">The <b>View</b> and <span style='color: rgb(0, 0, 0); font-family: Metric-Regular, \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;'><strong>Update</strong></span> permissions to the relevant record type</li></ul>\n\tIf you want to allow non-Service Management users to create records by email, please grant below additional permissions:\n\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">The <b>View</b> and <span style='color: rgb(0, 0, 0); font-family: Metric-Regular, \"Helvetica Neue\", Helvetica, Arial, sans-serif; font-size: 16px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: 400; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; white-space: normal; background-color: rgb(255, 255, 255); text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; display: inline !important; float: none;'><strong>Update</strong></span> permissions to the Person record type</li></ul>\n\tAlternatively, add the Tenant Admin role to grant general access.</li></ol><h4>Create an endpoint</h4><p>Create an endpoint using the Rest Executor 2.0 endpoint type:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Administration &gt; Utilities &gt; Integration &gt; Endpoints</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Add</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <strong>Rest Executor 2.0</strong> as the endpoint typenter a name for the endpoint, for example, Microsoft 365, and then click <strong>Add</strong>. The system creates the endpoint.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Configure</strong> and complete the following fields.\n\t<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\"><thead><tr><th scope=\"col\">Field</th><th scope=\"col\">Value</th></tr></thead><tbody><tr><td colspan=\"2\"><strong>General configuration</strong></td></tr><tr><td>Agent</td><td>Select <strong>Agentless</strong> for a direct connection to the Graph API.</td></tr><tr><td>Authentication type</td><td>Select <strong>OAuth 2.0</strong></td></tr><tr><td>Protocol</td><td>Select <strong>https</strong>.</td></tr><tr><td>Base URL</td><td>Enter the base URL of the Graph API:<strong> https://graph.microsoft.com</strong>.</td></tr><tr><td>Certificate type</td><td>Optional</td></tr><tr><td>Certificate format</td><td>Optional</td></tr><tr><td>Server certificate</td><td>Optional</td></tr><tr><td>Enable email notification for expired token</td><td>Optional</td></tr><tr><td>Recipients</td><td>Optional</td></tr><tr><td colspan=\"2\"><strong>Get Token configuration</strong></td></tr><tr><td>Grant Type</td><td><p>Authorization Code</p></td></tr><tr><td>Client ID</td><td>The application ID.</td></tr><tr><td>Client Secret</td><td>The client's secret value for the app.</td></tr><tr><td>Authorization URL</td><td><p>The URL can be found under <strong>Endpoints</strong> for the app in the Azure Portal (use the v2 one).</p><p>If you have enabled SAML SSO with Azure AD in Service Management and want to log in as a different user during the <em>Get token</em> process in the next step, add <code>&amp;prompt=login</code> it at the end of the URL. Example: <strong>https://login.microsoftonline.com/&lt;Directory_Id&gt;/oauth2/v2.0/authorize?prompt=login</strong>.</p></td></tr><tr><td>Redirect URL</td><td>Automatically generated.</td></tr><tr><td>Token URL</td><td>The URL can be found under <strong>Endpoints</strong> for the app in the Azure Portal (use the v2 one).</td></tr><tr><td>Scope</td><td><p>Enter: <strong>https://graph.microsoft.com/.default offline_access</strong>.</p></td></tr><tr><td>State</td><td>Optional</td></tr><tr><td>Send client Id and secret</td><td>In body</td></tr></tbody></table></li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Get token</strong>, and then complete the login and consent process. If your endpoint configuration is correct, you will see the <b>Available </b>status in the <strong>Token status</strong> section after the process is finished.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Save</strong>.</li></ol><h4>Create an integration</h4><p>Perform the following steps to create an integration based on the Microsoft Graph connector.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>Create one dedicated integration for each record type.</div></div></div><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Administration </strong>&gt; <strong>Utilities </strong>&gt; <strong>Integration </strong>&gt; <strong>Integration Studio</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>New</strong>, enter the name of your integration, and then click <strong>Save</strong>. The system displays the Integration page.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Details</strong> section, configure the integration user you created for the current Service Management system and activate the integration.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Connector-Endpoint mappings</strong> section, click <strong>Add</strong> to add a mapping.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <strong>Graph</strong> (under <strong>Microsoft</strong>) as the connector, select the Microsoft 365 endpoint created earlier and then enter an alias for the mapping.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Save</strong>.</li></ol><h4>Configure the scenario</h4><p>Perform the following steps to add and configure two Process email scenarios using the predefined template:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Add scenario</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Enter a name for the scenario. For example, enter <strong>Update records by emails</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Template</strong> field, select <strong>Update records by emails</strong> (under <strong>Microsoft Graph</strong>) from the list.\n\t<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>Using templates simplifies integration configuration compared to starting from scratch. If you don't use this option, you'll have to manually add your logic, starting from a blank page.</div></div></div></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Keep <strong>Enable Listener</strong> selected and click <strong>Save</strong> to add the scenario.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>General </strong>section, select <strong>Active</strong>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Listener </strong>section, click <a class=\"image\" href=\"\"><img alt=\"Generate\" src=\"../../../images/Xie_Generate_d7e2194a.png\" style=\"width: 25px; height: 26px;\"/></a>  Generate. Provide the integration username and password and specify the expiration date of the webhook URL. Enter the email addresses of recipients who will receive notifications when the webhook URL expires.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Process logic</strong> section, locate <strong>Settings</strong>, add a rule with the following parameters, and click <strong>Save</strong>.\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>UseSharedMailbox</strong>: If set to <strong>true</strong>, the system will check emails in the shared mailbox specified in the <strong>SharedMailboxAddress</strong> parameter. If set to <strong>false</strong>, the system will check emails in the mailbox for the user who performed the <strong>get token</strong> operation on the Endpoint page instead.</li><li style=\"margin-left: 40px; position: relative;\"><strong>SharedMailboxAddress</strong>: The email address for the shared mailbox.</li><li style=\"margin-left: 40px; position: relative;\"><strong>ReceiveFolderName</strong>: The folder where emails are checked. </li><li style=\"margin-left: 40px; position: relative;\"><strong>SuccessFolderName</strong>: The folder where successfully processed emails are moved. You should have already created the folder when you completed the prerequisite tasks.</li><li style=\"margin-left: 40px; position: relative;\"><strong>ErrorFolderName</strong>: The folder where failed-to-process emails are moved. You should have already created the folder when you completed the prerequisite tasks.</li><li style=\"margin-left: 40px; position: relative;\"><strong>SettingsCacheName</strong>:<strong> </strong>The <strong>Process emails</strong> scenario stores the settings in local storage and shares them with the <strong>Manage email subscription</strong> scenario in the same integration. So, this value should be consistent in these two scenarios.</li><li style=\"margin-left: 40px; position: relative;\"><strong>EnableRichTextComments</strong>:<strong></strong>If set to <strong>true</strong>, rich text formatting such as bold, italics, hyperlinks, and inline images are retained in the record comments. If set to <strong>false</strong>, the record comments are converted to plain text, removing all rich text formatting and inline images.\n\t\t<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>The <strong>EnableRichTextComments </strong>parameter setting is available in versions 25.1.1 and above.</div></div></div></li><li style=\"margin-left: 40px; position: relative;\"><strong>MaxProcessMailCountByScheduler</strong>: The number of emails pulled from the mail server when the scheduler triggers the scenario. The maximum value is 1,000.</li><li style=\"margin-left: 40px; position: relative;\"><div><strong>AddEntireEmailAsAttachment:</strong> Adds the entire email as an attachment to the created record. Default value is <strong>true</strong>. To disable adding<strong> </strong>the email as an attachment, set this property to <strong>false.</strong></div></li><li style=\"margin-left: 40px; position: relative;\"><div><strong>AddAttachments: </strong> Adds each attachment individually to the created record. Default value is <strong>true</strong>. To disable adding attachments, set this property to <strong>false.</strong> </div></li><li style=\"margin-left: 40px; position: relative;\"><div><strong>AllowUpdateFromOtherUserThanRequester: </strong>Allows updates to the record even if the email sender is not the ticket requester. For example, person A can update person B's ticket via email, even if person B did not create the ticket. Default value is <strong>true</strong>. To prevent others from updating the request via email, set this property to <strong>false.</strong></div></li><li style=\"margin-left: 40px; position: relative;\"><strong>AcceptEmailsWithoutOrInvalidToken</strong>: Accepts emails where there is no token or the token is invalid. For example, enable this property to accept email responses sent, using the Reply button in the email client.</li><li style=\"margin-left: 40px; position: relative;\"><strong>AllowToUpdateClosedRecord: </strong>Allows updates to closed records via email. Default value is <strong>true</strong>. To disable updates to closed records via emails, set this property to <strong>false</strong>.</li><li style=\"margin-left: 40px; position: relative;\"><strong>RegExPatternToGetRecordKeys: </strong>Enter regex patterns to identify the entity name and entity Id from the subject line of the email. Make sure you update the notification templates to match the specified pattern.</li></ul></li></ol><div>To configure the <strong>Manage email subscription</strong><span style=\"box-sizing: border-box; margin: 0px; padding: 0px;\"><strong> </strong></span>scenario, repeat steps 1 through 6, and select <strong>Manage email subscription </strong>for the <strong>Template </strong>field in step 3.</div></article></div><h4><a id=\"Activate_Reply_to_emails_\" name=\"Activate_Reply_to_emails_\" title='Activate \"Reply to emails\"'></a>Activate \"Reply to emails\"</h4><div>See the parameter settings needed to enable the following abilities:</div><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">To accept and process emails that do not contain a token, set parameter <strong>AcceptEmailsWithoutOrInvalidToken </strong>to true.</li><li style=\"margin-left: 28px; position: relative;\">To allow users other than the requester to update the record, set parameter <strong>AllowUpdateFromOtherUserThanRequester </strong>to true.</li><li style=\"margin-left: 28px; position: relative;\">To allow a closed record to be updated, set parameter <strong>AllowToUpdateClosedRecord </strong>to true.</li><li style=\"margin-left: 28px; position: relative;\">Make sure the RegEx pattern matches the record type and the record ID in the subject line of the email. This pattern helps identify and update the correct record based on its record type and record ID.</li></ul><div><strong>Go to the Studio</strong></div><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">Select a record type, for example, Request</li><li style=\"margin-left: 28px; position: relative;\">Go to <strong>notifications </strong>tab</li><li style=\"margin-left: 28px; position: relative;\">Change the subject line for all notifications where you want to allows customers to reply to via email. The predefined RegEx pattern in the scenario is <strong>##Request:(.*?)##</strong>, which parses strings such as <strong>Request:12345</strong> from the email subject to then update the Request with Id <strong>12345</strong>. The corresponding part in subject line within each notification template should resemble <strong>##${:entity.Type}:${:entity.Id}##</strong>. If you change the RegEx pattern, make sure you adjust the subject line.</li></ul><h4><span style=\"font-size: clamp(1.3125rem, 15.4737px + 1.15132vw, 1.75rem);\">Validate the </span><span style=\"font-size: clamp(1.3125rem, 15.4737px + 1.15132vw, 1.75rem);\">configuration</span></h4><p>Perform the following steps to validate that configurations are correct for two scenarios:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Go to the <strong>Update records by emails</strong> scenario.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Run scenario </strong>and confirm to run the selected scenario.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Execution history </strong>and wait until the scenario enters the <strong>Finish </strong>status. If the status is <strong>Failed</strong>, check if certain configurations are incorrect.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Go to the <strong>Manage email subscription</strong> scenario and repeat steps 2 and 3.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Send an email to the mailbox. If the <strong>Manage email subscription</strong> scenario works properly, the listener will immediately trigger the <strong>Update records by emails</strong> scenario. </li></ol><h3>Use the integration</h3><p>Select the scenario and click <strong style=\"font-size: 14px;\">Run scenario</strong><span style=\"box-sizing: border-box; margin: 0px; padding: 0px;\"><strong> </strong></span>to use the integration. We recommend setting up the scheduler to run these two scenarios regularly. To do this, perform the following steps:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Navigate to <strong>Administration </strong>&gt; <strong>Utilities </strong>&gt; <strong>Integration </strong>&gt; <strong>Integration Studio</strong> &gt; <strong>Scheduler</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Add</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Enter a name for the scheduler. For example, enter \"Hourly process emails\".</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">For <strong>Integration</strong>, select the integration created earlier.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Select <strong>Process emails</strong> from the list for <strong>Scenario</strong>, then click <strong>Next</strong>.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">In the <strong>Starts </strong>section, configure <strong>Time zone</strong> and <strong>Start date</strong>. In the <strong>Repeats </strong>section, configure a schedule for every<strong> 1 hour(s)</strong>. Then, click <strong>Next</strong>.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Save</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Repeat the above steps for the <strong>Manage email subscription</strong><b> </b>scenario. You should only run this scenario once a day.</li></ol><p>Once all configurations are complete, the system can automatically update records of the specified type from emails sent to a designated Microsoft 365 mailbox.</p><ol style=\"padding-left: 0px;\"></ol><h3>Troubleshooting</h3><div>For troubleshooting information, see <a href=\"/doc/423/26.1/troubleshootms365emailintegration\" title=\"Troubleshoot email integration\">Troubleshoot Microsoft 365 email integration</a>.</div></div>",
  "modifiedon": "2025-12-04 19:28:04"
}