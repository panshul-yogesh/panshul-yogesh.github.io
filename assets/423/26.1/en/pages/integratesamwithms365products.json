{
  "title": "Integrate with Microsoft 365 for SAM",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p style=\"vertical-align:middle\">This page describes how to configure integration with Microsoft 365 to import user entitlement data and license consumption data from Microsoft 365. This is part of the <a href=\"/doc/423/26.1/integratesamwithsaasapplications\" title=\"Set up SaaS products for license compliance calculation\">SaaS product setup</a> in SAM.</p>\n<h2 style=\"vertical-align: middle;\">Register a Microsoft 365 application</h2>\n<p>Registering a Microsoft 365 app is necessary to get the required credentials and permissions for integrating your app with Microsoft 365 services and APIs. To register a Microsoft 365 application, follow these steps.</p>\n<h3>Sign in to the Azure portal</h3>\n<p>Go to the <a href=\"https://portal.azure.com\" title=\"Azure portal\">Azure portal</a> and sign in with your Azure account as a global administrator of your organization.</p>\n<h3>Create a new app registration</h3>\n<ol>\n<li>In the Azure portal, click <strong>Azure Active Directory</strong> in the left menu.</li>\n<li>Under the <strong>Manage</strong> section, click<strong> App registrations </strong>&gt;<strong> New registration</strong>.</li>\n</ol>\n<h3>Configure app registration</h3>\n<ol>\n<li>Enter a name for your app in the <strong>Name</strong> field.</li>\n<li>Choose the appropriate account type in the <strong>Supported account types</strong> section, and select <strong>Accounts in any organizational directory (Any Azure AD directory - Multitenant)</strong>.</li>\n<li>In the <strong>Redirect URI</strong> section, specify the URI where Microsoft will redirect the user after authentication. This should match the authentication callback URL in your app.</li>\n<li>Click the <strong>Register</strong> button. Once registered, the system will redirect you to the app's overview page.</li>\n</ol>\n<h3>Configure the API permissions</h3>\n<ol>\n<li>In the app's overview page, navigate to <strong>API permissions</strong> &gt; <strong>Add a permission</strong>.</li>\n<li>On the <strong>Request API permissions </strong>dialog box, select the <strong>Microsoft APIs </strong>&gt;<strong> Microsoft Graph &gt; Application permissions</strong>.</li>\n<li> <strong>Select permissions</strong>, select the check boxes for the following permissions:\n\t<ul id=\"register-microsoft-app__ul_ncb_bqw_rqb\">\n<li><code>Directory.Read.All</code></li>\n<li><code>Organization.Read.All</code></li>\n<li><code>Reports.Read.All</code></li>\n<li><code>User.Read.All</code></li>\n</ul>\n</li>\n<li>Click <strong>Add permissions</strong>.</li>\n</ol>\n<h3>Grant admin consent</h3>\n<ol>\n<li>\n<p>If your app requires administrator consent to access certain APIs, you'll need to have an Azure AD administrator grant consent.</p>\n</li>\n<li>\n<p>On the <strong>API permissions</strong> page, click <strong>Grant admin consent for [Your tenant]</strong>. This will prompt an administrator to consent to the permissions on behalf of all users in the organization.</p>\n</li>\n</ol>\n<h3>Find the essential information for configuring the endpoint</h3>\n<ol>\n<li>In the<strong> Essentials</strong> section of the app's <strong>Overview</strong> page, note down the following values:\n\n\t<ul>\n<li><strong>Application (client) ID</strong>: The client ID of the application you registered in the Microsoft Azure portal.</li>\n<li><strong>Directory (tenant) ID</strong>: The GUID for the application you registered in the Microsoft Azure portal.</li>\n</ul>\n</li>\n<li>\n<p>Go to <strong>Certificates &amp; secrets</strong>, and click <strong>New client secret</strong> to generate a new secret key under the <strong>Client secrets</strong> section.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\"> You need to note down the secret, as the system will only display it once and it won't reappear upon leaving this page.</div>\n</div>\n</li>\n</ol>\n<p>For more information about how to register an application, see the <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/quickstart-register-app\" title=\"Microsoft documentation\">Microsoft documentation</a>.</p>\n<h2 id=\"Prepare_an_integration_user\">Prepare an integration user</h2>\n<p>You need to prepare an integration user before setting up the integration. For details of how to prepare an integration user, see <a href=\"/doc/423/26.1/integratesamwithsaasapplications#Prepare_an_integration_user\" title=\"Prepare an integration user\">Prepare an integration user</a>.</p>\n<h2>Set up the integration to import license consumption and entitlement data</h2>\n<p>To set up the integration based on the Integration Studio for Microsoft 365 data import, perform the following steps.</p>\n<h3 id=\"Create_an_endpoint\">Create an endpoint</h3>\n<p>Create an endpoint using the Rest Executor 2.0 endpoint type:</p>\n<ol>\n<li>Log in to the Agent Interface as the integration administrator.</li>\n<li>Navigate to <strong>Administration </strong>&gt; <strong>Utilities </strong>&gt; <strong>Integration</strong> &gt;<strong> Endpoints</strong>.</li>\n<li>Click <strong>Add</strong>.</li>\n<li>Select<strong> Rest Executor 2.0</strong> as the endpoint type, enter a name for the endpoint (for example, Microsoft 365), and then click <strong>Add</strong>. The system creates the endpoint. </li>\n<li>\n<p>Click <strong>Configure</strong> and complete the following fields.<br/>\n\t </p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" style=\"vertical-align:middle;\">\n<thead>\n<tr>\n<th scope=\"col\">Field</th>\n<th scope=\"col\">Value</th>\n</tr>\n<tr>\n<td colspan=\"2\"><strong>General configuration</strong></td>\n</tr>\n<tr>\n<td>Agent</td>\n<td>Select <strong>Agentless</strong> for a direct connection to the Graph API</td>\n</tr>\n<tr>\n<td>Authentication type</td>\n<td>Select <strong>OAuth</strong><strong> 2.0</strong></td>\n</tr>\n<tr>\n<td>Protocol</td>\n<td>Select <strong>https</strong></td>\n</tr>\n<tr>\n<td>Base URL</td>\n<td>Enter <code>https://graph.microsoft.com</code></td>\n</tr>\n<tr>\n<td>Certificate type</td>\n<td>(optional) Select <strong>X.509</strong></td>\n</tr>\n<tr>\n<td>Certificate format</td>\n<td>(optional) Select <strong>PEM</strong></td>\n</tr>\n<tr>\n<td>Server certificate</td>\n<td colspan=\"1\">\n<p>(optional)</p>\n<p>Open the root CA certificate file of the Microsoft 365 system in a text editor, and then copy and paste the content to this field. If the content is invalid, an error occurs when you click Save in the next step.</p>\n<p>The certificate content must resemble the following.</p>\n<p><code>-----BEGIN CERTIFICATE-----</code></p>\n<p><code>MIIF2TCCBMGgAwIBAgIQBMF1U8hY8bivE0+JHx922jANBgkqhkiG9w0BAQsFADBGMQswCQYDVQQGEwJVUzEPMA0GA1UEChMGQW1hem9uMRUwEwYDVQQLEwxTZXJ2ZXIgQ0EgMUIxDzANBgNVBAMTBkFtYXpvbjAeFw0yMTEwMTEwMDAwMDBaFw0yMjExMDkyMzU5NTlaMBsxGTAXBgNVBAMTEHhpZS5pdHNtYS1uZy5vcmcwggEiMA0GCSqGSIb31oIvQfpl2gj0S6JSJAYjJnY7HKCa7mkzBMiiXWI5aHMZfl1FsaNARM10LUpto61fIvk/SDNlOqVXuzGMTZkJBVZVmK5lNLvBB1Gk9+QlJ+SuUOW7FW2K5U+oQKWsHtvHC/DHn6yyhvqWes9q6A==</code></p>\n<p><code>-----END CERTIFICATE-----</code></p>\n</td>\n</tr>\n<tr>\n<td>Enable email notification for token expiration</td>\n<td>Check this option and configure the<strong> Recipients </strong>field based on your needs</td>\n</tr>\n<tr>\n<td>Recipients</td>\n<td>Configure the email notification recipients based on your needs</td>\n</tr>\n<tr>\n<td colspan=\"2\"><strong>Get token configuration</strong></td>\n</tr>\n<tr>\n<td>Grant Type</td>\n<td><strong>Client Credentials</strong></td>\n</tr>\n<tr>\n<td>Client ID</td>\n<td>Enter the Microsoft ID obtained during the app registration process.</td>\n</tr>\n<tr>\n<td>Client Secret</td>\n<td>Enter the client secret<strong> </strong>obtained during the app registration process.</td>\n</tr>\n<tr>\n<td>Token URL</td>\n<td>\n<p><code>https://login.microsoftonline.com/&lt;</code>tenant-id<code>&gt;/oauth2/v2.0/token</code></p>\n<p>Note that you can find the <code>&lt;tenant-id&gt;</code> in the <strong>Directory (tenant) ID </strong>field of the app's <strong>Overview</strong> page in the Microsoft Azure Portal.</p>\n</td>\n</tr>\n<tr>\n<td>Scope</td>\n<td>Enter <code>https://graph.microsoft.com/.default</code></td>\n</tr>\n<tr>\n<td>Send client Id and secret</td>\n<td>Select <strong>In body</strong></td>\n</tr>\n<tr>\n<td>Content-Type</td>\n<td><code>application/x-www-form-unlencoded</code></td>\n</tr>\n</thead>\n</table>\n</li>\n<li>Click <strong>Test connection</strong> to validate your configurations.</li>\n<li>Click <strong>Save</strong>.</li>\n</ol>\n<h3 id=\"Create_an_integration\">Create an integration</h3>\n<p>In the following steps, you'll create an integration with the predefined template.</p>\n<ol>\n<li>Navigate to <strong>Administration </strong>&gt; <strong>Utilities</strong> &gt; <strong>Integration</strong> &gt;<strong> Integration Studio</strong>.</li>\n<li>Click <strong>New</strong>, enter the name of your integration, and then click <strong>Save</strong>. The system displays the Integration page.</li>\n<li>In the<strong> Details</strong> section, configure the integration user you created for the current Service Management system and activate the integration.</li>\n<li>In the<strong> Connector-Endpoint mappings</strong> section, click <strong>Add</strong> to add a mapping.</li>\n<li>Select <b>Graph</b> (under <strong>Microsoft</strong>) as the connector, select the Microsoft 365 endpoint that you created earlier, and then enter an alias for the mapping.</li>\n<li>Click <strong>Save</strong>.</li>\n</ol>\n<h3 id=\"Configure_the_scenario\">Add the scenario</h3>\n<p>Perform the following steps to add the scenarios to the integration:</p>\n<ol>\n<li>Click <strong>Add scenario</strong>. </li>\n<li>Enter a name for the scenario. For example, Import Microsoft 365 license consumption.</li>\n<li>\n<p>In the <strong>Template</strong> field, select <strong>SAM - Import Microsoft 365 license consumption</strong> (under <strong>Microsoft Graph</strong>).</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">The  <strong>API version </strong>parameter in the <strong>SAM - Import Microsoft 365 license consumption</strong> template <strong> </strong>is set to 1.0, and you can customize it based on your needs.</div>\n</div>\n</li>\n<li>Click <strong>Save</strong> to add the scenario. </li>\n<li>To add another scenario template, simply follow the steps again and select <strong>SAM - Import Microsoft 365 user entitlement</strong> (under <strong>Microsoft Graph</strong>) in the <strong>Template</strong> field.</li>\n</ol>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\"> Using the out-of-the-box template will make the integration configuration easier than starting from scratch. If you don't select this option, you'll have to manually add your own logic, starting from a blank page. </div>\n</div>\n<h2>Next steps</h2>\n<p>Complete the remaining steps of the <a href=\"/doc/423/26.1/integratesamwithsaasapplications#SaaSConfig\" title=\"SaaS product configuration process\">SaaS product configuration process</a>:</p>\n<ul>\n<li>Create and configure the Microsoft 365 product in SAM</li>\n<li>Create license metrics (if necessary)</li>\n<li>Create licenses for services included in Microsoft 365 (if necessary)</li>\n<li>Verify the Microsoft 365 integration</li>\n<li>Verify the details of the license models for Microsoft 365 services</li>\n<li>Schedule the periodic triggering of the integration</li>\n</ul>\n<div></div>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}