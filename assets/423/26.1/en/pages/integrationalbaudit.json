{
  "title": "Create application load balancer for Audit service",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>For the suite and Audit service to work together on AWS, you can configure an internal Application Load Balancer (ALB) between the ingress services of the suite and Audit. This best practice enables you to isolate internal integration from external access. The diagram below depicts how the integration ALB sets up the connection between the suite and Audit:</p>\n<div><a class=\"image\" href=\"/file/images/3/35/Audit_EKS_Deployment.png\" title=\"/file/images/3/35/Audit_EKS_Deployment.png\"> <img alt=\"Audit_EKS_Deployment.png\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/3/35/Audit_EKS_Deployment.png\" height=\"437\" hspace=\"0\" src=\"../../../images/Audit_EKS_Deployment_f0469d41.png\" style=\"width: 800px; height: 437px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a></div>\n<p>Here are the details of the port:</p>\n<ul>\n<li>Type: Ingress listener port for integration</li>\n<li>Component: Audit</li>\n<li>Example: 443 </li>\n</ul>\n<p><span style=\"color: rgb(0, 115, 231); font-family: Roboto, sans-serif; font-size: 24px;\">Prerequisites</span></p>\n<p>You will need a certificate for the ALB to achieve the integration between the suite and Audit service. You can generate the certificate using <b>AWS Certificates Manager</b>, which AWS recommends. Before creating and configuring an ALB, you need to prepare a new certificate using one of the following methods:</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">The target domain name (CN name) of the certificate must be the domain or full name of the FQDN you will bind with the ALB in a later step.</div>\n</div>\n<h3 id=\"Request_a_certificate\">Request a certificate</h3>\n<ol>\n<li>Log in to the AWS Management Console in your target region.</li>\n<li>Navigate to <b>Services</b> &gt; <b>Certificate Manager</b>.</li>\n<li>Click <b>Request a certificate</b>.</li>\n<li>Select <b>Request a public certificate</b> and click <b>Request a certificate</b>.</li>\n<li>Specify your target domain name. You can use an asterisk (*) to request a wildcard certificate to protect several sites in the same domain. For example, <b>*.testsma-ng.org.</b></li>\n<li>Click <b>Next</b>.</li>\n<li>Select <b>DNS validation</b> or <b>Email validation</b> according to your permission.</li>\n<li>Click <b>Review</b> and then click <b>Confirm and request</b>.</li>\n<li>Click <b>Continue</b>.</li>\n<li>Finish the certificate validation based on the method you just selected. For more information, see the <a href=\"https://docs.aws.amazon.com/console/acm/validation\" title=\"AWS Certificate Manager user guide\">AWS Certificate Manager user guide</a>.</li>\n<li>Save the Amazon Resource Name (ARN) of the certificate as it you will require it while creating the Audit ingress YAML.</li>\n</ol>\n<h3 id=\"Import_a_certificate\">Import a certificate</h3>\n<ol>\n<li>Log in to the AWS Management Console in your target region.</li>\n<li>Navigate to <b>Services</b> &gt; <b>Certificate Manager</b>.</li>\n<li>Click <b>Import a certificate</b>.</li>\n<li>For <b>Certificate body</b>, paste the Privacy Enhanced Mail (PEM) encoded certificate.</li>\n<li>For <b>Certificate private key</b>, paste the PEM encoded, unencrypted private key that matches the certificate's public key. \n\t<div class=\"admonition\">\n<div class=\"admonition-icon admonition-important-icon\"></div>\n<div class=\"admonition-content admonition-important-content\">Currently, services integrated with AWS Certificate Manager support only the  <code>RSA_1024</code> and  <code>RSA_2048</code> algorithms.</div>\n</div>\n</li>\n<li>(Optional) For <b>Certificate chain</b>, paste the PEM encoded certificate chain.</li>\n<li>Click <b>Next </b>&gt;<b> Review and import </b>&gt;<b> Import.</b></li>\n</ol>\n<h2 id=\"Target_groups\">Internal ALB for Audit </h2>\n<p>You can configure ALB for Audit in two ways by either updating the existing internal ALB or creating an internal ALB.</p>\n<h3>Update existing internal ALB</h3>\n<p>Add a rule to the existing ALB, where ingress controller port is the port number to reach the Audit service. Refer to <code>audit-itom-ingress-controller-svc</code> in the diagram.</p>\n<h3>Create an internal ALB for Audit</h3>\n<h3><span style='color: rgb(51, 51, 51); font-family: Roboto, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; font-size: 16px;'>Follow these steps to c</span><span style='color: rgb(51, 51, 51); font-family: Roboto, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; font-size: 16px;'>reate an internal ALB for Audit</span><span style='color: rgb(51, 51, 51); font-family: Roboto, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; font-size: 16px;'>:</span></h3>\n<ol>\n<li>Save the content below as <strong>audit-service-internal-ingress.yaml </strong>in the install directory (<strong>audit-20xx.xx</strong>):\n\n\t<pre>apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: \"audit-integration-ingress\"\n  namespace: &lt;audit_namespace&gt;\n  annotations:\n    alb.ingress.kubernetes.io/scheme: internal\n    alb.ingress.kubernetes.io/group.name: &lt;internal_alb_name&gt;\n    alb.ingress.kubernetes.io/listen-ports: '[{\"HTTPS\": &lt;port&gt;}]'\n    alb.ingress.kubernetes.io/backend-protocol: HTTPS\n    alb.ingress.kubernetes.io/healthcheck-protocol: HTTPS\n    alb.ingress.kubernetes.io/healthcheck-port: traffic-port\n    alb.ingress.kubernetes.io/healthcheck-path: /healthz\n    alb.ingress.kubernetes.io/success-codes: 200-399\n    alb.ingress.kubernetes.io/target-type: instance\n    alb.ingress.kubernetes.io/load-balancer-attributes: idle_timeout.timeout_seconds=180\n    alb.ingress.kubernetes.io/certificate-arn: &lt;certificate_arn&gt;\n    alb.ingress.kubernetes.io/security-groups: &lt;security_groups&gt;\n    kubernetes.io/ingress.class: alb\n  labels:\n    app: audit-ingress\nspec:\n  ingressClassName: alb\n  tls:\n  - hosts:\n    - &lt;integration_hostname&gt;\n  rules:\n    - host:\n      http:\n        paths:\n          - backend:\n              service:\n                name: \"audit-itom-ingress-controller-svc\"\n                port: \n                  number: &lt;ingress_controller_port&gt;\n            path: /*\n            pathType: ImplementationSpecific\n</pre>\n<p>Replace the following with the actual values:<br/>\n<em>&lt;audit_namespace&gt;</em>: The unique namespace of the Audit deployment. For example, <strong>audit</strong><b>ns</b>.<br/>\n<em>&lt;internal_alb_name&gt;</em>: Specify the name of the ALB you want to create.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-important-icon\"></div>\n<div class=\"admonition-content admonition-important-content\">The name must consist of <strong>lower case</strong> alphanumeric characters, '-', or '.', and must start and end with an alphanumeric character. </div>\n</div>\n<p>&lt;certificate_arn&gt;: The<a href=\"https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html\" title=\"resource name\"> resource name</a> of the prepared certificate. For example, <strong>arn:aws:acm:region:123456789012:certificate/12345678-1234-1234-1234-123456789012</strong>. See details in the<i> Prerequisites </i>section.<br/>\n<em>&lt;integration_hostname&gt;</em>: The FQDN you've allocated for integration. For example, <em>internal.com</em> as shown in the diagram. Go to AWS Route 53 service and create a separate FQDN by creating a new record under the domain used for suite installation.<br/>\n<em>&lt;internal_alb_port&gt;</em>: Specify the internal ALB port that's used to access the Audit service. For example, <em>443</em> as shown in the diagram.<br/>\n<em>&lt;security_groups&gt;</em>: The security groups that the ALB belongs to (if you haven't configured security groups, delete this parameter from the YAML). The inbound rule should allow the traffic to pass. The security group should be the same as the one in <strong>smax-integration-ingress.yaml</strong>. Additionally, to allow the inbound traffic from the security group for the integration ALB, make sure that you also add an inbound rule to the security group for the node cluster.<br/>\n<em>&lt;ingress_controller_port&gt;</em>: The port number of the ingress controller of the Audit service (<code>audit-itom-ingress-controller-svc</code>). For example, <b>31051</b>.</p>\n</li>\n<li>Run the following command to apply the saved YAML file:\n\t<pre>kubectl create -f audit-service-internal-ingress.yaml\n</pre>\n</li>\n</ol>\n<h2 id=\"Bind_an_FQDN_with_Application_Load_Balancer\">Bind an FQDN with the integration ALB</h2>\n<p>After you create the ALB for Audit Service, bind the FQDN that you have allocated for Audit Service with this ALB in AWS Route 53. Refer to the AWS documentation.</p>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}