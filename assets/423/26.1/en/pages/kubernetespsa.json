{
  "title": "Kubernetes Pod Security Admission",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>The Kubernetes Pod Security Standards define different isolation levels for Pods. These standards let you define how you want to restrict the behavior of pods in a clear, consistent fashion.</p>\n<p>Kubernetes offers a built-in Pod Security admission controller to enforce the Pod Security Standards. Pod security restrictions are applied at the namespace level when pods are created.</p>\n<h2 id=\"pod-security-levels\">Pod Security levels</h2>\n<p>Pod Security admission places requirements on a Pod's Security Context and other related fields according to the three levels defined by the Pod Security Standards: <code>privileged</code>, <code>baseline</code>, and <code>restricted</code>. Refer to the Pod Security Standards page for an in-depth look at those requirements.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" style=\"width: 800px;\">\n<thead>\n<tr>\n<th scope=\"col\">Level</th>\n<th scope=\"col\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Privileged</td>\n<td>Unrestricted level, providing the widest possible level of permissions. This level allows for known privilege escalations.</td>\n</tr>\n<tr>\n<td>Baseline</td>\n<td>Minimally restrictive level which prevents known privilege escalations. Allows the default (minimally specified) Pod configuration.</td>\n</tr>\n<tr>\n<td>Restricted</td>\n<td>Heavily restricted level, following current Pod hardening best practices.</td>\n</tr>\n</tbody>\n</table>\n<p lang=\"en-US\"><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\">OO by default supports <code>restricted</code>  profile. OO RAS component is responsible for executing flows. With the <code>restricted</code> level, OO RAS limits the functionality and restricts some bash operations like <strong><code>ping</code></strong> … etc. If a user wants to allow RAS to execute a ping operation OO allows the user to change the level from restricted to privileged/baseline.  </span></span></p>\n<p><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\">To change PSA level use the parameter <code>psaLevel</code>. This parameter is present under the section <code>oocontroller --&gt; deployment --&gt; ooras</code>. Allowed values for this parameter are <code>privileged</code>, <code>baseline</code> and <code>restricted</code>. The default value of the psaLevel parameter is <code>restricted</code>.</span></span></p>\n<h3 style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"><b>How to set PSA Level for RAS </b></span></h3>\n<ul>\n<li value=\"1\"><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"><span style=\"font-weight:normal\"><span style=\"font-style:normal\">To set the PSA Level update the psaLevel parameter with the supported value in values yaml file. This parameter is present under the section </span></span><code>oocontroller --&gt; deployment --&gt; ooras</code><span style=\"font-weight:normal\"><span style=\"font-style:normal\">.</span></span></span></span></li>\n<li><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"><strong>If OO is not deployed</strong>, this value is considered at OO deployment time.</span></span></li>\n<li><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"><strong>If OO is already deployed</strong>, this value is considered at OO upgrade time.</span></span>\n<ul>\n<li><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"><span style=\"font-weight:normal\"><span style=\"font-style:normal\">Once the OO upgrade is completed, RAS pods that are created newly will use the new psaLevel value.</span></span></span></span></li>\n<li>For existing RAS pods, the user has to manually update the statefulset. Follow the below steps for all the tenants.\n\t\t<ul>\n<li>kubectl scale sts &lt;statefulset_name&gt; -n &lt;oo_namespace&gt; --replicas=0</li>\n<li>kubectl edit sts &lt;statefulset_name&gt; -n &lt;oo_namespace&gt;\n\t\t\t<ul>\n<li><strong>To set PSA Level to Privileged:</strong> Remove the security context section from itom-ooras container section and save.</li>\n<li><strong>To set PSA Level to baseline: </strong><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\">Add/update security context section under itom-ooras container as below and save.</span></span></li>\n<li>\n<pre><code>securityContext:\n  capabilities:\n    add:\n    - AUDIT_WRITE\n\t- CHOWN\n\t- DAC_OVERRIDE\n\t- FOWNER\n\t- FSETID\n\t- KILL\n\t- MKNOD\n\t- NET_BIND_SERVICE\n\t- SETFCAP\n\t- SETGID\n\t- SETPCAP\n\t- SETUID\n\t- SYS_CHROOT</code>\n</pre>\n</li>\n<li value=\"1\"><strong><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\"><span style=\"font-weight:normal\"><span style=\"font-style:normal\">To set PSA Level to restricted: </span></span></span></span></strong><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\">Add/update the security context section under itom-ooras container as below and save.</span></span></li>\n<li>\n<pre><code>securityContext:\n  allowPrivilegeEscalation: false\n  capabilities:\n    drop:\n    - ALL</code></pre>\n</li>\n</ul>\n</li>\n<li>kubectl scale sts &lt;statefulset_name&gt; -n &lt;oo_namespace&gt; --replicas=1</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"pod-security-admission-labels-for-namespaces\">Pod Security Admission labels for namespaces</h2>\n<p>Once the feature is enabled or the webhook is installed, you can configure namespaces to define the admission control mode you want to use for pod security in each namespace. Kubernetes defines a set of labels that you can set to define which of the predefined Pod Security Standard levels you want to use for a namespace. The label you select defines what action the control plane takes if a potential violation is detected:</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\" style=\"width: 500px;\">\n<thead>\n<tr>\n<th scope=\"col\">Mode</th>\n<th scope=\"col\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>enforce</strong></td>\n<td>Policy violations will cause the pod to be rejected.</td>\n</tr>\n<tr>\n<td><strong>audit</strong></td>\n<td>Policy violations will trigger the addition of an audit annotation to the event recorded in the audit log, but are otherwise allowed.</td>\n</tr>\n<tr>\n<td><strong>warn</strong></td>\n<td>Policy violations will trigger a user-facing warning, but are otherwise allowed.</td>\n</tr>\n</tbody>\n</table>\n<p>You can configure for a namespace any or all modes, or even set a different level for different modes.</p>\n<p>For each mode, there are two labels that determine the policy used:</p>\n<pre><code># The per-mode level label indicates which policy level to apply for the mode.\n#\n# MODE must be one of `enforce`, `audit`, or `warn`.\n# LEVEL must be one of `privileged`, `baseline`, or `restricted`.\npod-security.kubernetes.io/&lt;MODE&gt;: &lt;LEVEL&gt;\n\n# Optional: per-mode version label that can be used to pin the policy to the\n# version that shipped with a given Kubernetes minor version (for example v1.28).\n#\n# MODE must be one of `enforce`, `audit`, or `warn`.\n# VERSION must be a valid Kubernetes minor version, or `latest`.\npod-security.kubernetes.io/&lt;MODE&gt;-version: &lt;VERSION&gt;</code></pre>\n<h2>Workload resources and Pod templates</h2>\n<p>Pods are often created indirectly, by creating a workload object such as a Deployment or Job. The workload object defines a Pod template and a controller for the workload resource creates Pods based on that template. To help catch violations early, both the audit and warning modes are applied to the workload resources. However, enforce mode is <strong>not</strong> applied to workload resources, only to the resulting pod objects.</p>\n<h2 id=\"exemptions\">Exemptions</h2>\n<p>You can define <em>exemptions</em> from pod security enforcement in order to allow the creation of pods that would have otherwise been prohibited due to the policy associated with a given namespace. Exemptions can be statically configured in the Admission Controller configuration.</p>\n<p>Exemptions must be explicitly enumerated. Requests meeting exemption criteria are <em>ignored</em> by the Admission Controller (all <code>enforce</code>, <code>audit</code> and <code>warn</code> behaviors are skipped). Exemption dimensions include:</p>\n<ul>\n<li><strong>Usernames:</strong> requests from users with an exempt authenticated (or impersonated) username are ignored.</li>\n<li><strong>RuntimeClassNames:</strong> pods and workload resources specifying an exempt runtime class name are ignored.</li>\n<li><strong>Namespaces:</strong> pods and workload resources in an exempt namespace are ignored.</li>\n</ul>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-caution-icon\"></div>\n<div class=\"admonition-content admonition-caution-content\">Most pods are created by a controller in response to a workload resource, meaning that exempting an end user will only exempt them from enforcement when creating pods directly, but not when creating a workload resource. Controller service accounts (such as <code>system:serviceaccount:kube-system:replicaset-controller</code>) should generally not be exempted, as doing so would implicitly exempt any user that can create the corresponding workload resource.</div>\n</div>\n<p>Updates to the following pod fields are exempt from policy checks, meaning that if a pod update request only changes these fields, it will not be denied even if the pod is in violation of the current policy level:</p>\n<ul>\n<li>Any metadata updates <strong>except</strong> changes to the seccomp or AppArmor annotations:\n\n\t<ul>\n<li><code>seccomp.security.alpha.kubernetes.io/pod</code> (deprecated)</li>\n<li><code>container.seccomp.security.alpha.kubernetes.io/*</code> (deprecated)</li>\n<li><code>container.apparmor.security.beta.kubernetes.io/*</code></li>\n</ul>\n</li>\n<li>Valid updates to <code>.spec.activeDeadlineSeconds</code></li>\n<li>Valid updates to <code>.spec.tolerations</code></li>\n</ul>\n<h2 id=\"metrics\">Metrics</h2>\n<p>The <strong>kube-apiserver</strong> exposes the following Prometheus metrics:</p>\n<ul>\n<li><code>pod_security_errors_total</code>: This metric indicates the number of errors preventing normal evaluation. Non-fatal errors may result in the latest restricted profile being used for enforcement.</li>\n<li><code>pod_security_evaluations_total</code>: This metric indicates the number of policy evaluations that have occurred, not counting ignored or exempt requests during exporting.</li>\n<li><code>pod_security_exemptions_total</code>: This metric indicates the number of exempt requests, not counting ignored or out of scope requests.</li>\n</ul>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}