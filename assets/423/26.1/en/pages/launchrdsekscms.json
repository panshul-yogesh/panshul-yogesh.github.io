{
  "title": "Launch RDS for UD/UCMDB",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>UD/UCMDB contains an internal (embedded) PostgreSQL database instance, which should be used for demonstration purposes only. You must use external databases in a production environment. <br/>\nWhen deployed on AWS, the suite uses RDS as the database engine. This RDS instance will be used as the external databases for the following UD/UCMDB components:</p>\n<ul>\n<li>UCMDB Server</li>\n<li>AutoPass License Service (APLS)</li>\n</ul>\n<h2 id=\"Prepare_RDS_template_for_CMS\">Prepare RDS template for UD/UCMDB</h2>\n<ol>\n<li>Navigate to the<strong> smax-rds.template</strong> file under <code>../Cloud Deployment x.x.x/byok/smax-cloudformation-aws</code> in <a href=\"/doc/423/26.1/downloadcloudpackage\" title=\"Download the cloud deployment package\">the cloud deployment package</a>.</li>\n<li>Create a copy of the<strong> smax-rds.template</strong> file and rename the new file to<strong> cms-rds.template</strong>.</li>\n<li>Replace the<strong> </strong>two<strong> SMAX-RDS-Security-Group </strong>keys (under <strong>RDSSecurityGroup</strong><b> </b>in <strong>cms-rds.template</strong>) with <strong>CMS-RDS-Security-Group</strong>, and then save the file.</li>\n</ol>\n<h2>Create an RDS instance for UD/UCMDB</h2>\n<p>We recommend that you use RDS as the database engine on AWS. Follow these steps to launch RDS for UD/UCMDB.</p>\n<ol>\n<li>Log in to the AWS Management Console and switch to the selected region.</li>\n<li>Go to <b>All services</b> &gt; <b>Management &amp; Governance </b>&gt;<b> CloudFormation</b>.</li>\n<li>Click<b> Create stack </b>&gt; <strong>With new resources(standard)</strong>, click <b>Template is ready</b> &gt; <b>Upload a template file</b> &gt; Choose file and select the <b>cms-rds.template</b> file under <code>../Cloud Deployment x.x.x/byok/smax-cloudformation-aws</code>.</li>\n<li>Click <b>Next </b>and populate the following fields:\n\t<ul>\n<li><b>Stack name</b>: Give a name to this stack, such as <b>cms-rds</b>.</li>\n<li><b>VPC ID</b>: Select the created VPC from the drop-down list.</li>\n<li><b>First/Second Subnet for RDS</b>: Select the first/second database subnet created for RDS.</li>\n<li><b>RDS Instance Type</b>: Select an instance type from the drop-down list. See <a href=\"/doc/423/26.1/ekssizing\" title=\"Sizing considerations for EKS deployment\">Sizing considerations for EKS deployment</a>.</li>\n<li><b>RDS instance identifier</b>: Define an RDS instance name.</li>\n<li><b>User name</b>: Type a username for the database admin account, such as \"postgres.\"</li>\n<li><b>Password</b>: Define a password for the database admin account.</li>\n<li><b>RDS Storage size</b>: Type a storage size. See <a href=\"/doc/423/26.1/ekssizing\" title=\"Sizing considerations for EKS deployment\">Sizing considerations for EKS deployment</a>.</li>\n<li><b>Postgres engine version</b>: Type an engine version. See <a href=\"/doc/423/26.1/ekssupportmatrix\" title=\"Support matrix for EKS deployment\">Support matrix</a>.</li>\n<li><b>Multi-AZ RDS</b>: Select false for test and development environments, select true for staging and production environments</li>\n<li><b>BastionSecurityGroup</b>: Select the bastion's security group to allow the bastion node to communicate with RDS.</li>\n<li><b>ClusterSecurityGroup</b>: Select the EKS cluster's security group (<em>eks-cluster-sg-*</em>) to allow the EKS cluster to communicate with RDS.</li>\n</ul>\n</li>\n<li>Click <b>Next &gt; Next &gt; Submit</b>. Wait until the stack creation finishes and you can check the results under the <b>Outputs </b>tab. Take note of the value of <strong>RDSEndpointAddress</strong>. It will be used in later steps.</li>\n</ol>\n<p>After the RDS is created, you must test its connectivity by running the commands below on the bastion node. </p>\n<pre>sudo yum install -y postgresql\npsql -h &lt;RDSEndpointAddress&gt; -U &lt;postgres admin&gt; -d postgres</pre>\n<p>Where: <br/>\n<code>&lt;RDSEndpointAddress&gt;</code><em> </em>can be collected in the <b>Outputs </b>of the previous step.<br/>\n<code>&lt;postgres admin&gt;</code> is the PostgreSQL admin user you specified when launching RDS. Replace it with the actual value.</p>\n<p><br/>\nNext, set up the PostgreSQL databases for UD/UCMDB on the RDS instance created.</p>\n<h2>Set up PostgreSQL databases for UD/UCMDB on the RDS instance</h2>\n<p>In a production environment, you must use external databases for UD/UCMDB. The database user and database name information are required when you install UD/UCMDB, and the database schema information is also required.</p>\n<p>The databases must be empty so that UD/UCMDB will initialize them during installation. The table below shows example database information prepared for the UD/UCMDB components.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Service</th>\n<th scope=\"col\">DB User</th>\n<th scope=\"col\">DB Name</th>\n<th scope=\"col\">Schema</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>UCMDB Server</td>\n<td>ucmdb</td>\n<td>ucmdb_db</td>\n<td>ucmdb_schema</td>\n</tr>\n<tr>\n<td>APLS</td>\n<td>ucmdb_autopass</td>\n<td>ucmdb_autopass_db</td>\n<td>ucmdb_autopass_schema</td>\n</tr>\n</tbody>\n</table>\n<p><br/>\nBelow are sample SQL commands for creating a user and a database for a service:</p>\n<ol>\n<li>\n<p>Log in to the bastion node and then run the following command to connect to the PostgreSQL instance.</p>\n<pre>psql -h &lt;RDSEndpointAddress&gt; -p &lt;RDSEndpointPort&gt; -U &lt;postgres admin&gt; -d postgres</pre>\n<p>Where: <b>RDSEndpointAddress</b> and <b>RDSEndpointPort</b> can be collected in the <b>Outputs</b> of the <b>Create an RDS instance for UD/UCMDB</b> step.</p>\n</li>\n<li>\n<p>Run the following commands to create the databases and the users used by UCMDB Server and AutoPass:</p>\n<pre>CREATE USER &lt;USERNAME&gt; PASSWORD '&lt;PASSWORD&gt;';\n\ngrant &lt;USERNAME&gt; to &lt;PostgresSQL admin&gt;;\n\nCREATE DATABASE &lt;DBNAME&gt; OWNER &lt;USERNAME&gt;;   </pre>\n<div class=\"Admonition_Note\"><span class=\"autonumber\">Note  </span><code>&lt;PASSWORD&gt;</code> for database user should follow below complexity defined by the Vault secret utility:\n\n\t<ul>\n<li>At least 8 characters long</li>\n<li>Alphanumeric characters</li>\n<li>At least one lower case letter</li>\n<li>At least one upper case letter</li>\n<li>At least one digit</li>\n</ul>\n</div>\n<p>For example:</p>\n<b># For UCMDB </b>\n<pre>CREATE USER ucmdb PASSWORD '&lt;PASSWORD&gt;';\n\ngrant ucmdb to &lt;PostgresSQL admin&gt;;\n\nCREATE DATABASE ucmdb_db OWNER ucmdb; </pre>\n<b># For APLS  </b>\n<pre>CREATE USER ucmdb_autopass PASSWORD '&lt;PASSWORD&gt;';\n\ngrant ucmdb_autopass to &lt;PostgresSQL admin&gt;;\n\nCREATE DATABASE ucmdb_autopass_db OWNER ucmdb_autopass; </pre>\n</li>\n<li>\n<p>Run the following commands to create the schemas used by UCMDB Server and AutoPass: </p>\n<pre>\\c &lt;DBNAME&gt;\n\nCREATE SCHEMA &lt;DBSCHEMA&gt; AUTHORIZATION &lt;USERNAME&gt;;\n\nALTER USER &lt;USERNAME&gt; SET search_path TO &lt;DBSCHEMA&gt;;</pre>\n<p>For example:</p>\n<b># For UCMDB</b>:\n\n\t<pre>\\c ucmdb_db\n\nCREATE SCHEMA ucmdb_schema AUTHORIZATION ucmdb_user;\n\nALTER USER ucmdb_user SET search_path TO ucmdb_schema;</pre>\n<b># For APLS</b>  :\n\n\t<pre>\\c autopass_db\n\nCREATE SCHEMA autopass_schema AUTHORIZATION autopass_user;\n\nALTER USER autopass_user SET search_path TO ucmdb_autopass_schema;</pre>\n</li>\n</ol>\n<div class=\"Admonition_Note\"><span class=\"autonumber\">Note</span>: If you want to use the SSL connection mode for PostgreSQL, you can download a root certificate that works for all AWS regions. For details, see the related AWS document <a href=\"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/UsingWithRDS.SSL.html\" title=\"AWS doc\">here</a>. Then, when creating <strong>my-values.yaml </strong>for the UD/UCMDB deployment later, set <strong>global.database.tlsEnabled</strong> to <strong>true </strong>and configure <strong>caCertificates</strong>.</div>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}