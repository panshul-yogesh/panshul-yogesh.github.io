{
  "title": "Launch Amazon RDS for OO",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>OO Containerized uses Amazon Relational Database Service (Amazon RDS) to store its data.</p>\n<p>There are two options for setting up Amazon RDS for OO:</p>\n<ul>\n<li>(Recommended) Use a dedicated Amazon RDS instance for OO to ensure a smooth and fluent experience.</li>\n<li>Use the same Amazon RDS instance as the rest of the suite components.</li>\n</ul>\n<p>Irrespective of the choice, review the <a href=\"/doc/423/26.1/ekssizing#Additional_hardware_requirements_for_OO\" title=\"sizing considerations\">sizing considerations</a> to check the Amazon RDS requirements.</p>\n<p>For option #1:<br/>\nPerform all the following steps:</p>\n<ul>\n<li><a href=\"/doc/423/26.1/launchrdseksooc#Prepare_Amazon_RDS_template_for_OO\" title=\"Prepare Amazon RDS template for OO\">Prepare Amazon RDS template for OO</a> </li>\n<li><a href=\"/doc/423/26.1/launchrdseksooc#Create_an_Amazon_RDS_instance_for_OO\" title=\"Create an Amazon RDS instance for OO\">Create an Amazon RDS instance for OO</a></li>\n<li><a href=\"/doc/423/26.1/launchrdseksooc#Create_databases_for_OO_on_the_Amazon_RDS_instance\" title=\"Create databases for OO on the Amazon RDS instance\">Create databases for OO on the Amazon RDS instance</a></li>\n</ul>\n<p>For option #2:</p>\n<ul>\n<li>You must resize the shared Amazon RDS instance to an instance type capable of supporting the added requirements of both suite and OO.</li>\n<li>Perform the step <a href=\"/doc/423/26.1/launchrdseksooc#Create_databases_for_OO_on_the_Amazon_RDS_instance\" title=\"Create databases for OO on the Amazon RDS instance.\">Create databases for OO on the Amazon RDS instance.</a> </li>\n</ul>\n<h2>Prepare Amazon RDS template for OO</h2>\n<p>Copy and save the following as <strong>oo-rds.template</strong>. Upload it later in the<strong> AWS Console</strong>:</p>\n<pre>{\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\n    \"Description\": \"Amazon EKS Control Plane\",\n    \"Parameters\": {\n        \"DBSubnet1\": {\n            \"Description\": \"First Subnet for RDS. \",\n            \"Type\": \"AWS::EC2::Subnet::Id\"\n        },\n        \"DBSubnet2\": {\n            \"Description\": \"Second Subnet for RDS \",\n            \"Type\": \"AWS::EC2::Subnet::Id\"\n        },\n        \"DBInstanceIdentifier\": {\n            \"Default\": \"oo-postgres\",\n            \"Description\": \"The RDS instance identifier\",\n            \"Type\": \"String\",\n            \"MinLength\": \"1\",\n            \"MaxLength\": \"64\",\n            \"AllowedPattern\": \"[a-zA-Z][a-zA-Z0-9_-]*\",\n            \"ConstraintDescription\": \"DBInstanceIdentifier must begin with a letter and contain only alphanumeric characters.\"\n        },\n        \"DBUser\": {\n            \"Default\": \"postgres\",\n            \"Description\": \"The database admin account username\",\n            \"Type\": \"String\",\n            \"MinLength\": \"1\",\n            \"MaxLength\": \"16\",\n            \"AllowedPattern\": \"[a-zA-Z][a-zA-Z0-9]*\",\n            \"ConstraintDescription\": \"DBUser must begin with a letter and contain only alphanumeric characters.\"\n        },\n        \"DBPassword\": {\n            \"NoEcho\": \"true\",\n            \"Default\": \"postgres\",\n            \"Description\": \"The database admin account password\",\n            \"Type\": \"String\",\n            \"MinLength\": \"8\",\n            \"MaxLength\": \"41\",\n            \"AllowedPattern\": \"[a-zA-Z0-9_-]*\",\n            \"ConstraintDescription\": \"DBPassword must contain only alphanumeric characters.\"\n        },\n        \"MultiAZDatabase\": {\n            \"Default\": \"false\",\n            \"Description\": \"Create a Multi-AZ RDS database instance or not.\",\n            \"Type\": \"String\",\n            \"AllowedValues\": [\n                \"true\",\n                \"false\"\n            ],\n            \"ConstraintDescription\": \"Must be either true or false. Select false for demo and development environments, select true for staging and production environments.\"\n        },\n        \"DBAllocatedStorage\": {\n            \"Default\": \"100\",\n            \"Description\": \"The size of the database storage (GB), must be between 100 and 1024GB. For details see Additional hardware requirements for OO\",\n            \"Type\": \"Number\",\n            \"MinValue\": \"100\",\n            \"MaxValue\": \"20480\",\n            \"ConstraintDescription\": \"DBAllocatedStorage must be between 100 and 20480GB (20 TB).\"\n        },\n        \"RDSInstanceType\":{\n            \"Description\": \"RDS instance type. Please refer to EKS sizing.\",\n            \"Default\": \"db.r5.large\",\n            \"AllowedValues\": [\n                \"db.m5.large\",\n                \"db.m5.xlarge\",\n                \"db.m5.2xlarge\",\n                \"db.m5.4xlarge\",\n                \"db.r5.large\",\n                \"db.r5.xlarge\",\n                \"db.r5.2xlarge\",\n                \"db.m6g.large\",\n                \"db.m6g.xlarge\",\n                \"db.m6g.2xlarge\",\n                \"db.m6g.4xlarge\"\n            ],\n            \"Type\": \"String\"\n        },\n        \"RDSEngineVersion\":{\n            \"Description\": \"The version number of the database engine to use. Please refer to Additional hardware requirements for OO\",\n            \"Default\": \"12.9\",\n            \"Type\": \"String\"\n        },\n        \"ClusterSecurityGroup\": {\n            \"Description\": \"Allow EKS cluster to communicate with RDS.\",\n            \"Type\": \"AWS::EC2::SecurityGroup::Id\"\n        },\n        \"BastionSecurityGroup\":  {\n            \"Description\": \"Allow bastion to communicate with RDS.\",\n            \"Type\": \"AWS::EC2::SecurityGroup::Id\"\n        },\n        \"VpcId\": {\n            \"Description\": \"The VPC of the worker instances\",\n            \"Type\": \"AWS::EC2::VPC::Id\"\n        }\n    },\n    \"Metadata\": {\n        \"AWS::CloudFormation::Interface\": {\n            \"ParameterGroups\": [\n                {\n                    \"Label\": {\n                        \"default\": \"RDS Config\"\n                    },\n                    \"Description\": {\n                        \"default\": \"RDS Config Parameters for OO deployment\"\n                    },\n                    \"Parameters\": [\n                        \"VpcId\",\n                        \"DBSubnet1\",\n                        \"DBSubnet2\",\n                        \"RDSInstanceType\",\n                        \"RDSSecurityGroup\",\n                        \"DBInstanceIdentifier\",\n                        \"DBUser\",\n                        \"DBPassword\",\n                        \"DBAllocatedStorage\",\n                        \"RDSEngineVersion\",\n                        \"MultiAZDatabase\"\n                    ]\n                }\n            ],\n            \"ParameterLabels\": {\n                \"DBInstanceIdentifier\": {\n                    \"default\": \"RDS instance identifier: \"\n                },\n                \"DBUser\": {\n                    \"default\": \"User name: \"\n                },\n                \"DBPassword\": {\n                    \"default\": \"Password: \"\n                },\n                \"MultiAZDatabase\": {\n                    \"default\": \"Multi-AZ RDS: \"\n                },\n                \"DBAllocatedStorage\": {\n                    \"default\": \"RDS Storage size: \"\n                },\n                \"DBSubnet1\": {\n                    \"default\": \"First Database Subnet for RDS: \"\n                },\n                \"DBSubnet2\": {\n                    \"default\": \"Second Database Subnet for RDS: \"\n                },\n                \"RDSInstanceType\": {\n                    \"default\": \"RDS Instance Type: \"\n                },\n                \"RDSSecurityGroup\": {\n                    \"default\": \"RDS Security Group: \"\n                },\n                \"VPCID\": {\n                                        \"default\": \"VPC ID: \"\n                },\n                \"RDSEngineVersion\": {\n                                        \"default\": \"Postgres engine version: \"\n                }\n            }\n        }\n    },\n    \"Rules\": {\n        \"SubnetsInVPC\": {\n            \"Assertions\": [\n                {\n                    \"Assert\": {\n                        \"Fn::EachMemberIn\": [\n                            {\n                                \"Fn::ValueOfAll\": [\n                                    \"AWS::EC2::Subnet::Id\",\n                                    \"VpcId\"\n                                ]\n                            },\n                            {\n                                \"Fn::RefAll\": \"AWS::EC2::VPC::Id\"\n                            }\n                        ]\n                    },\n                    \"AssertDescription\": \"All subnets must exist in the VPC\"\n                }\n            ]\n        }\n    },\n    \"Resources\": {\n        \"RDSSubnetGroup\": {\n            \"Type\": \"AWS::RDS::DBSubnetGroup\",\n            \"Properties\": {\n                \"DBSubnetGroupDescription\": \"Subnet available for the RDS DB Instance\",\n                \"SubnetIds\": [\n                    {\n                        \"Ref\": \"DBSubnet1\"\n                    },\n                    {\n                        \"Ref\": \"DBSubnet2\"\n                    }\n                ],\n                \"Tags\": [\n                    {\n                        \"Key\": \"Application\",\n                        \"Value\": {\n                            \"Ref\": \"AWS::StackId\"\n                        }\n                    },\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": {\n                            \"Fn::Join\": [\n                                \"\",\n                                [\n                                    {\n                                        \"Ref\": \"AWS::StackName\"\n                                    },\n                                    \"- RDSSubnetGroup\"\n                                ]\n                            ]\n                        }\n                    }\n                ]\n            }\n        },\n        \"RDSInstance\": {\n            \"Type\": \"AWS::RDS::DBInstance\",\n            \"Properties\": {\n                \"Engine\": \"postgres\",\n                \"EngineVersion\": {\n                    \"Ref\": \"RDSEngineVersion\"\n                },\n                \"MultiAZ\": {\n                    \"Ref\": \"MultiAZDatabase\"\n                },\n                \"DBInstanceIdentifier\":{\n                    \"Ref\": \"DBInstanceIdentifier\"\n                },\n                \"MasterUsername\": {\n                    \"Ref\": \"DBUser\"\n                },\n                \"MasterUserPassword\": {\n                    \"Ref\": \"DBPassword\"\n                },\n                \"DBInstanceClass\": {\n                    \"Ref\": \"RDSInstanceType\"\n                },\n                \"StorageType\":\"gp2\",\n                                \"StorageEncrypted\":true,\n                \"AutoMinorVersionUpgrade\": false,\n                \"AllocatedStorage\": {\n                    \"Ref\": \"DBAllocatedStorage\"\n                },\n                \"DBSubnetGroupName\": {\n                    \"Ref\": \"RDSSubnetGroup\"\n                },\n                \"VPCSecurityGroups\": [{\n                    \"Ref\": \"RDSSecurityGroup\"\n                }],\n                \"Tags\": [\n                    {\n                        \"Key\": \"Application\",\n                        \"Value\": {\n                            \"Ref\": \"AWS::StackId\"\n                        }\n                    },\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": {\n                            \"Fn::Join\": [\n                                \"\",\n                                [\n                                    {\n                                        \"Ref\": \"AWS::StackName\"\n                                    },\n                                    \"-RDSInstance\"\n                                ]\n                            ]\n                        }\n                    }\n                ]\n            },\n                        \"DeletionPolicy\": \"Delete\"\n        },\n        \"RDSSecurityGroup\": {\n            \"Type\": \"AWS::EC2::SecurityGroup\",\n            \"Properties\": {\n                                \"GroupDescription\": \"Open database for access\",\n                                \"GroupName\": \"OO-RDS-Security-Group\",\n                \"VpcId\": {\n                    \"Ref\": \"VpcId\"\n                },\n                \"Tags\": [\n                    {\n                        \"Key\": \"Application\",\n                        \"Value\": {\n                            \"Ref\": \"AWS::StackId\"\n                        }\n                    },\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"OO-RDS-Security-Group\"\n                    }\n                ]\n            }\n                },\n\n                \"RDSSecurityGroupIngressFromBastion\": {\n                        \"Type\": \"AWS::EC2::SecurityGroupIngress\",\n                        \"DependsOn\": \"RDSSecurityGroup\",\n                        \"Properties\": {\n                \"Description\": \"Allow bastion to communicate with RDS \",\n                \"GroupId\": {\n                    \"Ref\": \"RDSSecurityGroup\"\n                },\n                \"SourceSecurityGroupId\": {\n                                        \"Ref\": \"BastionSecurityGroup\"\n\n                },\n                \"IpProtocol\": \"tcp\",\n                                \"FromPort\": \"5432\",\n                                \"ToPort\": \"5432\"\n                        }\n                },\n\n                \"RDSSecurityGroupIngressFromWorker\": {\n                                \"Type\": \"AWS::EC2::SecurityGroupIngress\",\n                                \"DependsOn\": \"RDSSecurityGroup\",\n                                \"Properties\": {\n                                        \"Description\": \"Allow cluster to communicate with the RDS instance \",\n                                        \"GroupId\": {\n                                                \"Ref\": \"RDSSecurityGroup\"\n                                        },\n                                        \"SourceSecurityGroupId\": {\n                                                \"Ref\": \"ClusterSecurityGroup\"\n\n                                        },\n                                        \"IpProtocol\": \"tcp\",\n                                        \"FromPort\": \"5432\",\n                                        \"ToPort\": \"5432\"\n                                }\n                }\n    },\n    \"Outputs\": {\n        \"RDSEndpointAddress\": {\n            \"Description\": \"RDS endpoint Address\",\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"RDSInstance\",\n                    \"Endpoint.Address\"\n                ]\n            }\n        },\n        \"RDSEndpointPort\": {\n            \"Description\": \"RDS endpoint Port\",\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"RDSInstance\",\n                    \"Endpoint.Port\"\n                ]\n            }\n        }\n    }\n}</pre>\n<h2>Create an Amazon RDS instance for OO</h2>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">Please take into consideration that AWS Console UI might change over time, so the information here might become outdated at some point.</div>\n</div>\n<ol>\n<li>Log in to the AWS Management Console and switch to the region selected for Service Management and OO Containerized deployment.</li>\n<li>Go to <b>CloudFormation</b>.</li>\n<li>Click<b> Create stack</b>, click <b>With new resources (standard)</b> &gt; <strong>Next &gt; </strong><b>Upload a template file</b> &gt; <strong>Choose file</strong> and select the <b>oo-rds.template</b> file created earlier.</li>\n<li>Click <b>Next </b>and populate the following fields:\n\t<ul>\n<li><b>Stack name</b>: Give a name to this stack, such as <b>oo-rds</b>.</li>\n<li><b>VPC ID</b>: From the drop-down list select the VPC that's used with the SMA suite deployment.</li>\n<li><b>First &amp; Second Subnet for RDS</b>: Select the same subnet IDs that you used for the SMA RDS database instance. </li>\n<li><b>RDS Instance Type</b>: Keep the default one or select another type from the drop-down list.</li>\n<li><b>RDS instance identifier</b>: Define an Amazon RDS instance name. You can keep the default or add a custom one.</li>\n<li><b>User name</b>: Type a username for the database admin account, such as \"<strong>postgres</strong>.\"</li>\n<li><b>Password</b>: Define a password for the database admin account.</li>\n<li><b>RDS Storage size</b>: Specify a desired storage size for the OO database. For more information, see the \"Additional hardware requirements for OO\" section in Sizing considerations for EKS deployment.</li>\n<li><b>Postgres engine version</b>: Type an engine version.</li>\n<li><b>Multi-AZ RDS</b>: It's recommended to select <strong>false </strong>for test and development environments and <strong>true </strong>for staging and production environments to have high availability.</li>\n<li><strong>BastionSecurityGroup</strong>: Select the same Security Group ID that's used by the SMA RDS instance to allow the bastion node to communicate with Amazon RDS.</li>\n<li><strong>ClusterSecurityGroup</strong>: Select the same Security Group ID that's used by the SMA RDS instance to allow the EKS cluster to communicate with Amazon RDS.</li>\n</ul>\n</li>\n<li>Click <b>Next &gt; Next &gt; Create stack</b>. Wait until the stack creation finishes and you can check the results under the <b>Outputs </b>tab.</li>\n</ol>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">Take note of the value of <b>RDSEndpointAddress</b>. You'll use this in later steps.</div>\n</div>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">In case of <strong>Create Stack</strong> errors, check the <strong>Events</strong> tab to see what the issue is.</div>\n</div>\n<h3>Verify creating Amazon RDS</h3>\n<p>After creating the Amazon RDS instance, you must test its connectivity by running the command below on the bastion node. </p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">Make sure to install the PostgreSQL client on the bastion node before running the below command.</div>\n</div>\n<pre>psql -h &lt;RDSEndpointAddress&gt; -p &lt;RDSEndpointPort&gt; -U &lt;postgres_admin&gt; -d postgres</pre>\n<p>Where: </p>\n<ul>\n<li><code>&lt;RDSEndpointAddress&gt;, &lt;RDSEndpointPort&gt;</code>: get these values in the <b>Outputs </b>of the previous step. </li>\n<li><code>&lt;postgres_admin&gt;</code> is the PostgreSQL admin user you specified when launching the Amazon RDS instance. Replace it with the actual value.</li>\n</ul>\n<h2>Create databases for OO on the Amazon RDS instance</h2>\n<p>The databases must be empty so that OO will initialize them during installation. The table below shows example database information prepared for the following components.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Component</th>\n<th scope=\"col\">Database User</th>\n<th scope=\"col\">Database Name</th>\n<th scope=\"col\">Schema (default)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>OO Central</td>\n<td><code>oocentraldbuser</code></td>\n<td><code>oocentraldb</code></td>\n<td><code>oo_cen_core</code></td>\n</tr>\n<tr>\n<td>OO Session Manager</td>\n<td><code>oosessionmanagerdbuser</code></td>\n<td><code>oosessionmanagerdb</code></td>\n<td><code>public</code></td>\n</tr>\n<tr>\n<td>OO Controller</td>\n<td><code>oocontrollerdbuser</code></td>\n<td><code>oocontrollerdb</code></td>\n<td><code>public</code></td>\n</tr>\n<tr>\n<td>OO Scheduler</td>\n<td><code>ooschedulerdbuser</code></td>\n<td><code>ooschedulerdb</code></td>\n<td><code>oo_sch_core</code></td>\n</tr>\n<tr>\n<td>AutoPass</td>\n<td><code>aplsdbuser</code></td>\n<td><code>aplsdb</code></td>\n<td><code>public</code></td>\n</tr>\n</tbody>\n</table>\n<p>Below are sample SQL commands for creating a user and a database:</p>\n<ol>\n<li>\n<p>Log in to your database server with the administrator credentials, using the command below:</p>\n<pre>psql -h &lt;RDSEndpointAddress&gt; -p &lt;RDSEndpointPort&gt; -U &lt;postgres_admin&gt; -d postgres\n</pre>\n<p>You get the values of <strong>RDSEndpointAddress</strong> and <strong>RDSEndpointPort</strong> from the <strong>Outputs</strong> of Create an Amazon RDS instance for OO step and <code>&lt;postgres_admin&gt;</code> is the PostgreSQL admin user you specified when launching the RDS instance.</p>\n</li>\n<li>\n<p>Run the following commands to create the databases and the users, by substituting the exemplified database names, database users, and their respective passwords of each component with the desired values.</p>\n<p><strong>OO Central:</strong></p>\n<pre><code>CREATE ROLE \"oocentraldbuser\" LOGIN ENCRYPTED PASSWORD 'oocentraldbuserPass' NOSUPERUSER INHERIT;\nCREATE DATABASE \"oocentraldb\"; \nALTER DATABASE \"oocentraldb\" OWNER TO \"oocentraldbuser\";</code></pre>\n<p><strong>OO Session Manager:</strong></p>\n<pre><code>CREATE ROLE \"oosessionmanagerdbuser\" LOGIN ENCRYPTED PASSWORD 'oosessionmanagerdbuserPass' NOSUPERUSER INHERIT;\nCREATE DATABASE \"oosessionmanagerdb\"; \nALTER DATABASE \"oosessionmanagerdb\" OWNER TO \"oosessionmanagerdbuser\";</code></pre>\n<p><strong>OO Controller:</strong></p>\n<pre><code>CREATE ROLE \"oocontrollerdbuser\" LOGIN ENCRYPTED PASSWORD 'oocontrollerdbuserPass' NOSUPERUSER INHERIT;\nCREATE DATABASE \"oocontrollerdb\"; \nALTER DATABASE \"oocontrollerdb\" OWNER TO \"oocontrollerdbuser\";</code></pre>\n<p><strong>OO Scheduler:</strong></p>\n<pre><code>CREATE ROLE \"ooschedulerdbuser\" LOGIN ENCRYPTED PASSWORD 'ooschedulerdbuserPass' NOSUPERUSER INHERIT;\nCREATE DATABASE \"ooschedulerdb\"; \nALTER DATABASE \"ooschedulerdb\" OWNER TO \"ooschedulerdbuser\";</code></pre>\n<p><strong>AutoPass:</strong></p>\n<pre><code>CREATE ROLE \"aplsdbuser\" LOGIN ENCRYPTED PASSWORD 'aplsdbuserPass' NOSUPERUSER INHERIT;\nCREATE DATABASE \"aplsdb\"; \nALTER DATABASE \"aplsdb\" OWNER TO \"aplsdbuser\";</code></pre>\n</li>\n</ol>\n<div></div>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}