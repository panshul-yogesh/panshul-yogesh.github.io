{
  "title": "Customize service workflows against a license usage record",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p data-mc-conditions=\"NC.Cust\">The license usage report in SAM provides a list of license usage records per license model and product version. Each license usage record presents detailed product compliance data generated upon the latest license consumption calculation. As a software manager, you can customize the service workflows against the License Usage record type to meet your business requirements. This will help track your license usage, manage software compliance, and reduce license expenses.</p>\n<h2 data-mc-conditions=\"NC.Cust\">Solution overview</h2>\n<p data-mc-conditions=\"NC.Cust\">This figure shows the basic workflow of how you can create a license usage record and use it for managing software compliance within your organization.</p>\n<div><a class=\"image\" href=\"/file/images/2/26/SAMLicUsageSol.png\" title=\"/file/images/2/26/SAMLicUsageSol.png\"> <img alt=\"SAMLicUsageSol.png\" border=\"0\" file=\"/mediawiki/images/2/26/SAMLicUsageSol.png\" height=\"280\" hspace=\"0\" src=\"../../../images/SAMLicUsageSol_c4621626.png\" style=\"width: 800px; height: 280px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a></div>\n<ol>\n<li>The configuration of license models controls the creation and deletion of license usage records by adding or removing the linked product version. Configuring the license model will initiate a license usage record.</li>\n<li>By calculating license consumption, SAM gets the current compliance information of the product.</li>\n<li>SAM pushes the latest calculation result to the new license usage record according to the license model and linked product version. Then, you can leverage the Service Management service workflows customized against the license usage record:\n\t<ul>\n<li>Use case 1: send email notifications when a product becomes noncompliant</li>\n<li>Use case 2: create service requests for purchasing new licenses when the license usage exceeds the threshold</li>\n</ul>\n</li>\n<li>* If the license model isn't configured correctly for the product, SAM fails to push the calculation result to the license usage record. In this case, the system can automatically create a license model after you configure the notification template and business rules. See the <em>What if no license model is configured</em> section.</li>\n<li>* You can review the pending license model and proceed to step 1 for configuring the license model.</li>\n</ol>\n<p>* If the license model hasn't been pre-configured correctly as instructed, steps 4 and 5 serve as an exception handling case. This design also works when a product has one or more top-level versions in the upgrade matrix that aren't covered by any license in the license model settings.</p>\n<h2>Use cases</h2>\n<p>This section walks you through the procedure of how Eve, a software manager, customizes Service Management service workflows based on the license usage records. </p>\n<p>To manage software assets more efficiently, Eve wants the system to automatically send her an email notification when a product becomes noncompliant and create a service request to apply for new licenses on her behalf when the license usage of the product exceeds its threshold.</p>\n<h3>Customize service workflow configurations</h3>\n<p>To receive email notifications and requests, the tenant admin has already completed the following configurations:</p>\n<ul>\n<li>Enabled mail configurations in <strong>Administration</strong> &gt; <strong>Configuration</strong> &gt; <strong>Application settings</strong>. See <a href=\"/doc/423/26.1/appsettings\" title=\"Application settings\">Application settings</a>.</li>\n<li>Configured the email recipients in <strong>Administration</strong> &gt; <strong>Master Data</strong> &gt;<strong> People</strong>. See <a href=\"/doc/423/26.1/userscontacts\" title=\"Users and contacts\">Users and contacts</a>.</li>\n<li>Localized the language of the text strings in <strong>Asset Model details</strong> via changing the <strong>Locale setting </strong>in<strong> Application settings</strong>. See <a href=\"/doc/423/26.1/appsettings#Locale_setting\" title=\"Application settings\">Application settings</a>. Note that the synchronization of<strong> Locale setting</strong> from Service Management to SAM runs hourly.</li>\n</ul>\n<h3 data-mc-conditions=\"NC.Cust\">Configure the license model</h3>\n<ol>\n<li>In Service Management, navigate to <strong>Run</strong> &gt; <strong>Software Asset</strong>.</li>\n<li>In Software Asset Management, go to <strong>License Models</strong>.</li>\n<li>Select the license model record used for the required product (for example, <em>SQL Server</em>) to open its General tab.</li>\n<li>In the <strong>Asset Model details </strong>section, configure the <strong>Owner </strong>field as Eve.</li>\n<li>In the <strong>Software coverage</strong> section, select a license metric for the product (<em>Per core - Generic</em>), and then add the highest product version as needed (<em>SQL Server 2019 Ent</em>).</li>\n<li>Click <strong>Save</strong>.<br/>\n\tThis creates a license usage record on the <strong>License Usage</strong> page with limited information. <a class=\"image\" href=\"/file/images/f/f2/SAMSQLServerLM.png\" title=\"/file/images/f/f2/SAMSQLServerLM.png\"> <img alt=\"SAMSQLServerLM.png\" border=\"0\" file=\"/mediawiki/images/f/f2/SAMSQLServerLM.png\" height=\"44\" hspace=\"0\" src=\"../../../images/SAMSQLServerLM_5f12cc38.png\" style=\"width: 800px; height: 44px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a></li>\n</ol>\n<h3>Schedule a calculation task</h3>\n<p>Other than manually starting a calculation task, Eve chooses to define a scheduler for SAM to run a calculation task every day at 22:00 by following these steps:</p>\n<ol>\n<li>Go to the <strong>Products</strong> page, on the On-premises tab, search for and select SQL Server, and then click <strong>Schedule</strong>.</li>\n<li>In the dialog box that appears, set the <strong>Cron expression</strong> field to <b>0 0 22 * * ?</b>, leave other fields empty, and then click <strong>SAVE</strong>.</li>\n</ol>\n<h3>Work with system notification templates and business rules</h3>\n<p>The system sends notifications based on predefined notification templates. Eve can add, update, or delete any template for an email notification with the administration permissions. Each template contains the information that the recipient needs to know when the workflow triggers the email to be sent. For instructions on how to work with notification templates, see <a href=\"/doc/423/26.1/workwithnotificationtemplates\" title=\"Work with notification templates\">Work with notification templates</a>. To automate the service workflow, there are some system business rules that appear under the process events out-of-the-box. For more information on how to modify a business rule, see <a href=\"/doc/423/26.1/modifybizrule\" title=\"Edit, remove, or disable a business rule\">Edit, remove, or disable a business rule</a>.</p>\n<h3>Use case 1: send email notifications when a product becomes noncompliant</h3>\n<p>The system defines a business rule that will automatically send the license model owner an email notification when a product becomes noncompliant. </p>\n<h4>View the OOTB business rule as a tenant admin</h4>\n<ol>\n<li>Go to <strong>Administration </strong>&gt;<strong> Studio</strong>. </li>\n<li>Select <strong>License Usage</strong> from the record type drop-down list.</li>\n<li>Click the <strong>Processes and Rules</strong> tab.</li>\n<li>Navigate to <strong>LicenseUsage</strong> &gt; <strong>Normal</strong> &gt; <strong>Active</strong> &gt; <strong>Noncompliant </strong>&gt;<strong> After applying changes</strong>.</li>\n</ol>\n<p><strong>OOTB business rule: sending email notifications for noncompliant products</strong></p>\n<p><code>If ${entity.AssetModel.Owner != null &amp;&amp; entity.Balance !=null &amp;&amp; entity.Balance &lt; 0} Send notification to ${entity.AssetModel.Owner.Id}<br/>\n using Notification template for noncompliant products with parameters</code></p>\n<h4>Example of email notifications sent to Eve for noncompliant products</h4>\n<div><a class=\"image\" href=\"/file/images/7/78/download9211.png\" title=\"/file/images/7/78/download9211.png\"> <img alt=\"download9211.png\" border=\"0\" file=\"/mediawiki/images/7/78/download9211.png\" height=\"694\" hspace=\"0\" src=\"../../../images/download9211_07bc4e52.png\" style=\"width:800px;height:694px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\" width=\"800\"/> </a></div>\n<p>When running a calculation task at 22:00, SAM pushes the latest calculation result to the license usage record. The new license record now has more field values related to product compliance, including the available license points, the consumed license points, and the estimated cost for purchasing extra licenses to bring the product back into compliance, as shown in the following figure.</p>\n<div><a class=\"image\" href=\"/file/images/6/62/noteshaa.png\" title=\"/file/images/6/62/noteshaa.png\"> <img alt=\"noteshaa.png\" border=\"0\" file=\"/mediawiki/images/6/62/noteshaa.png\" height=\"45\" hspace=\"0\" src=\"../../../images/noteshaa_c94b24bc.png\" style=\"width: 800px; height: 45px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a></div>\n<p>If the number of license points consumed exceeds the number of license points available, Eve will receive an email, indicating that the product is noncompliant. Then, Eve can decide either to stop using the product on some devices or purchase extra licenses to bring the product back to compliance. </p>\n<h4>Limitations</h4>\n<ul>\n<li>You might receive multiple email notifications at the same time in either of the following cases:\n\t<ul>\n<li>If a product has multiple noncompliant product versions, In this case, check the license compatibility matrix configurations in SAM.</li>\n<li>The product has different editions that don't support license downgrade and both editions are noncompliant.</li>\n</ul>\n</li>\n<li>If a product version is noncompliant but it's not linked to the license model, SAM can't update the license usage record with the latest consumption result. As a result, no email notifications will be sent. See the <em>What if no license model is configured</em> section.</li>\n</ul>\n<h3>Use case 2: create service requests for purchasing new licenses when the license usage exceeds the threshold</h3>\n<p>By default, the pre-defined OOTB business rules that trigger the notifications and license requests are disabled.</p>\n<h4>Enable the OOTB business rules as a tenant admin</h4>\n<p>If Eve wants the system to automatically create an email notification and a service request when the license usage of a product exceeds 90%, the tenant admin can do the following:</p>\n<ol>\n<li>Go to <strong>Administration </strong>&gt;<strong> Studio</strong>. </li>\n<li>Select <strong>License Usage</strong> from the record type drop-down list.</li>\n<li>Click the <strong>Processes and Rules</strong> tab.</li>\n<li>In the <strong>After applying changes</strong> tab, Eve will see the following OOTB business rules for sending email notifications with predefined templates and creating new requests, and she can enable the OOTB rules via clicking <b>Edit</b> &gt; <b>Enable rule</b>. </li>\n</ol>\n<p><strong>OOTB business rule: sending email notifications for license usage that exceeds the threshold</strong><br/>\n<code>If ${entity.AssetModel.Owner != null &amp;&amp; entity.LatestUpgrade == true &amp;&amp; entity.ConsumtionPoints/entity.LicensePoints &gt; 0.9 &amp;&amp; entity.MetaPhase != 'Inactive' &amp;&amp; current_update.PhaseId.IsChanged == false}<br/>\nSend notification to ${entity.AssetModel.Owner.Id} using Notification template for license usage that exceeds the threshold with parameters</code></p>\n<p><strong>OOTB business rule: creating a new request </strong></p>\n<p><code>If ${entity.AssetModel.Owner != null &amp;&amp; entity.LatestUpgrade == true &amp;&amp; entity.ConsumtionPoints/entity.LicensePoints &gt; 0.9 &amp;&amp; entity.MetaPhase != 'Inactive' &amp;&amp; lookup('Request','Id','CreationSource','CreationSourceSAM','ExternalProcessReference',entity.Code,'Active','true') == null }</code><br/>\n<code>Create Request with Description: ${concat('License request for ', entity.AssetModel.DisplayLabel, ' - ', entity.ProductVersion, ' - ', entity.LicenseMetric, ' - The balance is: ', entity.Balance)}</code> <code>RequestedByPerson: ${entity.AssetModel.Owner.Id}</code> <code>ImpactScope: Enterprise</code></p>\n<p><code>···</code></p>\n<h4>Examples of email notifications sent to Eve</h4>\n<p>After the two business rules are enabled, if the license consumption result meets the conditions in the business rules, Eve will receive two emails, one indicating that the license usage for this product has exceeded the threshold, and the other informing her of a service request created for purchasing new licenses. Eve can view and modify this request in <strong>Run</strong> &gt; <strong>Service Request</strong>.</p>\n<ul>\n<li><strong>When the license usage exceeds the threshold:</strong></li>\n</ul>\n<p><strong><a class=\"image\" href=\"/file/images/7/7b/exceedthethreshold.png\" title=\"/file/images/7/7b/exceedthethreshold.png\"> <img alt=\"exceedthethreshold.png\" border=\"0\" file=\"/mediawiki/images/7/7b/exceedthethreshold.png\" height=\"655\" hspace=\"0\" src=\"../../../images/exceedthethreshold_b054ec78.png\" style=\"width: 800px; height: 655px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a> </strong></p>\n<ul>\n<li><strong>When a new license request is created:</strong></li>\n</ul>\n<p><strong><a class=\"image\" href=\"/file/images/f/f1/SMAte.png\" title=\"/file/images/f/f1/SMAte.png\"> <img alt=\"SMAte.png\" border=\"0\" file=\"/mediawiki/images/f/f1/SMAte.png\" height=\"335\" hspace=\"0\" src=\"../../../images/SMAte_a4a57d99.png\" style=\"width: 800px; height: 335px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a> </strong></p>\n<p>In addition, a service request record as the following will be created:</p>\n<p><strong><a class=\"image\" href=\"/file/images/f/f8/SAMRequestRec.png\" title=\"/file/images/f/f8/SAMRequestRec.png\"> <img alt=\"SAMRequestRec.png\" border=\"0\" file=\"/mediawiki/images/f/f8/SAMRequestRec.png\" height=\"68\" hspace=\"0\" src=\"../../../images/SAMRequestRec_3b187137.png\" style=\"width: 800px; height: 68px; margin: 0px; border: 0px solid black;\" vspace=\"0\" width=\"800\"/> </a> </strong></p>\n<h4>Limitations</h4>\n<p>If a product version is linked to multiple license models, the total license usage of all product versions that the license can cover might not exceed the threshold. In such cases, SAM may still create notifications and requests if one of the license usage records meets the condition in the business rule.</p>\n<h3>What if no license model is configured</h3>\n<p>If a product version is at the top of the license upgrade matrix but it's not linked to a license model, SAM can't push the current calculation result to the license usage record. In this case, based on the OOTB business rule, the system will enable SAM to automatically create a license model and inform Eve about this through an email notification. </p>\n<h4><span style=\"color: rgb(0, 0, 0); font-family: Roboto, sans-serif;\">Configure </span>OOTB<span style=\"color: rgb(0, 0, 0); font-family: Roboto, sans-serif;\"> business rule</span></h4>\n<ol>\n<li>​​​​​Click the <strong>Processes and Rules</strong> tab.</li>\n<li>Choose <strong>AssetModel</strong> &gt; <strong>Normal</strong> &gt; <strong>Active</strong> &gt; <strong>Active</strong>.</li>\n<li>In the <strong>After applying changes</strong> phase, because SAM creates the new license model without configuring the <strong>Owner</strong> field, you need to customize the OOTB business rule as the following:<br/>\n<code>${(current_update.ReviewStatus.IsChanged() &amp;&amp; current_update.ReviewStatus.NewValue == 'Pending') || (current_update.PhaseId.OldValue == 'Inactive' &amp;&amp; entity.ReviewStatus == 'Pending')}</code></li>\n<li>Configure the <code>Send email to ${entity.Owner.Id} </code>field as Eve.</li>\n<li>Click <strong>Save</strong>.<br/>\n\tAfter a calculation task is run, Eve will receive an email notifying her that the license model is automatically created.</li>\n</ol>\n<h4>Example of email notifications sent to Eve for license models pending review:</h4>\n<div><a class=\"image\" href=\"/file/images/f/f3/pendrev.png\" title=\"/file/images/f/f3/pendrev.png\"> <img alt=\"pendrev.png\" border=\"0\" file=\"/mediawiki/images/f/f3/pendrev.png\" height=\"743\" hspace=\"0\" src=\"../../../images/pendrev_10c19d17.png\" style=\"width:800px;height:743px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\" width=\"800\"/> </a></div>\n<h4>Review the license model</h4>\n<ol>\n<li>Go to the <strong>License Models</strong> page.</li>\n<li>Locate the automatically created license model and click the record ID to open its General tab.</li>\n<li>In the <strong>Asset Model details</strong> section, click <strong>Show more</strong>,<strong> </strong>and view the <strong>Reason</strong> field to check why this license model is created. </li>\n<li>Find the <strong>Review status</strong> field and decide whether you want to use this license model.\n\t<ul>\n<li>To use this license model, configure the proper license metric and product version, change the value of the <strong>Review status</strong> field from <strong>Pending</strong> to <strong>Done </strong>or <strong>Rejected</strong>, and then click <strong>Save</strong>.</li>\n<li>If you already have a license model available and don't want to use the new license model, change the phase of the new license model from <strong>ACTIVE</strong> to <strong>INACTIVE</strong>. Then, configure the existing license model record with the correct license metric and product version.</li>\n</ul>\n</li>\n</ol>\n<p>When the license model configuration is complete, you can start customizing the service workflows against the license usage record to meet your business requirements.</p>\n<p><span style=\"color: rgb(0, 115, 231); font-family: Roboto, sans-serif; font-size: 24px;\">Related topics</span></p>\n<p><a href=\"/doc/423/26.1/samlicenseusage\" title=\"License usage\">License usage</a></p>\n<div></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}