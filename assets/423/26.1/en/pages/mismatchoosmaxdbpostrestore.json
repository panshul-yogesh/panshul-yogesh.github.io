{
  "title": "Database mismatch between Service Management and OO after restore on AWS",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>For a suite deployment on AWS (EKS), you have restored the suite using the backup databases for the suite and Operations Orchestration (OO), but the tenant status (Activated/Deactivated) for a tenant isn't consistent between the suite and OO.</p>\n<h2>Cause</h2>\n<p>This issue occurred because of a backup and restore flow similar to the example described below:</p>\n<ol>\n<li>At 4:00 pm, the suite database was backed up, where a tenant with id as 123456789 was in an <strong>Activated</strong> state.</li>\n<li>At 4:05 pm, tenant 123456789 was deactivated in Suite Administration. The tenant state was set to <b>Deactivated</b> in both the suite and OO databases.</li>\n<li>At 4:06 pm, the OO database was backed up. At this point in time, tenant 123456789 was marked as <strong>Activated</strong> in the suite database backup, and as <strong>Deactivated</strong> in the OO database backup.</li>\n<li>At 4:07 pm, the cluster crashed.</li>\n<li>At 5:17 pm, the cluster was restored with the database backups for the suite and OO in steps 1 and 3. At this point, the following inconsistency occurred:\n\t<ul>\n<li>In the suite database: Tenant 123456789 was in an <strong>Activated</strong> state. </li>\n<li>In the OO database: Tenant 123456789 was in a <strong>Deactivated</strong> state. </li>\n</ul>\n</li>\n</ol>\n<h2>Solution</h2>\n<p>Follow the below steps to synchronize the tenant status between the suite and OO databases:</p>\n<ol>\n<li>Create a list of all the <strong>Active</strong> tenants that have OO capability enabled.</li>\n<li>Create a list of all <strong>Inactive</strong> tenants that have the OO capability enabled.</li>\n<li>Ensure that the restoration of OO k8s objects is completed and that all OO pods are up and running.</li>\n<li>Run the following command:\n\t<pre>helm upgrade &lt;oo_install_name&gt; -n &lt;oo_namespace&gt; &lt;path_to_oo_chart&gt; --reuse-values --set ootenants-sync.deployment.activeTenants=\"&lt;comma_separated_tenant_IDs_list&gt;\" --set ootenants-sync.deployment.inactiveTenants=\"&lt;comma_separated_tenant_IDs_list&gt;\"</pre>\n<strong>For example: </strong>\n<pre>helm upgrade oo -n oons /root/oo.tgz --reuse-values --set ootenants-sync.deployment.activeTenants=\"123456789\\,987654321\" --set ootenants-sync.deployment.inactiveTenants=\"111222333\\,999888777\"\n\nootenants-sync.deployment.activeTenants = tenants to be activated\n\nootenants-sync.deployment.inactiveTenants = tenants to be deactivated\n</pre>\n<p>By running the above command, OO creates a K8s job responsible for syncing the OO tenants in the OO DB with the suite tenant IDs provided accordingly via the helm upgrade command.</p>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}