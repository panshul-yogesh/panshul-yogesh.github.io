{
  "title": "Modify the configuration information of external databases",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p><!--cke_bookmark_211S--><!--cke_bookmark_211E--></p>\n<p>This topic describes how to modify the configuration information of external databases for Service Management.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-tip-icon\"></div>\n<div class=\"admonition-content admonition-tip-content\">To learn how to modify the configuration information of OMT's external IdM database, refer to the OMT documentation: <a href=\"/doc/406/25.4/modifyexternaldatabaseconfiguration\" title=\"Modify the configuration information of an external IdM database\">Modify the configuration information of an external IdM database</a>.</div>\n</div>\n<p>Use the following steps to modify the configuration information of external databases. These steps allows you to update the database host, port and SSL configuration.</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">In the following procedure, step 5 requires a cluster restart, which will cause a system downtime. If you want to avoid this, you can:\n<ol start=\"1\">\n<li>Download the <a href=\"https://marketplace.opentext.com/itom/content/service-management-automation-operation-toolkit\" title=\"SMA Operation Toolkit\">SMA Operation Toolkit</a> package (SMA-operation-toolkit-xxxx.xx.tar.gz and SMA-operation-toolkit-xxxx.xx.tar.gz.sig) and upload it to a control plane node (in an embedded Kubernetes environment) or to the bastion node (in a managed Kubernetes environment). </li>\n<li>Extract the toolkit package by running command \"tar xzvf  SMA-operation-toolkit-xxxx.xx.tar.gz\".</li>\n<li>Skip step 5. Instead, go to step 6.</li>\n</ol>\n</div>\n</div>\n<ol>\n<li>Run the following command to get your current helm values.\n\t<pre>helm get values &lt;ESM_RELEASE_NAME&gt; -n &lt;ESM_NAMESPACE&gt; &gt; my_values.yaml</pre>\n<p>Where:</p>\n<ul>\n<li><code>&lt;ESM_RELEASE_NAME&gt;</code> is the release name, which you can obtain by using the following command:\n\n\t\t<pre>helm list -n &lt;ESM_NAMESPACE&gt; | awk '{print $1}'</pre>\n</li>\n<li><code>&lt;ESM_NAMESPACE&gt;</code> is the unique namespace of the ESM chart deployment.</li>\n<li><em>my_values.yaml</em> is the yaml file with your customized settings.</li>\n</ul>\n<p>Example:</p>\n<pre>helm get values sma -n itsma-xxx &gt; my_values.yaml</pre>\n</li>\n<li>\n<p>Modify the <em>my_values.yaml </em>with the new database port, host or SSL configurations you wish to update. </p>\n<pre>global:\n  database:\n    admin: postgres\n    host: &lt;DB host&gt;\n    port: 5432\n    tlsEnabled: true\n\ndatabase:\n  caCertificates:\n    pg_server1_ca.crt: XXXX</pre>\n<p>To enable SSL, you need to configure the <code>tlsEnabled</code>and <code>caCertificates </code>values as above. See <a href=\"/doc/423/26.1/changecertforpostgresql\" title=\"Enable SSL connection\">Enable SSL connection</a>.</p>\n</li>\n<li>Run the following command to clean up unused jobs before applying the changes. \n\t<pre><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\">kubectl get job -n </span></span>&lt;ESM_NAMESPACE&gt;<span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\">|grep -v NAME | awk '{print $1}'|xargs kubectl delete job -n </span></span>&lt;ESM_NAMESPACE&gt;</pre>\n</li>\n<li>\n<p>Use the following helm command to update the database information</p>\n<pre> helm upgrade  &lt;ESM_RELEASE_NAME&gt; -n &lt;ESM_NAMESPACE&gt; &lt;ESM_HELM_CHART_PATH&gt; -f my_values.yaml</pre>\n<p>Where <code>&lt;ESM_HELM_CHART_PATH&gt;</code>:  The absolute path of the helm package.</p>\n<p>Example:</p>\n<pre> helm upgrade sma -n itsma-xxx esm-1.0.0+2x.x-xxx/charts/esm-1.0.0+2x.x-xxx.tgz -f my_values.yaml</pre>\n</li>\n<li>Run the following command to make sure the sma-approle-secret-init-job-xxx  pod status is completed before next step. \n\t<pre>kubectl get pod -n &lt;<em>ESM_NAMESPACE</em>&gt; |grep sma-approle-secret-init-job</pre>\n</li>\n<li>\n<p>If a system downtime is acceptable:</p>\n<ol start=\"1\">\n<li>\n<p>Run the following command to stop the suite after completing the upgrade.</p>\n<pre>$CDF_HOME/bin/cdfctl runlevel set -l DOWN -n &lt;ESM_NAMESPACE&gt;\n</pre>\n</li>\n<li>\n<p>Run the following command to restart.</p>\n<pre>$CDF_HOME/bin/cdfctl runlevel set -l UP -n &lt;ESM_NAMESPACE&gt;</pre>\n</li>\n</ol>\n</li>\n<li>\n<p>If system downtime is unacceptable, go to where you extracted the <a href=\"https://marketplace.opentext.com/itom/content/service-management-automation-operation-toolkit\" title=\"SMA Operation Toolkit\">SMA Operation Toolkit</a> package, in the subfolder <code>db_connection_management</code>, run <code>helm-restart-db-pods.sh</code> to perform a rolling restart of the database-related pods.</p>\n</li>\n</ol>\n<h4>Monitor the database update result</h4>\n<p>Wait until the suite pods have restarted. You can run the following command to watch the suite pod status:</p>\n<pre>watch kubectl get pods -n &lt;ESM_NAMESPACE&gt;</pre>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}