{
  "title": "Set up a secure connection between SMA and UCMDB Gateway",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\">\n<p>To set up a secure connection between Service Management and the UCMDB Gateway, you need to import the root CA certificate of both parties into each other. If the CA certificates are changed on either side, you need to import the new CA certificate chains to the other side again.</p>\n<h2>Get the root CA certificate of UCMDB Gateway (classic UD/UCMDB)</h2>\n<p>Get the <strong>cmsrootca.crt</strong> file from the <b>ssl</b> folder in the unzipped installer package of UCMDB Gateway for classic UD/UCMDB.</p>\n<h2>Get the root CA certificate of UCMDB Gateway (containerized UD/UCMDB)</h2>\n<p>Use one of the following methods to get the root CA certificate.</p>\n<p><strong>From the browser:</strong></p>\n<ol start=\"1\">\n<li>Log in to UCMDB Gateway (<strong>https://&lt;UCMDB_HOSTNAME&gt;:&lt;UCMDB_PORT&gt;/cms</strong>) from the browser. As an example, the following are steps for Chrome. </li>\n<li>Click the lock icon before the URL on the address bar.</li>\n<li>Click <strong>Connection is secure</strong></li>\n<li>Click <strong>Certificate is valid</strong>.</li>\n<li>On the <strong>Certification Viewer</strong>, click <strong>Details</strong>.</li>\n<li>In the <b>Certificate Hierarchy</b>, select the site <strong>root </strong>certificate (the topmost one), and then click <strong>Export</strong>. </li>\n<li>Select the <strong>Base-64 encoded ASCII, single certificate</strong> format, set the file name as <strong>UCMDB_Gateway_CA_Certificate.crt</strong>, and then click <strong>Save</strong>.</li>\n</ol>\n<p><strong>Using a command line:</strong></p>\n<ol start=\"1\">\n<li>Run the following commands to get the certificate details\n\t<pre>openssl s_client -connect cmsdemo01.esmlab.net:9443 -showcerts</pre>\n</li>\n<li>The output of the command will display the certificates. </li>\n<li>Look for the certificate that has the same <strong>s:/CN</strong> and <strong>i:/CN</strong> values.</li>\n<li>Copy the last certificate (from <b>-----BEGIN CERTIFICATE-----</b> to <b>-----END CERTIFICATE-----</b>) from the command line output, and then save it as <strong>&lt;UCMDB_Gateway_CA_Certificate&gt;.crt</strong>.</li>\n</ol>\n<h2 id=\"Set_the_permission_for_the_certificate_file\">Set the permission for the certificate file</h2>\n<p>Run the following command in the suite control plane node to set the permissions for the certificate file:</p>\n<pre><code>chown &lt;SYSTEM_USER_ID&gt;:&lt;SYSTEM_GROUP_ID&gt; &lt;UCMDB_Gateway_CA_Certificate&gt;.crt</code></pre>\n<p>Replace &lt;SYSTEM_USER_ID&gt; and &lt;SYSTEM_GROUP_ID&gt; with the <strong>SYSTEM_USER_ID</strong> and <strong>SYSTEM_GROUP_ID</strong> values configured during the suite installation. They're the user ID and group ID of an operating system user used to run the process in the container. For example:</p>\n<pre><code>chown 1999:1999 &lt;UCMDB_Gateway_CA_Certificate&gt;.crt</code></pre>\n<h2>Import the UCMDB Gateway root CA certificate to the Suite</h2>\n<h3>Classic deployment</h3>\n<ol start=\"1\">\n<li>Place the file that contains the root CA certificate in the following Service Management directory: <code>&lt;<i>Service Management global NFS share</i>&gt;/certificate/source</code>. For example, <code>/var/vols/itom/itsma/global-volume/certificate/source</code>. After importing the file to the Service Management truststore, the system automatically moves this file from the <code>&lt;<i>Service Management global NFS share</i>&gt;/certificate/source</code> folder to the <code>&lt;<i>Service Management global NFS share</i>&gt;/certificate/imported</code> directory.</li>\n<li>Run the following commands to restart all online/offline platform pods to reload the global <strong>itsma-truststore</strong> file:\n\t<pre><code>kubectl rollout restart deployment itom-xruntime-platform -n &lt;suite namespace&gt;\nkubectl rollout restart deployment itom-xruntime-platform-offline -n &lt;suite namespace&gt;\nkubectl rollout restart deployment itom-xruntime-platform-offline-ng -n &lt;suite namespace&gt;</code></pre>\n</li>\n<li>If you installed the SAM services, you must restart the SAM backend pod. Run the following command to restart the pod:\n\t<pre><code>kubectl rollout restart deployment sam-backend-deployment -n &lt;suite namespace&gt;</code></pre>\n</li>\n</ol>\n<h3>Helm deployment</h3>\n<ol>\n<li>To import the UCMDB Gateway root CA certificate to the suite, see <a href=\"/doc/423/26.1/importcertificatehelm\" title=\"Import CA certificate into the Suite\">Import CA certificate into the Suite</a>.</li>\n<li>Run the following commands to restart all online/offline platform pods so that the global <strong>itsma-truststore</strong> file is reloaded:\n\t<pre><code>kubectl rollout restart deployment itom-xruntime-platform -n &lt;suite namespace&gt;\nkubectl rollout restart deployment itom-xruntime-platform-offline -n &lt;suite namespace&gt;\nkubectl rollout restart deployment itom-xruntime-platform-offline-ng -n &lt;suite namespace&gt;</code></pre>\n</li>\n<li>If you installed the SAM services, you must restart the SAM backend pod. Run the following command to restart the pod:\n\t<pre><code>kubectl rollout restart deployment sam-backend-deployment -n &lt;suite namespace&gt;</code></pre>\n</li>\n</ol>\n<h2 id=\"Copy_the_certificate_file_to_the_SMAX_NFS_server\">Import the Service Management root CA certificate to UCMDB Gateway<span style=\"color: rgb(0, 115, 231); font-size: 24px;\"> (classic UD/UCMDB)</span></h2>\n<div class=\"transcontent stn-begin--SSLclassic\"> </div>\n<ol start=\"1\">\n<li>Retrieve the content of the Service Management root CA certificate. For details on this, see <a href=\"/doc/423/26.1/getsuitecacertificate\" title=\"Get the suite CA certificate\">Get the suite CA certificate</a>.</li>\n<li>Open the <strong>trustedCAs.crt</strong> file in the <b>ssl</b> folder in the unzipped installer package of UCMDB Gateway, paste the content retrieved in the previous step to the end of the <strong>.crt</strong> file without any line breaks. </li>\n<li>Restart UCMDB Gateway.\n\t<ul>\n<li>Windows: Go to the Windows Services Manager to restart the service.</li>\n<li>Linux: Run the <code>systemctl restart ucmdb_gateway.service</code> command to restart the service.</li>\n</ul>\n</li>\n</ol>\n<div class=\"transcontent stn-end--SSLclassic\"> </div>\n<h2>Import the Service Management root CA certificate to UCMDB Gateway (containerized UD/UCMDB)</h2>\n<ol start=\"1\">\n<li>Retrieve the content of the Service Management root CA certificate. For details on this, see <a href=\"/doc/423/26.1/getsuitecacertificate\" title=\"Get the suite CA certificate\">Get the suite CA certificate</a>.</li>\n<li>Open your <span style=\"font-size:11.0pt\"><span style='font-family:\"Microsoft YaHei\",sans-serif'>values.yaml file, for example, </span></span><b>my-values.yaml</b><span style=\"font-size:11.0pt\"><span style='font-family:\"Microsoft YaHei\",sans-serif'>, and paste the content of the Service Management root CA certificate in parallel with the global settings (there is no indent before the </span></span><strong>caCertificates</strong> line)<span style=\"font-size:11.0pt\"><span style='font-family:\"Microsoft YaHei\",sans-serif'>. Make sure that the certificate format (indent) is exactly the same as the following sample. </span></span>\n<pre><code>caCertificates:\n  smax.crt: |\n    &lt;certificate content base-64 encoded&gt;</code></pre>\n<p>Example:<br/>\n<a class=\"image\" href=\"/file/images/5/5b/cms_values_yaml_certificate-smax_only.png\" title=\"/file/images/5/5b/cms_values_yaml_certificate-smax_only.png\"> <img alt=\"cert example\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/5/5b/cms_values_yaml_certificate-smax_only.png\" height=\"484\" hspace=\"0\" src=\"../../../images/cms_values_yaml_certificate-smax_only_013bcd10.png\" style=\"width:631px;height:484px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\" width=\"631\"/> </a></p>\n</li>\n<li>Run the following command to get the UD/UCMDB deployment name and UD/UCMDB namespace:\n\t<pre><code>helm ls -A</code></pre>\n</li>\n<li>Run the following command to make this certificate update take effect:\n\t<pre>helm upgrade &lt;UD/UCMDB RELEASE NAME&gt; &lt;UD/UCMDB CHART FILE&gt; -n &lt;UD/UCMDB NAMESPACE&gt; -f &lt;VALUES YAML FILE&gt;</pre>\n<ul>\n<li><code>&lt;UD/UCMDB RELEASE NAME&gt;</code>: The UD/UCMDB deployment name.</li>\n<li><code>&lt;UD/UCMDB CHART FILE&gt;</code>: The file path of the .tgz package unzipped from the UD/UCMDB installation package, for example, /tmp/ucmdb-helm-charts/charts/<strong>ucmdb-1.xx.x-xxx+2x.x.x.tgz</strong>.</li>\n<li><code>&lt;UD/UCMDB NAMESPACE&gt;</code>: The UD/UCMDB namespace.</li>\n<li><code>&lt;VALUES YAML FILE&gt;</code>: The custom <strong>my-v</strong><b>alues.yaml </b>file with properties configured for the UD/UCMDB deployment.</li>\n</ul>\n</li>\n<li>Restart the UCMDB Gateway pod by running the following command:\n\t<pre><code>kubectl rollout restart deployment itom-cms-gateway -n &lt;UD/UCMDB NAMESPACE&gt;</code></pre>\n</li>\n</ol>\n<h2></h2>\n</div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}