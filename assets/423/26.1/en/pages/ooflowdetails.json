{
  "title": "Technical details about the OO flows",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p id=\"Technical_details_about_the_OO_flows\"><span style='color: rgb(51, 51, 51); font-family: Roboto, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; font-size: 16px;'>This section describes the OO flows in more detail. Since the Service Management side is documented in the previous sections, it's not mentioned again.</span></p>\n<p>The OO flows contain all the logic to receive data from Service Management and to transform the data and submit it to SAP Solution Manager.</p>\n<h2 id=\"Flow_1_–_Create_Incidents_in_SAP\">Flow 1 – Create incidents in SAP</h2>\n<div><a class=\"image\" href=\"/file/images/8/87/SMAX_integrate_SAP/SMAX_integrate_SAP_49.png\" title=\"/file/images/8/87/SMAX_integrate_SAP/SMAX_integrate_SAP_49.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 49.png\" data-file-height=\"510\" data-file-width=\"1090\" height=\"510\" src=\"../../../images/SMAX_integrate_SAP_49_d9f686f6.png\" width=\"1090\"/> </a></div>\n<h3>Step - Get an XSFR token</h3>\n<p>This step connects with the SAP credentials configured in the System Properties to receive an XSFR token, which is required in the following steps when connecting to SAP.</p>\n<h3>Step - Parse the HTTP header</h3>\n<p>This step parses the header returned from the first step and extracts the XSFR token. If no token is available, an error occurs. </p>\n<h3>Step - Create and manipulate the SAP Solution Manager payload</h3>\n<p>This step takes the data received from Service Management and prepares the JSON payload for the SAP Request. This step also transforms the data to ensure the payload is acceptable to SAP.</p>\n<p>The scriptlet section of this step prepares the data. For example, it transforms the priority values from Service Management to the corresponding values in SAP.</p>\n<div><a class=\"image\" href=\"/file/images/3/30/SMAX_integrate_SAP/SMAX_integrate_SAP_50.png\" title=\"/file/images/3/30/SMAX_integrate_SAP/SMAX_integrate_SAP_50.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 50.png\" data-file-height=\"493\" data-file-width=\"1215\" height=\"493\" src=\"../../../images/SMAX_integrate_SAP_50_d0d4777b.png\" width=\"1215\"/> </a></div>\n<p>The script creates a variable “<i>payloadSAP</i>”, which is used in the next step as input for the POST request towards SAP.</p>\n<h3>Step – Create Incident in SAP Solution Manager</h3>\n<p>This step takes the generated payload and posts it to SAP Solution Manager by using the XSFR token generated in the first step.</p>\n<p>The payload consists of several other parameters required by SAP, where the JSON payload is embedded.</p>\n<div><a class=\"image\" href=\"/file/images/a/a1/SMAX_integrate_SAP/SMAX_integrate_SAP_51.png\" title=\"/file/images/a/a1/SMAX_integrate_SAP/SMAX_integrate_SAP_51.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 51.png\" data-file-height=\"491\" data-file-width=\"1205\" height=\"491\" src=\"../../../images/SMAX_integrate_SAP_51_bfe206b6.png\" width=\"1205\"/> </a></div>\n<p>The header contains the XSFR token plus some other required parameters.</p>\n<div><a class=\"image\" href=\"/file/images/f/f5/SMAX_integrate_SAP/SMAX_integrate_SAP_52.png\" title=\"/file/images/f/f5/SMAX_integrate_SAP/SMAX_integrate_SAP_52.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 52.png\" data-file-height=\"320\" data-file-width=\"1215\" height=\"320\" src=\"../../../images/SMAX_integrate_SAP_52_91db042d.png\" width=\"1215\"/> </a></div>\n<p>In the results area of this step, we filter the response from SAP. Since SAP is returning a multipart message, we parse the response and extract the embedded JSON part for further processing.</p>\n<p>We also parse the HTTP return code to check for errors.</p>\n<h4>Extracting the JSON from the SAP response</h4>\n<p>Click on the scriptlet filter to see the script, parsing and extracting the data.</p>\n<div><a class=\"image\" href=\"/file/images/0/06/SMAX_integrate_SAP/SMAX_integrate_SAP_53.png\" title=\"/file/images/0/06/SMAX_integrate_SAP/SMAX_integrate_SAP_53.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 53.png\" data-file-height=\"248\" data-file-width=\"1218\" height=\"248\" src=\"../../../images/SMAX_integrate_SAP_53_0f05c688.png\" width=\"1218\"/> </a></div>\n<div><a class=\"image\" href=\"/file/images/a/a7/SMAX_integrate_SAP/SMAX_integrate_SAP_54.png\" title=\"/file/images/a/a7/SMAX_integrate_SAP/SMAX_integrate_SAP_54.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 54.png\" data-file-height=\"434\" data-file-width=\"1220\" height=\"434\" src=\"../../../images/SMAX_integrate_SAP_54_594e8f08.png\" width=\"1220\"/> </a></div>\n<h4>Parsing the HTTP code</h4>\n<p>The http code is parsed in the statusCode results script. If the HTTP code is 201, the incident was successfully created; otherwise, an error happened.</p>\n<div><a class=\"image\" href=\"/file/images/e/e3/SMAX_integrate_SAP/SMAX_integrate_SAP_55.png\" title=\"/file/images/e/e3/SMAX_integrate_SAP/SMAX_integrate_SAP_55.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 55.png\" data-file-height=\"257\" data-file-width=\"1216\" height=\"257\" src=\"../../../images/SMAX_integrate_SAP_55_e3bd6c8c.png\" width=\"1216\"/> </a></div>\n<div><a class=\"image\" href=\"/file/images/1/1c/SMAX_integrate_SAP/SMAX_integrate_SAP_56.png\" title=\"/file/images/1/1c/SMAX_integrate_SAP/SMAX_integrate_SAP_56.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 56.png\" data-file-height=\"425\" data-file-width=\"1218\" height=\"425\" src=\"../../../images/SMAX_integrate_SAP_56_31c74d1b.png\" width=\"1218\"/> </a></div>\n<p>If the HTTP code was not 201, we enforce the step to take the failure exit by setting the <strong>scriptletResponse</strong> value to “failure.”</p>\n<div><a class=\"image\" href=\"/file/images/4/4e/SMAX_integrate_SAP/SMAX_integrate_SAP_57.png\" title=\"/file/images/4/4e/SMAX_integrate_SAP/SMAX_integrate_SAP_57.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 57.png\" data-file-height=\"280\" data-file-width=\"1207\" height=\"280\" src=\"../../../images/SMAX_integrate_SAP_57_0f3a7def.png\" width=\"1207\"/> </a></div>\n<h3>Step – Success/Error Prepare Service Management Payload</h3>\n<p>These steps are called to prepare the payload for Service Management to update the Incident with the latest details.</p>\n<p>Both steps are very similar, and the payload is defined in the Scriptlet tab of the step.</p>\n<div><a class=\"image\" href=\"/file/images/d/dd/SMAX_integrate_SAP/SMAX_integrate_SAP_58.png\" title=\"/file/images/d/dd/SMAX_integrate_SAP/SMAX_integrate_SAP_58.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 58.png\" data-file-height=\"541\" data-file-width=\"1216\" height=\"541\" src=\"../../../images/SMAX_integrate_SAP_58_d7b85a8f.png\" width=\"1216\"/> </a></div>\n<p>Both steps create a variable “payloadSMAX”, which is used in the next step to update the Incident.</p>\n<p>In the success step, the system is extracting the JSON properties from the SAP response such as Incident ID, and Unique ID. All these details are then used in the JSON string for the Service Management payload.</p>\n<p>In the error step, we simply append the error message to the JSON payload to add a comment to the Service Management ticket.</p>\n<h3>Step – Connect to Service Management</h3>\n<p>This step calls a subflow, which is establishing a connection to Service Management to retrieve the LW-SSO token which is then used in the further step. The step is using the Service Management credentials defined in the system account.</p>\n<h3>Step – Update Incident in Service Management</h3>\n<p>This step calls a subflow, which is updating the Incident in Service Management. It takes the generated payload and uses the Service Management case exchange API to update the record.</p>\n<div><a class=\"image\" href=\"/file/images/1/1b/SMAX_integrate_SAP/SMAX_integrate_SAP_59.png\" title=\"/file/images/1/1b/SMAX_integrate_SAP/SMAX_integrate_SAP_59.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 59.png\" data-file-height=\"257\" data-file-width=\"1216\" height=\"257\" src=\"../../../images/SMAX_integrate_SAP_59_8f5f802d.png\" width=\"1216\"/> </a></div>\n<h2 id=\"Flow_2_–_Update_Incident_in_SAP\">Flow 2 – Update Incident in SAP</h2>\n<p>This flow updates the Incident in SAP with the latest details from Service Management. Service Management only sends new comments, the solution and closure details to SAP.</p>\n<p>Most of the steps are the same as in the first flow, and therefore only the differences are described here.</p>\n<h3>Step – Create and manipulate the SAP Solution Manager payload</h3>\n<p>Similar to the first flow, this step prepares the payload for the update action against the SAP Incident. The flow differentiates between 3 events:</p>\n<ol>\n<li>Update</li>\n<li>Resolve</li>\n<li>Close</li>\n</ol>\n<p>The event is triggered by the rule from Service Management and generates a different payload for SAP.</p>\n<div><a class=\"image\" href=\"/file/images/5/57/SMAX_integrate_SAP/SMAX_integrate_SAP_60.png\" title=\"/file/images/5/57/SMAX_integrate_SAP/SMAX_integrate_SAP_60.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 60.png\" data-file-height=\"649\" data-file-width=\"1218\" height=\"649\" src=\"../../../images/SMAX_integrate_SAP_60_6416eebf.png\" width=\"1218\"/> </a></div>\n<p>In the current version, Service Management only sends updates into the ticket history of SAP by using the following payload:</p>\n<pre><code>{\"TextString\": sUpdate,\"TextMode\":\"P\"};</code></pre>\n<h3>Step – Update Incident in SAP Solution Manager</h3>\n<p>This step takes the payload from the previous step and updates the Incident in SAP. The headers are the same as in the <i>Create Incident flow</i>; however, the body of this post request is different because we pass the SAP internal <strong>SAPGUIID</strong> to update the correct record in SAP.</p>\n<div><a class=\"image\" href=\"/file/images/9/92/SMAX_integrate_SAP/SMAX_integrate_SAP_61.png\" title=\"/file/images/9/92/SMAX_integrate_SAP/SMAX_integrate_SAP_61.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 61.png\" data-file-height=\"459\" data-file-width=\"1219\" height=\"459\" src=\"../../../images/SMAX_integrate_SAP_61_de11d288.png\" width=\"1219\"/> </a></div>\n<h2 id=\"Flow_3_–_Update_Incident_in_SAP\">Flow 3 – Update Incident in SAP</h2>\n<div><a class=\"image\" href=\"/file/images/3/30/SMAX_integrate_SAP/SMAX_integrate_SAP_62.png\" title=\"/file/images/3/30/SMAX_integrate_SAP/SMAX_integrate_SAP_62.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 62.png\" data-file-height=\"565\" data-file-width=\"1188\" height=\"565\" src=\"../../../images/SMAX_integrate_SAP_62_1b76ab1d.png\" width=\"1188\"/> </a></div>\n<p>This flow pulls the latest updates from SAP and forwards them to Service Management. This section explains only the differences between this flow and the previous flows.</p>\n<p>The major difference here is that this flow is connecting twice to SAP to do the following:</p>\n<ul>\n<li>Pull the latest status</li>\n<li>Pull the latest history</li>\n</ul>\n<p>To pull the latest status we generate the payload in the step “<i>Create and Manipulate</i>” payload.</p>\n<p>For example, in line 8 we create the query and the search filter and specify the fields to return.</p>\n<div><a class=\"image\" href=\"/file/images/b/b7/SMAX_integrate_SAP/SMAX_integrate_SAP_63.png\" title=\"/file/images/b/b7/SMAX_integrate_SAP/SMAX_integrate_SAP_63.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 63.png\" data-file-height=\"496\" data-file-width=\"1223\" height=\"496\" src=\"../../../images/SMAX_integrate_SAP_63_a3ee24e1.png\" width=\"1223\"/> </a></div>\n<p>This query is then used in the next step to pull the attributes specified.</p>\n<div><a class=\"image\" href=\"/file/images/f/f5/SMAX_integrate_SAP/SMAX_integrate_SAP_64.png\" title=\"/file/images/f/f5/SMAX_integrate_SAP/SMAX_integrate_SAP_64.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 64.png\" data-file-height=\"510\" data-file-width=\"1212\" height=\"510\" src=\"../../../images/SMAX_integrate_SAP_64_54486c13.png\" width=\"1212\"/> </a></div>\n<p>Parsing the result is done through the filter options in the Results tab, like in previous steps.</p>\n<p>As the next step, the flow pulls the ticket updates from SAP. The highlighted GET instructions in the payload pull the latest ticket details.</p>\n<div><a class=\"image\" href=\"/file/images/f/f5/SMAX_integrate_SAP/SMAX_integrate_SAP_64.png\" title=\"/file/images/f/f5/SMAX_integrate_SAP/SMAX_integrate_SAP_64.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 64.png\" data-file-height=\"510\" data-file-width=\"1212\" height=\"510\" src=\"../../../images/SMAX_integrate_SAP_64_54486c13.png\" width=\"1212\"/> </a></div>\n<p>Once we've pulled the status and history, we prepare the payload for Service Management again. As the first step, we extract the status from the SAP response.</p>\n<div><a class=\"image\" href=\"/file/images/1/11/SMAX_integrate_SAP/SMAX_integrate_SAP_65.png\" title=\"/file/images/1/11/SMAX_integrate_SAP/SMAX_integrate_SAP_65.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 65.png\" data-file-height=\"399\" data-file-width=\"1220\" height=\"399\" src=\"../../../images/SMAX_integrate_SAP_65_5061cec8.png\" width=\"1220\"/> </a></div>\n<p>As the second step, we parse the history and ignore all records that are:</p>\n<ul>\n<li>older than the last pull time</li>\n<li>generated by the SAP remote agent, since these updates represent the Service Management updates</li>\n</ul>\n<div><a class=\"image\" href=\"/file/images/6/6f/SMAX_integrate_SAP/SMAX_integrate_SAP_66.png\" title=\"/file/images/6/6f/SMAX_integrate_SAP/SMAX_integrate_SAP_66.png\"> <img alt=\"SMAX integrate SAP/SMAX integrate SAP 66.png\" data-file-height=\"624\" data-file-width=\"1218\" height=\"624\" src=\"../../../images/SMAX_integrate_SAP_66_6e554734.png\" width=\"1218\"/> </a></div>\n<div></div>\n<div></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}