{
  "title": "OPB doesn't work after suite upgrade",
  "content": "<div class=\"mw-parser-output\">\n<div></div>\n<p>After the suite is upgraded to a new version, the suite can't connect to the On-Premises Bridge (<span class=\"nanospell-typo\">OPB</span>) agent. The system sends notification emails to the predefined admin users about the error. </p>\n<h2><a id=\"Cause\" name=\"Cause\" title=\"Cause\"></a>Cause</h2>\n<p>During the suite upgrade, <span class=\"nanospell-typo\">OPB</span> is automatically upgraded if the new suite version comes with a newer version of <span class=\"nanospell-typo\">OPB</span>. As such the <span class=\"nanospell-typo\">OPB</span> service is automatically restarted during the upgrade. Normally, an <span class=\"nanospell-typo\">OPB</span> upgrade can be completed in less than 10 minutes depending on the network speed. You can monitor the <span class=\"nanospell-typo\">OPB</span> upgrade status in the &lt;Agent_installation_directory&gt;\\product\\log\\controller\\upgrade.log file. This file contains data only when an <span class=\"nanospell-typo\">OPB</span> upgrade has taken place. </p>\n<p>This issue occurs if the <span class=\"nanospell-typo\">OPB</span> upgrade fails during the suite upgrade. The <span class=\"nanospell-typo\">OPB</span> upgrade may fail due to certain reasons. </p>\n<p lang=\"EN-US\" xml:lang=\"EN-US\">For example, the <span class=\"nanospell-typo\">OPB</span> may fail to work if the upgrade process is stuck because it failed to download the correct agent-update.zip.  You may find the following error message in the &lt;Agent_installation_directory&gt;\\product\\log\\controller\\controller.log file</p>\n<pre lang=\"EN-US\" xml:lang=\"EN-US\">ERROR [<span class=\"nanospell-typo\">OPBServiceSampler</span>-1-thread] (<span class=\"nanospell-typo\">AgentUpgrader</span>.java:229) <span class=\"nanospell-typo\">OPB</span> update agent - failed to download the new agent code from: [https://myhost.mycompany.com:443/v22/install/on-premise-bridge/agent-update.zip], to: [C:\\Program Files\\OPB\\product\\util\\3rd-party\\wrapper\\..\\..\\..\\upgrade\\download]. \nDownload retry 75. Wait 900 seconds between retries</pre>\n<p>Another example of <span class=\"nanospell-typo\">OPB</span> failure is when the system needs to delete some files during an <span class=\"nanospell-typo\">OPB</span> upgrade. If there are processes using one or more folders or files of the <span class=\"nanospell-typo\">OPB</span> installation, the delete operations will fail, blocking the whole upgrade process. If this happens, you can find messages that resemble the following in the &lt;Agent_installation_directory&gt;\\product\\log\\controller\\upgrade.log file:</p>\n<pre><code>ERROR [main] (AgentUpgraderMain.java:82) OPB update agent - failed to execute agent update!! \n\njava.io.IOException: Unable to delete file: C:\\Program Files\\OPB\\product\\util\\3rd-party\\wrapper\\..\\..\\..\\agent\\opb-controller\\lib\\apache-httpclient-jmx-1.0.0-master-3006.jar</code></pre>\n<h2><a id=\"Solution\" name=\"Solution\" title=\"Solution\"></a>Solution</h2>\n<p>Perform the following steps.</p>\n<h3><a id=\"Make_sure_no_OPB_installation_folders_or_files_are_being_locked\" name=\"Make_sure_no_OPB_installation_folders_or_files_are_being_locked\" title=\"Make sure no OPB installation folders or files are being locked\"></a>Make sure no <span class=\"nanospell-typo\">OPB</span> installation folders or files are being locked</h3>\n<p>First, check for any processes that are keeping any folders of the existing <span class=\"nanospell-typo\">OPB</span> installation in use. If any, manually kill the processes or simply restart the <span class=\"nanospell-typo\">OPB</span> machine. After that, retry connecting to <span class=\"nanospell-typo\">OPB</span>. The problem might be gone.</p>\n<p>If the problem persists, reinstall <span class=\"nanospell-typo\">OPB</span> as described below. </p>\n<h3><a id=\"Reinstall_OPB\" name=\"Reinstall_OPB\" title=\"Reinstall OPB\"></a>Reinstall <span class=\"nanospell-typo\">OPB</span></h3>\n<p>If the problem persists, reinstall <span class=\"nanospell-typo\">OPB</span> as follows.</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>This solution won't affect your existing integration and endpoints, as it won't remove your existing endpoint configurations stored on the server side. </div></div></div>\n<h4><a id=\"Back_up_the_old_OPB\" name=\"Back_up_the_old_OPB\" title=\"Back up the old OPB\"></a>Back up the old <span class=\"nanospell-typo\">OPB</span></h4>\n<p>Back up the following files of your old <span class=\"nanospell-typo\">OPB</span> installation:</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">The configuration files located in the &lt;install dir&gt;\\On-Premise Bridge Agent\\product\\conf directory:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><span class=\"nanospell-typo\">agentCredentialsStore</span>.<span class=\"nanospell-typo\">xml</span></li><li style=\"margin-left: 40px; position: relative;\">credentials.<span class=\"nanospell-typo\">xml</span></li><li style=\"margin-left: 40px; position: relative;\">key.bin</li><li style=\"margin-left: 40px; position: relative;\">wrapper-custom.conf</li><li style=\"margin-left: 40px; position: relative;\">wrapper-<span class=\"nanospell-typo\">maas</span>.conf</li><li style=\"margin-left: 40px; position: relative;\">server-connection.conf</li><li style=\"margin-left: 40px; position: relative;\">dump.conf</li></ul>\n</li><li style=\"margin-left: 28px; position: relative;\">The <span class=\"nanospell-typo\">cacerts</span> file located in the &lt;install dir&gt;\\On-Premise Bridge Agentproduct\\util\\3rd-party\\jre\\lib\\security directory.</li></ul>\n<h4>Reinstall <span class=\"nanospell-typo\">OPB</span></h4>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><span class=\"nanospell-typo\">Uninstall</span> the old <span class=\"nanospell-typo\">OPB</span>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Download the new <span class=\"nanospell-typo\">OPB</span> installation files from the upgraded environment. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Reinstall <span class=\"nanospell-typo\">OPB</span>. For detailed steps, you can refer to the <span class=\"nanospell-typo\">OPB</span> installation instructions for <a href=\"/doc/423/26.1/opbinstall\" title=\"Windows\">Windows</a> and <a href=\"/doc/423/26.1/opbinstalllinux\" title=\"Linux\">Linux</a>.</li></ol>\n<h4><a id=\"Restore_the_old_configuration_files_and_certificate\" name=\"Restore_the_old_configuration_files_and_certificate\" title=\"Restore the old configuration files and certificate\"></a>Restore the old configuration files and certificate</h4>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Copy the configuration files from the backup you made previously to the new <span class=\"nanospell-typo\">OPB</span> installation. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Copy the <span class=\"nanospell-typo\">cacerts</span> file from the backup you made previously to the new <span class=\"nanospell-typo\">OPB</span> installation. </li></ol>\n<h4><a id=\"Start_the_new_OPB\" name=\"Start_the_new_OPB\" title=\"Start the new OPB\"></a>Start the new <span class=\"nanospell-typo\">OPB</span></h4>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Start the <span class=\"nanospell-typo\">OPB</span> service. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Start the <span class=\"nanospell-typo\">OPB</span> agent in the integration administration UI (<strong>Administration</strong> &gt; <strong>Utilities</strong> &gt;<strong> Integration</strong>).</li></ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}