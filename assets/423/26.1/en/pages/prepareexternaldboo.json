{
  "title": "Prepare databases for OO (AKS)",
  "content": "<div class=\"mw-parser-output\">\n<ul style=\"padding-left: 0px;\"></ul>\n<p>To prepare the database for Operations Orchestration Containerized (OO Containerized), review the sizing considerations and identify the targeted tenant(s) that OO has to support. </p>\n<p>It's strongly recommended to use a dedicated database server for OO to ensure a smooth and fluent experience. </p>\n<p>However, if you connect OO to the same database that the suite uses, resize the database to be capable of supporting the added requirements of both the suite and OO.</p>\n<h2 id=\"Install_PostgreSQL\"><a id=\"Set_up_an_Azure_flexible_server\" name=\"Set_up_an_Azure_flexible_server\" title=\"Set up an Azure flexible server\"></a>Set up an Azure flexible server</h2>\n<p>To set up an Azure flexible server, follow these steps.</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Go to the <a href=\"https://portal.azure.com\" title=\"Azure portal\">Azure portal</a>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Search for <strong>Azure Database for PostgreSQL flexible servers</strong> and open it.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Create</strong>.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the creation page, enter the following information.\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Project details</strong>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><strong>Subscriptions</strong>: Enter your subscription ID. You can get it from the <strong>Azure portal Home page</strong> &gt; <strong>Subscriptions</strong>.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Resource group</strong>: Enter the name of the resource group created in the prerequisite tasks. For example, <strong>myResourceGroup</strong>.</li></ul>\n</li><li style=\"margin-left: 40px; position: relative;\"><strong>Server details</strong>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><strong>Server name</strong>: Enter a name for the flexible server. For example: <b>oopg</b>.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Region</strong>: Choose a region. Ideally, your database should be in the same region as your production environment.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Workload type:</strong> Select a workload type according to your needs.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Compute + storage</strong>: Click <strong>Configure server</strong>, then choose the compute size according to the targeted tenant amount (see <a href=\"/doc/423/26.1/akssizing\" title=\"Sizing considerations for Azure deployment\">Plan the deployment on AKS</a>). Click <strong>Save</strong>.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Availability Zone</strong>: No preference.</li></ul>\n</li><li style=\"margin-left: 40px; position: relative;\"><strong>High availability</strong>  \n\t\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\">Check <strong>Enable high availability</strong> as needed.</li></ul>\n</li><li style=\"margin-left: 40px; position: relative;\"><strong>PostgreSQL Version</strong>: Choose the PostgreSQL version. For details about supported PostgreSQL versions, see <a href=\"/doc/423/26.1/akssizing\" title=\"Sizing considerations for Azure deployment\">Plan the deployment on AKS</a>.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Administrator account</strong>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><strong>Admin username</strong>: Name your database administrator. </li><li style=\"margin-left: 52px; position: relative;\"><strong>Password</strong>: Set the password for the admin.</li><li style=\"margin-left: 52px; position: relative;\"><strong>Confirm password</strong>: Confirm the password.</li></ul>\n</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Next: Networking</strong>. Enter the following information.\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><strong>Connectivity method</strong>: Select <strong>Private access (Vnet Integration) </strong>&gt;<strong> Virtual network</strong>.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Subscription: </strong>Enter your subscription ID. You can get it from the <strong>Azure portal Home page</strong> &gt; <strong>Subscriptions</strong>.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Virtual network:</strong> Select the <strong>Vnet</strong> you created for OO.</li><li style=\"margin-left: 40px; position: relative;\"><strong>Subnet:</strong> Select a subnet different from the one you prepared for OO, or enter a nonexistent subnet name and let the system create it. Please be aware that this subnet must be independent and you can't share it with other objects.</li></ul>\n</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click <strong>Review + create</strong>.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Download the root CA. To do this, go to the <strong>Azure Database for PostgreSQL flexible server</strong> page &gt; <strong>Networking</strong> section, &gt; click <strong>Download SSL Certificate</strong>.<br/>\n\tYou will need to select the <b>Use SSL connection</b> option and add this certificate to the <strong>caCertificates </strong>section when you <a href=\"/doc/423/26.1/399-createconfigureyaml\" title=\"Create and configure values.yaml file\">Create and configure values.yaml (AKS)</a> during the OO installation.  </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Check and validate if the database is ready. You can either:\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">After installing the PostgreSQL client on the bastion, run the following command to check the database:\n\t\t<pre>psql \"host=&lt;fqdn of flexible server&gt; port=5432 dbname=postgres user=&lt;postgres_admin&gt; password=&lt;password for admin&gt; sslmode=verify-full sslrootcert=&lt;full path of the root CA certificate&gt;\"</pre>\n</li><li style=\"margin-left: 40px; position: relative;\">Or use <strong>pgAdmin</strong> and use the bastion as the SSH Tunnel. With <strong>pgAdmin4</strong> version 6.5 and later, you can do this by configuring the SSH Tunnel.</li></ul>\n\tIf you want to use a plain connection instead of TLS to the flexible server, you can go to Server parameters and use <strong>require_secure_transport</strong> to turn off the SSL force.</li></ol>\n<h2 id=\"Set_up_PostgreSQL_databases_for_CMS\"><a id=\"Set_up_PostgreSQL_databases_for_OO\" name=\"Set_up_PostgreSQL_databases_for_OO\" title=\"Set up PostgreSQL databases for OO\"></a>Set up PostgreSQL databases for OO</h2>\n<p>The databases must be empty so that OO will initialize them during installation. The table below shows example database information prepared for the following components.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Component</th>\n<th scope=\"col\">Database User</th>\n<th scope=\"col\">Database Name</th>\n<th scope=\"col\">Schema (default)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>OO Central</td>\n<td><code>oocentraldbuser</code></td>\n<td><code>oocentraldb</code></td>\n<td><code>oo_cen_core</code></td>\n</tr>\n<tr>\n<td>OO Session Manager</td>\n<td><code>oosessionmanagerdbuser</code></td>\n<td><code>oosessionmanagerdb</code></td>\n<td><code>public</code></td>\n</tr>\n<tr>\n<td>OO Controller</td>\n<td><code>oocontrollerdbuser</code></td>\n<td><code>oocontrollerdb</code></td>\n<td><code>public</code></td>\n</tr>\n<tr>\n<td>OO Scheduler</td>\n<td><code>ooscheduler</code></td>\n<td><code>ooschedulerdb</code></td>\n<td><code>oo_sch_core</code></td>\n</tr>\n<tr>\n<td>AutoPass</td>\n<td><code>aplsdbuser</code></td>\n<td><code>aplsdb</code></td>\n<td><code>public</code></td>\n</tr>\n</tbody>\n</table>\n<p>Below are sample SQL commands for creating a user and a database for a service for PostgreSQL database:</p>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Log in to the bastion host and then run the following command to connect to the PostgreSQL instance. Replace the placeholder values, such as &lt;<code>postgres admin</code>&gt; with the actual value.</p>\n<pre>psql \"host=&lt;fqdn of flexible server&gt; port=5432 dbname=postgres user=&lt;postgres admin&gt; password=&lt;password for admin&gt; sslmode=verify-full sslrootcert=&lt;full path of the root CA certificate&gt;\"</pre>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">\n<p>Run the following commands to create the databases and the users, by substituting the exemplified database names, database users and their respective passwords of each component with the desired values.</p>\n<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">\n<p><strong>OO Central:</strong></p>\n<pre><code>CREATE ROLE oocentraldbuser LOGIN ENCRYPTED PASSWORD 'oocentraldbuserPass' NOSUPERUSER INHERIT CREATEDB CREATEROLE;\nCREATE DATABASE oocentraldb WITH owner=oocentraldbuser;\nGRANT CREATE ON DATABASE oocentraldb TO oocentraldbuser;</code></pre>\n</li><li style=\"margin-left: 40px; position: relative;\">\n<p><strong>OO Session Manager:</strong></p>\n<pre><code>CREATE ROLE oosessionmanagerdbuser LOGIN ENCRYPTED PASSWORD 'oosessionmanagerdbuserPass';\nCREATE DATABASE oosessionmanagerdb WITH owner=oosessionmanagerdbuser;\nGRANT CREATE ON DATABASE oosessionmanagerdb TO oosessionmanagerdbuser;</code></pre>\n</li><li style=\"margin-left: 40px; position: relative;\">\n<p><strong>OO Controller:</strong></p>\n<pre><code>CREATE ROLE oocontrollerdbuser LOGIN ENCRYPTED PASSWORD 'oocontrollerdbuserPass';\nCREATE DATABASE oocontrollerdb WITH owner=oocontrollerdbuser;\nGRANT CREATE ON DATABASE oocontrollerdb TO oocontrollerdbuser;</code></pre>\n</li><li style=\"margin-left: 40px; position: relative;\">\n<p><strong>OO Scheduler:</strong></p>\n<pre><code>CREATE ROLE ooschedulerdbuser LOGIN ENCRYPTED PASSWORD 'ooschedulerPass';\nCREATE DATABASE ooschedulerdb WITH owner=ooschedulerdbuser;\nGRANT CREATE ON DATABASE ooschedulerdb TO ooschedulerdbuser;</code></pre>\n</li><li style=\"margin-left: 40px; position: relative;\">\n<p><strong>AutoPass:</strong></p>\n<pre><code>CREATE ROLE \"aplsdbuser\" LOGIN ENCRYPTED PASSWORD 'aplsdbuserPass' NOSUPERUSER INHERIT;\nGRANT \"aplsdbuser\" TO postgres;\nCREATE DATABASE \"aplsdb\"; \nALTER DATABASE \"aplsdb\" OWNER TO \"aplsdbuser\";\nGRANT ALL ON SCHEMA \"public\" TO \"aplsdbuser\";</code></pre>\n</li><li style=\"margin-left: 40px; position: relative;\">\n<p><strong>Grant CONNECT to all DB users to their respective databases:</strong></p>\n<pre><code>GRANT CONNECT ON DATABASE oocentraldb TO oocentraldbuser;\nGRANT CONNECT ON DATABASE oosessionmanagerdb TO oosessionmanagerdbuser;\nGRANT CONNECT ON DATABASE oocontrollerdb TO oocontrollerdbuser;\nGRANT CONNECT ON DATABASE ooschedulerdb TO ooscheduler;\nGRANT CONNECT ON DATABASE aplsdb TO aplsdbuser;</code></pre>\n</li></ul>\n</li></ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}