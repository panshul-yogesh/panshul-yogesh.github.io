{
  "title": "Prepare external databases (OpenShift)",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\">\n<p>You must use external databases for OPTIC Management Toolkit (OMT) and the suite in a production environment. For information about supported external databases, see <a href=\"/doc/423/26.1/supportmatrixonprem\" title=\"Support matrix for on-premises deployment\">Support matrix for on-premises deployment</a>. </p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">\n<p>This topic doesn't include instructions on how to Configure external PostgreSQL databases for OMT. This is because your deployment doesn't require OMT or you have already done so during the OMT installation. </p>\n</div>\n</div>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-tip-icon\"></div>\n<div class=\"admonition-content admonition-tip-content\">The following procedures include steps to configure the pg_hba.conf file for PostgreSQL. For more information about how to configure the parameters in this file (connection type, database name, user name, client IP address range, and authentication method), refer to your specific PostgreSQL documentation (for example, the <a href=\"https://www.postgresql.org/docs/14/auth-pg-hba-conf.html\" title=\"PostgreSQL 14 documentation\">PostgreSQL 14 documentation</a>). </div>\n</div>\n<h2>General requirements for PostgreSQL databases</h2>\n<p>To set up PostgreSQL databases, you must meet the following requirements:</p>\n<ul>\n<li>Configurations described in this section, including parameters per profile (see the <em>Prepare external PostgreSQL for the suite </em>section), <a href=\"/doc/423/26.1/supportmatrixonprem\" title=\"PostgreSQL version matrix\">PostgreSQL version matrix</a>, and PostgreSQL encoding (utf8), must be applied.</li>\n<li>You must be able to create a user with the <strong>create db</strong> role. Then, you can create databases with this newly created user.</li>\n<li>The database owner must be able to perform Create, Read, Update, and Delete operations on its own database objects (table, index, and so on).</li>\n<li>As the suite needs long and live connections with databases, the timeout of the PostgreSQL solution should be longer than the timeout setting of the heartbeat between the suite and the database. The database heartbeat is determined by the <strong>IDLE_CONNECTION_TEST_PERIOD</strong> parameter in the <strong>itom-xruntime-infra-config</strong> configmap.</li>\n<li>The PostgreSQL high availability environment needs to be accessed by a single IP or FQDN.</li>\n<li>Low network latency is required. We recommend a network latency lower than 0.5 ms.</li>\n<li>The <strong>pg_trgm</strong> module (included in the <strong>postgresql-contrib</strong> module) must be available on the PostgreSQL database server. This module is required by the \"contains\" search function when creating indexes to help improve system performance. You can check if it is available by running the SQL statement:<br/>\n<code>select * from pg_available_extensions where name='pg_trgm';</code></li>\n</ul>\n<h2>Install PostgreSQL</h2>\n<ol>\n<li>Install a supported version of PostgreSQL. </li>\n<li>On the database server, install the <strong>postgresql-contrib</strong> module that has the same version as the PostgreSQL server.</li>\n<li>Prepare a PostgreSQL admin user with \"Superuser\" role. In the steps below, it's referred to as \"&lt;postgres admin&gt;.\"</li>\n<li>If your database server uses SSL for connection, obtain the database CA certificate in PEM (Base64 encoded) format, which can have a file extension of .pem, .cer, or .crt. Later, you will need to specify this certificate when running the <code>install</code> script to install OMT and when configuring databases in the installation portal UI. </li>\n<li>(Optional if you are using PostgreSQL version 14) Configure PostgreSQL to use the <strong>scram-sha-256</strong> encryption algorithm. To do this, set the parameter in the <strong>postgresql.conf</strong> file:\n\t<pre><code>password_encryption=scram-sha-256</code></pre>\n<p>On the PostgreSQL server host, run the <strong>psql</strong> command to connect to your PostgreSQL instance, and then run the following SQL command to reload the PostgreSQL server configuration so that the change takes effect: </p>\n<pre><code>select pg_reload_conf();</code></pre>\n<p>Run the following SQL command to verify that the setting is <strong>scram-sha-256</strong>:</p>\n<pre><code>show password_encryption;</code></pre>\n<p>Now, you need to run the following SQL command to reset the DBA user password (the password can be either new or the same as before). This changes your current password to use the SCRAM-SHA-256 password encryption.</p>\n<pre><code>alter user &lt;DBA user&gt; with password 'xxxx';</code></pre>\n</li>\n<li>The default value of the <strong>listen_addresses</strong> parameter in the <strong>postgresql.conf</strong> file is \"localhost\", which means only localhost can connect to the PostgreSQL instance. You need to set <strong>listen_addresses = '*'</strong> to allow remote connections. </li>\n<li>In addition, we recommend that you turn off Just-in-Time Compilation (JIT) for better performance. To do this, check if the line <strong>jit=off</strong> is in the <strong>postgresql.conf</strong> file. If not, add it to the file. </li>\n<li>(Optional) To enforce TLSv1.3 on the PostgreSQL server side, set the <a href=\"https://postgresqlco.nf/doc/en/param/ssl_min_protocol_version/\" title=\"ssl_min_protocol_version\"><strong>ssl_min_protocol_version</strong></a> and <strong><a href=\"https://postgresqlco.nf/doc/en/param/ssl_max_protocol_version/\" title=\"ssl_max_protocol_version\">ssl_max_protocol_version</a> </strong>parameters to <strong>TLSv1.3</strong>.  <br/>\n\tYou can set <strong>ssl_min_protocol_version=TLSv1.3</strong> and <strong>ssl_max_protocol_version=TLSv1.3 </strong>in the <code>postgresql.conf</code> file, then run the <code>select pg_reload_conf()</code> SQL statement to apply the change without restarting the PostgreSQL database server. <br/>\n\tOn the PostgreSQL database server, you also need to make sure the OpenSSL version is 1.1.1 or greater, which supports TLSv1.3.</li>\n<li>Restart PostgreSQL. </li>\n</ol>\n<div class=\"transcontent stn-end--cdf\"> </div>\n<h2 id=\"Prepare_external_PostgreSQL_for_SMA\">Prepare external PostgreSQL for the suite</h2>\n<p>The following table lists the suite components that require database configuration during the suite installation. The suite supports PostgreSQL databases with or without TLS enabled.</p>\n<table>\n<tbody>\n<tr>\n<th>Component</th>\n<th>Notes</th>\n</tr>\n<tr>\n<td>\n<ul>\n<li>Suite Administration</li>\n<li>Service Management and Smart Analytics</li>\n<li>IdM</li>\n<li>Autopass</li>\n</ul>\n</td>\n<td>Mandatory</td>\n</tr>\n<tr>\n<td>\n<ul>\n<li>DND</li>\n</ul>\n</td>\n<td>Optional</td>\n</tr>\n<tr>\n<td>\n<ul>\n<li>CMP FinOps</li>\n</ul>\n</td>\n<td>Optional</td>\n</tr>\n<tr>\n<td>\n<ul>\n<li>SAM</li>\n</ul>\n</td>\n<td>Optional</td>\n</tr>\n</tbody>\n</table>\n<p>You can use a separate PostgreSQL instance for each component. The following steps assume that you are using one PostgreSQL instance for all components:</p>\n<ol>\n<li>Make sure your PostgreSQL instance doesn't contain databases that have duplicate names of the suite databases.<br/>\n\tDuring the suite installation, you will need to specify a database administrator (DBA) user for each component, and the suite installer will automatically create the required databases and database owner for each component by using the DBA account that you specify. See the following table for the names of the automatically created databases and users. If these databases or users already exist, you need to delete them first; otherwise, your suite database configuration will fail when you run the suite installer.\n\t<table>\n<tbody>\n<tr>\n<th>Component</th>\n<th>User name</th>\n<th>Databases</th>\n</tr>\n<tr>\n<td>Service Management</td>\n<td>maas_admin</td>\n<td>maas_admin, maas_template, xservices_ems, xservices_mng, xservices_rms, xie, scheduler, and carbon</td>\n</tr>\n<tr>\n<td>Suite Administration</td>\n<td>bo_db_user</td>\n<td>bo_ats, bo_user, bo_config, and bo_license</td>\n</tr>\n<tr>\n<td>Smart Analytics</td>\n<td>smarta</td>\n<td>smartadb</td>\n</tr>\n<tr>\n<td>IdM</td>\n<td>idm</td>\n<td>idm</td>\n</tr>\n<tr>\n<td>Autopass</td>\n<td>autopass</td>\n<td>autopassdb</td>\n</tr>\n<tr>\n<td>Design and Deploy (DND)</td>\n<td>hcm_admin</td>\n<td>dnd</td>\n</tr>\n<tr>\n<td>Cloud Management Platform (CMP) FinOps</td>\n<td>cgro</td>\n<td>cgro</td>\n</tr>\n<tr>\n<td>Software Asset Management (SAM)</td>\n<td>sam</td>\n<td>sam</td>\n</tr>\n</tbody>\n</table>\n\tIn a later step, you will need to update the pg_hba.conf file to allow these automatically created database owners to connect to their corresponding databases.</li>\n<li>Configure the postgresql.conf file.<br/>\n\tIn the postgresql.conf file, configure the following parameters depending on your suite deployment size (Small, Medium, or Large).\n\t<p>The following table provides example database settings for your reference. If you'll use the same database server for Operations Orchestration (OO) Containerized, you need to increase the max_connections values according to the <a href=\"/doc/423/26.1/sizingforsmadndcgro\" title=\"sizing guide\">sizing guide</a>.</p>\n<table>\n<tbody>\n<tr>\n<th>Parameter</th>\n<th>Small</th>\n<th>Medium</th>\n<th>Large</th>\n</tr>\n<tr>\n<td>effective_cache_size</td>\n<td>RAM * 0.65</td>\n<td>RAM * 0.70</td>\n<td>RAM * 0.75</td>\n</tr>\n<tr>\n<td>maintenance_work_mem</td>\n<td>1 GB</td>\n<td>2 GB</td>\n<td>4 GB</td>\n</tr>\n<tr>\n<td>max_connections</td>\n<td>2000</td>\n<td>2000</td>\n<td>3000</td>\n</tr>\n<tr>\n<td>shared_buffers</td>\n<td>8 GB</td>\n<td>16 GB</td>\n<td>24 GB</td>\n</tr>\n<tr>\n<td>work_mem</td>\n<td>8 MB</td>\n<td>16 MB</td>\n<td>16 MB</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>Configure encoding and locale. Make sure that the PostgreSQL instance uses the following encoding and locale settings:<br/>\n\tEncoding: UTF8<br/>\n\tLC_COLLATE: en_US.UTF-8<br/>\n\tLC_CTYPE: en_US.UTF-8</li>\n<li>Add the following lines to the pg_hba.conf file:\n\t<pre>host bo_ats bo_db_user 172.0.0.0/24 scram-sha-256\nhost bo_user bo_db_user 172.0.0.0/24 scram-sha-256\nhost bo_config bo_db_user 172.0.0.0/24 scram-sha-256\nhost bo_license bo_db_user 172.0.0.0/24 scram-sha-256\nhost smartadb smarta 172.0.0.0/24 scram-sha-256\nhost xservices_ems maas_admin 172.0.0.0/24 scram-sha-256\nhost xservices_mng maas_admin 172.0.0.0/24 scram-sha-256\nhost xservices_rms maas_admin 172.0.0.0/24 scram-sha-256\nhost xie maas_admin 172.0.0.0/24 scram-sha-256\nhost scheduler maas_admin 172.0.0.0/24 scram-sha-256\nhost carbon maas_admin 172.0.0.0/24 scram-sha-256\nhost maas_admin maas_admin 172.0.0.0/24 scram-sha-256\nhost maas_template maas_admin 172.0.0.0/24 scram-sha-256\nhost idm idm 172.0.0.0/24 scram-sha-256\nhost autopassdb autopass 172.0.0.0/24 scram-sha-256\nhost bo_ats &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost bo_user &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost bo_config &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost bo_license &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost smartadb &lt;dba_user&gt;  172.0.0.0/24 scram-sha-256\nhost xservices_ems &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost xservices_mng &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost xservices_rms &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost xie &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost scheduler &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost carbon &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost maas_admin &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost maas_template &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost idm &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost autopassdb &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\nhost postgres &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\n</pre>\n<p>Where:</p>\n\tFor example, if you use <b>postgres</b> as the DBA user, add the following lines (replace 172.0.0.0/24 with your own value):\n\n\t<pre>host bo_ats bo_db_user 172.0.0.0/24 scram-sha-256\nhost bo_user bo_db_user 172.0.0.0/24 scram-sha-256\nhost bo_config bo_db_user 172.0.0.0/24 scram-sha-256\nhost bo_license bo_db_user 172.0.0.0/24 scram-sha-256\nhost smartadb smarta 172.0.0.0/24 scram-sha-256\nhost xservices_ems maas_admin 172.0.0.0/24 scram-sha-256\nhost xservices_mng maas_admin 172.0.0.0/24 scram-sha-256\nhost xservices_rms maas_admin 172.0.0.0/24 scram-sha-256\nhost xie maas_admin 172.0.0.0/24 scram-sha-256\nhost scheduler maas_admin 172.0.0.0/24 scram-sha-256\nhost carbon maas_admin 172.0.0.0/24 scram-sha-256\nhost maas_admin maas_admin 172.0.0.0/24 scram-sha-256\nhost maas_template maas_admin 172.0.0.0/24 scram-sha-256\nhost idm idm 172.0.0.0/24 scram-sha-256\nhost autopassdb autopass 172.0.0.0/24 scram-sha-256\nhost bo_ats postgres 172.0.0.0/24 scram-sha-256\nhost bo_user postgres 172.0.0.0/24 scram-sha-256\nhost bo_config postgres 172.0.0.0/24 scram-sha-256\nhost bo_license postgres 172.0.0.0/24 scram-sha-256\nhost smartadb postgres  172.0.0.0/24 scram-sha-256\nhost xservices_ems postgres 172.0.0.0/24 scram-sha-256\nhost xservices_mng postgres 172.0.0.0/24 scram-sha-256\nhost xservices_rms postgres 172.0.0.0/24 scram-sha-256\nhost xie postgres 172.0.0.0/24 scram-sha-256\nhost scheduler postgres 172.0.0.0/24 scram-sha-256\nhost carbon postgres 172.0.0.0/24 scram-sha-256\nhost maas_admin postgres 172.0.0.0/24 scram-sha-256\nhost maas_template postgres 172.0.0.0/24 scram-sha-256\nhost idm postgres 172.0.0.0/24 scram-sha-256\nhost autopassdb postgres 172.0.0.0/24 scram-sha-256\nhost postgres postgres 172.0.0.0/24 scram-sha-256\n</pre>\n<ul>\n<li>You can use “hostssl” instead of \"host\" if your PostgreSQL database server has SSL enabled, but this is optional for the suite installation. For information about the difference between “host” and “hostssl”, see the <a href=\"https://www.postgresql.org/docs/11/auth-pg-hba-conf.html\" title=\"PostgreSQL documentation\">PostgreSQL documentation</a>. In order for the suite to connect to PostgreSQL through SSL, you only need to enable the TLS option and import your PostgreSQL CA certificate into the suite from the installation portal UI in a later step when configuring database connection settings for the suite.</li>\n<li>&lt;dba_user&gt;: replace it with the DBA user name of the PostgreSQL server. You will specify this user later on the installation portal UI. </li>\n<li>172.0.0.0/24: this is an example value used in this step and some of the next steps. You need to replace this example value with the IPv4 address range of the cluster nodes or a single cluster node's hostname. </li>\n</ul>\n</li>\n<li>Add the following line to the pg_hba.conf file to allow the maas_admin user to access the default <b>postgres</b> database:\n\t<pre>host postgres maas_admin 172.0.0.0/24 scram-sha-256 </pre>\n\tThis configuration is needed because before creating the component databases, the suite installer will check if they already exist, and will skip the database creation if they already exist. To check the existence of the databases, the suite installer will use the mass_admin user to connect to the default <b>postgres</b> database.</li>\n<li>If you want to deploy the DND capability, add the following lines to the pg_hba.conf file:\n\t<pre>host dnd hcm_admin 172.0.0.0/24 scram-sha-256\nhost postgres hcm_admin 172.0.0.0/24 scram-sha-256\nhost dnd &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\n</pre>\n</li>\n<li>If you want to deploy the SAM capability, add the following lines to the <strong>pg_hba.conf</strong> file:\n\t<pre>host sam sam 172.0.0.0/24 scram-sha-256\nhost sam &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256\n</pre>\n</li>\n<li>If you want to deploy the CMP FinOps capability, add the following lines to the <strong>pg_hba.conf</strong> file:\n\t<pre>host cgro cgro 172.0.0.0/24 scram-sha-256\nhost cgro &lt;dba_user&gt; 172.0.0.0/24 scram-sha-256</pre>\n</li>\n<li>Run the following commands on the PostgreSQL host to check the <b>DefaultTasksMax</b> value:\n\t<pre>systemctl show --property DefaultTasksMax\nsystemctl status &lt;postgresql.service name&gt; | grep Task\n</pre>\n<p>Where: &lt;postgresql.service name&gt; refers to the PostgreSQL service name in your environment, which may vary from one PostgreSQL installation to another (an example of the service name is <b>postgresql.service</b>). If the <b>DefaultTasksMax</b> value is too small (for example, the <b>DefaultTasksMax</b> property has a default value of 512 on SUSE), your connection to the PostgreSQL database may fail with the following error: <code>could not fork new process for connection: Resource temporarily unavailable</code>. To prevent this issue from occurring, you need to add the following line to the /usr/lib/systemd/system/&lt;postgresql.service name&gt; file:</p>\n<pre>TasksMax=1000000</pre>\n<p><b>Note</b>: Normally this step isn't needed if PostgreSQL is running on RHEL, CentOS, or Oracle Linux.</p>\n</li>\n<li>Restart PostgreSQL. </li>\n</ol>\n<h2>Install and configure Vertica for CMP FinOps</h2>\n<p>To use CMP FinOps, in addition to the PostgreSQL configuration described above, you still need to install and configure a Vertica database. For details, see <a _ngcontent-c23=\"\" href=\"/doc/423/26.1/installconfigureverticadb\" title=\"Install and configure Vertica database\">Install and configure Vertica database</a>.</p>\n<ul>\n</ul>\n</div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}