{
  "title": "Prepare persistent volumes for ESM on GCP",
  "content": "<div class=\"mw-parser-output\"><br/><p>To install the application in the Helm mode, you must create PVs. You can create PVs either using static volume provisioning or dynamic volume provisioning. To learn more about the two methods, see <a href=\"/doc/423/26.1/install#Dynamic_vs_static_volume_provisioning\" title=\"Dynamic vs. static volume provisioning\">Dynamic vs. static volume provisioning</a>. </p>\n<p lang=\"EN-US\" xml:lang=\"EN-US\">As you should already choose one of the following methods: </p>\n<ul role=\"list\">\n<li data-aria-level=\"2\" data-aria-posinset=\"1\" role=\"listitem\">\n<p lang=\"EN-US\" xml:lang=\"EN-US\">Option 1:  Cloud  Filestore static provision and Peristent Disk dynamic provision </p>\n</li>\n<li data-aria-level=\"2\" data-aria-posinset=\"2\" role=\"listitem\">\n<p lang=\"EN-US\" xml:lang=\"EN-US\">Option 2:  Cloud  Filestore dynamic provision and Peristent Disk dynamic provision </p>\n</li>\n</ul>\n<p lang=\"EN-US\" xml:lang=\"EN-US\">You need choose the steps according to your option.<strong> </strong></p>\n<h2 lang=\"EN-US\" xml:lang=\"EN-US\"><strong>Prerequisite</strong></h2>\n<p lang=\"EN-US\" xml:lang=\"EN-US\">Make you have the Filestore CSI driver deployed to your GKE cluster. For details, see <a href=\"https://cloud.google.com/filestore/docs/csi-driver#existing\" title=\"Enable the Filestore CSI driver on an existing cluster\">Enable the Filestore CSI driver on an existing cluster</a>. This is required for both option 1 and option 2.</p>\n<h2>Create PVs using static volume provisioning</h2>\n<p>Only applied to option 1.</p>\n<p>To create PVs for the suite using static volume provisioning, run the <strong>createPV.sh </strong>script. The following examples show how to use the <strong>createPv.sh</strong> script:</p>\n<div>Example for File Storage:</div>\n<pre> ./createPV.sh -n itsma -gcp -s 10.xx.97.2 -p smax/var/vols/itom/itsma --location us-west2/esm-verify/smax  -u 1999 -g 1999  --size small\n</pre>\n<h2>Create PVs using dynamic volume provisioning</h2>\n<p>To create PVs for the suite using dynamic provisioning, add the StorageClass name defined in your PVC to your <strong>my-values.yaml</strong> file (for CLI installation) or specify using the YAML Editor (for AppHub installation). A StorageClass defines how persistent volumes belonging to the class will be provisioned dynamically. PVC uses this StorageClass to create PVs required for the suite. Create the StorageClass in one of the following ways based on your deployment: </p>\n<h4>Persistent Disks</h4>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Storage administrator</td>\n<td>Bastion node</td>\n</tr>\n</tbody>\n</table>\n<p>Applied to both option 1 and option 2. Complete the following steps to use Persistent Disk to store the search engine and RabbitMQ data.</p>\n<ol>\n<li>Copy the contents of the script below and save it as <strong>gcp-disk-sc.yaml</strong>:\n\n\t<pre>allowVolumeExpansion: true\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: <code>&lt;disk_storageclass&gt;</code>\nparameters:\n  type: pd-ssd\nprovisioner: pd.csi.storage.gke.io\nreclaimPolicy: Retain\nvolumeBindingMode: Immediate\n</pre>\n<p>Where <code>&lt;disk_storageclass&gt;</code> is the StorageClass name you want to define. For example, <strong>pd-premium-sc</strong>.</p>\n<p>Use the value for <code>&lt;disk_storageclass&gt;</code>  as the StorageClass name in your <strong>my-values.yaml</strong> file. For example:</p>\n<pre tabindex=\"0\"><code data-lang=\"fallback\">persistence:\n    # When pvcCreate is set to true, the composition chart is expected to create PVCs(data-volume,config-volume and logging-volume) automatically.\n    # When pvcCreate is set to false, existing PVCs are utilized.\n    pvcCreate: true\n    # Used to inject storageClasses into PVC creation.\n    # Users can change any or all of these to match the actual storage classes used in their environment.\n    storageClasses:\n      default-rwx: itom-standard\n      default-rwo: &lt;disk_storageclass&gt;</code></pre>\n</li>\n<li>\n<p>Run the following command on the bastion node to create a StorageClass for the Azure Disks:</p>\n<pre>kubectl create -f gcp-disk-sc.yaml</pre>\n</li>\n</ol>\n<h4 class=\"mw-headline\">Cloud  Filestore</h4>\n<p>This is only applied to option 2. You need to create a StorageClass to use Cloud Filestore to store the generic data (data, log files, config files).</p>\n<ol>\n<li>\n<p>Copy the script's contents below and save it as <strong>gcp-filestore-sc.yaml</strong><strong> </strong>file.</p>\n<pre tabindex=\"0\">allowVolumeExpansion: true\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: <code>&lt;filestore_storageclass&gt;</code>\nparameters:\n  labels: app=esm\n  multishare: \"true\"\n  network: &lt;cluster network&gt;\n  tier: enterprise\nprovisioner: filestore.csi.storage.gke.io\nreclaimPolicy: Retain\nvolumeBindingMode: Immediate</pre>\n<p>The following table lists the parameters in the YAML file:<br/>\n<br/>\n\tWhere <code>&lt;filestore_storageclass&gt;</code> is the StorageClass name you want to define. For example: <strong>filestore-sc</strong>.<br/>\n\tWhere &lt;cluster network&gt; is the VPC network name of your gke cluster.</p>\n</li>\n<li>Run the following command on the bastion node to create a StorageClass for Cloud Filestore. Use the <strong>gcp-filestore-sc.</strong><strong>yaml </strong>file you created in Step 1.\n\t<pre>kubectl create -f  gcp-filestore-sc.yaml</pre>\n<p>Use the value for <code>&lt;filestore_storageclass&gt;</code>  as the StorageClass name in your <strong>my-values.yaml</strong> file. For example:</p>\n<pre>persistence:\n    # When pvcCreate is set to true, the composition chart is expected to create PVCs(data-volume,config-volume and logging-volume) automatically.\n    # When pvcCreate is set to false, existing PVCs are utilized.\n    pvcCreate: true\n    # Used to inject storageClasses into PVC creation.\n    # Users can change any or all of these to match the actual storage classes used in their environment.\n    storageClasses:\n      default-rwx: &lt;<code>filestore_storageclass</code>&gt;\n      default-rwo: &lt;disk_storageclass&gt;</pre>\n<p>Where <code>&lt;disk_storageclass&gt;</code> is the StorageClass name you mentioned for Persistent Disk in Step 1.</p>\n</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}