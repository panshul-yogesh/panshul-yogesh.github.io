{
  "title": "Reconfigure database",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>After the containerized UD/UCMDB is installed, if you need to change the external database host of your system, follow the instructions in this topic.</p>\n<h2>Back up configuration files</h2>\n<ol>\n<li>Back up<strong> cms-secret</strong> and <strong>cms-probe-secret</strong> (if available).\n\n\t<p>Run the following command:</p>\n<pre>kubectl get secret cms-secret -o yaml -n &lt;UD/UCMDB NAMESPACE&gt; &gt; cms-secret_backup_yyyy-mm-dd.yaml\nkubectl get secret cms-probe-secret -o yaml -n &lt;UD/UCMDB NAMESPACE&gt; &gt; cms-probe-secret_backup_yyyy-mm-dd.yaml\n</pre>\n<p>For example,</p>\n<pre>kubectl get secret cms-secret -o yaml -n ucmdb-prod &gt; secret_backup.yaml \nkubectl get secret cms-probe1-secret -o yaml -n ucmdb-prod &gt; probe1-secret_backup.yaml </pre>\n</li>\n<li>Make sure that the previous database is functioning before the switching is succeeded.</li>\n<li>Back up all the configuration files that you are using. For example, <strong>my-values.yaml</strong> file, <strong>my-values-probe.yaml</strong>, <strong>probe1-values.yaml</strong>, and <strong>probe2-values.yaml </strong>files.<br/>\n\tIf you don't remember the path of your custom <strong>my-values.yaml</strong> file, run the following command to create a copy of that file in the current directory:\n\t<pre><code>helm get values &lt;UD/UCMDB RELEASE NAME&gt; -n &lt;UD/UCMDB NAMESPACE&gt; &gt; my-values.yaml</code></pre>\n</li>\n</ol>\n<h2>Switch to an empty database</h2>\n<p>If you want to switch to a new, empty database without UCMDB data, follow these steps:</p>\n<ol>\n<li>Prepare the new database.<br/>\n\tThe databases must be empty so that UD/UCMDB will initialize them during installation. The following table shows example database information prepared for the UD/UCMDB components.\n\t<table>\n<thead>\n<tr>\n<th scope=\"col\">Service</th>\n<th scope=\"col\">DB User</th>\n<th scope=\"col\">DB Name</th>\n<th scope=\"col\">Schema</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>UCMDB Server</td>\n<td>ucmdb</td>\n<td>ucmdb_db</td>\n<td>ucmdb_schema</td>\n</tr>\n<tr>\n<td>IdM</td>\n<td>ucmdb_idm</td>\n<td>ucmdb_idm_db</td>\n<td>ucmdb_idm_schema</td>\n</tr>\n<tr>\n<td>APLS</td>\n<td>ucmdb_autopass</td>\n<td>ucmdb_autopass_db</td>\n<td>ucmdb_autopass_schema</td>\n</tr>\n<tr>\n<td>Data Flow Probe (PostgreSQL only)</td>\n<td>ucmdb_probe</td>\n<td>ucmdb_probe_db</td>\n<td>ucmdb_probe_schema</td>\n</tr>\n</tbody>\n</table>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">Make sure that the passwords are the same as the ones for the previous database.</div>\n</div>\n</li>\n<li>Change the database settings accordingly (for example, <strong>global.database.host</strong>) in your custom <strong>my-values.yaml</strong>.\n\t<table>\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Default</th>\n<th scope=\"col\">Example</th>\n</tr>\n<tr>\n<td>global.database.host</td>\n<td>Database server host name</td>\n<td></td>\n<td>db.example.com</td>\n</tr>\n<tr>\n<td>global.database.port</td>\n<td>Database server port</td>\n<td></td>\n<td>5432</td>\n</tr>\n<tr>\n<td>ucmdbserver.deployment.database.user</td>\n<td>UCMDB database user</td>\n<td>ucmdb</td>\n<td>ucmdb</td>\n</tr>\n<tr>\n<td>ucmdbserver.deployment.database.dbName</td>\n<td>UCMDB database name</td>\n<td>ucmdb</td>\n<td>ucmdb_db</td>\n</tr>\n<tr>\n<td>ucmdbserver.deployment.database.schema</td>\n<td>UCMDB database schema</td>\n<td>ucmdb</td>\n<td>ucmdb_schema</td>\n</tr>\n<tr>\n<td>autopass.deployment.database.user</td>\n<td>AutoPass database user</td>\n<td>autopass</td>\n<td>ucmdb_autopass</td>\n</tr>\n<tr>\n<td>autopass.deployment.database.dbName</td>\n<td>AutoPass database name</td>\n<td>autopass</td>\n<td>ucmdb_autopass_db</td>\n</tr>\n<tr>\n<td>autopass.deployment.database.schema</td>\n<td>AutoPass database schema</td>\n<td>public</td>\n<td>ucmdb_autopass_schema</td>\n</tr>\n<tr>\n<td>idm.deployment.database.user</td>\n<td>IdM database user</td>\n<td>idm</td>\n<td>ucmdb_idm</td>\n</tr>\n<tr>\n<td>idm.deployment.database.dbName</td>\n<td>IdM database name</td>\n<td>idm</td>\n<td>ucmdb_idm_db</td>\n</tr>\n<tr>\n<td>idm.deployment.database.schema</td>\n<td>IdM database schema</td>\n<td>public</td>\n<td>ucmdb_idm_schema</td>\n</tr>\n<tr>\n<td>ucmdbprobe.deployment.database.user</td>\n<td>Data Flow Probe database user. Required when <strong>probeEmbeddedDb</strong> is <strong>false</strong>.</td>\n<td>probe</td>\n<td>ucmdb_probe</td>\n</tr>\n<tr>\n<td>ucmdbprobe.deployment.database.dbName</td>\n<td>Data Flow Probe database name. Required when <strong>probeEmbeddedDb</strong> is <strong>false</strong>.</td>\n<td>dataflowprobe</td>\n<td>ucmdb_probe_db</td>\n</tr>\n<tr>\n<td>ucmdbprobe.deployment.database.schema</td>\n<td>Data Flow Probe database schema. Required when <strong>probeEmbeddedDb</strong> is <strong>false</strong>.</td>\n<td>probe</td>\n<td>ucmdb_probe_schema</td>\n</tr>\n</thead>\n</table>\n</li>\n<li>Run the following command to upgrade UD/UCMDB: \n\t<pre>helm upgrade &lt;<em>UD/UCMDB RELEASE NAME</em>&gt; &lt;<em>UD/UCMDB CHART FILE</em>&gt; -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt; -f &lt;<em>VALUES YAML FILE</em>&gt;</pre>\n<p>For example:</p>\n<pre>helm upgrade ucmdb-prod UCMDB_Helm_Chart-2x.x/ucmdb-helm-charts/charts/ucmdb-1.xx.x-xxx+2x.x.x.tgz --namespace ucmdb-prod -f my-values.yaml</pre>\n</li>\n</ol>\n<h2>Switch to a database with UCMDB data</h2>\n<p>If you want to switch to a database that already contains UCDMB data, follow these steps:</p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">You can only switch to the database connected to a UCMDB server in the same version as your current UD/UCMDB deployment.</div>\n</div>\n<ol>\n<li>(Optional) If the passwords of the new database are different from the passwords of the previous database, run the following commands to update the passwords in <strong>cms-secret</strong>.\n\n\t<ul>\n<li>\n<p>For standalone UD/UCMDB:</p>\n<pre>kubectl patch secret cms-secret -p '{\"data\":{\"ucmdb_server_db_password\":\"'$(echo -n '&lt;new UCMDB password&gt;'|base64 -w0)'\",\"autopass_db_password\":\"'$(echo -n '&lt;new Autopass password&gt;'|base64 -w0)'\",\"idm_db_password\":\"'$(echo -n '&lt;new IdM password&gt;'|base64 -w0)'\",\"ucmdb_probe_pg_probe_password\":\"'$(echo -n '&lt;new probe password&gt;'|base64 -w0)'\"}}' -n &lt;namespace&gt;\n</pre>\n</li>\n<li>\n<p>For UD/UCMDB as the next deployment of Service Management:</p>\n<pre>kubectl patch secret cms-secret -p '{\"data\":{\"ucmdb_server_db_password\":\"'$(echo -n '&lt;new UCMDB password&gt;'|base64 -w0)'\",\"autopass_db_password\":\"'$(echo -n '&lt;new Autopass password&gt;'|base64 -w0)'\",\"ucmdb_probe_pg_probe_password\":\"'$(echo -n '&lt;new probe password&gt;'|base64 -w0)'\"}}' -n &lt;namespace&gt;\n</pre>\n</li>\n</ul>\n</li>\n<li>In your custom <strong>my-values.yaml</strong>, change the database parameters (for example, <strong>global.database.host</strong>) <strong> </strong>according to the configuration of the new database that you want to switch to. \n\t<table>\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Default</th>\n<th scope=\"col\">Example</th>\n</tr>\n<tr>\n<td>global.database.host</td>\n<td>Database server host name</td>\n<td></td>\n<td>db.example.com</td>\n</tr>\n<tr>\n<td>global.database.port</td>\n<td>Database server port</td>\n<td></td>\n<td>5432</td>\n</tr>\n<tr>\n<td>ucmdbserver.deployment.database.user</td>\n<td>UCMDB database user</td>\n<td>ucmdb</td>\n<td>ucmdb</td>\n</tr>\n<tr>\n<td>ucmdbserver.deployment.database.dbName</td>\n<td>UCMDB database name</td>\n<td>ucmdb</td>\n<td>ucmdb_db</td>\n</tr>\n<tr>\n<td>ucmdbserver.deployment.database.schema</td>\n<td>UCMDB database schema</td>\n<td>ucmdb</td>\n<td>ucmdb_schema</td>\n</tr>\n<tr>\n<td>autopass.deployment.database.user</td>\n<td>AutoPass database user</td>\n<td>autopass</td>\n<td>ucmdb_autopass</td>\n</tr>\n<tr>\n<td>autopass.deployment.database.dbName</td>\n<td>AutoPass database name</td>\n<td>autopass</td>\n<td>ucmdb_autopass_db</td>\n</tr>\n<tr>\n<td>autopass.deployment.database.schema</td>\n<td>AutoPass database schema</td>\n<td>public</td>\n<td>ucmdb_autopass_schema</td>\n</tr>\n<tr>\n<td>idm.deployment.database.user</td>\n<td>IdM database user</td>\n<td>idm</td>\n<td>ucmdb_idm</td>\n</tr>\n<tr>\n<td>idm.deployment.database.dbName</td>\n<td>IdM database name</td>\n<td>idm</td>\n<td>ucmdb_idm_db</td>\n</tr>\n<tr>\n<td>idm.deployment.database.schema</td>\n<td>IdM database schema</td>\n<td>public</td>\n<td>ucmdb_idm_schema</td>\n</tr>\n<tr>\n<td>ucmdbprobe.deployment.database.user</td>\n<td>Data Flow Probe database user. Required when <strong>probeEmbeddedDb</strong> is <strong>false</strong>.</td>\n<td>probe</td>\n<td>ucmdb_probe</td>\n</tr>\n<tr>\n<td>ucmdbprobe.deployment.database.dbName</td>\n<td>Data Flow Probe database name. Required when <strong>probeEmbeddedDb</strong> is <strong>false</strong>.</td>\n<td>dataflowprobe</td>\n<td>ucmdb_probe_db</td>\n</tr>\n<tr>\n<td>ucmdbprobe.deployment.database.schema</td>\n<td>Data Flow Probe database schema. Required when <strong>probeEmbeddedDb</strong> is <strong>false</strong>.</td>\n<td>probe</td>\n<td>ucmdb_probe_schema</td>\n</tr>\n</thead>\n</table>\n</li>\n<li>Run the following command to upgrade UD/UCMDB for your current UD/UCMDB deployment: \n\t<pre>helm upgrade &lt;<em>UD/UCMDB RELEASE NAME</em>&gt; &lt;<em>UD/UCMDB CHART FILE</em>&gt; -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt; -f &lt;<em>VALUES YAML FILE</em>&gt; -f &lt;SECRETS YAML FILE&gt;</pre>\n<p>For example:</p>\n<pre>helm upgrade ucmdb-prod UCMDB_Helm_Chart-2x.x/ucmdb-helm-charts/charts/ucmdb-1.xx.x-xxx+2x.x.x.tgz --namespace ucmdb-prod -f my-values.yaml</pre>\n</li>\n</ol>\n<h2>Roll back to use the previous database</h2>\n<ol>\n<li>Run the following command to get the ID of the revision using the previous database. \n\t<pre>helm history &lt;<em>UD/UCMDB RELEASE NAME</em>&gt; -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt;</pre>\n</li>\n<li>Run the following command to roll back to the required revision. \n\t<pre>helm rollback &lt;<em>UD/UCMDB RELEASE NAME</em>&gt; <em>&lt;REVISION ID&gt;</em> -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt;</pre>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}