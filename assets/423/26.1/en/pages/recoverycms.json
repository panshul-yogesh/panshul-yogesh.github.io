{
  "title": "Restore containerized UD/UCMDB deployment",
  "content": "<div class=\"mw-parser-output\">\n<div class=\"transcontent stn-begin--RestoreCms\"> </div>\n<h2>Scenario 1 - the containerized UD/UCMDB deployment is still functioning but data are missing or corrupted</h2>\n<ol>\n<li>\n<p>Stop the UD/UCMDB deployment.</p>\n<p>On the control plane node (or bastion node), run the following command:</p>\n<pre>/opt/cdf/scripts/cdfctl.sh runlevel set -l DOWN -n &lt;namespace-of-CMS-deployment&gt;</pre>\n<p>Wait for a few minutes until the UD/UCMDB deployment fully stopped.</p>\n</li>\n<li>\n<p>Restore UD/UCMDB databases, including UCMDB database, IdM database, and Autopass database.</p>\n</li>\n<li>\n<p>Restore the following data in NFS volumes:</p>\n<table>\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Component</p>\n</th>\n<th scope=\"col\">\n<p>NFS volume name</p>\n</th>\n<th scope=\"col\">\n<p>Directory</p>\n</th>\n<th scope=\"col\">\n<p>Description</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>UCMDB Gateway</p>\n</td>\n<td>\n<p>ucmdb-data-volume</p>\n</td>\n<td>\n<p>&lt;ucmdb-data-volume&gt;/cms-gateway</p>\n</td>\n<td>\n<p>Data generated by the UCMDB Gateway</p>\n</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p>Start the UD/UCMDB deployment.</p>\n<p>On the control plane node (or bastion node), run the following command:</p>\n<pre>/opt/cdf/scripts/cdfctl.sh runlevel set -l UP -n &lt;namespace-of-CMS-deployment&gt;</pre>\n</li>\n</ol>\n<h2 class=\"mw-headline\" id=\"Disaster_Recovery_Process\">Scenario 2 - the containerized UD/UCMDB deployment is corrupted or failing</h2>\n<p>Make sure you always perform troubleshooting by following instructions in <a href=\"/doc/423/26.1/troubleshootcms\">Troubleshoot UD/UCMDB</a>.</p>\n<p>If this still cannot resolve the issue, follow the instructions below to restore the containerized UD/UCMDB deployment. </p>\n<ol>\n<li>\n<p>Uninstall UD/UCMDB.</p>\n<p>To uninstall UD/UCMDB, do the following: </p>\n<ol>\n<li>Delete the UD/UCMDB deployment</li>\n<li>Remove persistent volumes</li>\n<li>Clean the NFS volumes</li>\n</ol>\n<p>For details, see <a href=\"/doc/423/26.1/cmswithsmaxuninstallcms\">Uninstall UD/UCMDB</a>.</p>\n</li>\n<li>\n<p>Create a new deployment.</p>\n<p>For details, see <a href=\"/doc/423/26.1/cmswithsmaxcreatedeployment\">Create a new deployment</a>.</p>\n</li>\n<li>\n<p>Restore secret.</p>\n<ol start=\"1\">\n<li>\n<p>Create a new cms-secret using the backup secret yaml file:</p>\n<pre>kubectl apply -f cms-secret_backup_yyyy-mm-dd.yaml -n &lt;namespace-of-cms&gt;</pre>\n</li>\n<li>\n<p>Create a new cms-probe-secret using the backup secret yaml file:</p>\n<pre>kubectl apply -f cms-probe-secret_backup_yyyy-mm-dd.yaml -n &lt;namespace-of-cms&gt;</pre>\n</li>\n</ol>\n</li>\n<li>\n<p>Re-create NFS volumes (in the NFS server).</p>\n<p>For details, see <a href=\"/doc/423/26.1/cmswithsmaxcreatenfsvolumes\">Create NFS volumes</a>.</p>\n</li>\n<li>\n<p>Restore the following data in NFS volumes:</p>\n<table>\n<thead>\n<tr>\n<th scope=\"col\">\n<p>Component</p>\n</th>\n<th scope=\"col\">\n<p>NFS volume name</p>\n</th>\n<th scope=\"col\">\n<p>Directory</p>\n</th>\n<th scope=\"col\">\n<p>Description</p>\n</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>\n<p>UCMDB Gateway</p>\n</td>\n<td>\n<p>ucmdb-data-volume</p>\n</td>\n<td>\n<p>&lt;ucmdb-data-volume&gt;/cms-gateway</p>\n</td>\n<td>\n<p>Data generated by the UCMDB Gateway</p>\n</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>\n<p>Re-create PVs using the same configuration (<b>ucmdb-pv.yaml</b>).</p>\n<p>For details, see <a href=\"/doc/423/26.1/cmswithsmaxcreatenfsvolumes\">Create persistent volumes</a>.</p>\n</li>\n<li>\n<p>Re-install UD/UCMDB deployment with the same configuration (<b>my-values.yaml</b>) and the same helm chart.</p>\n<p>For details, see <a href=\"/doc/423/26.1/installcmswithsmaxinstallcms\">Deploy UD/UCMDB</a>.</p>\n</li>\n</ol>\n<div class=\"transcontent stn-end--RestoreCms\"> </div>\n<h2 class=\"mw-headline\" id=\"Disaster_Recovery_Process\">Scenario 3 - OMT crash</h2>\n<div class=\"transcontent stn-begin--RestoreCdfNode\"> </div>\n<ol>\n<li>\n<p>Restore or re-install OMT.  </p>\n<p>For instructions about restoring OMT, see <a href=\"/doc/423/26.1/administercdf\">Administer OMT</a>.</p>\n</li>\n<li>\n<p>Check whether the UD/UCMDB deployment is functioning properly.</p>\n<ul>\n<li>\n<p>If the UD/UCMDB deployment still crashes, follow instructions in Scenario 2 to restore UD/UCMDB deployment.</p>\n</li>\n<li>\n<p>If UD/UCMDB database crashes, follow the instructions in Scenario 1.</p>\n</li>\n</ul>\n</li>\n</ol>\n<div class=\"transcontent stn-end--RestoreCdfNode\"> </div>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}