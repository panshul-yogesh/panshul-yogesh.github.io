{
  "title": "Renew IdM SAML SSO certificate",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>The validity period of the IdM SAML certificate for SAML Identity Provider (IDP) is 1 year by default. You can check the validity of this certificate and renew the certificate to ensure the use of SAML authentication in the portal.</p>\n<h2>Check the validity of the IdM SAML SSO certificate</h2>\n<ol>\n<li>Download the IdM SAML metadata. To do this, visit the following URL:<br/>\n<code>https://&lt;external_access_host_FQDN&gt;:&lt;PORT&gt;/idm-service/saml/metadata</code><br/>\n\tFor example:<br/>\n<code>https://exampleVM.company.net/idm-service/saml/metadata</code></li>\n<li>Open the downloaded file, and then copy the text between the <code>&lt;ds:X509Certificate&gt;</code> and <code>&lt;/ds:X509Certificate&gt;</code> tags to a new, empty file.</li>\n<li>Save the file with a .crt suffix. For example, save the file as <strong>certCheck.crt</strong>.</li>\n<li>Open the file to view the validity dates of the certificate.  </li>\n</ol>\n<h2>Renew the IdM SAML SSO certificate</h2>\n<p>Use one of the following methods.</p>\n<h3>Method 1: Renew the certificate from IdM Admin Portal</h3>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">If you used method 2 previously, you need to remove or rename the &lt;config-volume&gt;/certificate/ca-trust/samlKeystore.jks file first before you use method 1. </div>\n</div>\n<p>Perform the following steps:</p>\n<ol>\n<li>Log in to the IdM Admin Portal: https://&lt;host&gt;/idm-admin as the suite admin.</li>\n<li>From <strong>SYSTEM SETTINGS</strong>, click <strong>SSO Certificate</strong> under <strong>SAML</strong> to update the SSO certificate. \n\t<ol start=\"1\">\n<li>Enter the display name. </li>\n<li>Click <strong>Set certificate by uploading. </strong></li>\n<li>Click<strong> Drag or click to upload</strong>. Then choose your new SSO certificate. </li>\n<li>Click <strong>Upload. </strong>Then click <strong>SAVE</strong>.</li>\n</ol>\n</li>\n<li>Click <strong>SSO PrivateKey</strong> under <strong>SAML</strong> to update the SSO private key.\n\t<ol start=\"1\">\n<li>Enter the display name. </li>\n<li>Click <strong>Set certificate by uploading.</strong></li>\n<li>Click<strong> Drag or click to upload</strong>. Then choose your new SSO certificate. </li>\n<li>Click <strong>Upload. </strong>Then click <strong>SAVE</strong>.</li>\n</ol>\n</li>\n<li>Then restart IdM. Run the following commands to restart IdM pods on any of the control plane nodes.\n\t<pre><code> kubectl scale -n &lt;suite namespace&gt; deployment idm --replicas 0\n kubectl scale -n &lt;suite namespace&gt; deployment idm --replicas &lt;number of idm pods&gt;</code></pre>\n</li>\n<li>Download the SAML metadata file from the portal. For example, download file <strong>idm_saml_metadata.xml</strong> from <code>https://&lt;external_access_host_FQDN&gt;/idm-service/saml/metadata</code>.</li>\n<li>Delete the old IdM relying party trust entry in SAML IDP and import the SAML metadata XML file to the IDP server. For details of how to import the SAML metadata to the IDP server, see <a href=\"/doc/423/26.1/configureauthenticationinidm#Add_SAML_authentication\" title=\"Set up SAML authentication\">Set up SAML authentication</a>. </li>\n</ol>\n<h3>Method 2: Renew the certificate from the backend</h3>\n<ol>\n<li>Log in to the control plane node or bastion node as root or a sudo user and run the following command to enter the idm container:\n\t<p><code>namespace=&lt;ESM_NAMESPACE&gt;  #&lt;ESM_NAMESPACE&gt;: your ESM namespace<br/>\n\tpod=$(kubectl get po -n $namespace|grep idm|head -1|awk '{print $1}')<br/>\n\tkubectl exec -ti $pod -n $namespace -c idm /bin/bash</code></p>\n</li>\n<li>Run the following command to import the env parameters:<br/>\n<code>export CERT_CN=&lt;suite FQDN&gt;<br/>\n\texport CERT_OU=&lt;organizational unit&gt;<br/>\n\texport CERT_O=&lt;organization&gt;<br/>\n\texport CERT_L=&lt;locality&gt;<br/>\n\texport CERT_ST=&lt;state&gt;<br/>\n\texport CERT_C=&lt;country&gt;<br/>\n\texport CERT_ALIAS=idm</code><br/>\n<code>export KEY_STORE_FILE=&lt;filepath&gt;/samlKeystore.jks<br/>\n\texport KEY_STORE_PASS=&lt;password&gt;<br/>\n\texport KEY_PASS=&lt;password&gt; <br/>\n\texport CERT_VALIDITY=&lt;validity period of the cerficiate&gt; (3650 means that the validity period is 10 years) <br/>\n\texport KEY_SIZE=2048<br/>\n\texport KEY_STORE_TYPE=JKS</code>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\"> <code>KEY_STORE_PASS and KEY_PASS</code> must have the same value (&lt;password&gt;).</div>\n</div>\n</li>\n<li>Run the following commands to generate a new samlKeystore.jks file:<br/>\n<code>keytool -noprompt -genkey -dname \"CN=${CERT_CN}, OU=${CERT_OU}, O=${CERT_O}, L=${CERT_L}, ST=${CERT_ST}, C=${CERT_C}\" -keyalg RSA -alias ${CERT_ALIAS} -keystore ${KEY_STORE_FILE} -storepass ${KEY_STORE_PASS} -keypass ${KEY_PASS} -validity ${CERT_VALIDITY} -keysize ${KEY_SIZE} -deststoretype ${KEY_STORE_TYPE}</code></li>\n<li>Run the following command to verify the new samlKeystore.jks file:<br/>\n<code>keytool -list -alias ${CERT_ALIAS} -keystore ${KEY_STORE_FILE} -storepass ${KEY_STORE_PASS} -storetype ${KEY_STORE_TYPE} -v</code></li>\n<li>Run the following command to replace the samlKeystore.jks file with the new one:<br/>\n<code>cp &lt;${KEY_STORE_FILE}&gt; /var/itsma/upload/security/</code></li>\n<li>Run the following command to update the keystore and key password to the vault:\n\t<p><code>update_secret idm_keystore_password_secret_key '&lt;password&gt;'</code><br/>\n\tWhere: &lt;password&gt; is the value used for KEY_STORE_PASS and KEY_PASS.<br/>\n\tYou can run the <code>get_secret idm_keystore_password_secret_key</code> command to verify that the value is correct.</p>\n</li>\n<li>\n<p>Exit the idm container and run the following command to restart the idm pods:</p>\n<p><code>kubectl scale -n &lt;suite namespace&gt; deployment idm --replicas 0<br/>\n\tkubectl scale -n &lt;suite namespace&gt; deployment idm --replicas &lt;number of idm pods&gt;</code></p>\n</li>\n<li>\n<p>Download the saml metadata file spring_saml_metadata.xml from https://&lt;EXTERNAL_ACCESS_HOST&gt;/idm-service/saml/metadata.</p>\n</li>\n<li>\n<p>Delete the old IdM relying party trust entry in the SAML IDP and import the SAML metadata XML file to the IDP server.<br/>\n\tTake Microsoft ADFS as an example, on the ADFS management console, click <strong>Relying Party Trust</strong>, select the old IdM relying party trust entry, right-click and delete it.</p>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}