{
  "title": "Replace certificate for Audit Service",
  "content": "<div class=\"mw-parser-output\"><div>In a production environment, you are recommended to replace the out-of-box certificate for Audit Service with your own certificate, signed by your corporate CA or a third-party CA. To do this, you must prepare the certificate based on whether your setup uses a single-level or multi-level certificate chain. Once preparation is complete, you proceed to replace the certificate for the Audit Service.</div>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>\n<p>Private keys protected by a passphrase are not supported. If your private key includes a passphrase, use the openssl rsa command to remove it. For example: <code># openssl rsa -in tls_with_pass.key -out tls.key</code>. If you are using Chrome, ensure that the server certificate defines the FQDN of the external access host in one of its Subject Alternative Names.</p>\n</div></div></div>\n<h2 class=\"mw-headline\" id=\"Prepare_your_certificate\">Prepare your certificate</h2>\n<p>Prepare a single-level or multi-level certificate based on your organization's requirements.</p>\n<h3 class=\"mw-headline\" id=\"Prepare_a_single-level_certificate\">Prepare single-level certificate</h3>\n<p>Prepare a certificate file (for example, <b>tls.crt</b>) and a private key file (for example, <b>tls.key</b>) in PEM format. </p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>In a production environment, we recommend you use your corporate root CA or a third-party root CA to sign the certificate. Additionally, the certificate's CN value must be the external access host name of the suite. </div></div></div>\n<p>The following figure shows the content of an example private key file (<b>tls.key</b>):<br/>\n<a class=\"image\" href=\"\"> <img alt=\"19894976.png\" data-file-height=\"558\" data-file-width=\"599\" height=\"558\" src=\"../../../images/19894976_c91f1af7.png\" width=\"599\"/> </a><br/>\nThe following figure shows the content of an example certificate file (<b>tls.crt</b>):<br/>\n<a class=\"image\" href=\"\"> <img alt=\"19894975.png\" data-file-height=\"547\" data-file-width=\"592\" height=\"547\" src=\"../../../images/19894975_9fea9712.png\" width=\"592\"/> </a></p>\n<h3 class=\"mw-headline\" id=\"Prepare_a_multi-level_certificate\">Prepare multi-level certificate</h3>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>\n<p>The following instructions use a three-level certificate as an example.</p>\n</div></div></div>\n<p>Prepare a certificate file (for example, <b>tls.crt</b>) and a private key file (for example, <b>tls.key</b>) in PEM format. Since the server certificate is a multi-level certificate, keep a certificate chain in the <b>tls.crt</b> file, as shown in the following example figure.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"sma_201802_multi_level_certificate.png\" data-file-height=\"802\" data-file-width=\"358\" height=\"1792\" src=\"../../../images/sma_201802_multi_level_certificate_84d1b592.png\" width=\"800\"/> </a><br/>\nYour organization requires you to import one or more CA certificates into the end user's browser. Use the Trusted Root Certification Authorities utility in Windows to complete the import, as shown in the following figure.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"800px-sma_201802_import_CAs.png\" data-file-height=\"572\" data-file-width=\"914\" height=\"501\" src=\"../../../images/800px-sma_201802_import_CAs_2611842d.png\" width=\"800\"/> </a><br/>\nIdentify your organization's scenario and follow the corresponding instructions:</p>\n<p><b>The Root CA, second-level CA and third-level CA certificates are installed as trusted CAs at the end user side</b><br/>\nIn this case, obtain the server certificate (for example, <b>tls.crt</b>) signed by the third-level CA.</p>\n<p><b>The Root CA and the second-level CA certificates are installed as trusted CAs at the end user side</b><br/>\nIn this case, obtain the following certificates:</p>\n<ul>\n<li>The third-level CA (for example, <b>thirdCA.crt</b>), signed by the second level CA</li>\n<li>The server certificate (for example, <b>server.crt</b>), signed by the third level CA.</li>\n</ul>\n<p>Then, bundle them in the following order into one certificate (for example, <b>tls.crt</b>):</p>\n<pre># cat server.crt&gt;tls.crt\n# cat thirdCA.crt&gt;&gt;tls.crt\n</pre>\n<p><b>Only the Root CA certificate is installed as a trusted CA at the end user side</b><br/>\nIn this case, obtain the following certificates:</p>\n<ul>\n<li>The second-level CA (for example, <b>secondCA.crt</b>), which is signed by the Root CA</li>\n<li>The third-level CA (for example, <b>thirdCA.crt</b>), which is signed by the second-level CA</li>\n<li>The server certificate (for example, <b>server.crt</b>), which is signed by the third-level CA</li>\n</ul>\n<p>Then, bundle them in the following order into one certificate (<b>tls.crt</b>):</p>\n<pre># cat server.crt&gt;tls.crt\n# cat thirdCA.crt&gt;&gt;tls.crt\n# cat secondCA.crt&gt;&gt;tls.crt\n</pre>\n<h2 class=\"mw-headline\" id=\"Replace_the_certificate\">Replace the certificate</h2>\n<p>Refer to the section applicable to your deployment type for details on how to replace the suite certificate.</p>\n<h3>Helm deployment</h3>\n<p>To replace the certificate for Audit service, perform the following steps.</p>\n<ol>\n<li>[Optional] If you do not remember the path of your custom <strong>my-values.yaml</strong> file, run the following command to get your yaml file.\n\n\t<pre>helm get values &lt;AUDIT_RELEASE_NAME&gt; -n &lt;AUDIT_NAMESPACE&gt; &gt; my-values.yaml</pre>\n<p>Where: <code>&lt;AUDIT_NAMESPACE&gt;</code> is the unique namespace of the Audit Helm chart deployment; <code>&lt;AUDIT_RELEASE_NAME&gt;</code> is the release name, which you can obtain by using the following command:<br/>\n<code>helm list -n &lt;AUDIT_NAMESPACE&gt; | awk '{print $1}</code></p>\n</li>\n<li>\n<p>Specify custom certificates for Audit to use in my-values.yaml.</p>\n<p>Complete this step only if you want to configure Audit to use custom certificates.</p>\n<table>\n<caption>parameters for custom certificates</caption>\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Required</th>\n<th scope=\"col\">Default</th>\n<th scope=\"col\">Example</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>global.tls.cert</strong></td>\n<td>The <strong>.pem</strong> encoded content of the custom certificate(s).</td>\n<td>No</td>\n<td>Not defined</td>\n<td><code>\"-----BEGIN CERTIFICATE-----<br/>\n\t\t\t\tMIIFGzCCBAOgAwIBAgITfAAAA2iVjHu0vPAXsAAEAAADaDANBgkqhkiG9w0BAQsF<br/>\n\t\t\t\t[...]<br/>\n\t\t\t\tJJ1hTIEoy96UnOIt5gQL<br/>\n\t\t\t\t-----END CERTIFICATE-----<br/>\n\t\t\t\t-----BEGIN CERTIFICATE-----<br/>\n\t\t\t\tMIIDfDCCAmSgAwIBAgIQOTQW1b748rlAtafk4cM8nDANBgkqhkiG9w0BAQsFADA9<br/>\n\t\t\t\t[...]<br/>\n\t\t\t\tutV0Pu/h9fsOEFaUiA9cWMGzH2p4aKNEIIAg67NxmQM=<br/>\n\t\t\t\t-----END CERTIFICATE-----\"</code></td>\n</tr>\n<tr>\n<td><strong>global.tls.key</strong></td>\n<td>\n<p>The .<strong>pem</strong> encoded content of the key.</p>\n</td>\n<td>No</td>\n<td>Not defined</td>\n<td>\n<p><code>\"-----BEGIN RSA PRIVATE KEY-----<br/>\n\t\t\t\tMIIEpAIBAAKCAQEAoR9CY4dwTMU+BKWwRsX+cpIFahRDN091Pc7qL4uMwEfi+W6r<br/>\n\t\t\t\t[...]<br/>\n\t\t\t\t//uHRFpE0FUvgFo8bV+rBzsQc5EMYB7udoYPRP2cSH3ly64OLE0T9A==<br/>\n\t\t\t\t-----END RSA PRIVATE KEY-----\"</code></p>\n</td>\n</tr>\n</tbody>\n</table>\n\tYou must include the content of the certificate(s) and key in double quotes. For example:\n\n\t<div><a class=\"image\" href=\"\"> <img alt=\"Cert content\" src=\"../../../images/oo_values_tls_cert_and_key_content_example_6fec0ebb.png\"/> </a></div>\n</li>\n<li>Run the following command to update the Audit Service:\n\t<pre>helm upgrade &lt;Audit Release Name&gt; &lt;Audit Service Chart&gt; -n &lt;Audit Namespace&gt; -f my-values.yaml</pre>\n</li>\n</ol>\n<h2>Verify Audit service installation</h2>\n<p>To verify the Audit service installation, do the following:</p>\n<ol>\n<li>\n<p>Log in to the control plane node.</p>\n</li>\n<li>\n<p>Run the following command to make sure that all pods are ready:</p>\n<pre>kubectl get pod -n &lt;Audit Namespace&gt; |grep -v 1/1|grep -v 2/2|grep -v 3/3|grep -v 4/4|grep -v Completed</pre>\n<p>Where,</p>\n<p><em>&lt;Audit Namespace&gt;</em> is the namespace where you have deployed the Audit Helm chart.</p>\n<p>This command returns a list of abnormal pods. When it returns no results, all pods are ready.</p>\n</li>\n<li>\n<p>Log in to the Audit UI as a suite administrator. The Tenant view displays.</p>\n</li>\n<li>Switch to the System view.</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}