{
  "title": "Replace the certificate for Service Management Automation",
  "content": "<div class=\"mw-parser-output\">\n<div class=\"transcontent stn-begin--no_dnd\"></div>\n<p>In a production environment, you are recommended to replace the out-of-box Nginx certificate for OMT and the suite with your own certificate, which must be signed by your corporate CA or a third-party CA. Before you replace the certificate, you need to prepare the certificate depending on whether it's single-level or multi-level. Once the certificate preparation is completed, you can replace the certificate for OMT and the suite.</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>\n<p>Private keys that are protected by a passphrase aren't supported. If your private key has a passphrase, use the <code>openssl rsa</code> command to remove the passphrase. For example: <code># openssl rsa -in tls_with_pass.key -out tls.key</code>. If using Chrome, the server certificate must define the FQDN of the external access host as one of its Subject Alternative Names.</p>\n</div></div></div>\n<h2 class=\"mw-headline\" id=\"Prepare_your_certificate\">Prepare your certificate</h2>\n<p>Your organization may use a single-level or multi-level certificate.</p>\n<h3 class=\"mw-headline\" id=\"Prepare_a_single-level_certificate\">Prepare a single-level certificate</h3>\n<p>Prepare a certificate file (for example, <b>tls.crt</b>) and a private key file (for example, <b>tls.key</b>) in PEM format. </p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>In a production environment, we recommend that you use your corporate root CA or a third-party root CA to sign the certificate. Additionally, the certificate's CN value must be the external access host name of the suite. </div></div></div>\n<p>The following figure shows the content of an example private key file (<b>tls.key</b>):<br/>\n<a class=\"image\" href=\"\"> <img alt=\"19894976.png\" data-file-height=\"558\" data-file-width=\"599\" height=\"558\" src=\"../../../images/19894976_c91f1af7.png\" width=\"599\"/> </a><br/>\nThe following figure shows the content of an example certificate file (<b>tls.crt</b>):<br/>\n<a class=\"image\" href=\"\"> <img alt=\"19894975.png\" data-file-height=\"547\" data-file-width=\"592\" height=\"547\" src=\"../../../images/19894975_9fea9712.png\" width=\"592\"/> </a></p>\n<h3 class=\"mw-headline\" id=\"Prepare_a_multi-level_certificate\">Prepare a multi-level certificate</h3>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>\n<p>The following instructions use a three-level certificate as an example.</p>\n</div></div></div>\n<p>Prepare a certificate file (for example, <b>tls.crt</b>) and a private key file (for example, <b>tls.key</b>) in PEM format. Since the server certificate is a multi-level certificate, you need to keep a certificate chain in the <b>tls.crt</b> file, as shown in the following example figure.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"sma_201802_multi_level_certificate.png\" data-file-height=\"802\" data-file-width=\"358\" height=\"1792\" src=\"../../../images/sma_201802_multi_level_certificate_84d1b592.png\" width=\"800\"/> </a><br/>\nYour organization may require that one or more of the CA certificates be imported into the end user's browser by using the Trusted Root Certification Authorities utility in Windows, as shown in the following figure.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"800px-sma_201802_import_CAs.png\" data-file-height=\"572\" data-file-width=\"914\" height=\"501\" src=\"../../../images/800px-sma_201802_import_CAs_2611842d.png\" width=\"800\"/> </a><br/>\nFollow the appropriate instructions below according to your organization's scenario.</p>\n<p><b>The Root CA, second-level CA and third-level CA certificates are installed as trusted CAs at the end user side</b><br/>\nIn this case, you only need to obtain the server certificate (for example, <b>tls.crt</b>), which is signed by the third-level CA.</p>\n<p><b>The Root CA and the second-level CA certificates are installed as trusted CAs at the end user side</b><br/>\nIn this case, you need to obtain the following certificates:</p>\n<ul>\n<li>The third-level CA (for example, <b>thirdCA.crt</b>), which is signed by the second level CA</li>\n<li>The server certificate (for example, <b>server.crt</b>), which is signed by the third level CA.</li>\n</ul>\n<p>Then, you need to bundle them in the following order into one certificate (for example, <b>tls.crt</b>):</p>\n<pre># cat server.crt&gt;tls.crt\n# cat thirdCA.crt&gt;&gt;tls.crt\n</pre>\n<p><b>Only the Root CA certificate is installed as a trusted CA at the end user side</b><br/>\nIn this case, you need to obtain the following certificates:</p>\n<ul>\n<li>The second-level CA (for example, <b>secondCA.crt</b>), which is signed by the Root CA</li>\n<li>The third-level CA (for example, <b>thirdCA.crt</b>), which is signed by the second-level CA</li>\n<li>The server certificate (for example, <b>server.crt</b>), which is signed by the third-level CA</li>\n</ul>\n<p>Then, you need to bundle them in the following order into one certificate (<b>tls.crt</b>):</p>\n<pre># cat server.crt&gt;tls.crt\n# cat thirdCA.crt&gt;&gt;tls.crt\n# cat secondCA.crt&gt;&gt;tls.crt\n</pre>\n<h2 class=\"mw-headline\" id=\"Replace_the_certificate\">Replace the certificate</h2>\n<p>Refer to the section applicable to your deployment type for details on how to replace the suite certificate.</p>\n<h3>Classic deployment</h3>\n<p>To replace the certificate, you need to first upload the certificate files and then activate the certificate. If the suite is deployed on AWS or AKS, you need to perform an additional step to replace the certificate for the services on the cloud. </p>\n<h4 id=\"Upload_the_certificate_files\">Upload the certificate files</h4>\n<p>To upload the certificate files:</p>\n<ol>\n<li>Log in to the OMT Management Portal as the <b>admin</b> user: https://&lt;EXTERNAL_ACCESS_HOST&gt;:5443.</li>\n<li>Navigate to <b>APPLICATION</b> &gt; <b>Certificate</b>.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"SMA_201911_replace_certificate.png\" data-file-height=\"626\" data-file-width=\"703\" height=\"626\" src=\"../../../images/SMA_201911_replace_certificate_1dbe6369.png\" width=\"703\"/> </a></li>\n<li>Select your certificate format.</li>\n<li>Select your certificate files and private key.</li>\n<li>Click <b>Update</b> to use the selected certificates and key.</li>\n</ol>\n<p class=\"mw-headline\" id=\"Option_2:_Replace_the_certificate_with_kubectl_command\"><strong>Note</strong>: This step performs certificate validation and may fail in a complex network environment. In this case, if you are sure that the certificate is valid, you can alternatively upload the certificate files in the backend. See <a href=\"/doc/406/25.4/managecert\" title=\"Renew OMT ingress/Suite ingress controller certificates\">Manage OMT certificates</a>.</p>\n<h3>Helm deployment</h3>\n<p>To replace the certificate for SMA, use the following steps.</p>\n<ol>\n<li>[Optional] If you don't remember the path of your custom <strong>my-values.yaml</strong> file, run the following command to get your yaml file.\n\n\t<pre>helm get values &lt;ESM_RELEASE_NAME&gt; -n &lt;ESM_NAMESPACE&gt; &gt; my-values.yaml</pre>\n<p>Where: <code>&lt;ESM_NAMESPACE&gt;</code> is the unique namespace of the ESM Helm chart deployment; <code>&lt;ESM_RELEASE_NAME&gt;</code> is the release name, which you can obtain by using the following command:<br/>\n<code>helm list -n &lt;ESM_NAMESPACE&gt; | awk '{print $1}</code></p>\n</li>\n<li>Update the nginx server cert and key in your values yaml. For example:\n\t<pre>nginx:\n  nginx:\n    # tls configuration\n    tls:\n      # The certificate encoded with base64. If empty, a self signed certificate with cn=global.externalAccessHost will be generated.\n      cert:\n      # The private key of the certificate, also encoded with base64\n      key:</pre>\n</li>\n<li>Run the following command to clean up unused jobs before applying the changes. \n\t<pre><span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\">kubectl get job -n </span></span>&lt;ESM_NAMESPACE&gt;<span style=\"font-size:11.0pt\"><span style=\"font-family:Calibri\">|grep -v NAME | awk '{print $1}'|xargs kubectl delete job -n </span></span>&lt;ESM_NAMESPACE&gt;</pre>\n</li>\n<li>Run the following command to update the ESM deployment:\n\t<pre>helm upgrade &lt;ESM_RELEASE_NAME&gt; &lt;ESM_HELM_CHART_PATH&gt; -n &lt;ESM_NAMESPACE&gt; -f  my-values.yaml</pre>\n<p>Where &lt;ESM_HELM_CHART_PATH&gt;  is the absolute path of the ESM Helm package.</p>\n<p>Example:</p>\n<pre>helm upgrade sma ESM_Helm_Chart-2x.x.x/charts/esm-1.0.0+2x.x-xxx.tgz -n itsma-xxx -f my-values.yaml</pre>\n</li>\n<li>Run the following command to restart the nginx pod:\n\t<pre>kubectl get pods -n &lt;ESM_NAMESPACE&gt; | grep itom-ingress-controller | awk '{print $1}'| xargs kubectl delete pod -n &lt;ESM_NAMESPACE&gt; </pre>\n</li>\n</ol>\n<h2 class=\"mw-headline\" id=\"Activate_the_certificate\">Activate the certificate</h2>\n<p>On a control plane node (in an embedded Kubernetes environment) or the bastion node (in a managed Kubernetes environment), restart the Nginx pods by running the following command:</p>\n<pre>kubectl get pods -n &lt;namespace&gt; | grep itom-ingress-controller | awk '{print $1}'| xargs kubectl delete pod -n &lt;namespace&gt;</pre>\n<p>Where: <code>&lt;namespace&gt;</code> is the suite namespace.</p>\n<h2 class=\"mw-headline\" id=\"_Replace_the_certificate_for_cloud-based_deployment\">Additional step for cloud-based deployment</h2>\n<p><strong>Note</strong>: No additional step is required if the suite is deployed on GCP.</p>\n<p>If the suite is deployed in a public cloud, you also need to replace certificates for relevant services in the cloud.</p>\n<h3 id=\"AWS_(classical_AWS_and_EKS)\"><span class=\"mw-headline\" id=\"AWS_.28classical_AWS_and_EKS.29\">AWS</span></h3>\n<p><span class=\"mw-headline\">Before you begin, make sure that your certificate is using the </span>1024-bit RSA or 2048-bit RSA algorithm. If not, you will not be able to find your certificate after you import it into your Application Load Balancer. For more information, see the <a href=\"https://aws.amazon.com/premiumsupport/knowledge-center/elb-ssl-tls-certificate-https/\" title=\"AWS documentation\">AWS documentation</a>. </p>\n<p>You need to import the certificate to ACM, and replace the application load balancer's certificate that's bound with the listeners. Follow these steps:</p>\n<ol>\n<li>Run the following command on the bastion node: \n\t<pre>aws acm import-certificate --certificate file://&lt;server.crt&gt; --private-key file://&lt;server.key&gt; --certificate-chain file://&lt;ca.crt&gt; --region &lt;region&gt;\n</pre>\n</li>\n<li>Go to <b>EC2</b> &gt; <b>LOAD BALANCING.</b> Select the application load balancer you created and click <b>Listeners</b>. Select the port 443 listener and then click <b>Edit.</b></li>\n<li>For <b>Default SSL certificate</b>, select <b>From ACM (recommended)</b> and then select the certificate that you uploaded.</li>\n<li>Repeat the steps above for the port 5443 listener. </li>\n</ol>\n<h3 id=\"Azure_(AKS)\"><span class=\"mw-headline\" id=\"Azure_.28AKS.29\">Azure (AKS)</span></h3>\n<p>Follow the following procedure to replace the Application gateway certificate:</p>\n<p>Before you begin, log in to the bastion node, and then run the following command to change the SSL certificate to PFX format.</p>\n<pre>openssl pkcs12 -export -out certificate.pfx -inkey server.key -in server.crt\n</pre>\n<p>Then, replace the certificate as follows:</p>\n<ol>\n<li>Log in to the Azure portal, and navigate to your application gateway listeners. Click the listener for port 443, and then click<strong> </strong> <bold> <strong>Create new</strong> </bold> under <bold> <strong>Choose a certificate</strong> </bold>. Select your <strong>certificate.pfx</strong> file to upload it. </li>\n<li>Rename your root CA certificate to .cer format. For example, change ca.crt to ca.cer. </li>\n<li>Log in to the Azure portal, navigate to your application gateway http-settings. Replace the http-settings ssl certificate with the root CA certificate(&lt;ca.cer&gt;). </li>\n<li>Repeat steps above for port 5443. </li>\n<li>(For port 5443 only) Check the <bold> <strong>Backend port</strong> </bold> field. It may be automatically changed to 443. If this is the case, change it back to 5443.</li>\n</ol>\n<div class=\"transcontent stn-end--no_dnd\"></div>\n<h2>Import custom server certificate to Design and Deploy (DND)</h2>\n<p>The <strong>custom server certificate</strong> should be imported to the DND trust store for any of the tenants with DND. Follow the below steps to import a custom certificate into DND</p>\n<ul>\n<li>Obtain <strong>server.crt</strong> of the custom certificate. Connect to NFS server and copy <strong>server.crt</strong> in the shared folder <code>&lt;persistent_volume&gt;/itsma/global-volume/certificate/cmp/source</code>.\n\n\t<p><strong>Example: </strong><code>/var/vols/itom/itsma/global-volume/certificate/cmp/source</code></p>\n</li>\n<li>Delete and restart the following DND pods using the following commands (for fresh installations).\n\t<ul>\n<li><code>kubectl scale deployment itom-dnd-deploy-controller -n &lt;namespace&gt; --replicas=0</code></li>\n<li><code>kubectl scale deployment itom-dnd-deploy-controller -n &lt;namespace&gt; --replicas=1</code></li>\n</ul>\n</li>\n</ul>\n<h2>Replace the suite certificate in the UD/UCMDB deployment</h2>\n<p>If you have deployed UD/UCMDB for Native SACM, after you replace the certificate for the suite, follow these steps to replace the suite certificate in UD/UCMDB:</p>\n<ol>\n<li>\n<p>Update the certificate content under the caCertificates parameter in your custom <strong>my-values.yaml</strong> file by copying the certificate content from the new suite server certificate.</p>\n<p>Example:</p>\n<pre>caCertificates:\n  smax.crt |\n  &lt;certificate content from the new suite server certificate&gt;</pre>\n</li>\n<li>Run the following command to get the UD/UCMDB deployment name and UD/UCMDB namespace:\n\t<pre>helm ls -A</pre>\n</li>\n<li>\n<p>Run the following command to update the UD/UCMDB deployment: </p>\n<pre>helm upgrade &lt;<em>UD/UCMDB RELEASE NAME</em>&gt; &lt;<em>UD/UCMDB CHART FILE</em>&gt; -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt; -f &lt;<em>VALUES YAML FILE</em>&gt;</pre>\n<p>For example:</p>\n<pre>helm upgrade ucmdb-prod UCMDB_Helm_Chart-202x.xx/ucmdb-helm-charts/charts/ucmdb-1.x.0+20xxxx00.xx.tgz -n ucmdb-prod -f my-values.yaml</pre>\n</li>\n<li>\n<p>Run the following command to make sure that all UD/UCMDB pods are ready. If the returned result of this command is blank, then all the pods are ready.</p>\n<pre>kubectl get pod -n &lt;UD/UCMDB NAMESPACE&gt; |grep -v 1/1|grep -v 2/2|grep -v 3/3|grep -v 4/4|grep -v Completed</pre>\n</li>\n<li>Restart UCMDB Gateway.\n\t<pre>kubectl rollout restart deployment itom-cms-gateway -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt;</pre>\n</li>\n</ol>\n<div class=\"transcontent stn-begin--relatedTopics\"></div>\n<h2 class=\"mw-headline\" id=\"Related_topics\">Related topics</h2>\n<p>For more details about how to update and renew the suite certificate, see <a href=\"/doc/406/25.4/managecert\" title=\"Manage OMT certificates\">Manage OMT certificates</a></p>\n<p>For more details on how to configure Deployment Providers with SSL connections, see <a href=\"/doc/423/26.1/provideroverview\" style=\"\" title=\"Creating, editing, and deleting providers\">Creating, editing, and deleting providers</a>.</p>\n<div class=\"transcontent stn-end--relatedTopics\"></div>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}