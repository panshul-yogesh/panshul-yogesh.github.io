{
  "title": "Configure the Suite to use the same load balancer as OMT",
  "content": "<div class=\"mw-parser-output\">\n<p>This topic guides you on how to configure the suite to use the same load balancer as OMT. Perform these steps only if your deployment requires OMT AppHub and after you have <a href=\"/doc/423/26.1/configurelbazure\" title=\"configured a load balancer for OMT\">configured a load balancer for OMT</a>.</p>\n<table>\n<tbody>\n<tr>\n<th>Role</th>\n<th>Location</th>\n</tr>\n<tr>\n<td>Suite administrator</td>\n<td>Azure portal</td>\n</tr>\n</tbody>\n</table>\n<h3 class=\"mw-headline\" id=\"Step_1:_Bind_the_load_balancer_with_rules_in_the_application_gateway\">Step 1: Bind the load balancer with rules in the application gateway</h3>\n<ol>\n<li>Open the application gateway <a href=\"/doc/423/26.1/configurelbazure#Step_1/_Create_an_Azure_application_gateway\" title=\"application gateway\">you created for OMT</a>.</li>\n<li>Click <b>Backend Pools</b> &gt; <b>+Add</b> to create a new backend pool for 443: \n\t<p>Provide the following information:</p>\n<ul>\n<li><b>Name</b>: Enter a name.</li>\n<li><b>Add backend pool without targets</b>: Select <b>No</b>.</li>\n<li><b>Target type</b>: Select <b>IP address or FQDN</b>.</li>\n<li><b>Target</b>: Enter the IP address of suite service. You can get the IP address by using the <code>kubectl get svc itom-ingress-controller-svc -n $(kubectl get namespaces|grep itsma|head -n 1|awk '{print $1}') | grep -v EXTERNAL-IP |awk '{print $4}'</code> command.</li>\n</ul>\n</li>\n<li>Click <b>Add</b>.</li>\n</ol>\n<h3 class=\"mw-headline\" id=\"Step_2:_Configure_listeners_for_ports_5443_and_443\">Step 2: Configure listeners for port 443</h3>\n<p>You will need to create a certificate for the listener that you will create for port 443. To do this, run the following commands on the bastion node:</p>\n<ol>\n<li>Create the server certificate :\n\t<pre>kubectl get secret nginx-default-secret -n$(kubectl get namespaces|grep itsma|head -n 1|awk '{print $1}') -o json  | jq .data.'\"tls.crt\"' -r | base64 -d &gt; server.crt</pre>\n</li>\n<li>Get the server certificate key:\n\t<pre>kubectl get secret nginx-default-secret -n$(kubectl get namespaces|grep itsma|head -n 1|awk '{print $1}') -o json  | jq .data.'\"tls.key\"' -r | base64 -d &gt; server.key</pre>\n</li>\n<li>Export the server certificate to a PFX file:\n\t<pre>openssl pkcs12 -export -out certificate.pfx -inkey server.key -in server.crt</pre>\n<p>When prompted, enter a password for the <code>certificate.pfx</code> file.</p>\n</li>\n<li>Copy the <code>certificate.pfx</code> file to the local drive of the machine on which you will launch the Azure portal. </li>\n</ol>\n<p>Configure a separate listener for port 443 as follows:</p>\n<ol>\n<li>Click <b>Listeners</b>, and then click <b>+Add listener</b> to create a listener for port 443.</li>\n<li>Provide the following information:\n\t<ul>\n<li><b>Listener name</b>: Enter a name for the listener.</li>\n<li><b>Frontend IP</b>: Select <b>Public</b> to choose the public IP address you created for the frontend.</li>\n<li><b>Port</b>: Enter <b>443</b>.</li>\n<li><b>Protocol</b>: Select <b>HTTPS</b>.</li>\n<li><b>Choose a certificate</b>: Select <b>Create new</b>, and then select <strong>Upload a certificate</strong> to upload the <code>certificate.pfx</code><strong> </strong>file that you created:\n\t\t<ul>\n<li><strong>PFX certificate file</strong>: select the <code>certificate.pfx</code><strong> </strong>file</li>\n<li><strong>Cert name</strong>: specify a name for the certificate</li>\n<li><strong>Password</strong>: enter the password you specified when exporting the <code>certificate.pfx</code><strong> </strong>file</li>\n</ul>\n</li>\n<li><b>Additional settings</b>:\n\t\t<ul>\n<li><b>Listener type</b>: Select <b>Basic</b>.</li>\n<li><b>Error page URL</b>: Select <b>No</b>.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Click <b>Add</b>.</li>\n</ol>\n<h3 class=\"mw-headline\" id=\"Step_3:_Configure_HTTP_settings_for_ports_5443_and_443\">Step 3: Configure Backend settings for port 443</h3>\n<p>Run the following commands on the bastion node to create an <code>RE_ca.cer</code> file, which will be used when you configure a backend setting for port 443.</p>\n<pre>kubectl get cm -n $(kubectl get namespaces|grep itsma|head -n 1|awk '{print $1}') public-ca-certificates -o json |sed -n '/\"RE_ca.crt\": \"-----BEGIN CERTIFICATE-----/p'|sed 's/\\\\n//g'|sed 's/ //g' |sed 's/\"RE_ca.crt\":\"-----BEGINCERTIFICATE-----/-----BEGIN CERTIFICATE-----\\n/g' |sed 's/-----ENDCERTIFICATE-----\",/\\n-----END CERTIFICATE-----/g' &gt; RE_ca.cer</pre>\n<p>Create a separate backend setting for each port as follows:</p>\n<ol>\n<li>Click <b>Backend settings</b> &gt; <b>+ Add</b> to create a backend setting for port 443.</li>\n<li>Provide the following information:\n\t<ul>\n<li><b>Backend settings name</b>: Enter a name.</li>\n<li><b>Backend protocol</b>: Choose <b>HTTPS</b>.</li>\n<li><b>Backend port</b>: Enter <b>443</b>.</li>\n<li><b>Choose a certificate</b>: Choose the <code>RE_ca.cer</code> file that you prepared earlier and click <strong>+ Add certificate</strong>.</li>\n<li><b>Override with new hostname</b>: Select <b>Yes</b>, choose <b>Override with specific domain name</b>, and then enter your external access hostname.</li>\n<li><b>Request time-out (seconds)</b>: Enter <b>180</b>.</li>\n<li><b>Use custom probe</b>: select <b>No</b>. You will create a custom probe in a later step.</li>\n</ul>\n</li>\n<li>Click <b>Save</b>. The backend setting configuration for port 443 is completed.</li>\n</ol>\n<h3 class=\"mw-headline\" id=\"Step_4:_Add_a_routing_rule_for_each_port\">Step 4: Add a routing rule for each port</h3>\n<p>Configure a separate routing rule for port 443.</p>\n<ol>\n<li>Click <b>Rules</b>, and then click <b>+Request routing rule</b> to create a rule for port 443.</li>\n<li>Select <b>Add a rule</b> in the Routing rules column.</li>\n<li>In the <b>Add a routing rule</b> window that opens, enter a name for the rule. Set <strong>Priority </strong>for 443 as 10.</li>\n<li>A routing rule requires a listener. On the <b>Listener</b> tab, in the <b>Listener</b> field, select the listener that you created for port 443.</li>\n<li>On the <b>Backend targets</b> tab, select <b>Backend pool</b> as the target type, and then in the <b>Backend target</b> field select the backend pool that you created for port 443.</li>\n<li>In the <b>Backend settings</b> field, select the backend setting that you created for port 443.</li>\n<li>Click <b>Save</b>. The configuration for port 443 is completed.</li>\n</ol>\n<h3 class=\"mw-headline\" id=\"Step_5:_Configure_health_probes_for_the_ports\">Step 5: Configure health probes for the ports</h3>\n<p>Configure a separate probe for port 443 as follows:</p>\n<ol>\n<li>Click <b>Health probes</b>, click <b>+Add</b> to create a health probe for port 443.</li>\n<li>Provide the following information:\n\t<ul>\n<li><b>Name</b>: Enter a name.</li>\n<li><b>Protocol</b>: Select <b>HTTPS</b>.</li>\n<li><b>Host</b>: Enter your external access hostname.</li>\n<li><b>Path</b>: Enter <b>/healthz</b>.</li>\n<li><b>Interval (seconds)</b>: Enter <b>30</b>.</li>\n<li><b>Timeout (seconds)</b>: Enter <b>5</b>.</li>\n<li><b>Unhealthy threshold</b>: Enter <b>15</b>.</li>\n<li><b>Backend settings</b>: Select the one that you created for port 443.</li>\n</ul>\n</li>\n<li>Uncheck the <b>I want to test the backend health before adding the health probe</b> option.</li>\n<li>Click <b>Save</b>. The health probe configuration for port 443 is completed.</li>\n</ol>\n<h3 class=\"mw-headline\" id=\"Step_6:_Check_the_backend_health_for_ports_5443_and_443\">Step 6: Check the backend health for port 443</h3>\n<ol>\n<li>Open the application gateway that you created. </li>\n<li>Click <b>Backend health</b>.</li>\n<li>Make sure that the <b>Status</b> value is <b>Healthy</b> for port 443. This indicates that the application gateway configuration is successful. </li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}