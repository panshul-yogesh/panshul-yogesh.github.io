{
  "title": "Integration Studio scenario rules for SAM",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>This page describes some important Integration Studio rules/actions used in various integration scenarios that enable the compliance calculation of SaaS products in SAM.</p>\n<h2 id=\"GetContext\">Get context information</h2>\n<p>To use the context data passed from SAM in scenario rules, use the <strong>Prepare Data</strong> rule to define an object (as an example, we name it as <em>Context</em>), and assign the values specified in the table below to various properties of the <em>Context</em> object. This rule should be added at the beginning of the scenarios that require the SAM context data.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Property</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Value</th>\n</tr>\n<tr>\n<td>ProductId</td>\n<td>SaaS product Id.</td>\n<td><code>json_parser(payload.data, '$.ProductId')</code></td>\n</tr>\n<tr>\n<td>ProductName</td>\n<td>SaaS product name.</td>\n<td><code>json_parser(payload.data, '$.ProductName')</code></td>\n</tr>\n<tr>\n<td>JobInstanceId</td>\n<td>The job instance Id.</td>\n<td><code>json_parser(payload.data, '$.JobInstanceId')</code></td>\n</tr>\n<tr>\n<td>SessionIdentifier</td>\n<td>A unique identifier for the integration session.</td>\n<td><code>json_parser(payload.data, '$.SessionIdentifier')</code></td>\n</tr>\n</thead>\n</table>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-note-icon\"></div>\n<div class=\"admonition-content admonition-note-content\">The following actions can be found in the <strong>Local System</strong> category on the <strong>Select action</strong> form when you add rules for a scenario.</div>\n</div>\n<h2 id=\"CreateLicenses\">Create or update license (SaaS products)</h2>\n<p>After using a rule that calls the SaaS product API to retrieve license data, add a <strong>SAM / SaaS - Create or update license </strong>rule to create license data.</p>\n<p>Note that the license created by the integration is in the <strong>New</strong> phase, and you need to move it (manually or through a workflow) to a proper phase as required.</p>\n<p>The rule also does the following:</p>\n<ul>\n<li><strong>Create product version records</strong>: the rule will create a product version record (if not already created) for each service retrieved from the SaaS product API, using the service name as the product version name.</li>\n<li><strong>Create or update license model</strong>: the rule will set the license metric and product versions list for license models that are associated with the services included in the SaaS product; the rule identifies the license models to update by using the license SKU number or service name that is specified in the parameters of the rule.</li>\n</ul>\n<p>Configure the rule's parameters as follows:</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Value</th>\n</tr>\n<tr>\n<td>Product Id</td>\n<td>SaaS product Id.</td>\n<td><code>Context.ProductId</code></td>\n</tr>\n<tr>\n<td>Session identifier</td>\n<td>A unique identifier for the integration session.</td>\n<td><code>Context.SessionIdentifier</code></td>\n</tr>\n<tr>\n<td>External Id</td>\n<td>The license record identifer in the external system.</td>\n<td>The record Id from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>SKU number</td>\n<td>License SKU number. </td>\n<td>The license SKU number from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Service name</td>\n<td>Name of the service.</td>\n<td>The service name from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Total points</td>\n<td>Total number of license points.</td>\n<td>The total points from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Total amount</td>\n<td>Total amount of the license.</td>\n<td>The total amount from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Currency code</td>\n<td>The currency code of the total amount.</td>\n<td>The currency code from Service Management.</td>\n</tr>\n<tr>\n<td>Owner Id</td>\n<td>Owner Id of the license.</td>\n<td>The Id of a Service Management user.</td>\n</tr>\n<tr>\n<td>Acquisition date</td>\n<td>Acquisition date of the license.</td>\n<td>The license acquisition date from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Start date</td>\n<td>Start date of the license.</td>\n<td>The license start date from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>End date</td>\n<td>End date of the license.</td>\n<td>The license end date from the response data of the SaaS API.</td>\n</tr>\n</thead>\n</table>\n<h2 id=\"CreateConsumption\">Create license consumption (SaaS products)</h2>\n<p>After using a rule that calls the SaaS product API to retrieve license consumption data, add a <strong>SAM / SaaS - Create license consumption</strong> rule to create license consumption data for each service included in the SaaS product in SAM.</p>\n<p>The rule also does the following:</p>\n<ul>\n<li><strong>Create product version records</strong>: the rule will create a product version record (if not already created) for each service retrieved from the SaaS product API, using the service name as the product version name.</li>\n<li><strong>Update license model</strong>: the rule will set the license metric and product versions list for license models that are associated with the services included in the SaaS product; the rule identifies the license models to update by using the license SKU number or service name that is specified in the parameters of the rule.</li>\n</ul>\n<p>Configure the rule's parameters as follows:</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Value</th>\n</tr>\n<tr>\n<td>Product Id</td>\n<td>SaaS product Id.</td>\n<td><code>Context.ProductId</code></td>\n</tr>\n<tr>\n<td>Session identifier</td>\n<td>A unique identifier for the integration session.</td>\n<td><code>Context.SessionIdentifier</code></td>\n</tr>\n<tr>\n<td>External Id</td>\n<td>The license consumption record identifer in the external system.</td>\n<td>The record Id from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>SKU number</td>\n<td>License SKU number. </td>\n<td>The license SKU number from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Service name</td>\n<td>Name of the service.</td>\n<td>The service name from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Total points</td>\n<td>Total number of entitled license points.</td>\n<td>The total points from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Consumed points</td>\n<td>Total number of license points consumed by entitled users.</td>\n<td>The consumed points from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Organization compliance scope</td>\n<td>The organization compliance scope associated with the consumption.</td>\n<td>The name of the organization compliance scope.<br/>\n\t\t\tIf you import data for the global scope, you may leave this parameter empty.</td>\n</tr>\n</thead>\n</table>\n<h2 id=\"CreateConsumption\">Create license consumption (on-premises products)</h2>\n<p>After using a rule that calls the on-premises product API to retrieve license consumption data, add a <strong>SAM / On-premises - Create license consumption</strong> rule to create license consumption data for each product version.</p>\n<p>The rule also creates a product version record (if not already created) for each version retrieved from the product API.</p>\n<p>Configure the rule's parameters as follows:</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Value</th>\n</tr>\n<tr>\n<td>Product Id</td>\n<td>Product Id.</td>\n<td><code>Context.ProductId</code></td>\n</tr>\n<tr>\n<td>Session identifier</td>\n<td>A unique identifier for the integration session.</td>\n<td><code>Context.SessionIdentifier</code></td>\n</tr>\n<tr>\n<td>External Id</td>\n<td>The license consumption record identifer in the external system.</td>\n<td>The record Id from the response data of the API.</td>\n</tr>\n<tr>\n<td>SKU number</td>\n<td>License SKU number. </td>\n<td>The license SKU number from the response data of the API.</td>\n</tr>\n<tr>\n<td>Product version</td>\n<td>The product version associated with the consumption.</td>\n<td>The product version from the response data of the API.</td>\n</tr>\n<tr>\n<td>Total points</td>\n<td>Total number of entitled license points.</td>\n<td>The total points from the response data of the API.</td>\n</tr>\n<tr>\n<td>Consumed points</td>\n<td>Total number of license points consumed by entitled users.</td>\n<td>The consumed points from the response data of the API.</td>\n</tr>\n<tr>\n<td>License metric code</td>\n<td>The code of the license metric associated with the product.</td>\n<td>The license metric code pre-configured in SAM.</td>\n</tr>\n<tr>\n<td>Organization compliance scope</td>\n<td>The organization compliance scope associated with the consumption.</td>\n<td>The name of the organization compliance scope.<br/>\n\t\t\tIf you import data for the global scope, you may leave this parameter empty.</td>\n</tr>\n</thead>\n</table>\n<h2 id=\"CreateEntitlement\">Create or update user entitlement (SaaS products)</h2>\n<p>After using a rule that calls the SaaS product API to retrieve user entitlement data for the SaaS product, add a <strong>SAM / SaaS - Create or update user entitlement</strong> rule to create user entitlement data in SAM.</p>\n<p>Additionally, the rule also creates a product version record (if not already created) for each service retrieved from the SaaS product API, using the service name as the product version name.</p>\n<p>Configure the rule's parameters as follows:</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Value</th>\n</tr>\n<tr>\n<td>Product Id</td>\n<td>SaaS product Id.</td>\n<td><code>Context.ProductId</code></td>\n</tr>\n<tr>\n<td>Session identifier</td>\n<td>A unique identifier for the integration session.</td>\n<td><code>Context.SessionIdentifier</code></td>\n</tr>\n<tr>\n<td>SKU number</td>\n<td>License SKU number. </td>\n<td>\n<p>The license SKU number from the response data of the SaaS API.</p>\n</td>\n</tr>\n<tr>\n<td>Service name</td>\n<td>Name of the service.</td>\n<td>\n<p>(Required) The service name from the response data of the SaaS API.</p>\n</td>\n</tr>\n<tr>\n<td>User principal name</td>\n<td>\n<p>A user property that can be used to uniquely identify a user, such as the user's email address.</p>\n<p>SAM uses the property to map the user to a Service Management user.</p>\n</td>\n<td>(Required) The unique user property from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>User name</td>\n<td>The user's display name.</td>\n<td>The user's display name from the response data of the SaaS API.</td>\n</tr>\n<tr>\n<td>Last login date</td>\n<td>The user's most recent login date.</td>\n<td>The last login date from the response data of the SaaS API (if available).</td>\n</tr>\n<tr>\n<td>Organization compliance scope</td>\n<td>The organization compliance scope associated with the consumption.</td>\n<td>The name of the organization compliance scope.<br/>\n\t\t\tIf you import data for the global scope, you may leave this parameter empty.</td>\n</tr>\n</thead>\n</table>\n<h2 id=\"InitEntitlement\">Initialize user entitlement (SaaS products)</h2>\n<p>Add a <strong>SAM / SaaS - Initialize user entitlement</strong> rule before a <strong>Create or update user entitlement</strong> rule to clear the existing user entitlement data for the SaaS product. This rule is required to align the user entitlement data in the SaaS product and in SAM. Otherwise, if user entitlement data is removed from the SaaS product, for example, there will be data discrepancies between the systems. </p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\"><strong>Parameter</strong></th>\n<th scope=\"col\"><strong>Description</strong></th>\n<th scope=\"col\"><strong>Value</strong></th>\n</tr>\n<tr>\n<td>Product Id</td>\n<td>SaaS product Id.</td>\n<td><code>Context.ProductId</code></td>\n</tr>\n</thead>\n</table>\n<h2 id=\"UpdateStatus\">Update job status</h2>\n<p>Add two instances of <strong>SAM / SaaS - Update job status</strong> rules in Try-Catch blocks as instructed in the <a href=\"/doc/423/26.1/integratesamwithsaasapplications#ScnGuideline\" title=\"SaaS product integration scenario configuration guideline\">SaaS product integration scenario configuration guideline</a> to inform SAM users about the scenario execution status.</p>\n<table border=\"1\" cellpadding=\"1\" cellspacing=\"1\">\n<thead>\n<tr>\n<th scope=\"col\">Parameter</th>\n<th scope=\"col\">Description</th>\n<th scope=\"col\">Value</th>\n</tr>\n<tr>\n<td>\n<p>Job instance Id</p>\n</td>\n<td>The job instance Id.</td>\n<td><code>Context.JobInstanceId</code></td>\n</tr>\n<tr>\n<td>Job status</td>\n<td>The job status.</td>\n<td><code>'COMPLETED_SUCCESS'</code> or <code>'FAILED'</code></td>\n</tr>\n<tr>\n<td>Result</td>\n<td>The job execution result.</td>\n<td>Enter a string value to indicate successful or failed execution. Examples: <code>'Successful'</code>, <code>'Scenario failure'</code>.</td>\n</tr>\n</thead>\n</table>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}