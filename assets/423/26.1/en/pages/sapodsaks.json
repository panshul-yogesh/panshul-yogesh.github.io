{
  "title": "Smart Analytics may encounter pod crashes during the upgrade on AKS platform",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>During the upgrade on the AKS platform, Smart Analytics may encounter pod crashes. </p>\n<p>When it happens, the pod status resembles the following:</p>\n<pre>[centos@7420150c-bastion ~]$ kubectl get po -n itsma-azfile|grep Crash\nsmarta-saw-con-0                                      1/2     CrashLoopBackOff   9 (24s ago)      28m\nsmarta-sawarc-con-0                                   1/2     CrashLoopBackOff   9 (41s ago)      29m\nsmarta-sawmeta-con-0                                  1/2     CrashLoopBackOff   9 (2m35s ago)    29m\nsmarta-stx-agent-645b5d69cc-92wb2                     1/2     CrashLoopBackOff   10 (2m28s ago)   29m\n</pre>\n<p>Also, the log of the crashed pod displays the content like this:</p>\n<pre>kubectl logs -f smarta-stx-agent-645b5d69cc-92wb2 -n itsma-azfile -c smarta-stx-agent\n… …\n10/01/2023 11:36:24 [1] 00-Always: Unable to load sentence breaking library \"chinesebreaking\" for language \"chinese\". File not found : /opt/content/langfiles/chinesebreaking.so: cannot open shared object file: No such file or directory\n10/01/2023 11:36:24 [1] 99-Always: Failed to initialise language settings. Exiting\n</pre>\n<h2>Cause</h2>\n<p>This issue occurs because of the file management on the AKS platform.</p>\n<h2>Solution</h2>\n<p>To fix this issue, perform the following steps:</p>\n<ol>\n<li>List and remember all the statefulset configurations.\n\t<pre>[centos@9c5de9dc-bastion]$ kubectl get sts -A\nNAMESPACE      NAME                   READY   AGE\ncms-ns         itom-ucmdb             2/2     5h13m\nitsma-azfile   infra-rabbitmq         3/3     7h24m\nitsma-azfile   smarta-saw-con         1/1     7h19m\nitsma-azfile   smarta-saw-con-a       1/1     7h19m\nitsma-azfile   smarta-saw-dah         1/1     7h17m\nitsma-azfile   smarta-sawarc-con      1/1     7h19m\nitsma-azfile   smarta-sawarc-con-a    1/1     7h19m\nitsma-azfile   smarta-sawarc-dah      1/1     7h17m\nitsma-azfile   smarta-sawmeta-con     1/1     7h19m\nitsma-azfile   smarta-sawmeta-con-a   1/1     7h19m\nitsma-azfile   smarta-sawmeta-dah     1/1     7h17m\n</pre>\n</li>\n<li>Scale all of the con satefulset to 0.\n\t<pre>centos@9c5de9dc-bastion]$ kubectl scale sts smarta-saw-con -n itsma-azfile --replicas=0\nstatefulset.apps/smarta-saw-con scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-saw-con-a -n itsma-azfile --replicas=0\nstatefulset.apps/smarta-saw-con-a scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-sawarc-con -n itsma-azfile --replicas=0\nstatefulset.apps/smarta-sawarc-con scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-sawarc-con-a -n itsma-azfile --replicas=0\nstatefulset.apps/smarta-sawarc-con-a scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-sawmeta-con -n itsma-azfile --replicas=0\nstatefulset.apps/smarta-sawmeta-con scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-sawmeta-con-a -n itsma-azfile --replicas=0\nstatefulset.apps/smarta-sawmeta-con-a scaled\n</pre>\n</li>\n<li>List all the deployment for Smart Analytics.\n\t<pre>[centos@9c5de9dc-bastion]$ kubectl get deployment -A|grep smarta-stx\nitsma-azfile   smarta-stx-agent                     1/1     1            1           7h22m\nitsma-azfile   smarta-stx-category                  1/1     1            1           7h18m\nitsma-azfile   smarta-stx-media                     1/1     1            1           7h22m\n</pre>\n</li>\n<li>Scale the deployment for agent and category to 0.\n\t<pre>[centos@9c5de9dc-bastion]$ kubectl scale deployment smarta-stx-agent -n itsma-azfile --replicas=0\ndeployment.apps/smarta-stx-agent scaled\n[centos@9c5de9dc-bastion]$ kubectl scale deployment smarta-stx-category -n itsma-azfile --replicas=0\ndeployment.apps/smarta-stx-category scaled\n</pre>\n</li>\n<li>Go to the NFS data folder:\n\t<pre>var/vols/itom/itsma/config-volume/idol</pre>\n\tfor example:\n\n\t<pre>cd/mnt/nfs/b25adc59ssb/var/vols/itom/itsma/config-volume/idol\n</pre>\n</li>\n<li>Backup the old langfiles by running this command:\n\t<pre>mv langfiles old_langfiles\n</pre>\n</li>\n<li>Restart the installer by running the following commands:\n\t<pre>[centos@9c5de9dc-bastion]$ kubectl get pods -A|grep smarta-install\nitsma-azfile   smarta-installer-8695fd8696-2pfsk                     0/2     Init:1/4    0          10s\n[centos@9c5de9dc-bastion idol]$ kubectl delete pod smarta-installer-8695fd8696-2pfsk -n itsma-azfile\npod \"smarta-installer-8695fd8696-2pfsk\" deleted\n</pre>\n</li>\n<li>Monitor the smarta-installer status until it becomes normal:\n\t<pre>[centos@9c5de9dc-bastion]$ kubectl get pods -A|grep smarta-install\nitsma-azfile   smarta-installer-8695fd8696-8vp72                     2/2     Running     0          97s\n</pre>\n</li>\n<li>Copy any modified language files, such as stop words, from the old_langfiles directory to the langfiles directory. If you haven't made any changes to the language files, please skip this step.</li>\n<li>Scale all the content pod back:\n\t<pre>[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-saw-con -n itsma-azfile --replicas=1\nstatefulset.apps/smarta-saw-con scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-saw-con-a -n itsma-azfile --replicas=1\nstatefulset.apps/smarta-saw-con-a scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-sawarc-con -n itsma-azfile --replicas=1\nstatefulset.apps/smarta-sawarc-con scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-sawarc-con-a -n itsma-azfile --replicas=1\nstatefulset.apps/smarta-sawarc-con-a scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-sawmeta-con -n itsma-azfile --replicas=1\nstatefulset.apps/smarta-sawmeta-con scaled\n[centos@9c5de9dc-bastion]$ kubectl scale sts smarta-sawmeta-con-a -n itsma-azfile --replicas=1\nstatefulset.apps/smarta-sawmeta-con-a scaled\n</pre>\n</li>\n<li>Scale the deployment for smarta-stx-agent and smarta-stx-category back:\n\t<pre>[centos@9c5de9dc-bastion]$ kubectl scale deployment smarta-stx-agent -n itsma-azfile --replicas=1\ndeployment.apps/smarta-stx-agent scaled\n[centos@9c5de9dc-bastion]$ kubectl scale deployment smarta-stx-category -n itsma-azfile --replicas=1\ndeployment.apps/smarta-stx-category scaled\n</pre>\n</li>\n<li>Monitor all the Smart Analytics pods, make sure they become normal now:\n\t<pre>kubectl get pods -A|grep smarta\nitsma-azfile   itom-smartanalytics-deploy-controller-pod       0/1     Completed   0          7h33m\nitsma-azfile   smarta-admin-ui-backend-7bf97b79f4-nzmcx      1/1     Running     0          7h30m\nitsma-azfile   smarta-data-source-86498d76d6-xhmck              2/2     Running     0          7h28m\nitsma-azfile   smarta-installer-8695fd8696-8vp72                     2/2     Running     0          3m7s\nitsma-azfile   smarta-ocr-86658d7d55-rfqtf                           2/2     Running     0          7h30m\nitsma-azfile   smarta-saw-con-0                                      1/2     Running     0          73s\nitsma-azfile   smarta-saw-con-a-0                                    1/2     Running     0          65s\nitsma-azfile   smarta-saw-dah-0                                      1/2     Running     0          7h25m\nitsma-azfile   smarta-saw-dih-94685c689-jzm76                        2/2     Running     0          7h25m\nitsma-azfile   smarta-saw-proxy-689ddd4fdd-7cdpx              1/1     Running     0          7h30m\nitsma-azfile   smarta-sawarc-con-0                                   1/2     Running     0          57s\nitsma-azfile   smarta-sawarc-con-a-0                                 1/2     Running     0          49s\nitsma-azfile   smarta-sawarc-dah-0                                   1/2     Running     0          7h26m\nitsma-azfile   smarta-sawarc-dih-6d9674cdc5-ftlzc                    2/2     Running     0          7h25m\nitsma-azfile   smarta-sawmeta-con-0                                  1/2     Running     0          43s\nitsma-azfile   smarta-sawmeta-con-a-0                                0/2     Init:0/3    0          34s\nitsma-azfile   smarta-sawmeta-dah-0                                  1/2     Running     0          7h25m\nitsma-azfile   smarta-sawmeta-dih-7785777f4-fg8jf                    2/2     Running     0          7h25m\nitsma-azfile   smarta-search-5758466d56-xfqtn                        2/2     Running     0          7h30m\nitsma-azfile   smarta-smart-ticket-6df64b6f85-7rm6n           2/2     Running     0          7h30m\nitsma-azfile   smarta-smart-ticket-admin-ui-6c96dfc958-f9w98   1/1  Running     0        7h30m\nitsma-azfile   smarta-smart-ticket-task-bd5dd6894-gnmmg     2/2     Running     0          7h28m\nitsma-azfile   smarta-stx-agent-95bdc46f4-p947f                      1/2     Running     0          26s\nitsma-azfile   smarta-stx-category-c4549cb5b-mwvgb                   0/2     Init:0/4    0          16s\nitsma-azfile   smarta-stx-media-586c5bb877-rdjc9                     2/2     Running     0          7h28m\n</pre>\n</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}