{
  "title": "SMA Backup Procedure",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p>This topic describes how to back up the suite data.</p><h2 class=\"mw-headline\">Verify the environment before making a backup</h2><p>To ensure a healthy backup, verify the environment before making a backup:</p><ol><li>Log in to the control plane node or bastion node and run the following command to make sure all the suite pods are ready:\n\t<pre>kubectl get pod --all-namespaces|grep -v 1/1|grep -v 2/2|grep -v 3/3|grep -v 4/4|grep -v Completed\n</pre>\n\tThis command returns a list of abnormal pods. When it returns no result, all the suite pods are ready. If any pods can't run, see <a href=\"/doc/423/26.1/troubleshootinstall\" title=\"Troubleshoot installation.\">Troubleshoot installation.</a></li><li>Clear your browser cache.</li><li>Verify that you can log in to the Suite Administration interface: <strong><em>https://&lt;external_access_host&gt;/bo</em></strong> as the <strong>suite-admin</strong> user.</li><li>Verify that you can log in to the OMT Management Portal: <strong>https://&lt;external_access_host&gt;:5443 </strong>as the <strong>admin</strong> user<b>.</b></li></ol><p>Next, choose the backup solution based on your deployment platforms.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\">For optimal security, always keep your backup files in a secure location.</div></div><h2>Scheduled routine backup</h2><p>OMT uses Velero to automatically back up your Kubernetes configurations at a specified time. This section explains the automatic backup and how to set your preferred period for the automatic back up.</p><h3>Update scheduled backup</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-VeleroBackup|updatebackup|N\"></span><p>Once you've enabled the Kubernetes backup capability, a schedule will be created automatically.  With this schedule, one backup will be created every day 00:00 AM, including all namespaces except the <code>default</code> and <code>kube-system</code> namespaces. </p>\n<p>You can update the schedule when you have special needs.</p>\n<div class=\"Admonition_Note\"><span class=\"autonumber\">Note</span>\n<ul>\n<li>Updating the backup scope may impact restoration when the resources that need to be restored aren't in the backup scope.</li>\n<li>We recommend you perform backup during non-business hours.</li>\n</ul>\n</div>\n<p>You can update the <code>schedule</code> value to change the scheduled time and update the <code>excludedNamespaces</code> and <code>includedNamespaces</code> values to change the backup scope in the schedule object.</p>\n<p>To make updates, perform the following steps:</p>\n<ol>\n<li>Run the following commands to check the allowed format for the scheduled time before updating the time:\n\t<div contenteditable=\"false\" tabindex=\"-1\">\n<div contenteditable=\"false\" tabindex=\"-1\">\n<pre><code> velero create schedule -h</code></pre>\n</div>\n</div>\n</li>\n<li>Run the following commands to edit the schedule object and save it:\n\t<div contenteditable=\"false\" tabindex=\"-1\">\n<div contenteditable=\"false\" tabindex=\"-1\">\n<pre><code> kubectl edit schedule k8s-backup -n $CDF_NAMESPACE</code></pre>\n</div>\n</div>\n</li>\n</ol>\n<p>The schedule object definition resembles below:</p>\n<div contenteditable=\"false\" tabindex=\"-1\">\n<div contenteditable=\"false\" tabindex=\"-1\">\n<pre><code># and an empty file will abort the edit. If an error occurs while saving this file will be\n# reopened with the relevant failures.\n#\napiVersion: velero.io/v1\nkind: Schedule\nmetadata:\n  creationTimestamp: \"2022-03-31T09:23:06Z\"\n  generation: 3\n  name: k8s-backup\n  namespace: core\n  resourceVersion: \"280172\"\n  uid: ec4bc1a7-b476-4b94-855a-a57f5d996b48\nspec:\n  schedule: 0 0 * * *\n  template:\n    excludedNamespaces:\n    - default\n    - kube-system\n    hooks: {}\n    includedNamespaces:\n    - '*'\n    metadata: {}\n    ttl: 720h0m0s\n  useOwnerReferencesInBackup: false\nstatus:\n  lastBackup: \"2022-03-31T09:23:06Z\"\n  phase: Enabled</code></pre>\n</div>\n</div>\n<p><br/>\n</p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-VeleroBackup|updatebackup|N\"></span><h2>Back up the suite on AWS​​​​​</h2><p>For AWS deployment, follow the procedures below to back up the suite data in your production environment.</p><p>The table below outlines your backup tasks.</p><table><tbody><tr><th>Task</th><th>Role</th><th>Method</th></tr><tr><td>Kubernetes configurations backup</td><td>Cloud administrator or Kubernetes cluster administrator</td><td>Use <a href=\"/doc/423/26.1/installveleromanagedk8s#Set_up_Velero_for_Managed_Kubernetes\" title=\"Velero\">Velero</a>.</td></tr><tr><td><p>EFS backup</p></td><td>Cloud administrator or storage administrator</td><td>Use <a href=\"https://docs.aws.amazon.com/aws-backup/latest/devguide/creating-a-backup-plan.html\" rel=\"nofollow\" target=\"1\" title=\"AWS Backup\">AWS Backup</a>.</td></tr><tr><td>RDS backup</td><td>Cloud administrator or database administrator</td><td>Use <a href=\"https://docs.aws.amazon.com/aws-backup/latest/devguide/creating-a-backup-plan.html\" rel=\"nofollow\" target=\"1\" title=\"AWS Backup\">AWS Backup</a>.</td></tr></tbody></table><p><strong>Notes:</strong></p><ul><li>For each backup task, you can choose to perform either a manual or automatic backup.</li><li>Schedule the backup tasks based on your business requirements.</li><li>For IAM role option during backup and restore on AWS, always select Default role.</li></ul><h3 id=\"DR2.0documentscope&amp;instructions-backupyourK8Sconfigurations(prerequisiteforCDF/SMAclusterrestoreandk8sclusterrestore)\">Back up the Kubernetes configurations</h3><ol><li><div>Run <code>helm list -n core | grep itom-velero</code> to check if you have Velero enabled. If not enabled, set up Velero on AWS by referring to <a href=\"/doc/423/26.1/installveleromanagedk8s#Set_up_Velero_for_Managed_Kubernetes\" title=\"Set up Velero\">Set up Velero</a>.</div></li><li>Use Velero to back up your Kubernetes configurations. You can choose to back up manually or automatically. To use automatic backup, run <code>./velero --help -n core</code> on the bastion to learn about the command's usage and syntax and then structure it according to your business requirements.\n\t<p>Here is an example of how to back up all Kubernetes configurations of the current environment:</p><pre>./velero backup create &lt;backup.all.example1&gt; --wait -n core </pre><p>You can search your S3 for <strong>backup.all.example1</strong> in the bucket prepared for Velero.</p></li></ol><h3>Back up EFS and RDS</h3><p>For the <strong>first backup</strong>, you can create On-demand backup jobs to separately back up RDS and EFS. By doing this, you can back up your resources instantly. For details, see <a href=\"https://docs.aws.amazon.com/aws-backup/latest/devguide/create-on-demand-backup.html\" title=\"Create an on-demand backup\">Create an on-demand backup</a>.</p><p>For <strong>routine backups</strong>, back up your AWS RDS and EFS data by creating a <a href=\"https://docs.aws.amazon.com/aws-backup/latest/devguide/create-a-scheduled-backup.html\" title=\"scheduled backup plan\">scheduled backup plan</a>.</p><p>You can configure backup rules and resource assignments for both RDS and EFS in the same plan:</p><ul><li>You can configure backup rules according to your backup schedule, backup window, and lifecycle rules.</li><li>You can use resource assignments to specify resources to be backed up by the backup plan. Add your RDS and EFS to the assignments.</li></ul><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><ul><li>Take note of the database's DB identifier. You will need the DB identifier when you <a href=\"/doc/423/26.1/databasedatacorrupted#Restore_RDS_on_AWS\" title=\"restore databases\">restore databases</a> later.</li><li><p>Back up the external databases for the suite on a regular basis to ensure your data is safe. For each database, this normally includes a base backup (full backup) and continuous archiving backups.</p></li></ul></div></div><ul></ul><h2>Back up the suite on Azure</h2><p>For Azure deployment, follow the procedures below to back up the suite data in your production environment.</p><p>The table below outlines your backup tasks.</p><table><tbody><tr><th>Tasks</th><th>Role</th><th>Method</th></tr><tr><td>Kubernetes configurations backup</td><td>Cloud administrator or Kubernetes cluster administrator</td><td>Use <a href=\"/doc/423/26.1/installveleromanagedk8s#Set_up_Velero_for_Managed_Kubernetes\" title=\"Velero\">Velero</a>.</td></tr><tr><td><p>Azure Files backup</p></td><td>Cloud administrator or storage administrator</td><td>Use <a href=\"https://docs.microsoft.com/en-us/azure/backup/backup-afs\" title=\"Azure Backup\">Azure Backup</a>.</td></tr><tr><td>Database backup</td><td>Cloud administrator or database administrator</td><td>Flexible Server automatically performs regular backups of your server. For details, see <a aria-label=\"Link https://docs.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-backup-restore\" href=\"https://docs.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-backup-restore\" rel=\"noopener noreferrer\" tabindex=\"-1\" target=\"_blank\" title=\"https://docs.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-backup-restore\">Backup and restore in Azure Database for PostgreSQL - Flexible Server</a>.</td></tr></tbody></table><p><strong>Notes:</strong></p><ul><li>For each backup task, you can choose to perform either a manual or automatic backup.</li><li>Schedule the backup tasks based on your business requirements.</li></ul><h3 id=\"DR2.0documentscope&amp;instructions-backupyourK8Sconfigurations(prerequisiteforCDF/SMAclusterrestoreandk8sclusterrestore)\">Back up the Kubernetes configurations</h3><ol><li>Run <code>helm list -n core | grep itom-velero</code> to check if you have Velero enabled. If not enabled, set up Velero on Azure by referring to <a href=\"/doc/423/26.1/installveleromanagedk8s#Set_up_Velero_for_Managed_Kubernetes\" title=\"Set up Velero\">Set up Velero</a>.</li><li>Use Velero to back up your Kubernetes configurations. You can choose to back up manually or automatically. To use automatic backup, run <code>./velero --help -n core</code> on the bastion to learn about the command's usage and syntax and then structure it according to your business requirements.\n\t<p>Here is an example of how to back up all Kubernetes configurations of the current environment:</p><pre>./velero backup create &lt;backup.all.example1&gt; --wait -n core </pre><p>You can check your storage account for <strong>backup.all.example1</strong> in the blob prepared for Velero.</p></li></ol><h3 id=\"DR2.0documentscope&amp;instructions-backupyourRDS(prerequisiteforRDSrestore)andEFS(prerequisiteforEFSrestore)\">Back up the storage</h3><div class=\"admonition\"><div class=\"admonition-icon admonition-tip-icon\"></div><div class=\"admonition-content admonition-tip-content\"><strong>Note</strong> If you use Azure NetApp Files as the storage service, refer to <a href=\"https://docs.microsoft.com/en-gb/azure/azure-netapp-files/\" title=\"Azure's NetApp Files documentation\">Azure's NetApp Files documentation</a> for the backup and restore solution.</div></div><p>If you deployed the suite using Azure Files &amp; Azure Disks, your suite stores the Smart Analytics and RabbitMQ data using Azure Disks and all the other data using Azure file shares. We recommend that you back up your <strong>Azure Files</strong> storage using <a href=\"https://docs.microsoft.com/en-us/azure/backup/backup-afs\" title=\"Azure Backup\">Azure Backup</a>, in which case you need to <a href=\"https://docs.microsoft.com/en-us/azure/storage/files/storage-files-enable-soft-delete?tabs=azure-portal\" title=\"enable soft delete on Azure file shares\">enable soft delete on Azure file shares</a> to avoid accidental permanent deletion. The <strong>Azure Disks</strong> storage won't be backed up and you need to perform a full reindex to make sure your suite works properly after restore (see details at <a href=\"/doc/423/26.1/storagedatacorrupted#Restore_storage_on_Azure\" title=\"Restore storage on Azure\">Restore storage on Azure</a>).</p><h3>Back up the database</h3><p>On Azure, SMA currently only supports Azure Flexible Server, which automatically performs regular backups of your server. For details, see <a href=\"https://docs.microsoft.com/en-us/azure/postgresql/flexible-server/concepts-backup-restore\" title=\"Backup and restore in Azure Database for PostgreSQL - Flexible Server\">Backup and restore in Azure Database for PostgreSQL - Flexible Server</a>.</p><h2>Back up the suite on GCP</h2><p>For GCP deployment, follow the procedures below to back up the suite data in your production environment.</p><p>The table below outlines your backup tasks.</p><table><tbody><tr><th>Tasks</th><th>Role</th><th>Method</th></tr><tr><td>Kubernetes configurations backup</td><td>Cloud administrator or Kubernetes cluster administrator</td><td>Use <a href=\"/doc/423/26.1/installveleromanagedk8s#Set_up_Velero_for_Managed_Kubernetes\" title=\"Velero\">Velero</a>.</td></tr><tr><td><p>Filestore backup</p></td><td>Cloud administrator or storage administrator</td><td><p>Use <a href=\"https://cloud.google.com/filestore/docs/backup-restore?authuser=1#backing_up_a_file_share\" title=\"GCP Filestore backup\">GCP Filestore backup</a>.</p></td></tr><tr><td>Database backup</td><td>Cloud administrator or database administrator</td><td>Use <a href=\"https://cloud.google.com/sql/docs/mysql/backup-recovery/backups\" title=\"GCP backup for Cloud SQL\">GCP backup for Cloud SQL</a>.</td></tr></tbody></table><p><strong>Notes:</strong></p><ul><li>For each backup task, you can choose to perform either a manual or automatic backup.</li><li>Schedule the backup tasks based on your business requirements.</li></ul><h3 id=\"DR2.0documentscope&amp;instructions-backupyourK8Sconfigurations(prerequisiteforCDF/SMAclusterrestoreandk8sclusterrestore)\">Back up the Kubernetes configurations</h3><ol><li>Run <code>helm list -n core | grep itom-velero</code> to check if you have Velero enabled. If not enabled, set up Velero on GCP by referring to <a href=\"/doc/423/26.1/installveleromanagedk8s#Set_up_Velero_for_Managed_Kubernetes\" title=\"Set up Velero\">Set up Velero</a>.</li><li>Use Velero to back up your Kubernetes configurations. You can choose to back up manually or automatically. To use automatic backup, run <code>./velero -help -n core</code> on the bastion to learn about the command's usage and syntax and then structure it according to your business requirements.\n\t<p>Here is an example of how to back up all Kubernetes configurations of the current environment:</p><pre>./velero backup create &lt;backup.all.example1&gt; --wait -n core</pre><p>You can check for <strong>backup.all.example1 </strong>in the bucket prepared for Velero in your GCS bucket.</p></li></ol><h3>Back up the storage</h3><p>You can back up GCP Filestore using the cloud-native services provided by GCP. See <a href=\"https://cloud.google.com/filestore/docs/backup-restore?authuser=1#backing_up_a_file_share\" title=\"Google's official document\">Google's official document</a> for detailed steps. Remember to choose the same region as the source file share for the <strong>Region</strong> field.</p><h3 id=\"DR2.0documentscope&amp;instructions-backupyourRDS(prerequisiteforRDSrestore)andEFS(prerequisiteforEFSrestore)\">Back up the database</h3><p>For GCP PostgreSQL, we recommend that you use the GCP-native backup function. You can schedule automated backups or create an on-demand backup according to your requirements. Check <a href=\"https://cloud.google.com/filestore/docs/backup-restore?authuser=1#backing_up_a_file_share\" title=\"Google's official document About Cloud SQL backups\">Google's official document About Cloud SQL backups</a> to customize your backup plan.</p><h2>Back up the suite on OpenShift</h2><p>Before you begin, make sure that you have <a href=\"/doc/423/26.1/installveleromanagedk8s#Set_up_Velero_for_Managed_Kubernetes\" title=\"set up Velero on OpenShift\">set up Velero on OpenShift</a>.</p><h3>Back up the Kubernetes configurations</h3><p>You can back up manually or automatically. Run <code>./velero --help -n core</code> on the bastion node to get help information about the Velero command usage and syntax. You can use appropriate commands from the result according to your business needs.</p><p>The following are example steps to back up your files:</p><ol><li>Repeat the following command for the suite namespace and core namespace:\n\t<pre>velero backup create &lt;backup name&gt; --include-namespaces &lt;namespace&gt; --wait -n core </pre><p> For example:</p><pre>velero backup create itsma-backup --include-namespaces itsma-fghnd  --wait -n core \nvelero backup create core-backup --include-namespaces core  --wait -n core </pre></li><li>Find the backup files on the NFS server. We recommend that you move the backup files to a safe place.</li></ol><h3>Back up the storage</h3><p>Plan and schedule your NFS storage backup tasks according to your business needs. For details, see your storage product documentation.</p><h3 id=\"DR2.0documentscope&amp;instructions-backupyourRDS(prerequisiteforRDSrestore)andEFS(prerequisiteforEFSrestore)\">Back up the databases</h3><p>You can schedule automated backups or create an on-demand backup according to your requirements. For details, refer to your database documentation.</p><h2>Back up the suite on embedded kubernetes</h2><p>OMT uses Velero tool for back up, Velero comes pre-installed on embedded Kubernetes as a capability.</p><p>The suite installation process will generate a Velero master key, you will need this key to restore your system in case of any disaster.</p><h3>Back up Velero master key</h3><p>Use the following command in the source system to get the Velero master key.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\">Be sure to securely store your Velero master key. You will need it to restore your system, and you won't be able to get it if your source system is no longer reachable.</div></div><pre>helm get values itom-velero -n core -o json | jq .cloudserver.deployment.masterKey</pre><h3>Back up the Kubernetes configurations</h3><p>By default, OMT uses Velero to automatically back up your Kubernetes configurations during a scheduled routine backup. </p><p>We replaced MinIO with Zenko CloudServer as the internal S3 storage server used by Velero. If you've installed a previous OMT with Kubernetes capabilities enabled on the environment, upgrading to the latest release will remove the MinIO artifacts. For steps on how to recover your MinIO artifacts, see <a href=\"/doc/423/26.1/installveleromanagedk8s#Get_MinIO_backups_after_upgrade_to_CloudServer\" title=\"Get MinIO backups after upgrade to CloudServer\">Get MinIO backups after upgrade to CloudServer</a>.</p><p>If you would like to manually back up your Kubernetes configurations, use the following steps to backup your files.</p><ol><li>Run <code>helm list -n core | grep itom-velero</code> to check if you have Velero enabled. If not enabled, set up Velero on by referring to <a href=\"/doc/423/26.1/installveleromanagedk8s#Set_up_Velero_on_Embedded_Kubernetes\" title=\"Set up Velero\">Set up Velero</a>.</li><li>Use Velero to back up your Kubernetes configurations. You can choose to back up manually or automatically. To use automatic backup, run <code>./velero --help </code>on the bastion to learn about the command's usage and syntax and then structure it according to your business requirements.\n\t<p> For example:</p><pre>./velero backup create &lt;backup.all.example1&gt; --wait -n core </pre><p>You can run the following command to check the status of the backup. Make sure the status of the backup is <strong>Completed</strong>.</p><pre>velero get backup -n core </pre><p>You can locate your backup files (backup.all.example1) on the nfs server in<strong> </strong><strong>/var/vols/itom/core/cloudserver</strong>.</p></li></ol><h3>Back up NFS and Database</h3><p>Use any file copying tool to backup your <a href=\"/doc/423/26.1/confignfsshareshelm#NFS_volumes_required_for_the_suite\" title=\"NFS volumes required for the suite\">NFS volumes required for the suite</a>.</p><p>Follow the official PostgreSQL documentation to backup the <a href=\"/doc/423/26.1/prepareexternaldbs#Check_your_database_instance_for_duplicate_database_names\" title=\"database required for the suite\">database required for the suite</a>. Furthermore, you can use <a href=\"/doc/423/26.1/selfmanagedpgbackuprestore\" title=\"Self-managed PostgreSQL backup and restore\">Self-managed PostgreSQL backup and restore</a> for reference.</p></div><p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}