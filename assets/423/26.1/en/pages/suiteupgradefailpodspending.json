{
  "title": "Suite upgrade fails and the suite pod stays in a Pending state",
  "content": "<div class=\"mw-parser-output\"><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-SuiteUpgradeFailPodsPending||N\"></span><p class=\"mw-empty-elt\">\n</p><p>When you try to upgrade a suite, the suite upgrade pod stays in the Pending state. Additionally, you may notice that some volumes are missing from the environment.</p>\n<h2>Cause</h2>\n<p>This issue occurs because an unknown service deletes the volumes.</p>\n<h2>Solution</h2>\n<ol>\n<li>Copy the following text to a file and name it <strong>volumes.json</strong>. Update the placeholders with the actual values.\n\n\t<pre><code>[{\n\"volume_name\": &lt;the volume name&gt;\n\"nfs_server\": &lt;the NFS server IP/host to create the PV&gt;\n\"nfs_path\": &lt;the path to the NFS server to create the PV&gt;\n\"storage_class\": &lt;the storage class name&gt;\n\"storage_capability\": &lt;the storage capability of the volume&gt;\n}]</code></pre>\n<p> <br/>\n\tFor example: \n</p>\n<pre><code>[{\n\"volume_name\":\"demo1\",\n\"nfs_server\":\"16.111.xxx.xxx\",\n\"nfs_path\":\"/var/vols/itom/demo1\",\n\"storage_class\":\"cdf-default\",\n\"storage_capability\":\"1Mi\"\n},{\n\"volume_name\":\"demo2\",\n\"nfs_server\":\"16.111.xxx.xxx\",\n\"nfs_path\":\"/var/vols/itom/demo2\",\n\"storage_class\":\"cdf-default\",\n\"storage_capability\":\"1Mi\"\n}]</code></pre>\n</li>\n<li>Run the following command to change the permission of the file:\n\t<pre><code>chmod 744 volumes.json</code></pre>\n</li>\n<li>Copy the following text to a file and name it <strong>createVolumes.sh</strong>:\n\t<pre><code>#!/bin/bash\nusage() {\n  echo \"Usage: ./createVolumes.sh --config &lt;volumes.json&gt; --namespace &lt;namespace&gt;  create all volumes in volumes.json\"\n  exit 1\n}\nwhile [[ ! -z $1 ]]; do\n  case \"$1\" in\n  --config)\n    case \"$2\" in\n    -*)\n      echo \"--config parameter requires a value.\"\n      exit 1\n      ;;\n    *)\n      if [ -z $2 ]; then\n        echo \"--config parameter requires a value.\"\n        exit 1\n      fi\n      VOLUMES_CONFIG_JSON=$2\n      shift 2\n      ;;\n    esac\n    ;;\n  --namespace)\n    case \"$2\" in\n    -*)\n      echo \"--namespace parameter requires a value.\"\n      exit 1\n      ;;\n    *)\n      if [ -z $2 ]; then\n        echo \"--namespace parameter requires a value.\"\n        exit 1\n      fi\n      SUITE_NAMESPACE=$2\n      shift 2\n      ;;\n    esac\n    ;;\n  * | -* | -h | --help | /? | help) usage ;;\n  esac\ndone\ncreateVolumes() {\n  echo \"*****************************\"\n  echo \"Start to create volumes, namespace: ${SUITE_NAMESPACE}\"\n  echo \"*****************************\"\n  local volumes=$(cat $VOLUMES_CONFIG_JSON | jq -c '.[]' 2&gt;/dev/null|xargs -d '\\n')\n  for volume in ${volumes[@]}; do\n    local volume_name=\"$(echo $volume | jq -r '.volume_name')\"\n    local pvName=${SUITE_NAMESPACE}'-'${volume_name}\n    echo \"Start: create PVC ${volume_name} and PV ${pvName}\"\n    local nfs_server=\"$(echo $volume | jq -r '.nfs_server')\"\n    local nfs_path=\"$(echo $volume | jq -r '.nfs_path')\"\n    local storage_class=\"$(echo $volume | jq -r '.storage_class')\"\n    local storage_capability=\"$(echo $volume | jq -r '.storage_capability')\"\n    echo \"&gt;&gt;&gt;&gt;&gt;nfs_server:${nfs_server}, nfs_path:${nfs_path}, storage_class:${storage_class}, storage_capability:${storage_capability}\"\n    local pv_pvc_label=$(cat /dev/urandom | tr -cd \"[:alnum:]\" | head -c 5)\n    echo \"\nkind: PersistentVolume\napiVersion: v1\nmetadata:\n  name: ${pvName}\n  labels:\n    pv_pvc_label: ${pv_pvc_label}\n  annotations:\n    status: \"\"\n    message: \"\"\nspec:\n  capacity:\n    storage: ${storage_capability}\n  accessModes:\n    - ReadWriteMany\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: ${storage_class}\n  nfs:\n    path: ${nfs_path}\n    server: ${nfs_server}\n---\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: ${volume_name}\n  namespace: ${SUITE_NAMESPACE}\n  labels:\n    pv_pvc_label: ${pv_pvc_label}\n  annotations:\n    status: \"\"\n    message: \"\"\nspec:\n  accessModes:\n    - ReadWriteMany\n  storageClassName: ${storage_class}\n  resources:\n    requests:\n      storage: ${storage_capability}\n  selector:\n    matchLabels:\n      pv_pvc_label: ${pv_pvc_label}\" | kubectl create --validate=false -f -\n    echo \"End: create PVC ${volume_name} and PV ${pvName}\"\n  done\n}\ncreateVolumes</code></pre>\n</li>\n<li>Run the following command to change the permission of the file: \n\t<pre><code>chmod 744 createVolumes.sh</code></pre>\n</li>\n<li>Run the following command to execute the script:\n\t<pre><code>./createVolumes.sh --config volumes.json --namespace &lt;namespace&gt;</code></pre>\n</li>\n</ol>\n<p><br/>\n</p>\n<p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-SuiteUpgradeFailPodsPending||N\"></span></div>",
  "modifiedon": "2025-10-24 08:51:12"
}