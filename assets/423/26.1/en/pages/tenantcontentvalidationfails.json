{
  "title": "Tenant content validation fails",
  "content": "<div class=\"mw-parser-output\"><br/><p>Before the version update process starts, the tenant content precheck validates out-of-the-box workflows and forms in the suite environment to ensure metadata integrity. This validation may fail.</p>\n<h2 class=\"mw-headline\" id=\"Possible_causes\">Possible causes</h2>\n<ul>\n<li>Cause 1: The content validation job in the database is still in Running status.</li>\n<li>Cause 2: A timeout error occurs.</li>\n<li>Cause 3: Dirty data is detected.</li>\n<li>Cause 4: Incomplete or inconsistent data is detected.</li>\n</ul>\n<h2 class=\"mw-headline\" id=\"Solutions\">Solutions</h2>\n<p>The first step is to get the content validation report. You can do this by clicking <strong>Show Report</strong> on the upgrade UI.  If, for some reason, you are unable to get the report from the UI, you can get it using the API.</p>\n<p>Complete the following steps to get the validation report using the API.</p>\n<ol>\n<li>Run the following command to get the content verification jobId from the log:\n\t<pre><code>cat maas_upg_verification.log |grep \"Content Validation Job ended! JobId: \"</code></pre>\n\tThe command output contains the job ID. The output resembles the following example:<br/>\n<strong>Id=\"4b4f3925-c195-4ead-bd0f-8044e48d1334\"</strong></li>\n<li>Run the following commands to log in to content validation pods:\n\t<pre><code>ns=`kubectl get ns |grep itsma |awk '{print $1}'`\ncontent_validation_pod_name=`kubectl get pods -n ${ns} |grep itom-xruntime-content-validation |awk '{print $1}'`\nkubectl exec ${content_validation_pod_name} -n ${ns} -c itom-xruntime-content-validation -it bash</code></pre>\n</li>\n<li>In the following command, replace the <b>\"id=\"4b4f3925-c195-4ead-bd0f-8044e48d1334\"</b> with the job ID returned in step 1, and run the command in the pods:\n\t<pre><code>url=\"https://itom-xruntime-gateway-content-validation-svc:8443\"\nid=\"4b4f3925-c195-4ead-bd0f-8044e48d1334\"</code></pre>\n</li>\n<li>Run the following commands to get the <strong>bo_integreation_password</strong>:\n\t<pre><code>bo_integration_password=`get_secret \"bo_integration_password_secret_key\" \"itom-bo\" | awk -F \"=\" '{print $2}'`\necho  bo_integration_password:$bo_integration_password</code></pre>\n</li>\n<li>Run the following commands to get the token:\n\t<pre><code>LWSSO_TOKEN=`curl -k --header \"Content-Type: application/json\" --request POST --data '{\"login\":\"bo-integration@dummy.com\",\"password\":\"'${bo_integration_password}'\"}' \n${url}/auth/authentication-endpoint/authenticate/login?TENANTID=857561481`\necho LWSSO_TOKEN:$LWSSO_TOKEN</code></pre>\n</li>\n<li>Run the following command to generate the content validation report and save it to <strong>contentValidation-${id}-report.json</strong> file:\n\t<pre><code>curl -k --header 'Cookie: 'LWSSO_COOKIE_KEY=${LWSSO_TOKEN}'' --request GET ${url}/rest/857561481/content-validation/get-content-validation-summary/${id} &gt; contentValidation-${id}-report.json</code></pre>\n</li>\n<li>If there are any failures reported in the <strong>contentValidation-${id}-report.json</strong> file,  run the following command to get the failure details:\n\t<pre><code>detailUrl=$(cat contentValidation-${id}-report.json|jq .link.hyperlink -r)\ncurl -k --header 'Cookie: 'LWSSO_COOKIE_KEY=${LWSSO_TOKEN}'' --request GET ${detailUrl}</code></pre>\n</li>\n</ol>\n<h2 class=\"mw-headline\">Solutions (helm deployment)</h2>\n<p>The first step is to get the content validation report. </p>\n<ol>\n<li>Run the following command to get the content verification job ID from the log:\n\t<pre><code>cat maas_upg_verification.log |grep \"Content Validation Job ended! JobId: \"</code></pre>\n\tThe command output contains the job ID. The output resembles the following example:<br/>\n<strong>Id=\"4b4f3925-c195-4ead-bd0f-8044e48d1334\"</strong></li>\n<li>Run the following commands to check logs:\n\t<pre><code>cat [logging-volume]/xservices/content-validation/contentValidation-${jobId}-detail.json\ncat [logging-volume]/xservices/content-validation/contentValidation-${jobId}-report.json</code></pre>\n</li>\n</ol>\n<p>The following are the solutions for the example root causes listed. </p>\n<h3>Solution for cause 1</h3>\n<p>Perform the following steps:</p>\n<ol>\n<li>Connect to the <strong>xservices_rms</strong> database on your PostgreSQL server.</li>\n<li>Check the <strong>ContentValidationJobResult_857561481</strong> table for a validation job record that's still in Running status. The following is an example:\n\t<pre><code>{\n\n \"id\": \"5d512d1ce4b063e594c86ecb\",\n\n \"name\": \"Service Management Content Validation\",\n\n \"jobId\": \"5f2ab87b-807b-4f95-9b97-18af37fac158\",\n\n \"status\": \"Running\",\n\n \"endDate\": 1565601279731,\n\n \"startDate\": 1565601052558\n\n}</code></pre>\n</li>\n<li>Change the job status from <strong>Running</strong> to <strong>Done</strong>. For example:\n\t<pre><code>{\n\n \"id\": \"5d512d1ce4b063e594c86ecb\",\n\n \"name\": \"Service Management Content Validation\",\n\n \"jobId\": \"5f2ab87b-807b-4f95-9b97-18af37fac158\",\n\n \"status\": \"Done\",\n\n \"endDate\": 1565601279731,\n\n \"startDate\": 1565601052558\n\n}</code></pre>\n</li>\n</ol>\n<h3>Solution for cause 2</h3>\n<p>If a timeout occurs, you can configure the following settings for the content validation job. </p>\n<div class=\"admonition\">\n<div class=\"admonition-icon admonition-tip-icon\"> </div>\n<div class=\"admonition-content admonition-tip-content\">For your reference only, according to lab tests based on the default values for the following settings, the content validation job takes about 20 minutes to complete for 50 tenants and about 40 minutes for 100 tenants. </div>\n</div>\n<h4>Number of threads</h4>\n<p>By default, the content validation job processes four tenants in parallel. You can configure this setting as follows.</p>\n<ol>\n<li>Run the following command on a control plane node or the bastion node:\n\t<pre><code>kubectl edit cm -n &lt;suite namespace&gt; itom-xruntime-infra-config</code></pre>\n</li>\n<li>Add the following setting or edit it if it already exists.Tthe default value of 4 is used as an example here:\n\t<pre><code>PLATFORM_CONTENT_VERIFICATION_CORE_MAX_THREAD_NUMBER: \"4\"</code></pre>\n</li>\n<li>Restart the content validation pods:\n\t<pre><code>kubectl delete pod itom-xruntime-content-validation-xxxxxxxx -n &lt;suite namespace&gt;\nkubectl delete pod itom-xruntime-gateway-content-validation-xxxxxxx -n &lt;suite namespace&gt;</code></pre>\n</li>\n</ol>\n<h4>Content validation job timeout</h4>\n<p>By default, the content validation job fails if it's not completed within 120 minutes. You can configure this timeout value as follows. </p>\n<ol>\n<li><span id=\"cke_bm_17214S\" style=\"display: none;\"> </span>Run the following command on a control plane node or the bastion node:\n\n\t<pre><code>kubectl edit cm -n &lt;suite namespace&gt; itom-xruntime-infra-config</code></pre>\n</li>\n<li>Add the following setting or edit it if it already exists (the default value of 120 minutes is used as an example):\n\t<pre><code>PLATFORM_CONTENT_VERIFICATION_TIMEOUT_IN_MINUTE: \"120\"</code></pre>\n</li>\n<li>Restart the content validation pods:\n\t<pre><code>kubectl delete pod itom-xruntime-content-validation-xxxxxxxx -n &lt;suite namespace&gt;\nkubectl delete pod itom-xruntime-gateway-content-validation-xxxxxxx -n &lt;suite namespace&gt;</code></pre>\n</li>\n</ol>\n<h4><span id=\"cke_bm_5214S\" style=\"display: none;\"> </span>Content validation job timeout (helm deployment)</h4>\n<p>By default, the content validation job fails if it's not completed within 120 minutes. You can configure this timeout value as follows. </p>\n<ol>\n<li><span id=\"cke_bm_17214S\" style=\"display: none;\"> </span>Run the following command on a control plane node or the bastion node:\n\n\t<pre><code>kubectl edit cm -n &lt;suite namespace&gt; itom-xruntime-infra-config</code></pre>\n</li>\n<li>Add the following setting or edit it if it already exists (the default value of 120 minutes is used as an example):\n\t<pre><code>PLATFORM_CONTENT_VERIFICATION_TIMEOUT_IN_MINUTE: \"120\"</code></pre>\n</li>\n<li>Restart the content validation pods, change to the <strong>ESM_Helm_Chart-2x.x.x/scripts/precheck</strong> directory. The default value of the <strong>timeout_value</strong> parameter is also two hours.</li>\n<li>Run the following commands:\n\t<pre><code>chmod u+x checkContent.sh\nnohup ./checkContent.sh -t &lt;timeout_value&gt; &amp;</code></pre>\n</li>\n</ol>\n<h3>Solution for cause 3</h3>\n<p>One major purpose of the content precheck is to capture dirty data left by earlier version updates. The content precheck will report an error if dirty data is detected.</p>\n<p>The following table describes example dirty data errors.</p>\n<table>\n<tbody>\n<tr>\n<th>Tenant Id </th>\n<th>Content Type </th>\n<th>Error </th>\n</tr>\n<tr>\n<td>xxxxxxxxx</td>\n<td>Form </td>\n<td>Form-&gt;formsContentVerificationStep:Failed to validate form new for entity Agreement for formId 5b35ce2ee4b0a7ef6837a320 . Error:The field \"RequestTargetSet\" is hidden and cannot be presented in the form. {} </td>\n</tr>\n<tr>\n<td>xxxxxxxxx</td>\n<td>Form </td>\n<td>Form-&gt;formsContentVerificationStep:Failed to validate form defaultTargetSets for entity Agreement for formId 5b35ce2ee4b0a7ef6837a33b . Error:The field \"RequestTargetSet\" is hidden and cannot be presented in the form. {} </td>\n</tr>\n<tr>\n<td>xxxxxxxxx</td>\n<td>Form </td>\n<td>Form-&gt;formsContentVerificationStep:Failed to validate form full for entity Agreement for formId 5b35ce2ee4b0a7ef6837a353 . Error:The field \"RequestTargetSet\" is hidden and cannot be presented in the form. {} </td>\n</tr>\n<tr>\n<td>xxxxxxxxx</td>\n<td>Form </td>\n<td>Form-&gt;formsContentVerificationStep:Failed to validate form preview for entity Agreement for formId 5b35ce2ee4b0a7ef6837a3d0 . Error:The field \"IncidentTargetSet\" is hidden and cannot be presented in the form. {} </td>\n</tr>\n</tbody>\n</table>\n<p>To resolve the error in this example, navigate to <b>Administration</b> &gt; <b>Configuration</b> &gt; <b>Studio</b> &gt; <b>Forms</b> in tenant xxxxxxxxx, and then edit the following forms:</p>\n<ul>\n<li>Entity type: Agreement  </li>\n<li>Forms: Full Agreement, New Agreement, defaultTargetSets, and Preview Agreement </li>\n</ul>\n<p>For steps to recreate a <b>Target </b><b>sets</b> section (Record type: Agreement), see <a href=\"/doc/423/2018.05/upgrade_the_service_management_applications\" title=\"SMAX:2018.05/Upgrade-the-Service-Management-applications\">Update forms</a> in v2018.05 documentation. The same steps apply for the <strong>Target</strong> <strong>Set entity type</strong> if related errors are reported in the CSV file. </p>\n<h3 class=\"mw-headline\" id=\"Solution_for_cause_2\">Solution for cause 4</h3>\n<p>Another major purpose of the content precheck is to capture metadata loss or inconsistency that may be caused by any kinds of exceptions (for example, disk-full, out-of-memory, or power outage). The following are examples of typical metadata errors. </p>\n<h4 class=\"mw-headline\" id=\"Workflow_error_1:_Rule_definition_ID_is_null\">Workflow error 1: Rule definition ID is null</h4>\n<table>\n<tbody>\n<tr>\n<th>Tenant Id </th>\n<th>Content Type </th>\n<th>Error </th>\n</tr>\n<tr>\n<td>xxxxxxxxx</td>\n<td>Workflow </td>\n<td>Error verifying workflow for entity type '''SampleWorkflowUpgradeEntityWithROChanges''' failed with exception: null key in entry: null={id='null', template='setField', shared=true', isReadOnly=false', parameters={targetFieldName=targetFieldName=ParameterValueImpl{value=Description}, value=value=ParameterValueImpl{value=Desc}}, lastUpdatedInVersion=0} </td>\n</tr>\n</tbody>\n</table>\n<p><b>Root Cause</b>: Rule Definition ID is null in the workflow record. </p>\n<p><b>Solution</b>:</p>\n<ol>\n<li>Get the access token with tenant admin permission by using the <strong>Post</strong> REST URI. Make a note of the access token returned.<br/>\n<code>{protocol}://{host}:{port}/auth/authentication-endpoint/authenticate/login?TENANTID={tenantId}</code><br/>\n<br/>\n\tSee the following example of the<strong> </strong>request body:\n\n\t<pre>{ \n \"login\":\"{UserName}\", \n \"password\":\"{Password}\" \n} \n</pre>\n\tNote: By default, the protocol is https, and the port is 443.</li>\n<li>Get the workflow of the entity type <strong>\"SampleWorkflowUpgradeEntityWithROChanges\"</strong> by using the <strong>GET workflow </strong>REST URI:<br/>\n<code>{Protocol}://{host}:{port}/rest/{tenantId}/workflow/full/{entity type}</code>\n<ol start=\"1\">\n<li>Set the header of the rest call:\n\t\t<ul>\n<li>Cookie=LWSSO_COOKIE_KEY={access token}<br/>\n\t\t\tReplace {access token} with the access token that you obtained in step 1.</li>\n<li>Content-Type=application/json</li>\n</ul>\n</li>\n<li>In this example, the error message indicates that the <strong>Description</strong> field missing an id. Go through all processes defined in the workflow, get all <b>RuleIDs</b> that are used in Event Handlers, and see which <strong>RuleID</strong> is missing in the Rule definition section. Compare the context, and add the missing ID.</li>\n<li>The problematic part of the returned workflow is shown below. Set the id to \"<strong>set-Description1</strong>\" by using this format \"id\":\"set-Description1\"\n\t\t<pre>\"RuleDefinitions\": [{ \n\"LastUpdatedInVersion\": 0, \n\"Type\": \"action\", \n//\"id\":\"set-Description1\" is missing for 1st rule definition \n\"Parameters\": [{ \n\"Name\": \"targetFieldName\", \n\"Value\": \"Description\" \n}, \n{ \n\"Name\": \"value\", \n\"Value\": \"Desc\" \n}], \n\"TemplateId\": \"setField\" \n}, \n{ \n\"LastUpdatedInVersion\": 0, \n\"Type\": \"condition\", \n\"id\": \"condition1Updated2\", //id exists for 2nd rule definition \n… \n}, \n</pre>\n</li>\n</ol>\n</li>\n<li>Update the workflow of the entity type <strong>SampleWorkflowUpgradeEntityWithROChanges</strong> by using the <strong>POST workflow</strong> REST URI:<br/>\n<code>{protocol}://{host}:{port}/rest/{tenantId}/workflow/update</code><br/>\n<br/>\n\tSee the following example of the<strong> </strong>request body:\n\t<pre> { \n\"EntityType\": \"SampleWorkflowUpgradeEntityWithROChanges\", \n\"ProcessSelectionField\": \"Urgency\", \n\"DefaultProcessId\": \"ProcessUrgent\", \n\"IsReadOnly\": false, \n\"IsLockAddProcess\": false, \n\"RuleDefinitions\": [ \n{ \n\"LastUpdatedInVersion\": 0, \n\"Type\": \"action\", \n\"id\": \"set-Description1\" \n\"Parameters\": [{ \n\"Name\": \"targetFieldName\", \n\"Value\": \"Description\" \n}, \n{ \n\"Name\": \"value\", \n\"Value\": \"Desc\" \n}], \n\"TemplateId\": \"setField\" \n},…….. \n</pre>\n\tNote: set the same header for the REST URI as in step 2a.</li>\n</ol>\n<h4 class=\"mw-headline\" id=\"Workflow_error_2:_Illegal_rule_definition_type\">Workflow error 2: Illegal rule definition type</h4>\n<table>\n<tbody>\n<tr>\n<th>Tenant Id </th>\n<th>Content Type </th>\n<th>Warning </th>\n<th>Error </th>\n</tr>\n<tr>\n<td>xxxxxxxxx</td>\n<td>Workflow </td>\n<td>  </td>\n<td>Error verifying workflow for entity type Task failed with exception: null </td>\n</tr>\n</tbody>\n</table>\n<p><b>Root Cause</b>: A Rule Definition “Type” value is illegal. That is, it's not one of values in the legal set {“validation”,”action”,”condition”,”rendering”,”cascading”}.</p>\n<p><b>Solution</b>:</p>\n<ol>\n<li>Get the access token with tenant admin permission by using the <strong>Post</strong> REST URI:<br/>\n<code>{protocol}://{host}:{port}/auth/authentication-endpoint/authenticate/login?TENANTID={tenantId}</code><br/>\n<br/>\n\tSee the following example of the<strong> </strong>request body:\n\n\t<pre>{ \n\n \"login\":\"{UserName}\", \n\n \"password\":\"{Password}\" \n\n} \n</pre>\n</li>\n<li>Get the workflow of the entity type <strong>Task</strong> by using the <strong>GET workflow</strong> REST URI:<br/>\n<code>{Protocol}://{host}:{port}/rest/{tenantId}/workflow/full/{entity type}</code>\n<ol start=\"1\">\n<li>Set the header of the rest call:\n\t\t<ul>\n<li>Cookie=LWSSO_COOKIE_KEY={access token}<br/>\n\t\t\tReplace {access token} with the access token that you obtained in step 1.</li>\n<li>Content-Type=application/json</li>\n</ul>\n</li>\n<li>In the following example, the error message indicates that the entity type <strong>Task</strong> failed with exception: null in workflow.  Analysis of the returned <strong>Task</strong> <strong>workflow</strong> body, revealed that the issue was due to an illegal <strong>Type</strong> value in the workflow.  The expected <strong>Type</strong> values are <strong>validation</strong>, <strong>action</strong>, <strong>condition</strong>, <strong>rendering</strong>, and <strong>cascading</strong> as shown below.\n\t\t<pre> \n\n \"RuleDefinitions\": [{ \n\n                              \"LastUpdatedInVersion\": 0, \n\n                              \"Type\": \"XXX\",   //Must be one of values of {“validation”,”action”,”condition”,”rendering”,”cascading”} \n\n                              \"id\": \"sendManualPendingReview\", \n\n                              \"Parameters\": [{ \n\n                                             \"Values\": [], \n\n                                             \"Name\": \"templateParameters\" \n\n                              }, \n\n                … \n\n ] \n\n               }, \n\n               … \n\n               ] \n\n</pre>\n</li>\n</ol>\n</li>\n<li>Update the workflow of the entity type <strong>Task</strong> by using the <strong>POST workflow</strong> REST URI:<br/>\n<code>{protocol}://{host}:{port}/rest/{tenantId}/workflow/update</code><br/>\n<br/>\n\tYou must set the same header for the REST URI as in step 2a. See the following example of the<strong> </strong>request body:\n\t<pre> { \n\n\"EntityType\": \"Task\", \n\n\"ProcessSelectionField\": \"PlatformTaskType\", \n\n\"DefaultProcessId\": \"ManualTaskProcess\", \n\n\"IsReadOnly\": false, \n\n\"IsLockAddProcess\": true, \n\n\"RuleDefinitions\": [{ \n\n \"LastUpdatedInVersion\": 0, \n\n                              \"Type\": \"action\",   \n\n                              \"id\": \"sendManualPendingReview\", \n\n                              \"Parameters\": [{ \n\n                                             \"Values\": [], \n\n                                             \"Name\": \"templateParameters\" \n\n                              }, \n\n                … \n\n ] \n\n               }, \n\n               … \n\n               ] \n\n……. \n\n} \n\n</pre>\n</li>\n</ol>\n<h4 class=\"mw-headline\" id=\"Form_error_1:_Missing_localization_reference\">Form error 1: Missing localization reference </h4>\n<table>\n<tbody>\n<tr>\n<th>Tenant Id </th>\n<th>Content Type </th>\n<th>Warning </th>\n<th>Error </th>\n</tr>\n<tr>\n<td>xxxxxxxxx</td>\n<td>Form </td>\n<td>  </td>\n<td>Form-&gt;formsContentVerificationStep:Failed to validate form cartRequest for entity Request for formId 5b7142d0e4b0982e5c5ffa75 . Error:The section \"\"CartDetails\"\" is missing localization. {} </td>\n</tr>\n</tbody>\n</table>\n<p><b>Root Cause</b>: The localization field “resourceKey” is null or empty in the “section” field in the form record. </p>\n<p><b>Solution</b>: </p>\n<ol>\n<li>Get the access token with tenant admin permission by using the <strong>Post</strong> REST URI:<br/>\n<code>{protocol}://{host}:{port}/auth/authentication-endpoint/authenticate/login?TENANTID={tenantId}</code><br/>\n<br/>\n\tSee the following example of the<strong> </strong>request body:\n\n\t<pre>{ \n\n \"login\":\"{UserName}\", \n\n \"password\":\"{Password}\" \n\n} \n</pre>\n</li>\n<li>Get the form layout of the entity type \"<strong>Request</strong>\" by using the <strong>GET</strong> <strong>form layout</strong> REST URI:<br/>\n<code>{Protocol}://{host}:{port}/rest/{tenantId}/forms/{entity type}</code>\n<ol start=\"1\">\n<li>Set the header of the rest call:\n\t\t<ul>\n<li>Cookie=LWSSO_COOKIE_KEY={access token}<br/>\n\t\t\tReplace {access token} with the access token that you obtained in step 1.</li>\n<li>Content-Type=application/json</li>\n</ul>\n</li>\n<li>According the error message, localization is missing for the section <strong>CartDetails</strong> of the form <strong>cartRequest.</strong> The problematic part where the localization is missing is marked in the following sample response body:\n\t\t<pre>{ \n\n\"completionStatus\": \"OK\", \n\n\"results\": [ \n\n{ \n\n\"id\": \"5b7ba745e4b02d795eb2b2be\", \n\n\"name\": \"cartRequest\", \n\n\"domain\": \"saw\", \n\n\"entityType\": \"Request\", \n\n\"sections\": [ \n\n{ \n\n\"name\": \"CartDetails\", \n\n\"domain\": \"saw\", \n\n\"fields\": [ \n\n{ \n\n\"newLine\": true, \n\n\"fieldSize\": \"LARGE\", \n\n\"editorType\": \"TextBox\", \n\n\"modelAttribute\": \"DisplayLabel\" \n\n} \n\n], \n\n\"isHide\": true, \n\n\"isOpen\": true, \n\n//Miss \"resourceKey\" here for localization reference \n\n \n\n} \n\n] \n\n}, \n\n …. \n\n ….. \n</pre>\n</li>\n</ol>\n</li>\n<li>Update the form layout of the entity type \"<strong>Request</strong>\" by using the <strong>PUT</strong> <strong>Resource</strong> REST URI:<br/>\n<code>{protocol}://{host}:{port}/rest/{tenantId}/rms/formLayout/{resourceId}</code><br/>\n<br/>\n\tYou must set the same header for the REST URI as in step 2a. The resourceId is the same as the id returned in the form body.  It is also the same as the formID reported in the error message above.<br/>\n<br/>\n\tIn the following sample of the request body, the entry <strong>\"id\": \"5b7ba745e4b02d795eb2b2be\" </strong>is the resource id:\n\t<pre> { \n\n\"id\": \"5b7ba745e4b02d795eb2b2be\", \n\n\"name\": \"cartRequest\", \n\n\"domain\": \"saw\", \n\n\"entityType\": \"Request\", \n\n\"sections\": [ \n\n{ \n\n\"name\": \"CartDetails\", \n\n\"domain\": \"saw\", \n\n\"fields\": [ \n\n{ \n\n\"newLine\": true, \n\n\"fieldSize\": \"LARGE\", \n\n\"editorType\": \"TextBox\", \n\n\"modelAttribute\": \"DisplayLabel\" \n\n} \n\n], \n\n\"isHide\": true, \n\n\"isOpen\": true, \n\n\"resourceKey\": \"CartDetailSection\" \n\n} \n\n] \n\n} \n</pre>\n</li>\n</ol>\n<h4 class=\"mw-headline\" id=\"Form_Error_2:_Mismatched_modelAttribute_for_MANY2MANY_relation\">Form Error 2: Mismatched modelAttribute for MANY2MANY relation </h4>\n<table>\n<tbody>\n<tr>\n<th>Tenant Id </th>\n<th>Content Type </th>\n<th>Warning </th>\n<th>Error </th>\n</tr>\n<tr>\n<td>xxxxxxxxx</td>\n<td>Form </td>\n<td>  </td>\n<td>Form-&gt;formsContentVerificationStep:Failed to validate form preview for entity PersonGroup for formId 5b714cf1e4b0982e5c6000d0 . Error:\"isOpposite\" cannot be defined as true for \"Email\" which isn't a MANY2MANY relation. {} </td>\n</tr>\n</tbody>\n</table>\n<p><b>Root Cause</b>: A field in the form has an editorType of \"MultiEntityPicker\" and a MANY2MANY relation; however, it has a modelAttribute of \"Email\", which isn't a MANY2MANY field.</p>\n<p><b>Solution</b>: You can fix this error either from the UI or from the rest URI. </p>\n<p><strong>From the UI:</strong></p>\n<ol>\n<li>Navigate to <b>Administration</b> &gt; <b>Configuration</b> &gt; <b>Studio</b> &gt; <b>Forms</b> in tenant xxxxxxxxx.</li>\n<li>Select type <b>Group</b> and form <strong>Preview PersonGroup</strong>.</li>\n<li>Remove the incorrect <strong>Email</strong> field, and add the <strong>PersonToGroup</strong> field as the eighth field, as shown in the following screenshot. <br/>\n<a class=\"image\" href=\"\"> <img alt=\"SMA 2018.08 upgrade precheck1.png\" data-file-height=\"574\" data-file-width=\"1208\" height=\"475\" src=\"../../../images/1000px-SMA_2018.08_upgrade_precheck1_8ed1daab.png\" width=\"1000\"/> </a></li>\n</ol>\n<p><strong>From the REST URI:</strong></p>\n<ol>\n<li>Get the access token with tenant admin permission by using the <strong>Post</strong> REST URI:<br/>\n<code>{protocol}://{host}:{port}/auth/authentication-endpoint/authenticate/login?TENANTID={tenantId}</code><br/>\n<br/>\n\tSee the following example of the<strong> </strong>request body:\n\n\t<pre>{ \n \"login\":\"{UserName}\", \n \"password\":\"{Password}\" \n} \n</pre>\n</li>\n<li>Get the form layout of the entity type <strong>PersonGroup</strong> by using the <strong>GET form layout</strong> REST URI:<br/>\n<code>{Protocol}://{host}:{port}/rest/{tenantId}/forms/{entity type}</code>\n<ol start=\"1\">\n<li>Set the header of the rest call:\n\t\t<ul>\n<li>Cookie=LWSSO_COOKIE_KEY={access token}<br/>\n\t\t\tReplace {access token} with the access token that you obtained in step 1.</li>\n<li>Content-Type=application/json</li>\n</ul>\n</li>\n<li>In this example, the error message indicates that the <strong>formId 5b714cf1e4b0982e5c6000d0</strong> in <strong>PersonGroup</strong> entity type has error: \"isOpposite\" cannot be defined as true for \"Email\", which isn't a MANY2MANY relation. You must check the returned form body that contains id <strong>5b714cf1e4b0982e5c6000d0</strong>.\n\t\t<pre> … \n\"fields\": [{ \n\"isOpposite\": true, \n\"fieldSize\": \"LARGE\", \n\"editorType\": \"MultiEntityPicker\", \n\"modelAttribute\": \"Email\", //Need to change from \"Email\" to \"PersonToGroup\" \n\"labelSize\": 2, \n\"size\": 10 \n}], \n… \n</pre>\n</li>\n</ol>\n</li>\n<li>Update the form layout of the entity type <strong>PersonGroup</strong> by using the <strong>PUT Resource</strong> REST URI:<br/>\n<code>{protocol}://{host}:{port}/rest/{tenantId}/rms/formLayout/{resourceId}</code><br/>\n<br/>\n\tYou must set the same header for the REST URI as in step 2a. The resourceId is the same as the id returned in the form body.  It is also the same as the formID reported in the error message above.<br/>\n<br/>\n\tIn the following sample of the request body, the entry <strong>\"id\": \"5b714cf1e4b0982e5c6000d0\"</strong> is the resource id:\n\t<pre> { \n\"id\": \"5b714cf1e4b0982e5c6000d0\", \n\"name\": \"preview\", \n\"entityType\": \"PersonGroup\", \n \"sections\": [ \n{ \n\"name\": \"General\", \n\"domain\": \"platform\", \n\"fields\": [{ \n\"isOpposite\": true, \n\"fieldSize\": \"LARGE\", \n\"editorType\": \"MultiEntityPicker\", \n\"modelAttribute\": \"PersonToGroup\", \n\"labelSize\": 2, \n\"size\": 10 \n}], \n…… \n ……. \n } \n] \n } \n \n</pre>\n</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}