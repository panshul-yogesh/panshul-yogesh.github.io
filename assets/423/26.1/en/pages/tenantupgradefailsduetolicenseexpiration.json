{
  "title": "Tenant upgrade fails because tenant state changes due to license expiration",
  "content": "<div class=\"mw-parser-output\">\n<div></div>\n<p>The suite upgrade fails at the tenant upgrade stage. You find error messages that resemble the following in the upgrade.log file (for example: /var/vols/itom/logging-volume/xservices/upgradetenant/itom-xruntime-upgrade-tenants-yyyy-mm-dd/upgrade.log): </p>\n<pre><code>2021-01-18 11:49:19,380 : MainThread : 140002658956608 : INFO : tenant 602824400, status is Inactive; content version is v19\n2021-01-18 11:49:39,401 : MainThread : 140002658956608 : INFO : -----------------check tenants iteration No.90\n2021-01-18 11:49:40,083 : MainThread : 140002658956608 : INFO : tenant 602824400, status is Inactive; content version is v19\n2021-01-18 11:50:00,100 : MainThread : 140002658956608 : ERROR : upgrade content failed!\n2021-01-18 11:50:00,109 : MainThread : 140002658956608 : ERROR : upgrade content failed! abort!\n2021-01-18 11:50:00,109 : MainThread : 140002658956608 : ERROR : Upgrade tenants in parallel failed! System exit with code -1\nParameter PWD is NULL\n2021-01-18 11:50:01,133 : MainThread : 140513077261632 : ERROR : wrong args | action[upgrade|getTenants|getStatus] HOST USER PWD TARGET_VERSION FROM_VERSION\nParameter PWD is NULL\n2021-01-18 11:50:15,680 : MainThread : 139719238546752 : ERROR : wrong args | action[upgrade|getTenants|getStatus] HOST USER PWD TARGET_VERSION FROM_VERSION</code></pre>\n<h2><a id=\"Cause\" name=\"Cause\" title=\"Cause\"></a>Cause</h2>\n<p>The suite runs a system job every night after midnight to check license validity for each tenant. If the license of a tenant has expired, the suite moves the tenant to Inactive state. </p>\n<p>If a tenant's initial state is Active when the tenant upgrade starts and then the tenant's state becomes Inactive due to license expiration while the tenant upgrade is still in progress, the tenant upgrade fails. </p>\n<h2><a id=\"Solution\" name=\"Solution\" title=\"Solution\"></a>Solution</h2>\n<ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to the PostgreSQL database server for the suite, open the <strong>xservices_rms</strong> database, and run the following commands:\n\n\t<pre><code>select * from\n(SELECT body -&gt; 'tenant' -&gt;&gt; 'state' as state,\nbody -&gt; 'tenant' -&gt;&gt; 'initialState' as initialState,\nbody -&gt; 'tenant' -&gt;&gt; 'tenantId' as tenantId,\nid, body\nFROM \"TenantData_857561481\"\nwhere body -&gt; 'tenant' -&gt;&gt; 'version' = 'v19') t\nwhere t.state is distinct from t.initialState\nand t.initialState is not null</code></pre>\n<p>The commands return the following parameter values: state, initialState, and tenantId. The first two values are the current state and initial state of the tenant, which are different from each other. </p>\n</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Log in to Suite Administration as suite-admin: https://&lt;External_Access_Host&gt;/bo, locate each tenant by tenant ID, and then change the tenant's state to the initial state. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Retry the suite version update. See <a href=\"/doc/423/26.1/upgrademanagedk8s\" title=\"Upgrade (managed Kubernetes) - Service Management\">Upgrade (managed Kubernetes) - Service Management</a>.</li></ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}