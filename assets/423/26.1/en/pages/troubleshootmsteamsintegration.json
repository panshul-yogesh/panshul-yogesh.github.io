{
  "title": "Troubleshoot Microsoft Teams integration",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\">\n<p>The following describes typical issues that may occur when you set up Microsoft Teams integration based on the built-in integration framework. </p>\n<h2>SSL handshake failure</h2>\n<p>When you or your Teams admin opens the consent link in a browser, the page displays an error about SSL handshake failure. </p>\n<h3>Cause</h3>\n<p>There're no proxy settings or the settings are incorrect. </p>\n<h3>Solution</h3>\n<p>Add or modify your proxy settings:</p>\n<ol>\n<li>Log in to Suite Administration as suite-admin: <strong>https://&lt;External Access Host&gt;/bo</strong>.</li>\n<li>Click the <strong>CONFIGURATION </strong>tab on the main menu, and then click <strong>Proxy Settings</strong>.</li>\n<li>Set the following fields:\n\t<ul>\n<li><strong>Proxy host</strong>: the hostname of the proxy you configured.</li>\n<li><strong>Proxy port</strong>: the port number of the proxy.</li>\n<li>(Optional) <strong>Proxy username</strong> and <strong>Proxy password: </strong>enter the username and password if the proxy server requires authentication.</li>\n</ul>\n</li>\n<li>Click <strong>SAVE</strong>.</li>\n</ol>\n<h2>Failed to run function</h2>\n<div class=\"transcontent stn-begin--wrong_function\"> </div>\n<p>You have successfully saved the field mappings for an MS Teams channel, however, the integration fails at runtime. You can find the following message in the runtime log (&lt;logging-volume&gt;/xie/itom-sma-xie-deployment-xxxxxxxxxxxxxxxx/xie-engine.log): \"failed to run function : xxxxx.\"</p>\n<h3>Cause</h3>\n<p>The DSL defines a set of grammar rules; however, sometimes an expression complies with the grammar rules but fails to run at runtime. For example, the integration supports a limited number of functions. If you enter a wrong function such as wrongFunction(), it passes the grammar validation but fails to run at runtime. </p>\n<h3>Solution</h3>\n<p>Fix the wrong expression.</p>\n<div class=\"transcontent stn-end--wrong_function\"> </div>\n<h2>Failed to connect to MS Teams because required String parameter 'code' is not present</h2>\n<div class=\"transcontent stn-begin--string_absent\"> </div>\n<p>After you click <strong>Connect to Microsoft Teams</strong>, the browser displays the following error: </p>\n<pre><code>Required String parameter 'code' is not present</code></pre>\n<h3>Cause</h3>\n<p>This issue occurs probably because your Azure AD application settings are incorrect.</p>\n<h3>Solution</h3>\n<p>Check the following settings of the app registered in Azure Active Directory:</p>\n<ul>\n<li>Microsoft Teams licenses must be available (<strong>Licenses</strong> &gt; <strong>All products</strong>) </li>\n<li>Redirect URI must be correct</li>\n<li>Authentication: both <strong>Access tokens</strong> and <strong>ID tokens</strong> must be selected</li>\n</ul>\n<div class=\"transcontent stn-end--string_absent\"> </div>\n<h2>Failed to connect to MS Teams because of mismatching reply URLs</h2>\n<div class=\"transcontent stn-begin--mismatching_URLS\"> </div>\n<p>After you click <strong>Connect to Microsoft Teams</strong> and then attempt to sign in to Microsoft, the sign-in fails with the following error:</p>\n<pre><code>The reply URL specified in the request does not match the reply URLS configured for the application: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.</code></pre>\n<h3>Cause</h3>\n<p>Your Azure AD application doesn't have the correct web redirect URI configured.</p>\n<h3>Solution</h3>\n<ol>\n<li>Log in to the Azure portal with your Azure admin account.</li>\n<li>Go to Azure Active Directory, and then open the application that you have registered for the integration.</li>\n<li>In the Redirect URI section, configure a web redirect URI in this format: <strong>https://{your system fqdn}/xie/public/v1/azure_callback</strong>.</li>\n</ol>\n<div class=\"transcontent stn-end--mismatching_URLS\"> </div>\n<h2>Failed to connect to MS Teams because the refresh token has expired due to inactivity</h2>\n<p>After you click <strong>Connect to Microsoft Teams</strong>, there is an error detail in &lt;logging-volume&gt;/xie/itom-sma-xie-deployment-*/&lt;tenent-id&gt;/xie-engine.log on your NFS server:</p>\n<pre><code>Caused by:org.springframework.web.client,HttpClientErrorException$BadRequest: 400 Bad Request: [{\"error\":\"invalid grant\",\"error descrip tion\":\"AADSTS700082: The refresh token has expired due to inactivity. The t n was issued on 2021-07-06T10:15:16.30827542 and was inactive for 90.00:00:00.\\r\\nT... (569 bytes)\nat org.springframework.web.client.HttpClientErrorException.create(HttpClientErrorException.java:101)\nat org.springframework.web.client.DefaultResponseE rrorHandler.handleError(DefaultResponseE rrorHandler.java:186) at org.springframework.web.client.DefaultResponseE rrorHandler.handleError(DefaultResponseE rrorHandler.java:125) at org.springframework .web.client.ResponseE rrorHandler.handleError(ResponseE rrorHandler.java:63) at org.springframework.web.client.RestTemplate.handleResponse(RestTemplate.java:819) at org.springframework.web.client.\n</code></pre>\n<h3>Cause</h3>\n<p>This issue occurs because the Teams' account password has expired.</p>\n<h3>Solution</h3>\n<p>Update the account password.</p>\n<h2>Failed to send notification messages to the channel</h2>\n<div class=\"transcontent stn-begin--no_notificatin\"> </div>\n<p>You update a record in Service Management to trigger the integration, but there are no notification messages sent to the Microsoft Teams channel. </p>\n<h3>Cause</h3>\n<p>Any of the following:</p>\n<ul>\n<li>Incorrect field mapping, for example, wrong DSL expressions</li>\n<li>Incorrect team name or channel name configured</li>\n<li>The client secret of the app registered in Azure AD has expired</li>\n</ul>\n<h3>Solution</h3>\n<p>Check the items listed in the root cause section, and fix any issues if found. </p>\n<div class=\"transcontent stn-end--no_notificatin\"> </div>\n<h2>Failed to append comments to the Discussions tab</h2>\n<div class=\"transcontent stn-begin--no_comments\"> </div>\n<p>When a user replies to a notification message in the MS Teams channel, the integration doesn't append the reply as a comment to the Discussions tab of the record.</p>\n<h3>Cause</h3>\n<p>Any of the following:</p>\n<ul>\n<li>The FQDN of your Service Management system isn't accessible from the internet</li>\n<li>The current channel is being used by another tenant or another channel configuration</li>\n<li>The client secret of the app registered in Azure AD has expired</li>\n<li>You have configured a public FQDN for the integration because your system is deployed on a private network, but the certificate that is configured for the public FQDN isn't signed by a trusted CA or the certificate has expired. </li>\n</ul>\n<h3>Solution</h3>\n<p>Check the items listed in the root cause section; and if the problem persists, check if the runtime logs throw any error messages. </p>\n<div class=\"transcontent stn-end--no_comments\"> </div>\n<h2>Public FQDN isn't working</h2>\n<p>Your suite is deployed in a private network and you configure a public FQDN for this integration. However, the verification of the public FQDN configuration fails. See <a href=\"/doc/423/26.1/msteamsintegrationnetworkrequirements\" title=\"Microsoft Teams integration network requirements\">Microsoft Teams integration network requirements</a>.</p>\n<h3>Cause</h3>\n<p>Integration related pods aren't running or the network settings of the public FQDN are incorrect.</p>\n<h3>Solution</h3>\n<p>Normally this configuration change doesn't need a restart of relevant pods and takes effect in a minute. If the public FQDN isn't working, follow these steps:</p>\n<ol>\n<li>Check the public FQDN value in configmap by running the following command on a control plane node or bastion node:\n\t<pre><code>kubectl get cm itom-sma-xie-configmap -n $( kubectl get ns | grep itsm | awk '{print $1}') -o yaml | grep  public-fqdn</code></pre>\n</li>\n<li>If the public fqdn value in the configmap is correct but the verification fails, restart all XIE pods and then retry the verification. </li>\n<li>If the verification still fails, you may need to work with your IT team to check the network settings of the public FQDN. The Integration Studio should be accessible via the public FQDN from a public network.</li>\n</ol>\n</div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}