{
  "title": "Manage Persons API stops processing",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>The Manage Persons API stops processing.<br/>\nIf you check the database, you can see the following symptoms: </p>\n<ul>\n<li>The number of records in the job table (WQProvisionUsers_857561481) never decreases.</li>\n<li>The number of 'Pending' records in the status table (ProvisionUsersState_&lt;tenant_id&gt;) never decreases.</li>\n</ul>\n<h2 id=\"Cause\">Cause</h2>\n<p>The two tables become too large so that the Manage Persons API stops processing.</p>\n<h2 id=\"Solution\">Solution</h2>\n<p>You can check both the job table and the status table every 24 hours. When the issue happens, clean both tables.</p>\n<ol>\n<li>Query Group status:\n\t<pre><code>select body -&gt; 'provisionUsersBulkResultJSON' -&gt;&gt; 'BulkStatus' AS \"BulkStatus\", count(*), MIN(body -&gt;&gt; 'lastUpdateTime') AS \"minLastUpdateTime\" FROM \nProvisionUsersState_&lt;tenant_id&gt; where body -&gt; GROUP BY body -&gt; 'provisionUsersBulkResultJSON' -&gt;&gt; 'BulkStatus';</code></pre>\n</li>\n<li>Query RUNNING status:\n\t<pre><code>SELECT id, body FROM ProvisionUsersState_&lt;tenant_id&gt; where body -&gt; 'provisionUsersBulkResultJSON' -&gt;&gt; 'BulkStatus' = 'RUNNING';</code></pre>\n</li>\n<li>Delete the records in the job table:\n\t<pre><code>truncate table ProvisionUsersState_&lt;tenant_id&gt;;</code></pre>\n<strong>Note</strong>: A scheduled job runs at midnight UTC time and deletes records older than 5 days in the ProvisionUsersState_&lt;tenant_id&gt; table. If you cannot wait for the records to be deleted by the scheduled job and you want to delete all the records instead of just the records older than 5 days, you can manually delete records with the command above.</li>\n<li>Delete the records in the status table:\n\t<pre><code>truncate table WQProvisionUsers_857561481;</code></pre>\n</li>\n</ol>\n<p><br/>\n       </p>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}