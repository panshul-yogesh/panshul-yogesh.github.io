{
  "title": "Can't delete a tenant",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>When the tenant deployment fails, the tenant stays in the \"In Provision\" state. The suite admin cannot delete this tenant in Suite Administration.</p>\n<h2>Cause</h2>\n<p>The tenant that is in the \"In Provision\" state cannot be deleted from the Suite Administration UI. You need to manually update the tenant state accordingly before you can delete the tenant.</p>\n<h2>Solution</h2>\n<p>To update the tenant state and delete the tenant, follow these steps:</p>\n<ol>\n<li>Connect to the xservices_rms database and check the tenant state in Service Management:\n\t<ol>\n<li>Run the command on the master node to get the xruntime DB password:\n\t\t<pre><code>kubectl exec -n &lt;itsma namespace&gt; itom-xruntime-platform-&lt;xxxxxxxxx&gt; -c itom-xruntime-platform -it get_secret itom_itsma_db_password_secret_key</code></pre>\n</li>\n<li>Enter the password after you run this command:\n\t\t<pre><code>psql -h $pg_host  -p $pg_port  -U maas_admin -d xservices_rms</code></pre>\n</li>\n<li>Search for the tenant record:\n\t\t<pre><code>xservices_rms=&gt; SELECT * FROM \"TenantData_857561481\" WHERE body::json-&gt;'tenant'-&gt;&gt;'tenantId'='${tenantID}';</code></pre>\n\t\tExample of the result:<br/>\n<code>5e7021a7e4b0c8826051f038 | {\"id\": \"5e7021a7e4b0c8826051f038\", \"tenant\": {\"type\": \"Dev\", <span style=\"color:#e74c3c;\">\"state\": \"Active\",</span> \"version\": \"v16\", \"tenantId\": \"256981059\", \"customerId\": \"256981059\", \"tenantName\": \"xTenant4ManagedF8S0_0832_4ds\", \"tenantAdminUser\": \"user4ManagedF8S0\", \"TenantCreationDetailsJSON\": {\"tenantCreationTime\": 1584406951028, \"tenantCreationVersion\": \"v16\"}}}</code></li>\n</ol>\n</li>\n<li>Do one of the following based on the result of the tenant state in the previous state:\n\t<ul>\n<li>If the tenant state is \"Active\", the tenant creation succeeded. You need to manually call the tenant deploy callback API to update the tenant state to \"ACTIVE\" for Suite Administration. Then, the tenant can be used as a normal tenant.\n\t\t<ol>\n<li>Get the suite-admin LWSSO token:\n\t\t\t<pre><code>token=`curl -k --location --request POST \"https://$FQDN/bo/token\" \\\n--header 'Content-Type: application/json' \\\n--header 'Accept: application/json' \\\n-d  \"{\\\"username\\\":\\\"suite-admin\\\", \\\"password\\\": \\\"$password\\\"}\"`</code></pre>\n</li>\n<li>Call the tenant deploy callback API in the bo-ats container:\n\t\t\t<pre><code>kubectl exec -n itsmaxxxx  itom-bo-ats-deployment-xxxxxxx -c itom-bo-ats -it -- \\\ncurl --location --request POST 'http://localhost:31027/tenants/deploy/callback' --header \"Cookie: LWSSO_COOKIE_KEY=$token\" --header 'Content-Type: application/json' -d '{\"tenantId\": \"&lt;tenantId&gt;\",\"status\": \"Completed\"}'</code></pre>\n</li>\n</ol>\n</li>\n<li>If the tenant state is \"PendingRemoval\", the tenant creation failed. Manually call the tenant deploy callback API to update the tenant state to \"PENDING_FOR_REMOVAL\" for Suite Administration. \n\t\t<ol>\n<li>Get the suite-admin LWSSO token:\n\t\t\t<pre><code>token=`curl -k --location --request POST \"https://$FQDN/bo/token\" \\\n--header 'Content-Type: application/json' \\\n--header 'Accept: application/json' \\\n-d  \"{\\\"username\\\":\\\"suite-admin\\\", \\\"password\\\": \\\"$password\\\"}\"`</code></pre>\n</li>\n<li>Call the tenant deploy callback API in the bo-ats container:\n\t\t\t<pre><code>kubectl exec -n itsmaxxxx  itom-bo-ats-deployment-xxxxxxx -c itom-bo-ats -it -- \\\ncurl --location --request POST 'http://localhost:31027/tenants/deploy/callback' --header \"Cookie: LWSSO_COOKIE_KEY=$token\" --header 'Content-Type: application/json' -d '{\"tenantId\": \"&lt;tenantId&gt;\",\"status\": \"Failed\"}'</code></pre>\n</li>\n</ol>\n</li>\n<li>If the tenant state is still \"InCreation\",  do the following:\n\t\t<ol>\n<li>Run this command to change the tenant state to \"PendingRemoval\":\n\t\t\t<pre><code>xservices_rms=&gt; INSERT INTO \"TenantData_857561481\" (id, body) VALUES {\"id\": \"5e7021a7e4b0c8826051f038\", \"tenant\": {\"type\": \"Dev\", \"state\": \" PendingRemoval \", \"version\": \"v16\", \"tenantId\": \"256981059\", \"customerId\": \"256981059\", \"tenantName\": \"xTenant4ManagedF8S0_0832_4ds\", \"tenantAdminUser\": \"user4ManagedF8S0\", \"TenantCreationDetailsJSON\": {\"tenantCreationTime\": 1584406951028, \"tenantCreationVersion\": \"v16\"}}}</code></pre>\n</li>\n<li>Change the tenant state to \"PENDING_FOR_REMOVAL\" for Suite Administration:\n\t\t\t<ol>\n<li>Get the suite-admin LWSSO token:\n\t\t\t\t<pre><code>token=`curl -k --location --request POST \"https://$FQDN/bo/token\" \\\n--header 'Content-Type: application/json' \\\n--header 'Accept: application/json' \\\n-d  \"{\\\"username\\\":\\\"suite-admin\\\", \\\"password\\\": \\\"$password\\\"}\"`</code></pre>\n</li>\n<li>Call the tenant deploy callback API in the bo-ats container:\n\t\t\t\t<pre><code>kubectl exec -n itsmaxxxx  itom-bo-ats-deployment-xxxxxxx -c itom-bo-ats -it -- \\\ncurl --location --request POST 'http://localhost:31027/tenants/deploy/callback' --header \"Cookie: LWSSO_COOKIE_KEY=$token\" --header 'Content-Type: application/json' -d '{\"tenantId\": \"&lt;tenantId&gt;\",\"status\": \"Failed\"}'</code></pre>\n</li>\n</ol>\n</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>Delete the PENDING_FOR_REMOVAL tenant from the Suite Administration UI.<br/>\n<strong>Note</strong>: If you still cannot delete the tenant from the Suite Administration UI with an error message, contact support for assistance.</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}