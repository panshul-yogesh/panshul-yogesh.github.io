{
  "title": "Uninstall UD/UCMDB on Azure",
  "content": "<div class=\"mw-parser-output\"><p>To uninstall UD/UCMDB on Azure, perform the tasks in this section.</p><h2>Delete the UD/UCMDB deployment</h2><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UninstallCmsWithEks|DeleteCMSdeployment|N\"></span><ol>\n<li>Log on to the bastion node, navigate to the OPTIC Management Toolkit (OMT) installation directory:\n\t<pre>cd OMT_External_K8s_2x.x-xxx/bin</pre>\n</li>\n<li>Run the following command to remove the UD/UCMDB release:\n\t<pre>./helm uninstall &lt;<em>UD/UCMDB RELEASE NAME</em>&gt; -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt;</pre>\n<p>\tWhere:\n</p>\n<ul>\n<li><code>&lt;<em>UD/UCMDB RELEASE NAME</em>&gt;</code> is the UD/UCMDB release that you want to uninstall, which you can get by running the command <code>./helm list -n &lt;<em>UD/UCMDB NAMESPACE</em>&gt;.</code></li>\n<li><code>&lt;<em>UD/UCMDB NAMESPACE</em>&gt;</code> is the namespace where you installed UD/UCMDB.</li>\n</ul>\n</li>\n<li>Run the following command to remove the OMT deployment:\n\t<pre>cd OMT_External_K8s_2x.x-xxx/scripts\n./cdfctl deployment delete -d &lt;<em>CMS DEPLOYMENT NAME</em>&gt;</pre>\n<p>\tWhere\n</p>\n<ul>\n<li><code>&lt;<em>CMS DEPLOYMENT NAME</em>&gt;</code> is the name you specified for the deployment you created to install UD/UCMDB.</li>\n</ul>\n<p>\tFor example:\n</p>\n<pre>./cdfctl deployment delete -d ucmdb-prod</pre>\n<p>You will need to enter the password of the administrator that you set during the OMT installation. </p>\n</li>\n</ol>\n<p><br/>\n</p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UninstallCmsWithEks|DeleteCMSdeployment|N\"></span><h2 id=\"Remove_persistent_volumes\">Remove persistent volumes</h2><p>If you created PVs by following the instructions in <a href=\"/doc/423/26.1/aksazurefilecms\">Subscribe premium Azure Files for UD/UCMDB</a>, you can run the following command to delete the persistent volumes:</p><pre>kubectl delete -f &lt;UCMDB_Volume_Yaml_Path&gt;</pre><p>For example:</p><pre>kubectl delete -f /tmp/cmspvyamlsfolder/ucmdb-config-volume.yaml\nkubectl delete -f /tmp/cmspvyamlsfolder/ucmdb-data-volume.yaml\nkubectl delete -f /tmp/cmspvyamlsfolder/ucmdb-log-volume.yaml</pre><h2 id=\"Clean_the_NFS_volumes\">Clean the NFS volumes</h2><ol><li>Copy and save the following script as <strong>cleanCMSNFS.sh</strong> on the bastion node:\n\n\t<pre>#!/bin/bash\nshopt -s extglob\n# Edit as needed\nMOUNT_POINT=\"/mnt/nfs\"\nNFS_PARENT=\"var/vols/itom/cms\"\n\nrm -rf ${MOUNT_POINT}/${NFS_PARENT}/*/*\nls -l ${MOUNT_POINT}/${NFS_PARENT}/*/</pre></li><li>If you use Azure Files as the storage service, run the following commands to clean up the UD/UCMDB data:\n\t<pre>chmod 755 cleanCMSNFS.sh\nsudo ./cleanCMSNFS.sh &lt;ucmdb_file_share_name&gt;</pre><p><strong>&lt;ucmdb_file_share_name&gt;</strong> is the name of the Azure file share for storing the <strong>cms </strong>data.</p></li></ol><h2 id=\"Clean_the_databases\">Clean the databases</h2><p>The UD/UCMDB uninstallation process doesn't remove the databases residing in the external PostgreSQL databases. You need to remove the databases manually.</p><ol><li>Connect to the Postgres server with the following command:\n\t<pre>psql -h &lt;pg-private-ip&gt; -U postgres</pre></li><li>Delete all the UD/UCMDB databases by running the following commands:\n\t<pre># drop databases\ndrop database ucmdb_db;\ndrop database ucmdb_autopass_db;\n</pre></li><li>Delete all the UD/UCMDB databases users by running the following commands:\n\t<pre># drop users\ndrop role ucmdb;\ndrop role ucmdb_autopass;\n</pre></li></ol></div>",
  "modifiedon": "2025-10-24 08:51:12"
}