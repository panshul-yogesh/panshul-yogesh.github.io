{
  "title": "How to update the Audit service passwords",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>The Audit service uses the following users and passwords. </p>\n<ul>\n<li>Audit database user and password: Audit service uses the Audit service database user to connect to the audit database. </li>\n<li>IdM transport user and password: Audit service uses the Audit service IdM transport user to connect to IdM and to run some APIs. This user should be present in the IdM before Audit service deployment.</li>\n<li>IdM super user and password: Audit service uses the Audit service IdM super user to connect to IdM and to run some APIs. This user should be present in the IdM before Audit service deployment.</li>\n</ul>\n<p>If you or someone changes any of these passwords, </p>\n<ul>\n<li>You might see an authentication error when accessing Audit service.</li>\n<li>Audit service is unable to connect to IdM.</li>\n<li>Audit service is unable to connect to the database.</li>\n<li>The Audit UI doesn't show the data.</li>\n<li>When you check the logs, you will be able to see an authentication error.</li>\n</ul>\n<p>You have to then update these passwords in the Kubernetes container and Audit vault.</p>\n<p>The following sections give the steps on how to update each of the passwords in the Kubernetes container and Audit vault. If you need to update multiple passwords, you can run the upgrade Helm command in the end. </p>\n<h2>Check if the password is correct</h2>\n<p>Before you proceed to change the passwords in the Kubernetes secret and vault secret, check if the passwords are correct.</p>\n<h3>Audit service database password</h3>\n<p>Try connecting to the audit service database by using the PSQL or PG Admin client. If you are able to connect, then the password is correct. If you are unable to connect, then the password must be wrong. You have to now add the new password in the Kubernetes secret and in the Kubernetes vault.</p>\n<h3>Audit service IdM transport password</h3>\n<p>Run the following command to retrieve the password from IdM:</p>\n<pre><code>kubectl exec -it &lt;IDM Pod&gt; -n &lt;IDM pod namespace&gt; -c idm -- get_secret idm_transport_user_password_secret_key</code></pre>\n<p>For example,</p>\n<pre><code>kubectl exec -it idm-6c8876c8b8-qs68q -n itsma-gcmu7 -c idm -- get_secret idm_transport_user_password_secret_key</code></pre>\n<p>Compare the password you have with the password that you retrieved using the aforementioned command. If the password is different, then you need to update it in the Kubernetes secret and vault secret.</p>\n<h3>Audit service super user password</h3>\n<p>You can verify the username and corresponding password for the super user by connecting to the IdM admin page (<code>https://&lt;IDM host&gt;:&lt;IDM port&gt;/idm-admin</code>). If you are unable to log in to the IdM admin page, then you need to update the new password in the Kubernetes secret and vault secret.</p>\n<h2>Replace the Kubernetes secret </h2>\n<p>To replace the Kubernetes secret, you need to run the gen_secret.sh script and update the new password. This script generates an output file with the updated secret. You then need to pass this output file using the Helm upgrade command where Helm updates the Kubernetes secrets with the new password.</p>\n<ol>\n<li>Run the following command to update the Kubernetes secret:\n\t<pre>./gen_secrets.sh -n &lt;Audit Namespace&gt; -c &lt;Audit Chart File&gt; -o &lt;Secrets YAML File&gt;</pre>\n<p>where,<br/>\n<em>&lt;Audit Namespace&gt;</em> is the unique namespace of the Audit deployment.<br/>\n<em>&lt;Audit Chart File&gt;</em> is the tar file containing the Audit installation charts (<strong>audit-&lt;version&gt;.tgz</strong>).<br/>\n<em>&lt;Secrets YAML File&gt;</em> is the YAML file (for example, <strong>audit-updatedsecrets.yaml</strong>) that's generated after you run the gen_secret.sh script.</p>\n<p>Snippet of the output file:</p>\n<pre><code>secrets:\n\n  audit_db_pass_key: cG9zdGdyZXNfcGFzc0BGSVBTMTIzNA==\n\n  idm_super_user_pass_key: QWRtaW5fMTIzNA==\n\n  idm_transport_user_pass_key: cHdrUzJQM2ctN0d0VjVHYQ==</code></pre>\n</li>\n<li>Run the helm upgrade command and pass the updated secret file.\n\t<pre>$helm upgrade &lt;Audit Release Name&gt; &lt;Audit Service Chart&gt; -n &lt;Audit Namespace&gt; -f &lt;Values YAML File&gt; -f &lt;<code>Secrets YAML File&gt;</code> --set-file \"caCertificates.cert_one\"=/path/to/cert_one.crt --set-file \"caCertificates.cert_two\"=/path/to/cert_two.crt</pre>\n</li>\n</ol>\n<h2>Replace the vault secret </h2>\n<p>To replace the vault secret, run the update_secret script using either the Audit engine container or Audit gateway container:</p>\n<pre><code>kubectl exec -it &lt;Audit engine or Audit gateway pod&gt; -n &lt;audit service namespace&gt; -c &lt;Audit engine or Audit gateway container&gt; -- update_secret &lt;new or updated pass key/password&gt;</code></pre>\n<p>For example,</p>\n<pre><code>kubectl exec -it itom-audit-deployment-5d4dcfdd6c-jhs9m -n audit-service -c itom-audit-deployment -- update_secret audit_db_pass_key postgres_pppp@ABCD123456</code></pre>\n<h2>Restart the deployment</h2>\n<p>For Audit service to get the updated password from the vault, you need to restart the deployment such that the containers restart. The scale command scales down the containers to 0 and then scales them back to the replicas set in the values.yaml. Depending on whether the password change belongs to the Audit service deployment or the Audit gateway deployment, run the respective command:</p>\n<pre><code>kubectl scale deployment &lt;audit or audit gateway deployment&gt; -n &lt;Audit Service Namespace&gt; --replicas=0</code></pre>\n<pre><code>kubectl scale deployment &lt;audit or audit gateway deployment&gt; -n &lt;Audit Service Namespace&gt; --replicas=&lt;replicas set in the values.yaml&gt;</code></pre>\n<p style=\"margin-bottom:11px\">For example:</p>\n<p style=\"margin-bottom:11px\">For audit_db_pass_key and idm_super_user_pass_key, restart the Audit pods using the following command:</p>\n<pre><code>kubectl scale deployment itom-audit-deployment -n audit-service --replicas=0</code></pre>\n<pre><code>kubectl scale deployment itom-audit-deployment -n audit-service --replicas=2</code></pre>\n<p>For idm_transport_user_pass_key, restart the Audit gateway pods using the following command:</p>\n<pre><code>kubectl scale deployment itom-audit-gateway-deployment -n audit-service --replicas=0</code></pre>\n<pre><code>kubectl scale deployment itom-audit-gateway-deployment -n audit-service --replicas=2</code></pre>\n<p class=\"mw-empty-elt\"></p>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}