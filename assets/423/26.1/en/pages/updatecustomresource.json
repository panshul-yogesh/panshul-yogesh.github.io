{
  "title": "How to update custom resource settings",
  "content": "<div class=\"mw-parser-output\">\n<div></div>\n<p>This topic guides you on how to make changes to your custom resource settings. You might need to update the values of either the resources replicas, CPU, Memory or the nodeSelector of your deployment. The steps below guides you on how to perform this task.</p>\n<h2>Overview</h2>\n<p>To update a value in your custom resource settings, you will first need to get and save your current custom resource settings, and then use a helm command to update the values you wish to update. Use the steps below to update your custom resource settings.</p>\n<h2>Generate a template of customized values.yaml</h2>\n<p>Use these steps to generate and store your current custom settings to a <em>custom-resources-full-values.yaml</em> file.</p>\n<ol>\n<li>Log on to one of the control plane nodes (embedded Kubernetes) or a bastion node (external Kubernetes).</li>\n<li>Change to the <code>ESM_Helm_Chart-2x.x/scripts/custom_settings</code> directory.\n\t<ol>\n<li>Run the following commands to change the permission run the <code>generateCustomSettings.sh</code> script:\n\t\t<pre>chmod u+x generateCustomSettings.sh\n./generateCustomSettings.sh</pre>\n<p>The script generates and stores a <em>custom-resources-full-values.yaml</em> file in the current directory. This file contains replicas, CPU, Memory, nodeSelector vaules of each service charts or their sub-charts. Example for autopass and bo (and its sub-chart, bo-ats):</p>\n<pre>autopass:                       #service chart name\n  replicas: \"1\"\n  resources:\n    autopass-lm:\n      limits:\n        cpu: 3\n        memory: 3Gi\n      requests:\n        cpu: 100m\n        memory: 1500Mi\n  global:\n    service_nodeSelector:\n      Worker: label\n</pre>\n<pre>bo:                            #service chart name\n  bo-ats:                      #sub-chart of `bo` service chart\n    replicas: \"1\"\n    resources:\n      itom-bo-ats:\n        limits:\n          cpu: 2\n          memory: 1Gi\n        requests:\n          cpu: 10m\n          memory: 100Mi\n          global:\n    #bo-ats sub-service should run on worker node with Worker=boats label\n    nodeSelector:          \n      Worker: boats   \n  #other bo sub-sservice should run on worker node with Worker=label label\n  global:\n    service_nodeSelector:\n      Worker: label  \n</pre>\n</li>\n</ol>\n</li>\n<li>Copy the<em> custom-resources-full-values.yaml</em> file to the <em>ESM_Helm_Chart-2x.x/charts/</em> directory, and save a copy in a secure location as backup.</li>\n<li>Get the suite namespace and release name.\n\t<pre>NAMESPACE=&lt;ESM_NAMESPACE&gt;\nreleaseName=$(helm list -n $NAMESPACE --output json |jq -r '.[].name' )</pre>\n\twhere &lt;ESM_NAMESPACE&gt; is the suite unique namespace.</li>\n</ol>\n<h2>Updating a resource setting</h2>\n<p>The <em>custom-resources-full-values.yaml </em>contains setting for each service charts and their sub-charts. To update any settings of a particular service chart or sub-chart, you need to copy the section of the service chart or sub-chart and save it to a new yaml file, modify the new yaml file as required, and then use the helm upgrade command to apply the update.</p>\n<h3>How to update replicas</h3>\n<p>The steps below shows you how to update the replicas of the <code>xruntime-platform</code> sub-chart from 2 to 3:</p>\n<ol>\n<li>Locate the <code>xruntime-platform</code> sub-chart in the <em>custom-resources-full-values.yaml </em> file and copy the sub-chart details.\n\n\t<pre>xruntime-platform:\n  replicas: 2\n  resources:\n    itom-xruntime-platform:\n      limits:\n        cpu: 4\n        memory: 6144M\n      requests:\n        cpu: 100m\n        memory: 1024M</pre>\n</li>\n<li>Save the copied content to a new yaml file (for example, <em>platform-replicas.yaml</em>), append the first line as the service chart name <code>xruntime:</code>, then update the replicas:\n\t<pre>xruntime:\n  xruntime-platform:\n    replicas: 3\n    resources:\n      itom-xruntime-platform:\n        limits:\n          cpu: 4\n          memory: 6144M\n        requests:\n          cpu: 100m\n          memory: 1024M\n</pre>\n</li>\n<li>Run the follow command to apply this update.\n\t<pre>helm get values $releaseName -n $NAMESPACE &gt; my-values.yaml\nhelm upgrade $releaseName &lt;ESM_HELM_CHART_PATH&gt; -n $NAMESPACE -f  my-values.yaml -f &lt;CUSTOM_REPLICAS.yaml&gt;\n</pre>\n<p>Where</p>\n<ul>\n<li><em>&lt;ESM_HELM_CHART_PATH&gt;</em> is the absolute path of the helm package.</li>\n<li><em>&lt;CUSTOM_REPLICAS.yaml&gt;</em> is your customized yaml file, which you prepared in preview step. E.g. platform-replicas.yaml</li>\n</ul>\n<p>Example:</p>\n<pre>helm upgrade sma esm-1.0.0+2x.x-xxx\\charts\\esm-1.0.0+2x.x-xxx.tgz -n itsma-xxx -f my-values.yaml -f platform-replicas.yaml</pre>\n</li>\n</ol>\n<h3>How to update resource of limits/requests CPU/Memory</h3>\n<p>The steps below shows you how to update the requests <code>memory</code> of the <code>smarta-search</code> sub-chart:</p>\n<ol>\n<li>Locate the <code>smarta-search</code>  sub-chart in the <em>custom-resources-full-values.yaml</em> file and copy the sub-chart details.\n\n\t<pre>  smarta-search:\n    replicas: 1\n    resources:\n      smarta-search:\n        limits:\n          cpu: 2\n          memory: 1G\n        requests:\n          cpu: 10m\n          memory: 256M \n</pre>\n</li>\n<li>Save the copied content to a new yaml file (for example, <em>smarta-search-resource.yaml</em>), append the first line as the service chart name <code>smarta:</code> then the requests memory to <code>512M</code>.\n\t<pre>smarta:\n  smarta-search:\n    replicas: 1\n    resources:\n      smarta-search:\n        limits:\n          cpu: 2\n          memory: 1G\n        requests:\n          cpu: 10m\n          memory: 512M\n</pre>\n</li>\n<li>Run the follow command to make this update take effect\n\t<pre>helm get values $releaseName -n $NAMESPACE &gt; my-values.yaml\nhelm upgrade $releaseName &lt;ESM_HELM_CHART_PATH&gt; -n $NAMESPACE -f  my-values.yaml -f &lt;CUSTOM_REPLICAS.yaml&gt;\n</pre>\n<p>Where</p>\n<ul>\n<li><em>&lt;ESM_HELM_CHART_PATH&gt;</em> is the absolute path of the helm package.</li>\n<li><em>&lt;CUSTOM_REPLICAS.yaml&gt;</em> is your customized yaml file, which you prepared in preview step. E.g. smarta-search-resource.yaml</li>\n</ul>\n<p>Example:</p>\n<pre>helm upgrade sma esm-1.0.0+2x.x-xxx\\charts\\esm-1.0.0+2x.x-xxx.tgz -n itsma-xxx -f my-values.yaml -f smarta-search-resource.yaml</pre>\n</li>\n</ol>\n<h3>How to update nodeSelector</h3>\n<p>We support two ways to update the nodeSector, updating the <code>nodeSelector</code> of all service charts to the same value and updating the <code>nodeSelector </code>of a single service charts.</p>\n<h4>Updating all service to the same nodeSelector value</h4>\n<p>Use the following steps to update all nodeSelectors to the same value.</p>\n<ol>\n<li>Run the following command to get your <em>my-values.yaml</em> file\n\n\t<pre>helm get values $releaseName -n $NAMESPACE &gt; my-values.yaml</pre>\n</li>\n<li>Open your my-values.yaml file, and update the nodeSelector value:\n\t<pre><code>global:\n  nodeSelector: \n    &lt;key&gt;: &lt;value&gt;</code></pre>\n<p>Where</p>\n<ul>\n<li>&lt;key&gt; is your label key.</li>\n<li>&lt;value&gt; is your your label value.</li>\n</ul>\n</li>\n<li>Run the follow command to make this update take effect\n\t<pre>helm upgrade $releaseName &lt;ESM_HELM_CHART_PATH&gt; -n $NAMESPACE -f  my-values.yaml\n</pre>\n<p>Where &lt;ESM_HELM_CHART_PATH&gt; is the absolute path of the helm package.</p>\n<p>Example:</p>\n<pre>helm upgrade sma esm-1.0.0+2x.x-xxx\\charts\\esm-1.0.0+2x.x-xxx.tgz -n itsma-xxx -f my-values.yaml </pre>\n</li>\n</ol>\n<h4>Updating all sub-services to the same nodeSelector value</h4>\n<p>Use the following steps to update all nodeSelectors to the same value.</p>\n<ol>\n<li>Run the following command to get your <em>my-values.yaml</em> file\n\n\t<pre>helm get values $releaseName -n $NAMESPACE &gt; my-values.yaml</pre>\n</li>\n<li>Open your my-values.yaml file, and update the nodeSelector value:\n\t<pre><code>xruntime:\n  global:\n    service_nodeSelector:\n      &lt;key1&gt;: &lt;value1&gt;     #all xruntime sub-service should run on work node with key2=value2 label\nsmarta:\n  global:\n    service_nodeSelector:\n      &lt;key2&gt;: &lt;value2&gt;     #all smarta sub-service should run on work node with key2=value2 label\n</code></pre>\n<p>Where</p>\n<ul>\n<li>&lt;key1&gt; and &lt;key2&gt; are your label key.</li>\n<li>&lt;value2&gt; and &lt;value2&gt; are your your label value.</li>\n</ul>\n</li>\n<li>Run the follow command to make this update take effect\n\t<pre>helm upgrade $releaseName &lt;ESM_HELM_CHART_PATH&gt; -n $NAMESPACE -f  my-values.yaml\n</pre>\n<p>Where &lt;ESM_HELM_CHART_PATH&gt; is the absolute path of the helm package.</p>\n<p>Example:</p>\n<pre>helm upgrade sma esm-1.0.0+2x.x-xxx\\charts\\esm-1.0.0+2x.x-xxx.tgz -n itsma-xxx -f my-values.yaml </pre>\n</li>\n</ol>\n<h4>Updating a single nodeSelector</h4>\n<p>The steps below shows you how to update the <code>nodeSelector</code> of the <code>xruntime-platform-offline-ng</code> sub-chart.</p>\n<ol>\n<li>Locate the <code>xruntime-platform-offline-ng</code>  sub-chart in the <em>custom-resources-full-values.yaml</em> file and copy the sub-chart details.\n\n\t<pre>  xruntime-platform-offline-ng:\n    replicas: \"1\"\n    resources:\n      itom-xruntime-platform:\n        limits:\n          cpu: 4\n          memory: 6144M\n        requests:\n          cpu: 10m\n          memory: 1024M\n    nodeSelector: \"\"\n    \n</pre>\n</li>\n<li>Save the copied content to a new yaml file (for example, <em>ng_nodeSelector.yaml</em>), append the first line as the service chart name <code>xruntime:</code> then then update the nodeSelector.\n\t<pre>xruntime:\n  xruntime-platform-offline-ng:\n    replicas: \"1\"\n    resources:\n      itom-xruntime-platform:\n        limits:\n          cpu: 4\n          memory: 6144M\n        requests:\n          cpu: 10m\n          memory: 1024M\n    nodeSelector: \n        Worker: \"test\"\n</pre>\n</li>\n<li>Run the follow command to make this update take effect\n\t<pre>helm get values $releaseName -n $NAMESPACE &gt; my-values.yaml\nhelm upgrade $releaseName &lt;ESM_HELM_CHART_PATH&gt; -n $NAMESPACE -f  my-values.yaml -f &lt;CUSTOM_REPLICAS.yaml&gt;\n</pre>\n<p>Where</p>\n<ul>\n<li><em>&lt;ESM_HELM_CHART_PATH&gt;</em> is the absolute path of the helm package.</li>\n<li><em>&lt;CUSTOM_REPLICAS.yaml&gt;</em> is your customized yaml file, which you prepared in preview step. E.g. ng_nodeSelector.yaml</li>\n</ul>\n<p>Example:</p>\n<pre>helm upgrade sma esm-1.0.0+2x.x-xxx\\charts\\esm-1.0.0+2x.x-xxx.tgz -n itsma-xxx -f my-values.yaml -f ng_nodeSelector.yaml</pre>\n</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}