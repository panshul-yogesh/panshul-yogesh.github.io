{
  "title": "Upgrade OMT (managed Kubernetes)",
  "content": "<div class=\"mw-parser-output\"><p>This topic describes the steps to upgrade OMT for deployments that use managed Kubernetes. </p><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>Before upgrading OMT and the suite (and any other applications if any), do not upgrade the Kubernetes cluster. <a href=\"/doc/423/26.1/upgradek8s\" title=\"Upgrade the Kubernetes cluster (managed Kubernetes)\">Upgrade the Kubernetes cluster</a> as the last step of the upgrade process.</div></div></div><h2 class=\"mw-headline\">Prerequisite tasks </h2><h3 class=\"mw-headline\">Download, unzip, and verify the upgrade package</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UpgradeCDFBYOK|DownloadUnzipVerifyPackage1|N\"></span><table><tbody><tr><th>Role</th><th>Location</th></tr><tr><td>Suite admin</td><td>Bastion node</td></tr></tbody></table><ol><li>Visit <a class=\"external text\" href=\"https://sld.microfocus.com/mysoftware/index\" rel=\"nofollow\" target=\"1\" title=\"Software Licenses and Downloads Portal\">Software Licenses and Downloads Portal</a> and download the OMT upgrade package (<code>OMT2xx-xxx-15001-External-K8s.zip</code>) to a temporary directory on the bastion node.</li><li>Run the <code>unzip</code> command to unzip the upgrade package. For example, you run the following command:\n\t<pre>unzip OMT2xx-xxx-15001-External-K8s.zip</pre></li><li>To verify you have a genuine, signed OMT package, use a web browser and visit the <a href=\"https://portal.microfocus.com/s/article/KM000003948?language=en_US\" title=\"public key download portal\">public key download portal</a>. Download the <code>MF_public_keys-Updated.tar.gz</code> package to a local directory and extract the public keys, <code>ot-package-sign.pub</code>, using <code>gzip</code>. Refer to the steps on the page and verify the package either using RPM or GnuPG.</li><li>Run the <code>unzip</code> command to unzip the <code>OMT_External_K8s_2x.x-xxx.zip</code> file. For example, you run the following command:<br/>\n\t \n\t<pre><code>unzip OMT_External_K8s_2x.x-xxx.zip</code></pre></li><li>Save the unzipped <code>OMT_External_K8s_2x.x-xxx</code> directory to a temporary location on a bastion node.</li></ol><p><br/></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UpgradeCDFBYOK|DownloadUnzipVerifyPackage1|N\"></span><h3 class=\"mw-headline\" id=\"Check_the_platform_version\">Check the platform version </h3><table><tbody><tr><th>Role</th><th>Location</th></tr><tr><td>Suite admin</td><td>Bastion node</td></tr></tbody></table><p>Make sure that you are upgrading from the correct version. To do this, run the following command on the bastion node:</p><pre>kubectl get cm  cdf -n core -o yaml | grep PLATFORM_VERSION</pre><p>Confirm that the returned value is your current version and allows upgrading to your target version.</p><h3 class=\"mw-headline\" id=\"Download_the_cloud_deployment_package_to_the_bastion_node\">(OpenShift) Create new security context constraints for OMT</h3><p>This section applies only if you have not already installed security context constraint (SCC) for OMT.</p><p>For an OpenShift deployment, you need to create a new SCC for OMT. Use the following steps to create a new SCC for OMT:</p><ol><li>Run the following commands to create a new SCC with the helm chart:\n\t<pre>cd &lt;OMT_External_K8s_2x.x-xxx&gt;/bin\nhelm install scc -n core --set namespace=core ../cdf/charts/itom-openshift-scc-x.x.x.tgz --disable-openapi-validation</pre></li><li>After installing the helm chart successfully, run the following command to check the SCC:\n\t<pre>oc get scc microfocus-core -oyaml </pre><p>Your terminal resembles the following: </p><pre>[root@exampleopenshift8th ~]# oc get scc microfocus-core -oyaml\nallowHostDirVolumePlugin: false\nallowHostIPC: false\nallowHostNetwork: false\nallowHostPID: false\nallowHostPorts: false\nallowPrivilegeEscalation: true\nallowPrivilegedContainer: false\nallowedCapabilities: null\napiVersion: security.openshift.io/v1\ndefaultAddCapabilities: null\nfsGroup:\n  type: RunAsAny\ngroups: \n- system:serviceaccount:test-suite\nkind: SecurityContextConstraints\nmetadata:\n  annotations:\n    meta.helm.sh/release-name: testscc\n    meta.helm.sh/release-namespace: core\n  creationTimestamp: \"2021-09-09T09:44:17Z\"\n  generation: 1\n  labels:\n    app.kubernetes.io/managed-by: Helm\n  managedFields:\n  - apiVersion: security.openshift.io/v1\n    fieldsType: FieldsV1\n    fieldsV1:\n      f:fsGroup:\n        .: {}\n        f:type: {}\n      f:metadata:\n        f:annotations:\n          .: {}\n          f:meta.helm.sh/release-name: {}\n          f:meta.helm.sh/release-namespace: {}\n        f:labels:\n          .: {}\n          f:app.kubernetes.io/managed-by: {}\n      f:runAsUser:\n        .: {}\n        f:type: {}\n      f:seLinuxContext:\n        .: {}\n        f:type: {}\n      f:supplementalGroups:\n        .: {}\n        f:type: {}\n      f:users: {}\n    manager: helm\n    operation: Update\n    time: \"2021-09-09T09:44:17Z\"\n  name: microfocus-core\n  resourceVersion: \"34017459\"\n  selfLink: /apis/security.openshift.io/v1/securitycontextconstraints/microfocus-core\n  uid: 68472ccf-dd99-4f7c-9384-adf0839b0084\npriority: null\nreadOnlyRootFilesystem: false\nrequiredDropCapabilities: null\nrunAsUser:\n  type: RunAsAny\nseLinuxContext:\n  type: MustRunAs\nsupplementalGroups:\n  type: RunAsAny\nusers: []\nvolumes:\n- awsElasticBlockStore\n- azureDisk\n- azureFile\n- cephFS\n- cinder\n- configMap\n- csi\n- downwardAPI\n- emptyDir\n- ephemeral\n- fc\n- flexVolume\n- flocker\n- gcePersistentDisk\n- gitRepo\n- glusterfs\n- iscsi\n- nfs\n- persistentVolumeClaim\n- photonPersistentDisk\n- portworxVolume\n- projected\n- quobyte\n- rbd\n- scaleIO\n- secret\n- storageOS\n- vsphere</pre></li></ol><h3 class=\"mw-headline\">Download and upload the images</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UpgradeCDFBYOK|UploadImages|N\"></span><table class=\"Table\" style=\"width:213px; background:white; border-collapse:collapse; border:none\" width=\"0\"><tbody><tr><td style=\"border-bottom:1px dotted lightgrey; padding:8px 8px 8px 8px; background-color:#f3f3f3; border-top:1px dotted lightgrey; border-right:1px dotted lightgrey; border-left:1px dotted lightgrey\" valign=\"top\"><span style=\"font-size:11pt\"><span style=\"line-height:normal\"><span style=\"font-family:Calibri,sans-serif\"><b><span style=\"font-size:12.0pt\"><span style='font-family:\"Segoe UI Emoji\",sans-serif'><span style=\"color:#333333\">Role</span></span></span></b></span></span></span></td><td style=\"border-bottom:1px dotted lightgrey; padding:8px 8px 8px 8px; background-color:#f3f3f3; border-top:1px dotted lightgrey; border-right:1px dotted lightgrey; border-left:none\" valign=\"top\"><span style=\"font-size:11pt\"><span style=\"line-height:normal\"><span style=\"font-family:Calibri,sans-serif\"><b><span style=\"font-size:12.0pt\"><span style='font-family:\"Segoe UI Emoji\",sans-serif'><span style=\"color:#333333\">Location</span></span></span></b></span></span></span></td></tr><tr><td style=\"border-bottom:1px dotted lightgrey; padding:8px 8px 8px 8px; background-color:white; border-top:none; border-right:1px dotted lightgrey; border-left:1px dotted lightgrey\" valign=\"top\"><span style=\"font-size:11pt\"><span style=\"line-height:normal\"><span style=\"font-family:Calibri,sans-serif\"><span style=\"font-size:12.0pt\"><span style='font-family:\"Segoe UI Emoji\",sans-serif'><span style=\"color:#333333\">Suite admin</span></span></span></span></span></span></td><td style=\"border-bottom:1px dotted lightgrey; padding:8px 8px 8px 8px; background-color:white; border-top:none; border-right:1px dotted lightgrey; border-left:none\" valign=\"top\"><span style=\"font-size:11pt\"><span style=\"line-height:normal\"><span style=\"font-family:Calibri,sans-serif\"><span style=\"font-size:12.0pt\"><span style='font-family:\"Segoe UI Emoji\",sans-serif'><span style=\"color:#333333\">Bastion node</span></span></span></span></span></span></td></tr></tbody></table><ol><li><span style=\"font-size:11pt\"><span style=\"background:white\"><span style=\"color:#333333\"><span style=\"line-height:normal\"><span style=\"tab-stops:list .5in\"><span style=\"font-family:Calibri,sans-serif\"><span style=\"font-size:12.0pt\"><span style='font-family:\"Segoe UI Emoji\",sans-serif'>Run the following command to navigate to the scripts directory in the unzipped OMT package. In this command, <code>&lt;OMT_package&gt;</code> is a placeholder for the path to the unzipped OMT package.</span></span></span></span></span></span></span></span><pre><code>cd /&lt;OMT_package&gt;/scripts</code></pre><p>\tFor example, you run the following command:\n</p><pre><code>cd OMT_External_K8s_2x.x-xxx/scripts</code></pre></li><li>Run the following command to download the images:\n\t<pre><code>./downloadimages.sh -r &lt;Docker_hub_repository&gt; -u &lt;user&gt; –p &lt;password&gt; (or –f &lt;key_file&gt;) -o &lt;organization_name&gt;  --config  ./cdf-image-set.json -d &lt;image_download_path&gt; –y</code></pre><p><br/>\n\tWhere:\n</p><ul><li>The <code>-r</code> option specifies the URL of the Docker hub image repository.</li><li>The <code>-u</code> and -p options specify the registry credentials that we gave you.\n\t\t<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\">By selecting the <code>-p</code> option, you are disabling or bypassing security features, thereby exposing the system to increased security risks. By using this option, you understand and agree to assume all associated risks and hold OpenText harmless for the same.<br/>\n\t\tOpenText encourages you to use some other password options, which aren't provided by OpenText. By implementing the -p option, you may expose the system to increased security risks. You understand and agree to assume all associated risks and hold OpenText harmless for the same. It's always your sole responsibility to assess its own regulatory and business requirements. OpenText doesn't represent or warrant that its products comply with any specific legal or regulatory standards applicable to you in conducting your business.</div></div></li><li>The <code>-f</code> option specifies the key file for the image registry.</li><li>The <code>-o</code> option specifies the name of the namespace or organization where you can find the product images. The default value is <code>hpeswitom</code>.</li><li>The <code>-d</code> option specifies the temporary location where you will download the image files.</li></ul><p><br/>\n\tFor example, you run the following command:\n</p><pre><code>./downloadimages.sh -r docker.io -u user –p password --config ./cdf-image-set.json -d  ../test -o hpeswitom –y </code></pre></li><li>Run the following command to upload the images to the external registry:\n\t<pre><code>./uploadimages.sh -d &lt;downloaded_suite_image_directory&gt; -r &lt;external_repository_URL&gt; -o &lt;organization_name&gt; -u &lt;registry-user&gt;  -p &lt;password&gt;  (or -f &lt;key_file&gt;)</code></pre><p><br/>\n\tWhere:\n</p><ul><li>The <code>-d</code> option specifies the directory to which you downloaded the images.</li><li>The <code>-r</code> option specifies the URL of the external image repository.</li><li>The <code>-o</code> option specifies the name of the namespace or organization in which you can find the product images. The default value is <code>hpeswitom</code>.</li><li>The <code>-u</code> option specifies the external registry user who has the permission to upload images. You don't need to specify the <code>-u</code> option if the external registry supports anonymous upload.</li><li>The <code>-p</code> option specifies the password of the external registry user. You don't need to specify the <code>-p</code> option if the external registry supports anonymous upload.\n\t\t<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\">By selecting the <code>-p</code> option, you are disabling or bypassing security features, thereby exposing the system to increased security risks. By using this option, you understand and agree to assume all associated risks and hold OpenText harmless for the same.<br/>\n\t\tOpenText encourages you to use some other password options, which aren't provided by OpenText. By implementing the <code>-p</code> option, you may expose the system to increased security risks. You understand and agree to assume all associated risks and hold OpenText harmless for the same. It always remains your sole responsibility to assess its own regulatory and business requirements. OpenText doesn't represent or warrant that its products comply with any specific legal or regulatory standards applicable to you in conducting your business.</div></div></li><li>The <code>-f</code> option specifies the key file for the external registry.</li></ul><p>\tFor example, you run the following command:\n</p><pre><code>./uploadimages.sh -d ../test -r gcr.io -o hpeswitom -u user -p password</code></pre></li><li>Wait until the images are successfully uploaded.</li></ol><p><br/></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UpgradeCDFBYOK|UploadImages|N\"></span><h3 class=\"mw-headline\" id=\"Transfer_images_from_the_source_registry_to_your_own_registry\">Ensure that all the pods are running</h3><p>All pods in the OMT namespace of each node must be running when you perform the upgrade. To check the status of the pods, run the following command on the bastion node:</p><pre><code>kubectl get pods -n $CDF_NAMESPACE | grep -v 1/1 | grep -v 2/2 | grep -v 3/3 | grep -v 4/4 | grep -v Completed</code></pre><p>This command returns a list of abnormal pods. When it returns no results, all the pods are ready. </p><h2 class=\"mw-headline\" id=\"Upgrade_procedure\">Upgrade procedure</h2><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UpgradeCDFBYOK|Upgrade|N\"></span><table style=\"margin-bottom:10px;\"><tbody><tr><th>Role</th><th>Location</th></tr><tr><td>Suite admin</td><td>Bastion node</td></tr></tbody></table><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"> \n<ul><li>You must perform the upgrade procedure with the same user that installed OMT. If you use a different user, an error will occur as follows:\n\t<pre>Failed to find CDF_HOME. Please make sure CDF_HOME is in $HOME/itom-cdf.sh</pre></li><li>Don't delete any file folders generated during upgrade. Otherwise, the upgrade process might fail.</li></ul></div></div><ol><li>On the bastion node, navigate to the unzipped <code>OMT_External_K8s_2x.x-xxx</code> directory. For example, you run the following command:<br/><br/><code>cd OMT_External_K8s_2x.x-xxx</code></li><li>Run the following command. This command upgrades the OMT components.<br/><br/><code>./upgrade.sh -u</code><br/><br/>\n\tTo confirm any prompts or accept the default values during this process, you can run the command with the <code>-y</code> option.</li><li>When the upgrade process is successfully completed, the console displays the following message:\n\t<p><code>Successfully completed AppHub components upgrade process.</code></p></li></ol><p>To check that all pods are running, run the following command on the bastion node:</p><pre><code>kubectl get pods -n $CDF_NAMESPACE</code></pre><p>To view only those pods not in the <code>Running</code> state, run the following command:</p><pre><code>kubectl get pod -n $CDF_NAMESPACE |grep -v 1/1|grep -v 2/2|grep -v 3/3|grep -v 4/4|grep -v Completed</code></pre><p style=\"margin-bottom:10px;\">To check the OMT version number after the upgrade, run the following command. The <code>PLATFORM_VERSION</code> line displays the version number. <code>CDF_NAMESPACE</code> is under <code>$HOME/itom-cdf.sh</code>.</p><p><code>kubectl get cm cdf -n $CDF_NAMESPACE -o json | jq -r \".data.PLATFORM_VERSION\"</code></p><p><br/></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UpgradeCDFBYOK|Upgrade|N\"></span><h2 class=\"mw-headline\" id=\"Post-upgrade_tasks\">Post-upgrade tasks</h2><p>Perform the following post-upgrade tasks.</p><h3>Clear the browser cache</h3><p>You must clear the browser cache before you first log in to the OMT Management Portal to upgrade the suite. </p><h3>(AKS only) Reconfigure the load balancer for port 5443</h3><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>This task is only needed if you are upgrading a deployment on AKS.</div></div></div><table><tbody><tr><th>Role</th><th>Location</th></tr><tr><td>Cloud administrator &amp; IT / Network administrator</td><td>Azure Cloud console</td></tr></tbody></table><p>Upgrading OMT will remove the original load balancer for port 5443, so you need to reconfigure the original load balancer for port 5443.</p><p>Make sure you configure the application gateway with the correct IP address:</p><ol><li>Open the <b>Application gateways</b> service and select your application gateway from the list.</li><li>Click <b>Backend Pools</b>, and open the pool for 5443.</li><li>Check that the <b>Target</b> column displays the IP address of the load balancer created for port 5443.  You can get the IP address by using the <code>kubectl get svc portal-ingress-controller-svc -n core | grep -v EXTERNAL-IP |awk '{print $4}'</code> command. If not, enter the correct IP address.</li></ol><h3>Reapply your Alertmanager rules</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-ReapplyAlertmanagerRules||N\"></span><p class=\"mw-empty-elt\">\n</p><p>If you had configured Prometheus Alertmanager rules by using command line flags and a configuration file, you must reapply the rules after you upgrade OMT. There is no need to do this if you configured Alertmanager rules by using a Helm command.</p>\n<p><br/>\n</p>\n<p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-ReapplyAlertmanagerRules||N\"></span></div>",
  "modifiedon": "2025-10-24 08:51:12"
}