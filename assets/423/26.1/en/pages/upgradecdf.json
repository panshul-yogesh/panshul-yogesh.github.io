{
  "title": "Upgrade OMT (embedded Kubernetes)",
  "content": "<div class=\"mw-parser-output\"><p>You can upgrade ITOM OPTIC Management Toolkit (OMT) either by using an autoUpgrade script or manually.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div> The autoUpgrade script requires passwordless SSH connections between cluster nodes. If you can't configure passwordless SSH, you can still perform a manual upgrade.  </div></div></div><h2><a id=\"Plan\" name=\"Plan\" title=\"Plan\"></a>Plan </h2><p>To create an upgrade plan, review the following information.</p><h3><a id=\"Select_an_upgrade_method\" name=\"Select_an_upgrade_method\" title=\"Select an upgrade method\"></a>Select an upgrade method</h3><p>You can upgrade OMT manually or use the <code>autoUpgrade </code>script to do the upgrade. The <code>autoUpgrade</code> script requires passwordless SSH connections between cluster nodes. If you cannot configure passwordless SSH, you can still perform a manual upgrade.</p><p>Additionally, you can upgrade OMT in one of the following modes according to your business requirements:</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 28px; position: relative;\">Hot upgrade: In this mode, OMT is upgraded with no downtime. This requires you to run a shell script (podReScheduler.sh) before upgrading each worker node to reschedule those singleton pods of deployments or StatefulSets on the worker node to other worker nodes in advance. You can find the <code>podReScheduler.sh</code> script in the <code>upgrade</code> folder in the SMA Operation Toolkit package, available to download from the <a href=\"https://marketplace.opentext.com/itom/content/service-management-automation-operation-toolkit\" rel=\"nofollow\" target=\"1\" title=\"Download Service Management Automation Operation Toolkit\">ITOM Marketplace</a>.</li><li style=\"margin-left: 28px; position: relative;\">Non-hot upgrade: In this mode, OMT is upgraded with downtime. When a worker node is being upgraded, the worker node is shut down and all the pods on it are killed and then rescheduled to other worker nodes. Since the singleton pods are not rescheduled in advance, affected services are temporarily unavailable.</li></ul><p>The following describes the high-level upgrade steps of the two OMT upgrade modes: hot upgrade, and non-hot upgrade. </p><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>You can't mix the upgrade methods. For example, if you used the <code>autoUpgrade</code> script to upgrade to your current version, you must also use the script to upgrade OMT to the new version. Similarly, if the upgrade fails and you restart the upgrade process, you must continue to use the same upgrade method. </div></div></div><p><strong>Hot upgrade steps</strong></p><p>Hot upgrade applies only to the manual upgrade method:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Add firewall rules on each cluster node (if a firewall is enabled).</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Add one temporary worker node.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Complete the remaining prerequisite tasks required for a manual upgrade.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Copy the <code>podReScheduler.sh</code> script to a temporary directory on each worker node.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the <code>./upgrade.sh -i</code> command on the first control plane node, and then the remaining control plane nodes, in sequence.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the <code>podReScheduler.sh</code> script and then run the <code>./upgrade.sh -i</code> command on each worker node, in sequence.</li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the <code>./upgrade.sh -u</code> command on one control plane node.</li></ol><p>For more detailed instructions, see the \"Upgrade OMT manually\" section below.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>The \"Upgrade OMT manually\" section does not mention the step to run the <code>podReScheduler.sh</code> script. For a hot upgrade, be sure to run this script before running the <code>./upgrade.sh -i</code> command on each worker node.</div></div></div><p><strong>Non-hot upgrade steps</strong></p><p>Non-hot upgrade applies to both the auto and manual upgrade methods.</p><p>Auto upgrade:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Add firewall rules on each cluster node (if a firewall is enabled).</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Add one temporary worker node.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Complete the remaining prerequisite tasks required for an auto upgrade.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the <code>autoUpgrade</code> script on one node.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">(Optional) Remove the files in the working directory on each node.</li></ol><p>For more detailed instructions, see the \"Upgrade OMT by using the <code>autoUpgrade</code> script\" section below.</p><p>Manual upgrade:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Add firewall rules on each cluster node (if a firewall is enabled).</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Add one temporary worker node.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Complete the remaining prerequisite tasks required for a manual upgrade.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the <code>./upgrade.sh -i</code> command on the first control plane node, then on the remaining control plane nodes, and finally on all worker nodes, in sequence.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the <code>./upgrade.sh -u</code> command on one control plane node.</li></ol><p>For more detailed instructions, see the \"Upgrade OMT manually\" section below.</p><h3><a id=\"Select_an_upgrade_point\" name=\"Select_an_upgrade_point\" title=\"Select an upgrade point\"></a>Select an upgrade point</h3><p>If you upgrade OMT by using the <code>autoUpgrade</code> script, download the upgrade package to one location, and then run the script once from that location. This location can be outside of the cluster. </p><p>To perform a manual upgrade, you must copy the upgrade package to every cluster node, and then run the upgrade commands on every node, in sequence.</p><h3><a id=\"Required_disk_space_and_available_memory\" name=\"Required_disk_space_and_available_memory\" title=\"Required disk space and available memory\"></a>Required disk space and available memory</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UpgradeRequiredDiscSpace||N\"></span><p class=\"mw-empty-elt\"></p><p>If the file system size is less than or equals to 100 GB, the disk space required to upgrade OMT is at least 20% of the entire file system. If the file system size is more than 100 GB, the disk space required to upgrade OMT is at least <code>((20/&lt;filesystem size&gt;)*100)%</code> of the entire file system. If the <code>&lt;CDF_HOME&gt;</code> directory also locates on the file system plus a further 15 GB (if using the <code>upgrade.sh</code> script) or 20 GB (if using the <code>autoUpgrade</code> script) on all control plane and worker nodes. If the NFS server is inside the Kubernetes cluster, the upgrade process also requires 10 GB of free space on the node that hosts the NFS server. The reason that we don't require a fixed amount of free space is that Kubernetes will start to clean images when disk usage exceeds 80%. In this situation, OMT can't load any new images, and the upgrade fails.</p><p><code>&lt;CDF_HOME&gt;</code> refers to the home path of your OMT installation (by default, this is <code>/opt/cdf</code>). In addition, the temporary directory on each node (by default, this is <code>/tmp</code>) must have at least 1 GB of free disk space available to it. Note that this is the disk space required to perform the upgrade process only (to run the <code>upgrade.sh</code> command). If you are using a local registry, you will need a further 10 GB on the first control plane node to execute the <code>upgrade.sh -i</code> command. Because <code>uploadimages.sh</code> (called by upgrade) requires extra space to upload images. You will also require enough disk space on each node to back up all your data.</p><p>If you are upgrading from an earlier version which requires you to download intermediate versions, the uncompressed OMT/CDF packages for each version will take up a bit more disk space. For example, if you are upgrading from 2021.11 to 2022.11, you have to download both 2022.05 and 2022.11 packages.<br/><br/>\nAdditionally, the OMT upgrade process consumes up to 10% of CPU and 10% of the available memory on each cluster node. If either the CPU or memory consumption is too high, the upgrade process may fail. To check the CPU and memory consumption, run the following command on any control plane or worker node:</p><pre><code>kubectl top node</code></pre><p><br/>\nAfter you run the command, your terminal resembles the following:</p><pre><code>[root@shc cfg]# kubectl top node\n NAME                         CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%\n 192.0.2.0                    245m         3%    5554Mi          39%\n shc.mycompany.net            2279m        28%   12432Mi         87%</code></pre><p>If you've met a disk issue, refer to \"Free disk space for control plane nodes and worker nodes\" for a solution. </p><p><br/></p><p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UpgradeRequiredDiscSpace||N\"></span><h3><a id=\"Upgrade_system_requirements\" name=\"Upgrade_system_requirements\" title=\"Upgrade system requirements\"></a>Upgrade system requirements</h3><p>Check the system requirements for the new version. For more information, see <a href=\"/doc/423/26.1/supportmatrixonprem\" title=\"System requirements (on-premises)\">System requirements (on-premises)</a>.</p><h3><a id=\"Free_up_disk_space_for_control_plane_nodes_and_worker_nodes\" name=\"Free_up_disk_space_for_control_plane_nodes_and_worker_nodes\" title=\"Free up disk space for control plane nodes and worker nodes\"></a>Free up disk space for control plane nodes and worker nodes</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-FreeDiskSpace||N\"></span><p class=\"mw-empty-elt\"></p><div>If you don't have enough disk space for the upgrade, perform the following steps to free up the disk space: </div><ol><li>Remove the offline download image directory if it exists. By default, the directory is <code>/var/opt/cdf/offline</code>.</li><li>Remove the OMT build bundle file if it exists. The name of the bundle file resembles <code>OMT_Embedded_K8s_&lt;release number&gt;.zip</code>.</li><li>Run the following commands to clean up unused images from the cache on the current node:\n\t<pre><code>for im in `ctr i ls | grep -- /pause: | awk '{print $1}'`\ndo\n\t   ctr i export bk-pause-`date +%s`.tar $im\n\t   sleep 1\ndone\n\t \ncrictl rmi -q\n\t \nls bk-pause-*.tar | xargs -i sh -c \"ctr i import {}; rm -f {}\"</code></pre></li></ol><p>If If you don't have enough disk space on the NFS server, you can also perform the following steps to free up the disk space:</p><ol><li>Locate the OMT log files folder on NFS server with the below command:\n\t<pre><code>kubectl get pv -o json|jq '.items[].spec | select(.claimRef.name==\"itom-logging-vol\")' |jq -r .nfs.path</code></pre></li><li>Go to the NFS server and remove the log files. Replace <code>&lt;nfs path&gt;</code> with the output from the previous step and <code>&lt;days&gt;</code> to indicate that you'll remove the log files which are older than the specified days:\n\t<pre><code>cd &lt;nfs path&gt;\nfind -mtime +&lt;days&gt; -name \"*.log\" -delete</code></pre>\n\tFor example, if you'll remove the log files that are older than 30 days, then it should be: <code>find -mtime +30 -name \"*.log\" -delete</code></li></ol><p><br/></p><p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-FreeDiskSpace||N\"></span><h2><a id=\"Prerequisite_tasks\" name=\"Prerequisite_tasks\" title=\"Prerequisite tasks\"></a>Prerequisite tasks</h2><p>Perform the following prerequisite tasks before the OMT upgrade. </p><h3><a id=\"Add_one_worker_node\" name=\"Add_one_worker_node\" title=\"Add one worker node\"></a>Add one worker node</h3><p>During the upgrade process, Kubernetes reschedules all running pods and deployments to the worker nodes that aren't currently being upgraded. If your cluster doesn't have enough worker nodes to cover all the pods and deployments, we recommend you add one or more worker nodes before the upgrade.</p><p>Normally, for SMA, you can add one worker node. For detailed steps to add a worker node, see <a href=\"/doc/406/25.4/addadditionalworker\" title=\"Add or remove nodes from a cluster on the Management portal\">Add or remove nodes from a cluster by using the CLI</a>.</p><h3><a id=\"Check_that_the_hostname_has_not_changed\" name=\"Check_that_the_hostname_has_not_changed\" title=\"Check that the hostname has not changed\"></a>Check that the hostname has not changed</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-CheckHostnameUpgrade||N\"></span><p class=\"mw-empty-elt\"></p><table><tbody><tr><th>Role</th><th>Location</th><th>Privileges required</th></tr><tr><td>System administrator</td><td>Node where you will run the upgrade</td><td>Root or sudo</td></tr></tbody></table><p>If the hostname of the node where you run the upgrade has changed since you installed OMT, the current hostname and the hostname stored in the <code>${CDF_HOME}/bin/env.sh</code> file won't match. If the hostnames don't match, the upgrade process can't identify the node as being inside the cluster. Therefore, the upgrade preliminary check verifies the hostnames and pauses the upgrade if it finds a mismatch.</p><p>To check that the current hostname matches the hostname that's stored in the <code>${CDF_HOME}/bin/env.sh</code> file, follow these steps:</p><ol><li>Run the following command to identify the current hostname:\n\t<pre><code>hostname -f</code></pre></li><li>Run the following command to check the hostname stored in the <code>${CDF_HOME}/bin/env.sh</code> file. The value of the <code>THIS_NODE</code> key in the command output must match the hostname that you identified in step 1.\n\t<pre><code>cat ${CDF_HOME}/bin/env.sh</code></pre></li><li> Run the following command to query the cluster nodes. The command output must include the hostname that you identified in step 1.\n\t<pre><code>kubectl get nodes</code></pre></li></ol><p>If the hostname doesn't match, reset the hostname with the following command:</p><pre><code>hostnamectl set-hostname &lt;node_hostname&gt;</code></pre><p><br/></p><p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-CheckHostnameUpgrade||N\"></span><h3><a id=\"Confirm_the_Subject_Alternative_Name_certificate_contains_the_hostname\" name=\"Confirm_the_Subject_Alternative_Name_certificate_contains_the_hostname\" title=\"Confirm the Subject Alternative Name certificate contains the hostname\"></a>Confirm the Subject Alternative Name certificate contains the hostname</h3><p>Use Subject Alternative Name (SAN) certificates instead of Common Name (CN) certificates. Make sure your Subject Alternative Name (SAN) certificates contain the external access hostname (FQDN). If the SAN doesn't contain the FDQN, an error is displayed when you run the upgrade, and you won't be able to continue with the upgrade until you update the certificates. For details on how to update your OMT certificates, see <a href=\"/doc/406/25.4/managecert\" title=\"Manage OMT certificates\">Manage OMT certificates</a>. </p><h3><a id=\"Make_sure_you_have_backed_up_data\" name=\"Make_sure_you_have_backed_up_data\" title=\"Make sure you have backed up data\"></a>Make sure you have backed up data</h3><p>Make sure that you have backed up OMT data. For details, see <a href=\"/doc/423/26.1/upgradebackupcdf\" title=\"Back up OMT data before upgrade\">Back up OMT data before upgrade</a>.</p><h3><a id=\"Download_unzip_and_verify_the_upgrade_package\" name=\"Download_unzip_and_verify_the_upgrade_package\" title=\"Download, unzip, and verify the upgrade package\"></a>Download, unzip, and verify the upgrade package</h3><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Visit <a href=\"https://sld.microfocus.com/mysoftware/index\" title=\"Software Licenses and Downloads Portal\">Software Licenses and Downloads Portal</a> and download the OMT installation and upgrade package (OMT243-xxx-15001-Embedded-K8s.zip). If you are performing a manual upgrade, download this package to a temporary directory on every control plane node and worker node; if you're going to use the <code>autoUpgrade</code> script, download the package to a temporary directory on the node or endpoint where you will run the <code>autoUpgrade</code> script. </li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the unzip command to unzip the package:\n\t<pre>unzip OMT243-xxx-15001-Embedded-K8s.zip\n</pre></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Save the .zip and .zip.sig files from the unzipped package in the same directory.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">You will use GNU Privacy Guard (GnuPG) to verify the OMT upgrade package. If you haven't already done so, download and install GnuPG on your machine.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">You will need a public key to verify the OMT installation package. Visit <a href=\"https://portal.microfocus.com/s/article/KM000003948?language=en_US\" title=\"KM000003948\">KM000003948</a> to get detailed steps on how to verify signatures, and use the <code>ot-package-sign.pub</code> key that you can download from this article to verify the package.</li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\">If you are upgrading by using the <code>autoUpgrade</code> script, unzip the .zip file to a temporary directory on the same node:\n\t<pre>unzip OMT_Embedded_K8s_2x.x-xxx.zip</pre><strong>Notes</strong>:\n\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">Make sure that no installation packages are in the temporary directory.</li><li style=\"margin-left: 40px; position: relative;\">Make sure that no upgrade packages from earlier versions are in the temporary directory.</li></ul></li><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">If you are upgrading manually, run the following command to unzip the file, and then save the unzipped folder to a temporary directory on every control plane node and worker node:\n\t<pre>unzip OMT_Embedded_K8s_2x.x-xxx.zip</pre></li></ol><h3><a id=\"Disable_on_access_security_scans\" name=\"Disable_on_access_security_scans\" title=\"Disable on-access security scans\"></a>Disable on-access security scans</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-DisableOnAcessScanUpgrade||N\"></span><p class=\"mw-empty-elt\"></p><p>OMT upgrade may fail if you have enabled on-access scanning by security products such as McAfee Endpoint Security, Microsoft Defender, or TrendMicro Deep Security Agent in your environment.</p><p>This failure often occurs because the security product can't handle the large number of small files that are created and deleted during the image download and upload process. To prevent this, we recommend that you exclude certain directories on the first control plane node from the on-access scan during the upgrade. You can remove these exclusions afterwards, although you may have to reinstate them when you next upgrade OMT.</p><ul><li><code>&lt;RUNTIME_CDFDATA_HOME&gt;</code>. The kubernetes infrastructure runtime data directory. The default directory is <code>opt/cdf/data</code>. Make sure that you exclude the <code>&lt;RUNTIME_CDFDATA_HOME&gt;</code> directory and all its subdirectories.</li><li>The temporary installation directory. By default, this is <code>/tmp</code>, unless you have defined a different value in the <code>TMP_FOLDER</code> parameter of the <code>install.properties</code> file.</li><li><code>/var/opt/cdf/offline/</code> This is the default directory to which OMT downloads images.</li></ul><p>For detailed information about how to exclude directories from on-access scans, refer to your security provider's documentation.</p><p><br/></p><p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-DisableOnAcessScanUpgrade||N\"></span><h3><a id=\"Upload_the_images_if_you_use_an_external_registry\" name=\"Upload_the_images_if_you_use_an_external_registry\" title=\"Upload the images if you use an external registry\"></a>Upload the images if you use an external registry</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UploadImagesUpgrade||N\"></span><p class=\"mw-empty-elt\"></p><p>If you use an external image registry, follow the same steps that you used when you installed OMT to upload the images to the registry.</p><p>Additionally, you must run the following commands to upload the Kubernetes images to the external registry:</p><pre><code>&lt;upgrade_package&gt;/scripts/uploadimages.sh -F &lt;upgrade_package&gt;/k8s/images/infra-common-images.tgz -u &lt;username&gt; -r &lt;image_repository_URL&gt; -o &lt;REGISTRY_ORGNAME&gt;\n&lt;upgrade_package&gt;/scripts/uploadimages.sh -F &lt;upgrade_package&gt;/k8s/images/infra-master-images.tgz -u &lt;username&gt; -r &lt;image_repository_URL&gt; -o &lt;REGISTRY_ORGNAME&gt;\n&lt;upgrade_package&gt;/scripts/uploadimages.sh -F &lt;upgrade_package&gt;/cdf/images/cdf-all-images.tgz -u &lt;username&gt; -r &lt;image_repository_URL&gt; -o &lt;REGISTRY_ORGNAME&gt;</code></pre><ul><li>Replace <code>&lt;upgrade_package&gt;</code> with the path to the upgrade package.</li><li>Replace <code>&lt;image_repository_URL&gt; </code>with the URL of the external registry. You can format the URL with the HTTP or HTTPS protocol, or not specify a protocol (in this case, the protocol defaults to HTTPS). For example: <code>image-registry.com:443</code>, <code>http://image-registry.com</code>, or <code>https://image-registry.com</code>.</li><li>Replace <code>&lt;username&gt;</code> with the username of the registry user. If you don't specify the credentials here, the command will prompt you to specify them.</li><li>Replace <code>&lt;REGISTRY_ORGNAME&gt;</code>: The organization in the image registry that contains the images for installation. By default, this is <code>hpeswitom.</code> This option is mandatory if you aren't using the default organization name.</li><li>Use <code>--cleanup</code> option to delete the image source folder to save disk space. It only works when all images are uploaded successfully.</li></ul><p>When the images are successfully uploaded, your terminal resembles the following:</p><pre>Upload-process successfully completed.</pre><p><br/></p><p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UploadImagesUpgrade||N\"></span><h3><a id=\"Use_sudo_to_enable_a_regular_user_to_upgrade_OMT_on_the_embedded_K8s\" name=\"Use_sudo_to_enable_a_regular_user_to_upgrade_OMT_on_the_embedded_K8s\" title=\"Use sudo to enable a regular user to upgrade OMT on the embedded K8s\"></a>Use sudo to enable a regular user to upgrade OMT on the embedded K8s</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-AutoSudoUpg|Intro|N\"></span><p>OMT requires root permission to upgrade OMT. If the root users have security concerns to give a regular user the root password, you can delegate authority to a regular user. You can revoke these permissions after the upgrade if required.</p><div class=\"Admonition_Important\"><strong><span class=\"autonumber\">Important: </span></strong>You might have created a regular user with root permission during installation or a previous upgrade. However, that user may not have all the required permissions to perform the upgrade.\n<ul><li class=\"Admonition_Note\">The regular user with root permission created to install OMT doesn't have all the required permissions to perform an upgrade. Specifically, they don't have permission to the <code>/usr/bin/helm</code> command and to run the <code>upgradePreCheck</code> and upgrade scripts.</li><li class=\"Admonition_Note\">The regular user with root permission created to perform a previous upgrade doesn't have permission to run the upgrade script in the current OMT package. </li><li class=\"Admonition_Note\">The permissions required to perform an upgrade vary from release to release. The regular user with root permission created to perform a previous upgrade doesn't automatically have all the permissions required to perform this upgrade.</li></ul>\nTo make sure the upgrade process runs successfully, it's highly advisable you rerun the <code>node_prereq</code> script to delegate upgrade authority to the specified user again.</div><p>The <code>node_prereq</code> script can grant a specified regular user authority to run all the commands required to upgrade OMT. For a full command list that a regular user can run after granting permissions, refer to \"Use sudo to enable a regular user to install, upgrade, or administer OMT\" in the <strong>Administer</strong> section.</p><p><br/></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-AutoSudoUpg|Intro|N\"></span><p><strong>Delegate the authority to perform an automated upgrade of OMT to a regular user</strong></p><p>You can only delegate authority to upgrade OMT to a regular user on the node where there is an earlier version of OMT installed. To configure sudo permission, you must run the <code>node_prereq</code> script on the cluster node with a root user and the regular user must already exist on the node. Perform the following steps to delegate authority to a regular user:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p>Download the OMT package on a cluster node and unzip it.</p></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Change the directory to the OMT package directory and run the following command to delegate authority to upgrade OMT to a regular user:\n\t<pre><code>./node_prereq --sudo-user &lt;username&gt; --sudo-for upgrade</code></pre>\n\tThe  <code>&lt;username&gt;</code> in the command refers to the user that you'll specify by the <code>-u</code> option when you run the <code>autoUpgrade</code> script.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">After finishing the permission configuration on the first node, manually copy the files: <code>/etc/sudoers.d/OMT_cmnd_alias_upgrade</code>,<code> /etc/sudoers.d/OMT_&lt;username&gt;_permission</code> from the first node to the <code>/etc/sudoers.d</code> directory on all other nodes. Ensure that the permission to the file is 440. </li></ol><p>If you want to specify the working directory using the <code>-d</code> option when running the <code>autoUpgrade</code> script, specify the same working directory with <code>--auto-upgrade-working-folder</code> option when running <code>node_prereq</code>:</p><pre><code>./node_prereq --sudo-user &lt;username&gt; --sudo-for upgrade --auto-upgrade-working-folder &lt;working_directory&gt;</code></pre><p><span style='color: rgb(51, 51, 51); font-family: Roboto, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; font-size: 16px;'>After the regular user has got the required authorities, run the command to get a list of commands you can run as a regular user:</span></p><pre><code>#sudo -n -ll -U &lt;username&gt;</code></pre><p>If you'll perform an automated upgrade of OMT as a regular user, for example, you can run <code>./autoUpgrade -n 192.0.2.0 -u &lt;username&gt;</code>.</p><p><strong>Delegate the authority to perform a manual upgrade of OMT to a regular user</strong></p><p>You can only delegate authority to upgrade OMT to a regular user on the node where there is an earlier version of OMT installed. To configure sudo permission, you must run the <code>node_prereq</code> script on the cluster node with a root user and the regular user must already exist on the node. Perform the following steps to delegate authority to a regular user:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p>Download the OMT package on a cluster node and unzip it.</p></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Change the directory to the OMT package directory and run the following command to delegate authority to upgrade OMT to a regular user:\n\t<pre><code>./node_prereq --sudo-user &lt;username&gt; --sudo-for upgrade</code></pre></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">After finishing the permission configuration on the first node, manually copy the files: <code>/etc/sudoers.d/OMT_cmnd_alias_upgrade</code>,<code> /etc/sudoers.d/OMT_&lt;username&gt;_permission</code> from the first node to the <code>/etc/sudoers.d</code> directory on all other nodes. Ensure that the permission to the file is 440. </li></ol><p>After the regular user has got the required authorities, run the command to get a list of commands you can run as a regular user:</p><pre><code>#sudo -n -ll -U &lt;username&gt;</code></pre><p>To run the commands as a regular user, prefix the command with sudo.</p><p>For example, if you'll run <code>./upgrade.sh -i</code> as a regular user, run <code>sudo ./upgrade.sh -i</code> instead.</p><h3><a id=\"Configure_SSH_connections\" name=\"Configure_SSH_connections\" title=\"Configure SSH connections\"></a>Configure SSH connections</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-ConfigureSshUpgrade||N\"></span><p class=\"mw-empty-elt\"></p><table><tbody><tr><th>Role</th><th>Location</th><th>Privileges required</th></tr><tr><td>System administrator</td><td>Node or endpoint on which you run the script</td><td>Root or sudo</td></tr></tbody></table><p>Perform this step only if you are upgrading by using the <code>autoUpgrade</code> script.</p><p>If you run the <code>autoUpgrade</code> script from a node inside the cluster, the script will establish an SSH connection between that node and every node in the cluster, including the node on which you run the script. If you run the <code>autoUpgrade</code> script from an endpoint outside the cluster, the script will establish an SSH connection between that endpoint and every node in the cluster. You can use password based or passwordless SSH to do this. If you use password based SSH, you must specify the SSH user password by using the <code>-P</code> option when you run the <code>autoUpgrade</code> command. Note that this means that the SSH user password on every node must be the same.</p><p>We recommend that you configure passwordless SSH instead. Note that you don't need to configure passwordless SSH if you have already done this for an earlier upgrade.</p><div class=\"Admonition_Important\"><strong>Passwordless SSH and security</strong><br/><p><br/>\nPasswordless SSH uses asymmetric cryptographic key pairs to prevent you establishing an SSH connection to a target system unless your current system has a key that's paired to another key on the target system. The key pair comprises a private key (on the node on which you run the <code>autoUpgrade</code> script) and a public key (on all nodes).<br/><br/></p>\nPasswordless SSH offers increased security over purely password based authentication because, unlike passwords, you can't guess key pairs. You can't establish an SSH connection to a system that uses passwordless SSH unless you have a key. Although passwordless SSH enables you to establish SSH connections without entering a password, you can still configure a password for an added layer of security.</div><p>To configure passwordless SSH, follow these steps on the node or endpoint on which you will run the <code>autoUpgrade</code> script.</p><ol><li>If you will use a sudo user to perform the upgrade, log on to the node or endpoint as the sudo user. Otherwise, log on as the root user.</li><li>Run the following command to create a key pair:\n\t<pre><code>ssh-keygen -t &lt;algorithm&gt;</code></pre><p>\tIn this command, <code>&lt;algorithm&gt;</code> is a placeholder for the key algorithm. The supported algorithms are: RSA, DSA, ECDSA, and Ed25519. You can also use the optional <code>-b </code>option to specify the level of encryption (in bits). The default value is 2048 bit encryption.<br/><br/>\n\tFor example, to use the RSA algorithm and to set 4096 bit encryption, run the following command:\n</p><pre><code>ssh-keygen -b 4096 -t rsa</code></pre></li><li>Follow the displayed prompts to configure the key pair. If you want to use a password for an added layer of security, do that now.</li><li>The generated key pair includes a .key file and a .pub file. Don't share the .key file. This is the private key that grants the current node access to all nodes that have the matching public key. However, you must copy the .pub file (the public key) to all nodes, including the node on which you run the <code>autoUpgrade</code> script. To do this, run the following command once for each node:\n\t<pre><code>ssh-copy-id -i ~/.ssh/&lt;.pub file&gt; &lt;username&gt;@&lt;node IP address or hostname&gt;</code></pre><p><br/>\n\tFor example, if you are the root user and you want to run the <code>autoUpgrade</code> script on the control plane node (IP: 192.100.0.1), worker node 1 (192.168.0.2), and worker node 2 (192.168.0.3), and if you are using the RSA algorithm, you run the following commands:\n</p><pre>ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.100.0.1\n\nssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.0.2\n\nssh-copy-id -i ~/.ssh/id_rsa.pub root@192.100.0.3</pre><p>\tTo find the IP address or FQDN of every node in the cluster, run the following command from inside the cluster. The <code>NAME</code> column of the response indicates the IP address and hostname of each node.<br/>\n\t \n</p><pre><code>kubectl get nodes</code></pre></li><li>Run the following command to move the private key from the <code>~/.ssh/</code> directory to a safe location of your choice. This step is optional, but we strongly recommend that you do this. If you don't do this, any user may establish an SSH connection from this endpoint without entering the private key. Note that if you move the private key, you must specify the new location by using the <code>-i</code> option when you run the <code>autoUpgrade</code> command.\n\t<pre><code>mv ~/.ssh/&lt;key_file&gt; &lt;safe_location&gt;</code></pre><p>\tFor example, you run the following command:\n</p><pre><code>mv ~/.ssh/id_rsa /root/SafePlace</code></pre></li><li>Verify the passwordless SSH connection. To do this, run the appropriate command to log in to a node without a password:\n\t<ul><li>If you followed the previous step to move the key file:\n\t\t<pre><code>ssh -i &lt;safe_location&gt;/&lt;key_file&gt; &lt;username&gt;@&lt;node IP address or hostname&gt;</code></pre><p>\t\tFor example:\n</p><pre><code>ssh -i /root/SafePlace/id_rsa root@192.100.0.1</code></pre></li><li>If you didn't move the key file in the previous step:\n\t\t<pre><code>ssh &lt;username&gt;@&lt;ip_address&gt;or&lt;hostname&gt;</code></pre><p>\t\tFor example:\n</p><pre><code>ssh root@192.100.0.1</code></pre></li></ul></li></ol><p><br/></p><p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-ConfigureSshUpgrade||N\"></span><h3><a id=\"Make_sure_that_all_control_plane_nodes_and_worker_nodes_are_running\" name=\"Make_sure_that_all_control_plane_nodes_and_worker_nodes_are_running\" title=\"Make sure that all control plane nodes and worker nodes are running\"></a>Make sure that all control plane nodes and worker nodes are running</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-EnsureAllNodesRunning||N\"></span><p class=\"mw-empty-elt\"></p><table><tbody><tr><th>Role</th><th>Location</th><th>Privileges required</th></tr><tr><td>System administrator</td><td>Any control plane node</td><td>Root or sudo</td></tr></tbody></table><p>Make sure that all control plane and worker nodes are running. All pods in the OMT core namespace of each node must be running when you perform the upgrade. To check the status of the nodes, run the following command on any control plane node:<br/>\n </p><pre><code>${CDF_HOME}/bin/kube-status.sh</code></pre><p><br/><br/>\nIf all nodes are running as expected, the console displays the following message:<br/>\n </p><pre><code>K8S cluster is Running</code></pre><p><br/></p><p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-EnsureAllNodesRunning||N\"></span><h3><a id=\"Clean_up_unused_images\" name=\"Clean_up_unused_images\" title=\"Clean up unused images\"></a>Clean up unused images</h3><p>From release to release, OMT pulls the images from the private registry (NFS) to the worker nodes and control plane nodes to start the containers; however, it doesn't clean up unused images (for old releases). This may cause the docker storage to become full and hence the upgrade to fail when the containers try to pull images to the worker nodes or control plane nodes.</p><p>To avoid this issue, clean up unused images by running the following commands on each worker node. Don't run the <strong>kube-restart.sh</strong> script on more than one worker node at the same time. </p><pre><code>crictl rmi --prune\n${CDF_HOME}/bin/kube-restart.sh\n</code></pre><h2 id=\"Upgrade_procedure\"><a id=\"Upgrade_procedure\" name=\"Upgrade_procedure\" title=\"Upgrade procedure\"></a>Upgrade procedure</h2><p>Upgrade OMT according to whether you want to use the <code>autoUpgrade</code> script or not.  </p><h3 id=\"Upgrade_CDF_by_using_the_autoUpgrade_script\"><a id=\"Upgrade_OMT_by_using_the_autoUpgrade_script\" name=\"Upgrade_OMT_by_using_the_autoUpgrade_script\" title=\"Upgrade OMT by using the autoUpgrade script\"></a>Upgrade OMT by using the <code>autoUpgrade</code> script</h3><table><caption></caption><tbody><tr><th>Role</th><th>Location</th><th>Privileges required</th></tr><tr><td>System administrator</td><td>Node or endpoint where you downloaded the OMT package</td><td>Root or sudo</td></tr></tbody></table><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>Don't delete any files or folders generated during the upgrade. Otherwise, the upgrade process might fail.</div></div></div><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p>On the node or endpoint where you downloaded the OMT package, navigate to the unzipped OMT package directory.</p><p>For example, you run the following command:</p><pre><code>cd /temporary_directory/OMT_Embedded_K8s_2x.x-xxx</code></pre></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p>Run the following command:</p><pre>./autoUpgrade -n &lt;any_node_in_cluster&gt; </pre><p>Set the command line options in the <code>autoUpgrade</code> command as follows:</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\"><p><code>-d</code></p><p>The absolute path to the working directory for the upgrade on each node. For example, <code>-d /tmp_directory</code>. The directory must be empty, and the file system must have enough space for the upgrade. If you aren't the root user, ensure that you have permission to access this directory. The default value is <code>$HOME/autoUpgrade/work</code>.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\">Ensure that the working directory isn't the <code>$HOME</code> directory, the <code>$HOME/autoUpgrade</code> directory, or the directory in which you have saved the packages.</li><li style=\"margin-left: 52px; position: relative;\">The working directory must be empty.</li><li style=\"margin-left: 52px; position: relative;\">Don't change the upgrade file path for upgrading or if you need to rerun the upgrade.</li></ul></div></div></div></li><li style=\"margin-left: 40px; position: relative;\"><p><code>-n</code></p><p>The IP address of any node in the cluster. For example, <code>-n 192.0.2.0</code>. This command line option is mandatory.</p></li><li style=\"margin-left: 40px; position: relative;\"><p><code>-u</code></p><p>The user that's used for password based SSH connection to the cluster nodes. This user must have permission to operate on the cluster nodes. For example, <code>-u user1</code>. The default value is <code>root</code>. This command line option is mandatory only if you not using the root user to perform the upgrade.</p></li><li style=\"margin-left: 40px; position: relative;\"><p><code>-i</code></p><p>The <code>-i</code> option specifies the key file used for passwordless SSH connections to nodes in the cluster. You must specify this option if you have moved the key file from the default location to a safe location. Specify this option only if you have configured passwordless SSH. For example:</p><pre><code>-i rsa_id</code></pre></li><li style=\"margin-left: 40px; position: relative;\"> <code>-kp</code><br/>\n\t\tThe <code>-kp</code> (<code>keypass</code>) option specifies the passphrase for the private key.</li><li style=\"margin-left: 40px; position: relative;\"><p><code> -P</code></p><p>The <code>-P</code> option specifies the password used for password based SSH connections to nodes in the cluster. Specify this option only if you haven't configured passwordless SSH (we recommend that you do).  For example:</p><pre><code>-P MyPassword123</code></pre></li><li style=\"margin-left: 40px; position: relative;\"><p><code> -p</code></p><p>The <code>-p</code> option specifies the port number for SSH connections to nodes in the cluster. The default value is \"<code>22\"</code>.  For example:</p><pre><code>-p 22</code></pre></li><li style=\"margin-left: 40px; position: relative;\"><p><code>-o</code></p><p>The upgrade options. <strong>Note</strong>: starting from OMT 23.4, the upgrade versions are changed from <code>202xxx</code> to <code>2x.x</code>.</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 52px; position: relative;\"><p><code>--drain</code></p><p>Drains each worker node before it's upgraded. This command line option is optional. However, if the upgrade includes updates to CRI (Container Runtime Interface), this option helps reduce system downtime. If you use this option, don't use the worker node until the upgrade command finishes running. Note that if you face timeout issues when you use the <code>--drain</code> option, you must specify the option again when you run the <code>autoUpgrade</code> command again. Otherwise, you will need to manually uncordon the worker node.</p><p>To use this option, you must prefix it with the OMT version number (without a period) to which you are upgrading. For example, to upgrade to 24.4, you run the following command:</p><pre><code>./autoUpgrade -d /tmp_directory -n 12.34.56.78 -u user -o '24.4:--drain'</code></pre></li><li style=\"margin-left: 52px; position: relative;\"><p><code>--drain-timeout</code></p><p>Specifies a timeout value (in seconds) for the <code>--drain</code> option. If the timeout value is met before a node is drained, the upgrade process stops. The default value is 3600 seconds. The option only takes effect if you have set the <code>--drain</code> option. For example, to upgrade to 24.4, you run the following command:</p><pre><code>./autoUpgrade -d /tmp_directory -n 12.34.56.78 -u user -o '24.4:--drain,--drain-timeout=7200'</code></pre></li><li style=\"margin-left: 52px; position: relative;\"><code>--temp</code><br/>\n\t\t\tSpecify an absolute path that already exists to store OMT upgrade temp file. If it is not specified, the upgrade temp file will be saved in path <code>$CDF_HOME/backup</code>.</li></ul></li><li style=\"margin-left: 40px; position: relative;\"><p>--<code>dry-run</code><br/>\n\t\tDry run for the <code>autoUpgrade</code> script. If you want to perform a dry run, append <code>--dry-run</code> while running the <code>autoUpgrade</code> script.</p></li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p>When the upgrade finishes successfully, the console displays the following message:</p><pre><code>Successfully completed AppHub components upgrade process.</code></pre><p><br/>\n\tIf the endpoint from which you are running the upgrade is outside the cluster, wait for the <code>autoUpgrade</code> script to finish before you use it to upgrade another cluster.</p></li></ol><p>If the upgrade process fails, run the <code>autoUpgrade</code> script again. The upgrade will resume from the point at which it failed.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div> If you need to rerun the upgrade, you must use the same method that you started with. If you initially ran the <code>autoUpgrade</code> script, you must rerun the <code>autoUpgrade</code> script. If you performed a manual upgrade, you must rerun the <code>./upgrade.sh</code> command. </div></div></div><h3 id=\"Upgrade_CDF_manually\"><a id=\"Upgrade_OMT_manually\" name=\"Upgrade_OMT_manually\" title=\"Upgrade OMT manually\"></a>Upgrade OMT manually</h3><table><caption></caption><tbody><tr><th>Role</th><th>Location</th><th>Privileges required</th></tr><tr><td>System administrator</td><td>All control plane and worker nodes</td><td>Root or sudo</td></tr></tbody></table><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>Don't delete any files or folders generated during the upgrade. Otherwise, the upgrade process might fail.</div></div></div><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On a control plane node, navigate to the unzipped OMT package directory.<br/><br/>\n\tFor example, you run the following command:\n\t<pre>cd /temporary_directory/OMT_Embedded_K8s_2x.x-xxx</pre></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Run the following command to upgrade the OMT infrastructure: \n\t<pre>./upgrade.sh -i</pre>\n\t \n\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">To confirm any prompts or accept the default values during this process, you can run the command with the <code>-y</code> option.</li><li style=\"margin-left: 40px; position: relative;\">To specify the absolute path to the temporary directory for the upgrade files (by default directory, this is (<code>$CDF_HOME/backup</code>), you can run the command with the <code>-t</code> option. The directory that you specify must already exist.</li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Repeat this process to run the <code>./upgrade.sh -i</code> command on all control plane nodes in sequence.</li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p>When the <code>./upgrade.sh -i</code> command has successfully finished running on the control plane nodes, run the command on each worker node sequentially.</p><ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">To drain a worker node before the upgrade, run the command with the <code>--drain</code> option. This command line option is optional. However, if the upgrade includes updates to CRI (Container Runtime Interface), this option helps reduce system downtime. If you use this option, don't use the worker node until the upgrade command finishes running. Note that if you face timeout issues when you use the <code>--drain</code> option, you must specify the option again when you run the <code>upgrade</code> command again. Otherwise, you will need to manually uncordon the worker node.</li><li style=\"margin-left: 40px; position: relative;\">To specify a timeout value (in seconds) for the <code>--drain</code> option, run the command with the <code>--drain-timeout</code> option. The default value is 3600 seconds. The option only takes effect if you have set the <code>--drain</code> option.</li><li style=\"margin-left: 40px; position: relative;\">To confirm any prompts or accept the default values during this process, run the command with the <code>-y</code> option. This command line option is optional.</li><li style=\"margin-left: 40px; position: relative;\">To specify the absolute path to the temporary directory for the upgrade files (by default directory, this is (<code>$CDF_HOME/backup</code>), run the command with the <code>-t</code> option. This command line option is optional. Note that the directory that you specify must already exist.</li></ul></li><li style=\"--number-width: 12px; --number-spacing: 24px; margin-left: 36px; position: relative;\"><p>Run the following command on any one control plane node to upgrade the OMT components, and then enter <b>Y</b> to confirm that you want to proceed with the upgrade. Note that the upgrade process is irreversible. Don't run this command on any further nodes.</p><pre><code>./upgrade.sh -u</code></pre><p>To automatically confirm the prompt, append the <code>-y</code> option to the command as follows:</p><pre><code>./upgrade.sh -u -y</code></pre></li></ol><p>If the upgrade process fails, run the <code>upgrade</code> command again. The upgrade will resume from the point at which it failed.</p><div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div> If you need to rerun the upgrade, you must use the same method that you started with. If you initially ran the <code>autoUpgrade</code> script, you must rerun the <code>autoUpgrade</code> script. If you performed a manual upgrade, you must rerun the <code>./upgrade.sh</code> command. </div></div></div><h2><a id=\"Verify\" name=\"Verify\" title=\"Verify\"></a>Verify</h2><p>You can use the following methods to verify that all control plane nodes and worker nodes are upgraded successfully.</p><h3><a id=\"Check_the_log_file\" name=\"Check_the_log_file\" title=\"Check the log file\"></a>Check the log file</h3><p><strong>Steps for upgrades using the autoUpgrade script:</strong></p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the node where you ran the <strong>autoUpgrade </strong>script, look the autoUpgrade log file in one of the following temporary directories:\n\n\t<ul style=\"padding-left: 0px;\"><li style=\"margin-left: 40px; position: relative;\">If the upgrade is in progress or has failed, the log file is located in <strong>/tmp/autoUpgrade/upgradeLog.</strong></li><li style=\"margin-left: 40px; position: relative;\">If the upgrade is successful, the log file is located in <strong>/tmp/autoUpgradeBK/upgradeLog.</strong></li></ul></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">To confirm successful upgrade, check the last line in the log file <strong>/tmp/autoUpgradeBK/upgradeLog</strong>. It should resemble the following:\n\t<pre><code>Congratulations! Auto upgrade process is finished successfully!\n</code></pre></li></ol><p><strong>Steps for manual upgrades</strong>:</p><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">On the node where you ran the <code>upgrade.sh -u</code><b> </b>command, look for the upgrade log file in the temporary directory. By default, the upgrade log file is located in <strong>${CDF_HOME}/log/scripts/upgrade</strong>.<strong> </strong></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">To confirm that the upgrade was successful, check that the entries in the upgrade log file. It should resemble the following example:\n\t<pre><code>** Prerequisite tasks for Apphub components upgrade... (Step 1/4)\n\n** Start to upgrade Apphub add-on charts ... (Step 2/4)\n     Apphub add-on charts have been successfully updated.\n\n** Start to upgrade Apphub chart ... (Step 3/4)\n     Apphub chart has been successfully updated.\n     Refreshing ingress certificates...\n\n** Post tasks for Apphub components upgrade... (Step 4/4)\n     Cleaning up upgrade configmaps ...\n     Successfully completed AppHub components upgrade process.</code></pre></li></ol><h3><a id=\"Check_the_version\" name=\"Check_the_version\" title=\"Check the version\"></a>Check the version</h3><ol style=\"padding-left: 0px;\"><li style=\"--number-width: 10px; --number-spacing: 24px; margin-left: 36px; position: relative;\">View the current cluster node version number on each cluster node. Make sure it's the version to which you want to upgrade. To view the cluster version number, run the following command:\n\t<pre>cat ${CDF_HOME}/version.txt</pre></li><li style=\"--number-width: 13px; --number-spacing: 24px; margin-left: 36px; position: relative;\">Click the question mark icon on the top right menu of the Management portal to display the current version number. To log in to the Management Portal, enter the following URL in your browser address bar: https://&lt;External Access Host&gt;<external access=\"\" fqdn=\"\" host=\"\">:5443.</external></li></ol><h3><a id=\"Check_the_deployment_health\" name=\"Check_the_deployment_health\" title=\"Check the deployment health\"></a>Check the deployment health</h3><p>To check the health of the OMT deployment, run the following command:</p><pre>${CDF_HOME}/bin/kube-status.sh</pre><h2><a id=\"Post_upgrade_tasks\" name=\"Post_upgrade_tasks\" title=\"Post-upgrade tasks\"></a>Post-upgrade tasks</h2><p>Perform the following task after the OMT upgrade.</p><h3><a id=\"Reapply_your_Alertmanager_rules\" name=\"Reapply_your_Alertmanager_rules\" title=\"Reapply your Alertmanager rules\"></a>Reapply your Alertmanager rules</h3><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-ReapplyAlertmanagerRules||N\"></span><p class=\"mw-empty-elt\">\n</p><p>If you had configured Prometheus Alertmanager rules by using command line flags and a configuration file, you must reapply the rules after you upgrade OMT. There is no need to do this if you configured Alertmanager rules by using a Helm command.</p>\n<p><br/>\n</p>\n<p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-ReapplyAlertmanagerRules||N\"></span></div>",
  "modifiedon": "2025-12-03 13:19:23"
}