{
  "title": "\"UPGRADE FAILED\" error after updating certificates from OMT Management Portal",
  "content": "<div class=\"mw-parser-output\"><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UpgradeFailed||N\"></span><p class=\"mw-empty-elt\">\n</p><p>After uploading new certificates from the Management Portal, you might get the following error:  </p>\n<pre>Error: UPGRADE FAILED: template: apphub/charts/portalIngress/templates/secret.yaml:4:24: executing \"apphub/charts/portalIngress/templates/secret.yaml\" at &lt;index $secret.metadata.annotations \"deployments.microfocus.com/ingore-tls-cert\"&gt;: error calling index: index of untyped nil</pre>\n<h2>Cause</h2>\n<p>Some values in <code>nginx-default-secret</code> are missing.</p>\n<h2>Solution</h2>\n<p>After uploading certificates from the Management Portal, follow these steps to run the commands on one of the control plane nodes or worker nodes.</p>\n<ol>\n<li>Run the following command to get the <code>&lt;release-name&gt;</code>: \n\n\t<pre>helm list -n $CDF_NAMESPACE -a 2&gt;/dev/null | grep -E 'apphub-[0-9]+\\.[0-9]+\\.[0-9]\\+[0-9]+' | awk '{print $1}' | xargs</pre>\n</li>\n<li>Run the following command to patch <code>nginx-default-secret</code> and replace <code>&lt;release-name&gt;</code> with the result you get from step 1: \n\t<pre>kubectl patch secret nginx-default-secret -n $CDF_NAMESPACE -p \"{ \\\"metadata\\\": { \\\"annotations\\\": { \\\"meta.helm.sh/release-name\\\": \\\"&lt;release-name&gt; \\\", \\\"meta.helm.sh/release-namespace\\\": \\\"$CDF_NAMESPACE\\\" }, \\\"labels\\\":{ \\\"app.kubernetes.io/managed-by\\\": \\\"Helm\\\" } } }\"</pre>\n</li>\n<li>Run the following command to patch <code>nginx-frontend-secret</code> and replace <code>&lt;release-name&gt;</code> with the result you get from step 1: \n\t<pre>kubectl patch secret nginx-frontend-secret -n $CDF_NAMESPACE -p \"{ \\\"metadata\\\": { \\\"annotations\\\": { \\\"meta.helm.sh/release-name\\\": \\\"&lt;release-name&gt; \\\", \\\"meta.helm.sh/release-namespace\\\": \\\"$CDF_NAMESPACE\\\" }, \\\"labels\\\":{ \\\"app.kubernetes.io/managed-by\\\": \\\"Helm\\\" } } }\"</pre>\n</li>\n</ol>\n<p><br/>\n</p>\n<p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UpgradeFailed||N\"></span></div>",
  "modifiedon": "2025-10-24 08:51:12"
}