{
  "title": "Upgrade fails with \"Fail to delete SMA Service itom-sam\" error",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p><span style='color: rgb(51, 51, 51); font-family: Roboto, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; font-size: 16px;'>Upgrade fails with the following error under </span><strong style='color: rgb(51, 51, 51); font-family: Roboto, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; font-size: 16px;'>&lt;global-volume&gt;/logs/update/deployer.log</strong><span style='color: rgb(51, 51, 51); font-family: Roboto, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\"; font-size: 16px;'> file: </span></p>\n<pre>ERROR 132 --- [DeployerBackend,,,,] [Thread-18] c.h.i.i.service.ItsmaSuite - Fail to delete SMA Service itom-sam Found Exception: io.fabric8.kubernetes.client.KubernetesClientException: \nFailure executing: DELETE at: https://172.17.17.1/api/v1/namespaces/itsma-xxxxx/services?labelSelector=itsmaService%3Ditom-sam. Message: Forbidden!Configured service account doesn't have access. \nService account may have been revoked. services is forbidden: User \"system:serviceaccount:itsma-rzzyj:itom-suite-config\" cannot deletecollection resource \"services\" in API group \"\" in the namespace \"itsma-xxxxx\".</pre>\n<p>Run the following command to confirm the error: </p>\n<pre>kubectl get role -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \") microfocus:cdf:itom-suite-config -o yaml </pre>\n<p>From the output, under <code>resources:services</code>, the <code>deletecollection </code>is missing. </p>\n<h2>Cause:</h2>\n<p>Missing <code>deletecollection</code> permission for role <code>microfocus:cdf:itom-suite-config</code></p>\n<h2>Solution</h2>\n<ol>\n<li>Run the following command to add the missing role:\n\t<pre>kubectl patch role microfocus:cdf:itom-suite-config  -n $(kubectl get namespace |grep itsma | cut -f1 -d \" \") --type='json' -p='[{\"op\": \"add\", \"path\": \"/rules/0\", \"value\":{ \"apiGroups\": [\"\"], \"resources\": [\"services\"], \"verbs\": [\"deletecollection\"]}}]'</pre>\n</li>\n<li>Retry the upgrade.</li>\n</ol>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}