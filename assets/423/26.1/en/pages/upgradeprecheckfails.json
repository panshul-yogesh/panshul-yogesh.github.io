{
  "title": "Upgrade pre-check fails with \"dial tcp: lookup registry.hub.docker.com\" error",
  "content": "<div class=\"mw-parser-output\"><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UpgradePrecheckFails||N\"></span><p class=\"mw-empty-elt\">\n</p><p>When you try to upgrade to OMT 2022.05, the upgrade fails during the preliminary check, and you receive an error message that resembles the following:</p>\n<pre><code>Error: dial tcp: lookup registry.hub.docker.com on 10.123.45.67:89: server misbehaving</code></pre>\n<p>This issue occurs when you use an external registry, such as <code>registry.hub.docker.com</code>.</p>\n<h2>Cause</h2>\n<p>Possible causes:</p>\n<ul>\n<li>Cause 1: Your DNS server isn't working correctly.  </li>\n<li>Cause 2: Your registry CA for registry.hub.docker.com isn't correct.</li>\n</ul>\n<h2>Solution</h2>\n<p>First, check whether a DNS server problem is causing the issue.</p>\n<ol>\n<li>Run the following command to check if your DNS server can resolve the registry to the corresponding IP:\n\t<pre><code>nslookup &lt;registry&gt;</code></pre>\n<p>\tFor example, if your external registry is <code>registry.hub.docker.com</code>, run the following command:\n</p>\n<pre><code>nslookup registry.hub.docker.com</code></pre>\n</li>\n<li>Compare the result with the IP addresses that you obtained through a DNS authority. If they don't match, ask for your IT administrator to fix the DNS problem. You can change to an available nameserver by updating the <code>/etc/resolv.conf</code> file.</li>\n<li>Run the following command to check whether updating the DNS server has fixed the issue:\n\t<pre><code>openssl s_client -connect &lt;registry&gt;   </code></pre>\n<p>\tFor example, if your external registry is <code>registry.hub.docker.com</code>, run the following command:\n</p>\n<pre><code>openssl s_client -connect registry.hub.docker.com:443   </code></pre>\n</li>\n</ol>\n<p>If the command returns a handshake failure error, update your registry CA.</p>\n<ol>\n<li>Run the following command to copy the registry CA certificate to the OpenSSL directory:    \n\t<pre><code> cp &lt;registry_ca_certificate&gt; /etc/pki/ca-trust/source/anchors/  </code></pre>\n</li>\n<li>Load the private registry CA certificate:    \n\t<pre><code>update-ca-trust extract   </code></pre>\n</li>\n<li>Run the following command to restart the Kubernetes services, which will import the registry CA certificate:    \n\t<pre><code>${CDF_HOME}/bin/kube-restart.sh </code></pre>\n</li>\n<li>Repeat steps 1-3 on each node in the cluster.</li>\n</ol>\n<p><br/>\n</p>\n<p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UpgradePrecheckFails||N\"></span></div>",
  "modifiedon": "2025-10-24 08:51:12"
}