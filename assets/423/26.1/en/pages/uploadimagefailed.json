{
  "title": "Upload images script failed after changing the registry password",
  "content": "<div class=\"mw-parser-output\"><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-UploadImageFailed||N\"></span><p class=\"mw-empty-elt\">\n</p><p>When upgrading OMT, the <code>logrotate</code> or <code>fluentd</code> pods might get <code>ImagePullBackOff</code> errors and upgrade fails.</p>\n<h2>Cause</h2>\n<p>The issue occurs because you've updated the registry password with the <code>updateLocalRegistryInfo.sh</code> script before upgrading OMT. However, when upgrading OMT, the password was set back to the original one and it's inconsistent with the one in <code>registrypullsecret</code>.</p>\n<h2>Solution</h2>\n<ol>\n<li>Run the following commands in succession to fix the inconsistent registry password issue: \n\t<pre>source $CDF_HOME/properties/images/k8s_charts.properties</pre>\n<pre>REGISTRY_PWD=$(kubectl get secret -n $CDF_NAMESPACE registrypullsecret -ojson | jq -r '.data.\".dockerconfigjson\"' | base64 -d | jq -r '.auths.\"localhost:5000\".\"auth\"' | base64 -d | awk -F: '{print $2}')</pre>\n<pre>helm upgrade kube-registry $CDF_HOME/charts/$CHART_ITOM_KUBE_REGISTRY --set credentials.b64encPassword=$(echo -n \"$REGISTRY_PWD\" | base64 -w0) --reuse-values -n $CDF_NAMESPACE</pre>\n</li>\n<li>Rerun the upgrade commands.</li>\n</ol>\n<p><br/>\n</p>\n<p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-UploadImageFailed||N\"></span></div>",
  "modifiedon": "2025-10-24 08:51:12"
}