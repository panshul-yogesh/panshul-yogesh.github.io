{
  "title": "Use OData for BI integration",
  "content": "<div class=\"mw-parser-output\">\n<p>The Business Intelligence (BI) integration module enables you to define the fields and relationships that are synced for a record type when integrating with an external business intelligence system. This can help you export your data to a third-party system with different reporting tools. Alternatively, it's useful for aggregating your data with data from other parts of your organization.</p>\n<p>In addition to performing the integration using the BI integration API or PostgreSQL Views, you can now use OData as an alternative method for BI integration.</p>\n<h2><a id=\"What_is_OData\" name=\"What_is_OData\" title=\"What is OData\"></a>What is OData</h2>\n<p>OData (Open Data Protocol) is a standard REST-based protocol used for data exchange between different systems. The current OData version is 4.0, which is approved by ISO/IEC and standardized at OASIS. When used for BI reporting, OData can:</p>\n<ul>\n<li>Support metadata and data exchange, including relationships</li>\n<li>Provide all Create, Retrieve, Update, and Delete (CRUD) operations, from which you can use the Retrieve option for reporting purposes</li>\n<li>Accept both open-source and commercial implementations for client and server</li>\n</ul>\n<h2><a id=\"Advantages_of_OData\" name=\"Advantages_of_OData\" title=\"Advantages of OData\"></a>Advantages of OData</h2>\n<p>Service Management provides three ways for exposing the relevant data to the external reporting tools:</p>\n<ul>\n<li>PostgreSQL Views</li>\n<li>Business Intelligence Integration API</li>\n<li>External reporting based on OData integration</li>\n</ul>\n<p>However, the PostgreSQL Views tool isn't available for SaaS users and the Business intelligence integration API has a limited coverage.</p>\n<p>OData is newly introduced as a new method for BI Integration, which can provide a secure access to Service Management data for reporting with following advantages:</p>\n<ul>\n<li>The existing secure HTTPS/REST based communication can be used in SaaS</li>\n<li>OData is natively supported by main BI tools (Power BI, Tableau, Qlik Sense) and other apps (Excel)</li>\n<li>OData uses the existing Service Management authentication/authorization to access the Service Management data</li>\n</ul>\n<h2><a id=\"Use_OData_for_BI_reporting\" name=\"Use_OData_for_BI_reporting\" title=\"Use OData for BI reporting\"></a>Use OData for BI reporting</h2>\n<h3><a id=\"Metadata\" name=\"Metadata\" title=\"Metadata\"></a>Metadata</h3>\n<p>When retrieving data from Service Management, the following types of OData entity set are supported:</p>\n<ul>\n<li>The OData entity set for each Service Management entity type.<br/>\n\tThe name of the OData entity set equals to the name of the Service Management entity type.<br/>\n\tFor example: Service Management <code>Incident</code> corresponds to OData <code>Incident</code> set</li>\n<li>The OData entity set for each Service Management M2M relationship.<br/>\n\tThe name of the OData entity set corresponds to the name of the Service Management M2M relation with the prefix \"r_\".<br/>\n\tFor example: Service Management M2M relation <code>IncidentCausedByRequest</code> corresponds to OData <code>r_IncidentCausedByRequest</code> set.</li>\n</ul>\n<h3><a id=\"Authentication_method\" name=\"Authentication_method\" title=\"Authentication method\"></a>Authentication method</h3>\n<p>When you attempt to connect OData with your Service Management data source, you need to select the authentication method for accessing the data source.</p>\n<p><b>Basic authentication: </b>Use Basic authentication with BI tools that only support this method of authentication.<br/>\nBasic authentication credentials can be generated from:</p>\n<ul>\n<li>Service Portal - Agent/Portal users with the <strong>Access OData API</strong> role permission can generate the personal access tokens</li>\n<li>Service Management - Agent users with the <strong>Access OData API</strong> role permission can launch the <strong>Personal access tokens</strong> page in Service Portal<s><span style=\"background-color:#f1c40f;\"> </span></s></li>\n</ul>\n<p><strong>Service Management Authentication: </strong>Use Service Management authentication with BI tools that support custom authentication via scripting to generate and use a SMAX_AUTH_TOKEN cookie</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>For the token generated using the SMAX_AUTH_TOKEN cookie, the authentication token is valid for 1 hour by default. <span style=\"background-color: rgb(255, 255, 255);\"> </span></div></div></div>\n<ul>\n</ul>\n<h4><a id=\"Generate_personal_access_tokens_from_Service_Portal\" name=\"Generate_personal_access_tokens_from_Service_Portal\" title=\"Generate personal access tokens from Service Portal\"></a><a id=\"Generate_the_personal_access_tokens_from_Service_Portal\" name=\"Generate_the_personal_access_tokens_from_Service_Portal\" title=\"Generate the personal access tokens from Service Portal\"></a>Generate personal access tokens from Service Portal</h4>\n<p>Make sure the following prerequisites are met:</p>\n<ul>\n<li>Suite admin has enabled OData for your tenant. Note that this feature is enabled by default. In the case that OData is disabled, you can enable this feature from <a href=\"/doc/423/26.1/tenantdetails#OData_settings\" title=\"Tenant details\">Tenant details</a>.</li>\n<li>You log in as tenant admin, or use an account that has a role with the <strong>Access OData API</strong> permission. See <a href=\"/doc/423/26.1/pplroles#Reports_&amp;_Views\" title=\"Roles\">Roles</a>.</li>\n</ul>\n<p>Complete the following steps to generate the personal access tokens from Service Portal:</p>\n<ol>\n<li>Log in to Service Portal as an agent user or a portal user.</li>\n<li>In the Service Portal menu at the top right of the page, click <strong>Personal Access Tokens</strong>. </li>\n<li>To add a new token, complete the following steps:\n\t<ol>\n<li>Click <strong>Add</strong> on the <strong>Personal Access Tokens</strong> page.</li>\n<li>Enter the following information:\n\t\t<ul>\n<li><strong>Name:</strong> The name of the token.</li>\n<li><strong>Description:</strong> A brief description of the token. For example, the intended use of the token<strong>.</strong></li>\n<li><strong>Expiration</strong>:  Specifies the duration for which a token remains valid. It can range from <strong>1 minute to 365 days</strong>, with a default of <strong>60 </strong>minutes. Choose an expiration duration that suits your workflow.\n\t\t\t<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div>To ensure a secure deployment, we strogly recommend that you regenerate any existing tokens if they do not have an expiry.</div></div></div>\n</li>\n</ul>\n</li>\n<li>Click <strong>Save </strong>to apply your changes.</li>\n</ol>\n</li>\n<li>To edit or regenerate an existing token complete the following steps:\n\t<ol>\n<li>Click the name of the token on the <strong>Personal Access Tokens</strong> page. </li>\n<li>Select the <strong>Regenerate</strong> check box.</li>\n<li>Click <strong>Save</strong> to apply your changes.</li>\n</ol>\n</li>\n<li>The system generates and displays your personal access token. Make sure to copy and save the token in a file for later use.</li>\n<li>In BI tools, select <strong>Basic authentication</strong> for OData data source.\n\t<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div><strong>Legal notice:</strong> By selecting to enable basic authentication option, you are disabling or bypassing security features, thereby exposing the system to increased security risks. By using this option, you understand and agree to assume all associated risks and hold <code>OpenText</code> harmless for the same.</div></div></div>\n</li>\n<li>Fill in the following fields:\n\t<ul>\n<li><strong>Username</strong>: The user name for logging in to Service Portal.</li>\n<li><strong>Password</strong>: The personal access token generated in the earlier step.</li>\n</ul>\n</li>\n<li>Enter the URL of OData feed in one of the following formats:\n\t<ul>\n<li>https://&lt;Service Management host name&gt;/datahub/&lt;tenant ID&gt;/odata/</li>\n<li>https://&lt;Service Management host name&gt;/datahub/&lt;tenant ID&gt;/odata</li>\n</ul>\n\tFor example:\n\n\t<ul>\n<li>https://host.example.net:443/datahub/123456789/odata/</li>\n<li>https://host.example.net:443/datahub/123456789/odata</li>\n</ul>\n</li>\n</ol>\n<h4><a id=\"Generate_the_personal_access_token_from_Service_Management\" name=\"Generate_the_personal_access_token_from_Service_Management\" title=\"Generate the personal access token from Service Management\"></a>Generate the personal access token from Service Management</h4>\n<p><strong>Prerequisites</strong>:</p>\n<ul>\n<li>Suite admin has enabled OData for your tenant. Note that this feature is enabled by default. In the case that OData is disabled, you can enable this feature from <a href=\"/doc/423/26.1/tenantdetails#OData_settings\" title=\"Tenant details\">Tenant details</a>.</li>\n<li>You log in as tenant admin, or you are assigned with a role that contains the <strong>Access OData API</strong> and the <strong>Log into the application </strong>role permissions. See <a href=\"/doc/423/26.1/pplroles#Reports_&amp;_Views\" title=\"Roles\">Roles</a>.</li>\n</ul>\n<p>After the prerequisites are met, you can generate the the personal access tokens from Service Management:</p>\n<ol>\n<li>Log in to Service Management as an agent user.</li>\n<li>Go to <strong>Agent interface &gt; Profile and preferences &gt; User Profile</strong>.</li>\n<li>Click <strong>Personal access tokens</strong>. The <strong>Personal access tokens</strong> page in Service Portal is opened.</li>\n<li>In BI tools, select <strong>Basic authentication</strong> for OData data source. Fill in the required fields:<br/>\n<strong>Username</strong>: The agent user name<br/>\n<strong>Password</strong>: The personal access token generated from step 3</li>\n<li>Enter the URL of OData feed: <code>https://&lt;Service Management host name&gt;/datahub/&lt;tenant ID&gt;/odata/ </code>or<code> https://&lt;Service Management host name&gt;/datahub/&lt;tenant ID&gt;/odata</code><br/>\n\tFor example: <code>https://host.example.net:443/datahub/123456789/odata/ </code>or<code> https://host.example.net:443/datahub/123456789/odata</code></li>\n</ol>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-important-icon\"></div><div class=\"admonition-content admonition-important-content\"><div><strong>Legal notice:</strong> By selecting to enable basic authentication option, you are disabling or bypassing security features, thereby exposing the system to increased security risks. By using this option, you understand and agree to assume all associated risks and hold <code>OpenText</code> harmless for the same.</div></div></div>\n<h4><a id=\"Generate_the_personal_access_token_for_an_integration_user\" name=\"Generate_the_personal_access_token_for_an_integration_user\" title=\"Generate the personal access token for an integration user\"></a>Generate the personal access token for an integration user</h4>\n<p>If you need to use OData to pull data from Service Management, and then save the data into a data lake, you may use an integration user account for OData access.</p>\n<p>In such case, you need to generate a personal access token for the integration user account.</p>\n<ol start=\"1\" type=\"1\">\n<li>Access the following URL from your browser:<br/>\n<code>https://&lt;host name&gt;:443/idm-admin?tenant=&lt;Service Management tenant id&gt;</code></li>\n<li>Log in with your integration user account and password.</li>\n<li>After login, select <strong>API Token</strong> from the upper-right drop down menu.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"mediawiki/images/7/7c/UseODataForBIIntegrationIntUser.png\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/7/7c/UseODataForBIIntegrationIntUser.png\" hspace=\"0\" src=\"../../../images/UseODataForBIIntegrationIntUser_587008ec.png\" style=\"width:230px;height:280px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\"/> </a></li>\n<li>Add a new API token as required.</li>\n</ol>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>To ensure that the integration account can use OData, you need to assign appropriate permissions to the integration user role, including the <strong>Access OData API</strong> permission.</div></div></div>\n<h4><a id=\"Generate_the_token_by_using_the_SMAX_AUTH_TOKEN_cookie\" name=\"Generate_the_token_by_using_the_SMAX_AUTH_TOKEN_cookie\" title=\"Generate the token by using the SMAX_AUTH_TOKEN cookie\"></a>Generate the token by using the SMAX_AUTH_TOKEN cookie</h4>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div> This method is only available for the BI tools which support custom authentication, such as Power BI and Excel with Power Query customization.</div></div></div>\n<p><strong>Prerequisites</strong>: Suite admin has enabled OData for your tenant. Note that this feature is enabled by default. In the case that OData is disabled, you can enable this feature from <a href=\"/doc/423/26.1/tenantdetails#OData_settings\" title=\"Tenant details\">Tenant details</a>.</p>\n<p>If you want to avoid the license consumption for reporting purpose, you can use a Service Management integration user with this method of authentication.</p>\n<ol>\n<li>Create an integration user as the suite admin. See <a href=\"/doc/423/26.1/createuser\" title=\"How to create a user\">How to create a user</a>.</li>\n<li>Log in to the suite as tenant admin, then assign corresponding roles to the integration user for data access.</li>\n<li>Use the scripting language in your BI tool to generate a SMAX_AUTH_TOKEN cookie and use this cookie in subsequent OData calls. For example, you could use the following script in Microsoft Power Query editor:\n\t<pre>let\n    AuthToken = Text.FromBinary(Web.Contents(\"https://&lt;Service Management host name&gt;/auth/authentication-endpoint/authenticate/token?TENANTID=&lt;tenant ID&gt;\", [Headers = [#\"Content-Type\" = \"application/json\"], Content = Text.ToBinary(\"{\"\"login\"\":\"\"&lt;integration user name&gt;\"\",\"\"password\"\":\"\"&lt;integration user password&gt;\"\"}\")])),\n    Source = OData.Feed(\"https://&lt;Service Management host name&gt;/datahub/&lt;tenant ID&gt;/odata/\", null, [Implementation=\"2.0\", Headers=[Cookie=\"SMAX_AUTH_TOKEN=\" &amp; AuthToken]])\nin\n    Source</pre>\n</li>\n<li>In BI tools, select the authentication method as <strong>Anonymous</strong> for OData data source.<br/>\n\tSee <a href=\"/doc/423/26.1/intusersmaxauthtokenaccessodata\" title=\"Use integration user and SMAX_AUTH_TOKEN cookie to access OData\">Use integration user and SMAX_AUTH_TOKEN cookie to access OData</a> for detailed instructions.</li>\n</ol>\n<h3><a id=\"Throttling_configurations\" name=\"Throttling_configurations\" title=\"Throttling configurations\"></a>Throttling configurations</h3>\n<p>OData API calls are subject to throttling to limit their performance impact. Only the suite admin user can configure the throttling settings.</p>\n<h4><a id=\"Farm_level\" name=\"Farm_level\" title=\"Farm level\"></a>Farm level</h4>\n<p>At farm level, you can run the following command to set the restriction of global rate on Nginx Ingress controller.</p>\n<p><code># kubectl edit ingress itom-xruntime-datahub-ingress -n &lt;namespace&gt;</code></p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>Once the configurations are updated, the changes will take effect within 5 seconds without requiring a restart.</div></div></div>\n<p>You may configure the following parameters as required:</p>\n<ul>\n<li><code>ingress.kubernetes.io/limit-connections: \"200\"</code><br/>\n\tSet the number of concurrent connections allowed from a single IP address. A 503 error is returned when this limit is exceeded. Note that one connection may contain multiple requests.</li>\n</ul>\n<ul>\n<li><code>ingress.kubernetes.io/limit-rps: \"20\"</code><br/>\n\tSet the number of requests accepted from a given IP per second. The burst limit is set to this number multiplied by the burst multiplier. The default multiplier is 5. When clients exceed the limit, a <code>limit-req-status-code default: 503</code> error is returned.</li>\n</ul>\n<h4><a id=\"Tenant_level\" name=\"Tenant_level\" title=\"Tenant level\"></a>Tenant level</h4>\n<p>At tenant level, you can set the throttling configurations from <strong>Suite Administration</strong>:</p>\n<ol>\n<li>From the main menu, click <b>Tenants</b>.</li>\n<li>Click the tenant in the ID column to display the selected tenant.</li>\n<li>Select the <strong>Application settings</strong> tab.</li>\n<li>Set the configurations under OData settings:\n\t<table>\n<tbody>\n<tr>\n<th>Setting</th>\n<th>Description</th>\n</tr>\n<tr>\n<td><b>Enable OData service</b></td>\n<td>\n<p>By default, OData service is enabled to access your Service Management data source.</p>\n<p>To disable this feature, select <strong>Off</strong>.</p>\n</td>\n</tr>\n<tr>\n<td><strong>Maximum number of concurrent requests</strong></td>\n<td>\n<p>Set the maximum number of concurrent REST calls from OData.</p>\n<p><strong>Note:</strong> </p>\n<ul>\n<li>If <span style=\"background-color: transparent;\">the number in this parameter</span> is set to 0, then there is no limit.</li>\n<li>The range of possible values for this parameter: From 0 to 200.</li>\n<li>If you use Power BI, then before you set this parameter, you need to check <strong style=\"background-color: transparent;\">Maximum number of simultaneous evaluations</strong><span style=\"background-color: transparent;\"> in your Power BI Desktop. Make sure the number in this parameter is greater than or equal to the </span><strong style=\"background-color: transparent;\">Maximum number of simultaneous evaluations value</strong><span style=\"background-color: transparent;\">, so that the data can be pulled successfully,</span></li>\n</ul>\n</td>\n</tr>\n<tr>\n<td><strong>Maximum</strong><strong> number of records per day</strong></td>\n<td>\n<p>Set the maximum number of returned records that can be returned by OData REST calls per day.</p>\n<p><strong>Note:</strong> </p>\n<ul>\n<li><span style=\"background-color: transparent;\">I</span><span style=\"background-color: transparent;\">f </span><span style=\"background-color: transparent;\">the number in this parameter</span><span style=\"background-color: transparent;\"> is set to 0, then there is no limit.</span><span style=\"background-color: transparent;\"> </span></li>\n<li><span style=\"background-color: transparent;\">The range of possible values for this parameter: </span>From 0 to infinite.</li>\n</ul>\n</td>\n</tr>\n<tr>\n<td><strong>Maximum page size</strong></td>\n<td>\n<p>Set the maximum number of records returned in a single page from OData using server-side pagination.</p>\n<p><strong>Note:</strong> <span style=\"background-color: transparent;\">The range of possible values for this parameter: </span><span style=\"background-color: transparent;\">From 1 to 10000.</span></p>\n</td>\n</tr>\n<tr>\n<td><strong>Delay time</strong></td>\n<td>\n<p>Set the delay time between subsequent page requests (in milliseconds).</p>\n<p><strong>Note:</strong> <span style=\"background-color: transparent;\">The range of possible values for this parameter: </span><span style=\"background-color: transparent;\">From 0 to 30000.</span></p>\n</td>\n</tr>\n</tbody>\n</table>\n</li>\n</ol>\n<h3><a id=\"Supported_OData_query_options\" name=\"Supported_OData_query_options\" title=\"Supported OData query options\"></a>Supported OData query options</h3>\n<p>Currently, the solution supports the following OData query options:</p>\n<ul>\n<li><code>$select</code></li>\n<li><code>$filter</code></li>\n<li><code>$top</code></li>\n<li><code>$skip</code></li>\n<li><code>$count</code></li>\n<li><code>$skiptoken</code></li>\n</ul>\n<p>You may append the query options to your OData feed URL. Such as:</p>\n<p><code>https://&lt;Service Management host name&gt;/datahub/&lt;tenant ID&gt;/odata/&lt;OData entity set&gt;?$filter=Id eq '&lt;record ID&gt;'&amp;$select=Id,DisplayLabel</code></p>\n<p>For example:<br/>\n<code>https://host.example.net:443/datahub/123456789/odata/Request?$filter=Id eq '12345'&amp;$select= Id,DisplayLabel</code></p>\n<h3><a id=\"$select\" name=\"%24select\" title=\"$select\"></a>$select</h3>\n<p>Equivalent to the <code>layout</code> parameter in EMS REST API. </p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>If <code>$select</code> is not used in your query, <code>FULL_LAYOUT</code> will be used by default. <code>FULL_LAYOUT</code> will pull all fields in your table which may cause performance issues.</div></div></div>\n<h3><a id=\"$filter\" name=\"%24filter\" title=\"$filter\"></a>$filter</h3>\n<p>Equivalent to the <code>filter</code> parameter in EMS REST API. See the following table for examples.</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>\n<ul>\n<li>The expressions also work with \"<code>and</code>\" <font face=\"monospace\">and</font> \"<code>or</code>\" logical operators.</li>\n<li>The time values in the filter are specified in Universal Coordinated Time (UTC).</li>\n</ul>\n</div></div></div>\n<table style=\"width:500px\">\n<thead>\n<tr>\n<th scope=\"col\">Filter</th>\n<th scope=\"col\">Examples</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Filter with a defined record ID</td>\n<td><code>/datahub/&lt;tenant ID&gt;/odata/Request?$filter=Id eq '12345'</code></td>\n</tr>\n<tr>\n<td>Filter with a literal datetime value</td>\n<td>\n<p><code>/datahub/&lt;tenant ID&gt;/odata/Request?$filter=LastUpdateTime gt 2022-09-16T02:20:35.301Z</code></p>\n<p><code>/datahub/&lt;tenant ID&gt;/odata/Request?$filter=LastUpdateTime ge 2022-09-16T02:20:35.301Z</code></p>\n<p><code>/datahub/&lt;tenant ID&gt;/odata/Request?$filter=LastUpdateTime ge 2022-09-16T02:20:35.301-07:00</code></p>\n</td>\n</tr>\n<tr>\n<td>Filter with <code>cast()</code> function:</td>\n<td>\n<p><code>/datahub/&lt;tenant ID&gt;/odata/Request?$filter=LastUpdateTime lt cast('2022-09-16T02:20:35.301Z', Edm.DateTimeOffset)</code></p>\n<p><code>/datahub/&lt;tenant ID&gt;/odata/Request?$filter=LastUpdateTime le cast('2022-09-16T02:20:35.301Z', Edm.DateTimeOffset)</code></p>\n</td>\n</tr>\n<tr>\n<td>Filter with <code>now()</code> function:</td>\n<td><code>/datahub/&lt;tenant ID&gt;/odata/Request?$filter=LastUpdateTime lt now()</code></td>\n</tr>\n<tr>\n<td>Filter with <code>null</code> value</td>\n<td><code>/datahub/&lt;tenant ID&gt;/odata/Request?$filter=CreationTime eq null</code></td>\n</tr>\n<tr>\n<td>Filter with M2M entity set</td>\n<td>\n<p><code>/datahub/&lt;tenant ID&gt;/odata/r_RequestFulfilledByDevice?$filter=left eq '12707'</code></p>\n<p><code>/datahub/&lt;tenant ID&gt;/odata/r_RequestFulfilledByDevice?$filter=left gt '12707'</code></p>\n<p><code>/datahub/&lt;tenant ID&gt;/odata/r_RequestFulfilledByDevice?$filter=right eq '11625'&amp;$count=true</code></p>\n</td>\n</tr>\n</tbody>\n</table>\n<h3><a id=\"$top\" name=\"%24top\" title=\"$top\"></a>$top</h3>\n<p>Equivalent to the <code>size</code> parameter in EMS REST API (for client-side pagination). </p>\n<h3><a id=\"$skip\" name=\"%24skip\" title=\"$skip\"></a>$skip</h3>\n<p>Equivalent to the <code>skip</code> parameter in EMS REST API (for client-side pagination). </p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-tip-icon\"></div><div class=\"admonition-content admonition-tip-content\"><div>In client-side pagination, the client decides how many records it wants to load and asks the server that many records. That is achieved by using <code>$skip</code> and <code>$top</code> query options in conjunction. For instance, if a client needs to request 10 records from 71-80, it can send a similar request as below:<br/>\n<code>/datahub/&lt;tenant ID&gt;/odata/Request?$skip=70&amp;$top=10</code></div></div></div>\n<h3><a id=\"$count\" name=\"%24count\" title=\"$count\"></a>$count</h3>\n<p>Equivalent to <code>meta=TotalCount</code> in EMS REST API. </p>\n<h3><a id=\"$skiptoken\" name=\"%24skiptoken\" title=\"$skiptoken\"></a>$skiptoken</h3>\n<p>For server-side pagination.</p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-tip-icon\"></div><div class=\"admonition-content admonition-tip-content\"><div>In server-side pagination, the client asks for a collection of entities and the server sends back a single page as well as a <code>nextlink</code> to use to retrieve more results. The <code>nextlink</code> is an opaque link which may use <code>$skiptoken</code> to store state about the request, such as the last read entity.</div></div></div>\n<h3><a id=\"History_data_retrieval\" name=\"History_data_retrieval\" title=\"History data retrieval\"></a>History data retrieval</h3>\n<p lang=\"ZH-CN\">OData solution supports retrieving data from the History table using the following query options:</p>\n<ul>\n<li><code>$filter </code></li>\n<li><code>$top</code> (for client-side pagination)</li>\n<li><code>$skip</code> (for client-side pagination)</li>\n<li><code>$skiptoken</code> (for server-side pagination)</li>\n</ul>\n<p>The OData History API must be invoked with query filters. The following fields are supported in the query filter. In these fields, the mandatory field in query filter is <code>EntityType</code> or <code>EntityId</code>. Also, you may append other fields in the query filter with logical operator '<code>AND</code>' only. </p>\n<table border=\"1\">\n<thead>\n<tr role=\"row\">\n<th role=\"rowheader\" scope=\"col\">Query Filter Fields </th>\n<th role=\"columnheader\" scope=\"col\">Supported Comparison Operators </th>\n<th role=\"columnheader\" scope=\"col\">Value </th>\n</tr>\n</thead>\n<tbody>\n<tr role=\"row\">\n<td role=\"rowheader\"><code>EntityType </code></td>\n<td><code>eq </code></td>\n<td>Record type, such as Request, Problem, Incident, etc. </td>\n</tr>\n<tr role=\"row\">\n<td role=\"rowheader\"><code>Time </code></td>\n<td><code>gt</code>, <code>lt</code>, <code>ge</code>, <code>le </code></td>\n<td>Time value. For example: 2024-01-30T00:00:00.000Z, 2022-09-16T02:20:35.301-07:00, cast('2022-09-16T02:20:35.301Z', Edm.DateTimeOffset), now() </td>\n</tr>\n<tr role=\"row\">\n<td role=\"rowheader\"><code>ChangeType </code></td>\n<td><code>eq</code></td>\n<td>ALL, ADD_ENTITY, UPDATE_ENTITY, REMOVE_ENTITY*(refer to Note), ADD_RELATION**(refer to Note), REMOVE_RELATION**(refer to Note)</td>\n</tr>\n<tr role=\"row\">\n<td role=\"rowheader\"><code>EntityId </code></td>\n<td><code>eq</code></td>\n<td>Record ID, such as 12345.</td>\n</tr>\n</tbody>\n</table>\n<p>Example usages:</p>\n<p><code>https://host.example.net:443/datahub/123456789/odata/History?$filter=EntityType eq 'Request' </code></p>\n<p><code>https://host.example.net:443/datahub/123456789/odata/History?$filter=EntityId eq '12345' </code></p>\n<p><code>https://host.example.net:443/datahub/123456789/odata/History?$filter=EntityType eq 'Incident' and Time ge 2024-01-30T00:00:00.000Z and Time le 2024-01-30T12:00:00.000Z </code></p>\n<p><code>https://host.example.net:443/datahub/123456789/odata/History?$filter=EntityType eq 'Problem' and Time le 2024-01-30T12:00:00.000Z and ChangeType eq 'UPDATE_ENTITY' </code></p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>\n<ul role=\"list\">\n<li>*: The OData History API won't return the history of soft-deleted records unless you explicitly specify <code>ChangeType eq 'REMOVE_ENTITY'</code> in the query filter. However, because the History table is large, querying the records of \"<code>REMOVE_ENTITY</code>\" may cause performance downgrade, so please avoid using such query. </li>\n<li>**：Relations with all types (1:1, 1:M, M:M) will be retrieved when <code>ChangeType</code> is set as \"<code>ADD_RELATION</code>\" or \"<code>REMOVE_RELATION</code>\".</li>\n<li>In addition to the explicitly specified query options, the history records returned by OData calls will implicitly: \n\t<ul>\n<li>Align with the data domains of the current user </li>\n<li>Be authorized to view by the current user </li>\n</ul>\n</li>\n<li>As history of satellite tables are not stored in the ‘history_&lt;tenant id&gt;’ table, the data won't be retrieved by OData API as well. </li>\n</ul>\n</div></div></div>\n<h4 id=\"Add_indexes_in_the_PG_database\"><a id=\"Add_indexes_in_the_PG_database_for_history_data_retrieval\" name=\"Add_indexes_in_the_PG_database_for_history_data_retrieval\" title=\"Add indexes in the PG database for history data retrieval\"></a>Add indexes in the PG database for history data retrieval</h4>\n<p>As the History table is huge, you may encounter some performance issues. To improve the performance of OData API, it's recommended that suite admin user manually add composite indexes for the History table (for both SaaS and on-premise environments).</p>\n<p>Database: xservices_ems<br/>\nSchema: maas_admin<br/>\nTable name: history_&lt;tenant id&gt;</p>\n<p lang=\"EN-US\" xml:lang=\"EN-US\">To create composite indexes for the History table, run the following SQL queries: </p>\n<p><code>CREATE INDEX CONCURRENTLY history_&lt;tenant id&gt;_composite_idx ON maas_admin.history_&lt;tenant id&gt; (entity_type, time, change_type, entity_id, property_names); </code></p>\n<p><code>CREATE INDEX CONCURRENTLY history_&lt;tenant id&gt;_composite_removed_entity_idx ON maas_admin.history_&lt;tenant id&gt; (entity_type, time, change_type, entity_id, property_names) where change_type='REMOVE_ENTITY'; </code></p>\n<p><code>VACUUM maas_admin.history_&lt;tenant id&gt;;</code></p>\n<div class=\"admonition\"><div class=\"admonition-icon admonition-note-icon\"></div><div class=\"admonition-content admonition-note-content\"><div>\n<p>The CONCURRENTLY option of CREATE INDEX is specified in above SQL queries, thus PostgreSQL will build the index without taking any locks that prevent concurrent inserts, updates, or deletes on the table, and in addition it must wait for all existing transactions that could potentially modify or use the index to terminate. In such case, it may take more time to create indexes but there won't be a system downtime required.</p>\n<p>Normally, in a lab environment, it takes about 22 minutes to create the <code>history_[tenantId]_composite_idx</code> index and 8 minutes to create the <code>history_[tenantId]_composite_removed_entity_idx</code> index when the data volume of <code>history_&lt;tenant id&gt;</code> is 280 million.</p>\n<p>If the CREATE INDEX commands unfortunately fail but leave behind an “invalid” index, you can drop the index and then try to perform the CREATE INDEX CONCURRENTLY commands again. Or you might need to plan system downtime to create above indexes without the CONCURRENTLY option.</p>\n<p>For details about the CONCURRENTLY option of CREATE INDEX, see <a href=\"https://www.postgresql.org/docs/current/sql-createindex.html#SQL-CREATEINDEX-CONCURRENTLY\" title=\"https://www.postgresql.org/docs/current/sql-createindex.html#SQL-CREATEINDEX-CONCURRENTLY\">https://www.postgresql.org/docs/current/sql-createindex.html#SQL-CREATEINDEX-CONCURRENTLY</a> .</p>\n</div></div></div>\n<h3><a id=\"L10N_support\" name=\"L10N_support\" title=\"L10N support\"></a>L10N support</h3>\n<p>OData solution supports retrieving localized data from following tables/fields based on the user's language setting:</p>\n<ul>\n<li>Categories, Service Definitions, Offerings and Articles localized in Service Management</li>\n<li>Display name of ENUM/ENUM_SET fields localized in Service Management</li>\n</ul>\n<p>The language setting mentioned above is identified from the <strong>Language </strong>field in the <strong>Person </strong>record:</p>\n<ul>\n<li>For account users, the language can be set in the user profiles page by themselves.</li>\n<li>For integration users, tenant admin can set the language field in the <strong>Person </strong>records on behalf of them.</li>\n</ul>\n<h3><a id=\"Limitations\" name=\"Limitations\" title=\"Limitations\"></a>Limitations</h3>\n<ul>\n<li>The localized display name of the List/Multi-Select List typed user options can't be retrieved by OData.</li>\n<li>For M2M relationship, there are entity links from different tables. OData can't get details of the records from these entity links.</li>\n<li>The <code>$expand</code> OData query option isn't supported.</li>\n<li>The Record Level Access Control (RLAC) configurations doesn't work for history data retrieval, which means even if a user isn't allowed to access a record due to RLAC restrictions, the user can still query the record’s history data through OData.</li>\n</ul>\n<h2><a id=\"Additional_information:_Connect_to_Service_Management_data_source_with_SSL\" name=\"Additional_information:_Connect_to_Service_Management_data_source_with_SSL\" title=\"Additional information: Connect to Service Management data source with SSL\"></a>Additional information: Connect to Service Management data source with SSL</h2>\n<p>To use BI tools, you need to follow these steps to connect to Service Management data source with SSL.<br/>\nNote that these steps are required for on-premises deployment only.</p>\n<ol>\n<li>Export the CA certificate from the browser. Be sure to verify that the certificate presented is legit according to your IT’s verification process. For example, verify the serial number of the certificate.<br/>\n\tThe Chrome browser is used for example:</li>\n<li>\n<ul>\n<li>Open the Service Management URL in the browser. Click the <strong>Not secure</strong> label, then select <strong>Certificate is not valid</strong>.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"MAXExportCAcertificate1.png\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/7/7f/SMAXExportCAcertificate1.png\" hspace=\"0\" src=\"../../../images/SMAXExportCAcertificate1_6784c3f2.png\" style=\"width:800px;height:431px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\"/> </a></li>\n<li>Click <strong>View Certificate</strong> and go to <strong>Details</strong>, then click <strong>Copy to File…</strong>. <br/>\n\t\tYou may select the default format to save the certificate file.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"SMAXExportCAcertificate2.png\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/5/51/SMAXExportCAcertificate2.png\" hspace=\"0\" src=\"../../../images/SMAXExportCAcertificate2_8258e968.png\" style=\"width:400px;height:481px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\"/> </a>    <a class=\"image\" href=\"\"> <img alt=\"SMAXExportCAcertificate3.png\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/5/5a/SMAXExportCAcertificate3.png\" hspace=\"0\" src=\"../../../images/SMAXExportCAcertificate3_e55f0dda.png\" style=\"width:400px;height:491px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\"/> </a></li>\n</ul>\n</li>\n<li>Open the certificate file to install it.</li>\n<li>Follow the screen prompts to import the root CA certificate. Note that for <strong>Certificate store</strong>, you need to select <strong>Trusted Root Certificate Authorities</strong>.<br/>\n<a class=\"image\" href=\"\"> <img alt=\"SMAXExportCAcertificate4.png\" border=\"0\" file=\"https://staging.docs.microfocus.com/mediawiki/images/5/5d/SMAXExportCAcertificate4.png\" hspace=\"0\" src=\"../../../images/SMAXExportCAcertificate4_99cb46cf.png\" style=\"width:550px;height:340px;margin-top:0px;margin-bottom:0px;margin-left:0px;margin-right:0px;border:0px solid black;\" vspace=\"0\"/> </a></li>\n</ol>\n<h2><a id=\"Optimize_OData_performance\" name=\"Optimize_OData_performance\" title=\"Optimize OData performance\"></a>Optimize OData performance</h2>\n<p>By default, the OData integration connects the BI Tool and the Service Management database through one Datahub pod and one read-only platform pod. The Datahub pod consists of the OData EMS Adaptor and OData REST APIs while the read-only platform pod consists of EMS REST APIs in EMS read-only mode. This design allows the Datahub pod and the online platform pod to work independently, thus ensuring performance. </p>\n<p>However, the performance optimization doesn't stop here, Service Management provides approaches that enable customers to scale out the integration by adding replicas of the Datahub pod and read-only platform pod. You can also create one read-only replica of the Service Management database server to reduce the load on the master database. </p>\n<h3><a id=\"Sizing_guide\" name=\"Sizing_guide\" title=\"Sizing guide\"></a>Sizing guide</h3>\n<p>Before starting to use the OData integration, please refer to the <a href=\"/doc/423/26.1/sizingforodata\" title=\"Sizing guide for OData integration\">sizing guide</a> to determine if you need additional Datahub pods, read-only platform pods, and additional worker nodes accordingly.</p>\n<h3><a id=\"Create_replicas_and_get_them_connected\" name=\"Create_replicas_and_get_them_connected\" title=\"Create replicas and get them connected\"></a>Create replicas and get them connected</h3>\n<p>To create replicas and get them connected, follow the steps below. These steps apply to both newly installed and upgraded Service Management.</p>\n<ol>\n<li>According to the <a href=\"/doc/423/26.1/sizingforodata\" title=\"Sizing guide for OData integration\">sizing guide</a>, estimate the concurrent OData requests/throughput and decide the required number of Datahub and read-only platform pods (and corresponding additional worker nodes) in the planning phase.</li>\n<li>To guarantee the read-only mode, <a href=\"/doc/423/26.1/customizereadonlyplatformdatabaseconnectionsettings#Use_a_read-only_DB_user_for_the_read-only_platform_pods\" title=\"Create a read-only database user for the read-only platform pod\">Create a read-only database user for the read-only platform pod</a> to access the PostgreSQL database. This is strongly recommended as post-installation or post-upgrade steps. </li>\n<li>According to the number of data-hub and read-only pods suggested by the <a href=\"/doc/423/26.1/sizingforodata\" title=\"Sizing guide for OData integration\">sizing guide</a>, create replicas for the Datahub pod and the read-only platform pod by using Kubernetes commands.\n\t<ul>\n<li><code>kubectl scale deployment itom-xruntime-datahub -n &lt;namespace&gt; --replicas=&lt;target number of the pods&gt;</code></li>\n<li><code>kubectl scale deployment itom-xruntime-platform-readonly -n &lt;namespace&gt; --replicas=&lt;target number of the pods&gt;</code></li>\n</ul>\n</li>\n<li>Depending on the actual DB load (e.g., CPU usage ratio of the primary DB server), decide if you need to <a href=\"/doc/423/26.1/customizereadonlyplatformdatabaseconnectionsettings#(Optional)_Switch_the_read-only_platform_pods_to_a_replica_database_instance\" title=\"connect the read-only pod(s) to the read-only database replica\">connect the read-only pod(s) to the read-only database replica</a>. This may need additional cost.</li>\n</ol>\n</div>",
  "modifiedon": "2025-10-24 08:51:12"
}