{
  "title": "Use the PostgreSQL exporter to monitor the external database",
  "content": "<div class=\"mw-parser-output\"><p class=\"mw-empty-elt\"></p><div class=\"mw-parser-output\"><p class=\"mw-empty-elt\">\n</p><p>A PostgreSQL exporter image is available in the ITOM Marketplace, which can be used to collect PostgreSQL metrics such as queries per second (QPS) and rows fetched/returned/inserted/updated/deleted per second. These metrics are then exposed in the Prometheus style. </p>\n<h2>Prepare a database user for the PostgreSQL exporter</h2>\n<p>Run the following commands with the database administrator account to create a new database user with the <strong>pg_monitor</strong> role for the PostgreSQL exporter:</p>\n<pre>create user &lt;test_monitor&gt; with password '&lt;password&gt;';\ngrant pg_monitor to &lt;test_monitor&gt;;</pre>\n<p>You will need the name and password of this user when running the <code>install.sh</code> command later.</p>\n<h2>Install the PostgreSQL exporter</h2>\n<ol>\n<li>Download the itom-postgres-monitor-2X.X.tar.gz image from the <a href=\"https://marketplace.opentext.com/itom/content/postgresql-instance-monitor\" title=\"ITOM Marketplace\">ITOM Marketplace</a>.</li>\n<li>Run the following command:\n\t<pre>tar zxvf &lt;itom-postgres-monitor-2X.X.tar.gz&gt;\nchmod 755 install.sh\n./install.sh</pre>\n</li>\n<li>The script will prompt you to enter credentials. Enter the requested username and password.<br/>\n<br/>\n\tNote that for an on-premises deployment, the registry repository username and password is <code>registry-admin/&lt;original_admin_password&gt;</code>.</li>\n<li>As the installation will take time, you need to wait until you see the message \"Wait for itom-postgres-exporter running up. Press Ctl+C to exit..\". If you want to exit the command, you can press Ctrl+C.</li>\n<li>\n<p>Run the following command and make sure the itom-postgres-exporter-xxxxxxxx-xxxxx pod's status is 2/2.</p>\n<pre>kubectl get pods -n $( kubectl get ns |grep itsma | cut -f1 -d \" \") |grep itom-postgres-exporter</pre>\n</li>\n</ol>\n<p><span style=\"color: rgb(0, 115, 231); font-family: Roboto, sans-serif; font-size: 24px;\">Certificate requirements</span></p>\n<p>If TLS is required for Service Management database connections and you can't see the database monitor data in the dashboard, you can run the following command to check the log from the itom-postgres-exporter-xxxxxxxx-xxxxx pod:</p>\n<pre>kubectl logs &lt;itom-postgres-exporter-xxxxxxxx-xxxxx&gt; -c itom-postgres-exporter -n &lt;namespace&gt; -f</pre>\n<p>If you see the error message \"x509: certificate relies on legacy Common Name field, use SANs instead,\" you may consider replacing the current certificate with a SAN for the database server. Once a new database server certificate is signed with a different CA, you can follow <a href=\"/doc/423/26.1/modifyexternaldbconfig\" title=\"Modify the configuration information of external databases\">Modify the configuration information of external databases</a> to replace the CA certificate in Service Management. Note that a certificate update needs to be implemented in a maintenance window. </p>\n<p>In a dev or test environment where security is not a concern and you want to use a non-TLS protocol (which is not advisable for a production system), run the following commands:</p>\n<pre>cp itom-postgres-exporter.yaml itom-postgres-exporter-disable.yaml\nsed -i \"/        - name: \\\"DB_SSL_MODE\\\"/{N;N;N;N;s/.*/        - name: \\\"DB_SSL_MODE\\\"\\n          value: \\\"disable\\\"/p;d;}\" itom-postgres-exporter-disable.yaml\nkubectl delete -f itom-postgres-exporter.yaml\nkubectl create -f itom-postgres-exporter-disable.yaml</pre>\n<h2>Related topics</h2>\n<p>For more information about how to configure Prometheus, including creating the service monitor for PostgreSQL, see <a href=\"/doc/423/25.1/smamonitoring#Configure_Prometheus\" title=\"Observe metrics with Prometheus and Grafana\">Observe metrics with Prometheus and Grafana</a>.</p>\n<p class=\"mw-empty-elt\"></p></div>\n<p class=\"mw-empty-elt\"></p></div>",
  "modifiedon": "2025-10-24 08:51:12"
}