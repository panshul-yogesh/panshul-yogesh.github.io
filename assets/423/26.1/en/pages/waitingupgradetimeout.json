{
  "title": "\"Waiting for upgrade finished timeout\" error during OMT upgrade",
  "content": "<div class=\"mw-parser-output\"><span class=\"snippet-start\" data-sname=\"423-25.4-423-25.3-WaitingUpgradeTimeout||N\"></span><p class=\"mw-empty-elt\">\n</p><p>OMT upgrade fails with a <code>Waiting for upgrade finished timeout</code> error message.</p>\n<h2 class=\"mw-headline\" id=\"Cause\">Cause</h2>\n<p>This issue occurs when an exception is thrown when a suite is uninstalled. In this situation, the status of the deployment isn't updated. Therefore, when you try to create a new deployment, more than one deployment exists in the system.</p>\n<h2 class=\"mw-headline\" id=\"Solution\">Solution</h2>\n<p>Remove the references to the old deployment. To do this, follow these steps:</p>\n<ol>\n<li>Run the following command to identify the cdfapiserver-db database pod:<br/>\n<br/>\n<code># kubectl get pods -n $CDF_NAMESPACE</code><br/>\n<br/>\n\tThe output resembles the following. Make a note of the cdfapiserver-db database pod name.\n\t<pre>NAME                                        READY   STATUS      RESTARTS  AGE\n\n…….\ncdfapiserver-postgresql-75ccd5dc97-jmsbs                    2/2     Running    9          3d14h\n\n……..</pre>\n</li>\n<li>Run the following command to log in to the cdfapiserver-db database pod:<br/>\n<br/>\n<code>kubectl exec -it -n $CDF_NAMESPACE &lt;</code>cdfapiserver-db<code> name&gt; bash</code><br/>\n<br/>\n\tFor example:<br/>\n<br/>\n<code>kubectl exec -it -n $CDF_NAMESPACE cdfapiserver-postgresql-75ccd5dc97-jmsbs bash</code></li>\n<li>Run the following command to get the cdfapiserver-db user password:<br/>\n<br/>\n<code>get_secret </code>ITOM_DB_API_PASSWD_KEY<br/>\n<br/>\n\tThe output resembles the following. Make a note of the password.<br/>\n\t \n\t<pre>PASS=D22J6HafYh/2Uw==</pre>\n</li>\n<li>Run the following command to log in to the cdfapiserver-db database:<br/>\n<br/>\n<code>psql -U cdfapiserver -d </code>cdfapiserverdb<code> -h localhost</code></li>\n<li>Enter the password that you noted earlier.</li>\n<li>Run the following command to list the deployments:<br/>\n<br/>\n<code>select * from deployment;</code><br/>\n<br/>\n\tThe output should resemble the following:<br/>\n\t \n\t<pre> id | admin_certificate_auth_port | admin_port |      create_time       | deployment_mode | deployment_name | deployment_namespace | deployment_type | external_access_port | deployment_status | suite | suite_version | system_group_id | system_user_id | update_time       | updates |                 uuid                 \n----+-----------------------------+------------+-------------------------+-----------------+-----------------+----------------------+-----------------+----------------------+-------------------+-------+---------------+-----------------+----------------+-------------------------+---------+--------------------------------------\n…….\n  8 | 5444                        | 5443       | 2020-01-09 07:58:07.553 | SUITE           | itsma-FAvGh     | itsma-favgh          | PRIMARY         |                      | NEW               | itsma |       |                 |                | 2020-01-09 07:58:07.553 |       0 | 7793f630-60b0-4389-96e3-c7ff48551906\n…….\n  9 | 5444                        | 5443       | 2020-01-09 07:58:49.167 | SUITE           | itsma-QNJG6     | itsma-qnjg6          | PRIMARY         |                      | NEW               | itsma |        |                 |                | 2020-01-09 07:58:49.167 |       0 | 938cfd2c-be67-4ccf-9186-c8e19f3ff607</pre>\n</li>\n<li>In the output, locate the two records have a \"NEW\" status and \"PRIMARY\" deployment type. Make a note of the namespace of the older record, and then run the following command to update its status to \"DELETED\":<br/>\n<br/>\n<code>update deployment set deployment_status = 'DELETED' where uuid = '&lt;UUID&gt;';</code><br/>\n<br/>\n\tUpdate <code>&lt;UUID&gt;</code> with the value in the \"uuid\" column of the output. For example, you run the following command:<br/>\n<br/>\n<code>update deployment set deployment_status = 'DELETED' where uuid = '7793f630-60b0-4389-96e3-c7ff48551906';</code><br/>\n<br/>\n\tIf only one record in the output has a \"NEW\" status and \"PRIMARY\" deployment type, and another record has an \"INSTALL_FINISHED\" status and \"PRIMARY\" deployment type, follow the same steps for the record with the \"NEW\" status.</li>\n<li>Run the following commands to exit the cdfapiserver-db database pod:<br/>\n<br/>\n<code>\\q</code><br/>\n<code>exit</code></li>\n<li>Run the following commands to delete the redundant namespace:<br/>\n<br/>\n<code>kubectl delete ns &lt;namespace&gt;</code><br/>\n<br/>\n\tFor example:<br/>\n<br/>\n<code>kubectl delete ns itsma-favgh</code></li>\n</ol>\n<p><br/>\n</p>\n<p class=\"mw-empty-elt\"></p><span class=\"snippet-end\" data-sname=\"423-25.4-423-25.3-WaitingUpgradeTimeout||N\"></span></div>",
  "modifiedon": "2025-10-24 08:51:12"
}